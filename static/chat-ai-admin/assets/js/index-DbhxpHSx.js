import{k as t,M as o,N as m,W as e,Y as L,Z as I,U as pe,a7 as U,Q as z,S as s,X as Ct,a6 as Oe,e as g,d as ee,B as Q,G as re,H as _e,u as k,aa as Y,a1 as G,a2 as H,a5 as tt,F as T,$ as K,w as me,l as ot,x as ye,o as Lt,j as Ae,ad as we,ah as Se,D as It,b as be,a0 as Rt,z as st,ac as Ut,V as Et,a9 as Ot,p as At}from"./vue-chunks-BjMuQ6KD.js";import{A as jt,b as B,d as de,B as se,az as Mt,ap as Ye,k as Z,M as X,an as zt,as as Dt,ar as ve,aA as Pt,aB as Nt,a0 as nt,e as Tt,aC as Vt,aD as Ee,E as Te,ay as Bt}from"../../index-CfxQ5aRu.js";import{_ as qe}from"./index-D8Y0HnA5.js";import{C as Qt}from"./cu-upload-ClnFwtpn.js";import"./index-DcUUFn-g.js";import{I as ue}from"./Input-C5WaaE9Z.js";import{_ as Ce}from"./TextArea-CN_AI7y7.js";import{_ as Be}from"./cu-scroll-ClwfOnpN.js";import{e as Ft,g as it,f as Jt,h as Gt}from"./index-W8wCYhw3.js";import{S as je}from"./index-BLP-Fxny.js";import{_ as Ht}from"./index-C3Es6Ui_.js";import{I as Kt}from"./index-ChR9oB9d.js";import{_ as at,F as Ve}from"./index-xqeVJHPz.js";import{S as lt,_ as ct,h as Wt}from"./index-BuS_bfCI.js";import{D as Zt}from"./DownloadOutlined-BrqGknZq.js";import{T as rt,_ as _t}from"./index-BMYKVcHu.js";import{P as Me}from"./PlusOutlined-xiVHYVI8.js";import{D as dt}from"./DownOutlined-Gk0UBxct.js";import{U as Yt}from"./UpOutlined-CY9GinGn.js";import{_ as ne}from"./index-D1MiuDW_.js";import{_ as ie}from"./index-BCGkuM1J.js";import{c as ut}from"./index-d7geF-HW.js";import{C as Xt}from"./index-BWdnNCYH.js";import{_ as pt}from"./index-DVvZbe-E.js";import{_ as ze}from"./index-QsoU6-T8.js";import{Q as oe}from"./QuestionCircleOutlined-Deh272L3.js";import{_ as eo,a as to}from"./index-CeT0BIQm.js";import{S as oo}from"./SearchOutlined-B7dGgS_P.js";import{C as Qe,_ as Fe}from"./index-CxLzlFzW.js";import{S as so}from"./SyncOutlined-DZpJ_zyP.js";import{_ as mt}from"./index-Capld-U4.js";import{_ as no}from"./recommendation-AQ4_FPQ9.js";import{R as io}from"./RightOutlined-BHf0iqSq.js";import{g as vt}from"./index-BERrfq5W.js";import{_ as ht}from"./empty-CzGZrENG.js";import{d as Je}from"./vuedraggable.umd-D6lXKDzo.js";import{M as ao}from"./model-select-c6lAzYs5.js";import"./index-DPiF7UEG.js";import{R as ft,_ as bt}from"./RadioButton-_iRIgmgW.js";import{E as yt}from"./EditOutlined-COZMcG4o.js";import{_ as lo}from"./index-Qxwv7brO.js";import{u as co}from"./robot-Buya70Kq.js";import{i as ro,e as _o,f as uo}from"./index-OIK33vUW.js";import{A as po}from"./add-collaborator-CFHr-dvH.js";import{A as mo}from"./index-DjukszQZ.js";import{U as Xe}from"./UserOutlined-kSSEuP4H.js";import{C as Ne}from"./CheckOutlined-BLsT0eZM.js";import{E as vo}from"./Password-BCnVcrNJ.js";import{_ as ho}from"./index-C-uK-k7U.js";import{a as fo}from"./index-P3IiyBCy.js";import"./axios-Cm0UX6qg.js";import"./qs-DjdPq-RR.js";import"./crypto-js-BemCeW_6.js";import"./dayjs-DK4rpucX.js";import"./FormItemContext-DQ1b1ToO.js";import"./index-D6-G2N0k.js";import"./Search-DozVr2pE.js";import"./isPlainObject-xAKL-sfk.js";import"./inputProps-D7qr__m5.js";import"./index-CXSrVsd0.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./pull-up.esm-JZ91zQ8P.js";import"./observe-dom.esm-DPKTicVt.js";import"./colors-C9XVGyX_.js";import"./Trigger-Dy6Dc2CN.js";import"./responsiveObserve-X1b6Czsg.js";import"./collapseMotion-BH6Vz7El.js";import"./slide-BYYxYcj9.js";import"./move-BjmscfYf.js";import"./index-Bx_z5H0C.js";import"./shallowequal-B6gQS78g.js";import"./dropdown-DsYo-imx.js";import"./pick-CoYCIHvO.js";import"./Checkbox-DQe8ZxR1.js";import"./index-BSl1-tWC.js";import"./index-C38XHIGB.js";import"./useMaxLevel-C9fYQrQA.js";import"./CaretDownFilled-CgS0_Akm.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-qzkQKHcF.js";import"./index-CBvtIVuM.js";import"./CaretDownOutlined-Qu8nVykI.js";var bo={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885 780H165c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM400 325.7h73.9V664c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V325.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 171a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13z"}}]},name:"to-top",theme:"outlined"};const yo=bo;function et(u){for(var c=1;c<arguments.length;c++){var f=arguments[c]!=null?Object(arguments[c]):{},v=Object.keys(f);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(f).filter(function(p){return Object.getOwnPropertyDescriptor(f,p).enumerable}))),v.forEach(function(p){ko(u,p,f[p])})}return u}function ko(u,c,f){return c in u?Object.defineProperty(u,c,{value:f,enumerable:!0,configurable:!0,writable:!0}):u[c]=f,u}var Ge=function(c,f){var v=et({},c,f.attrs);return t(jt,et({},v,{icon:yo}),null)};Ge.displayName="ToTopOutlined";Ge.inheritAttrs=!1;const go=Ge,$o={class:"edit-box-header"},xo={class:"left-box"},wo={class:"edit-box-title"},So={key:0},qo={key:0,class:"title-tip"},Co={class:"right-box"},Lo={class:"extra-box"},Io={class:"actions-box"},Ro={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(u,{emit:c}){const f=c,v=u,p=_=>{f("edit"),f("update:isEdit",_)},n=()=>{f("save")};return(_,y)=>{const l=de,d=se,w=qe;return o(),m("div",{class:Oe(["edit-box",{"is-edit":u.isEdit}])},[e("div",$o,[e("div",xo,[t(l,{class:"edit-box-icon",name:v.iconName},null,8,["name"]),e("span",wo,[L(I(v.title)+" ",1),_.$slots.icon?(o(),m("span",So,[pe(_.$slots,"icon",{},void 0,!0)])):U("",!0)]),_.$slots.tip?(o(),m("span",qo,[pe(_.$slots,"tip",{},void 0,!0)])):U("",!0)]),e("div",Co,[e("div",Lo,[pe(_.$slots,"extra",{},()=>[e("div",Io,[v.isEdit?(o(),z(w,{key:0,gap:8},{default:s(()=>[t(d,{onClick:n,size:"small",type:"primary"},{default:s(()=>[L("保存")]),_:1}),t(d,{onClick:y[0]||(y[0]=i=>p(!1)),size:"small"},{default:s(()=>[L("取消")]),_:1})]),_:1})):(o(),z(d,{key:1,onClick:y[1]||(y[1]=i=>p(!0)),size:"small"},{default:s(()=>[L("修改")]),_:1}))])],!0)])])]),e("div",{class:"edit-box-body",style:Ct({...u.bodyStyle})},[pe(_.$slots,"default",{},void 0,!0)],4)],2)}}},te=B(Ro,[["__scopeId","data-v-dbe09743"]]),kt=u=>(G("data-v-899bcb03"),u=u(),H(),u),Uo={class:"robot-form-box"},Eo={class:"form-item"},Oo=kt(()=>e("div",{class:"form-item-label"},"机器人名称/头像",-1)),Ao={class:"form-item-body robot-name-item"},jo={class:"robot-avetar-upload"},Mo=["src"],zo={class:"robot-name-box"},Do={class:"form-item"},Po=kt(()=>e("div",{class:"form-item-label"},"简介",-1)),No={class:"form-item-body"},To={class:"robot-info-box"},Vo={class:"robot-name-box"},Bo=["src"],Qo={class:"robot-name"},Fo={class:"robot-intro"},Jo={__name:"basic-config",setup(u){const c=g(!1),{robotInfo:f,updateRobotInfo:v}=ee("robotInfo"),p=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=()=>{v({...Y(p)}),c.value=!1},_=l=>{let d=l[0];return p.robot_avatar=d,Mt(d).then(w=>{p.robot_avatar_url=w}),!1},y=()=>{p.robot_name=f.robot_name,p.robot_intro=f.robot_intro,p.robot_avatar=f.robot_avatar,p.robot_avatar_url=f.robot_avatar_url};return(l,d)=>{const w=ue,i=Ce;return o(),z(te,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:c.value,"onUpdate:isEdit":d[2]||(d[2]=r=>c.value=r),onSave:n,onEdit:y},{default:s(()=>[re(e("div",Uo,[e("div",Eo,[Oo,e("div",Ao,[t(Qt,{accept:"image/*",onChange:_},{default:s(()=>[e("div",jo,[p.robot_avatar_url?(o(),m("img",{key:0,class:"robot-avetar",src:p.robot_avatar_url},null,8,Mo)):U("",!0)])]),_:1}),e("div",zo,[t(w,{value:p.robot_name,"onUpdate:value":d[0]||(d[0]=r=>p.robot_name=r),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",Do,[Po,e("div",No,[t(i,{rows:3,value:p.robot_intro,"onUpdate:value":d[1]||(d[1]=r=>p.robot_intro=r),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[_e,c.value]]),re(e("div",To,[e("div",Vo,[e("img",{class:"robot-avatar",src:k(f).robot_avatar_url,alt:""},null,8,Bo),e("span",Qo,I(k(f).robot_name),1)]),e("div",Fo,I(k(f).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[_e,!c.value]])]),_:1},8,["isEdit"])}}},Go=B(Jo,[["__scopeId","data-v-899bcb03"]]),gt=u=>(G("data-v-896a48d0"),u=u(),H(),u),Ho={class:"ai-create-box"},Ko={class:"input-box"},Wo=gt(()=>e("span",null,"生成",-1)),Zo={class:"quick-tags-box"},Yo=gt(()=>e("div",{class:"quick-label"},"快捷生成：",-1)),Xo={class:"ai-list-box"},es={key:0,class:"loading-box"},ts={key:0,class:"prompt-list-box"},os={class:"prompt-list"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={class:"prompt-content"},as={class:"prompt-list"},ls={class:"prompt-header"},cs={class:"prompt-title"},rs={class:"prompt-content"},_s={class:"prompt-list"},ds={class:"prompt-header"},us={class:"prompt-title"},ps={class:"prompt-content"},ms={class:"prompt-list"},vs={class:"prompt-header"},hs={class:"prompt-title"},fs={class:"prompt-content"},bs={class:"prompt-list"},ys={class:"prompt-header"},ks={class:"prompt-title"},gs={class:"prompt-content"},$s={class:"prompt-header"},xs={class:"prompt-title"},ws={class:"prompt-content"},Ss={key:1,class:"empty-box"},qs={__name:"ai-create-prompt",emits:["handleAiSave"],setup(u,{expose:c,emit:f}){const v=Ye.PRESENTED_IMAGE_SIMPLE,p=g(!1),n=g(!1),_=tt().query,y=f,l=g(""),d=g(!1),w=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],i=g("在上方输入框输入要求，点击生成提示词"),r=()=>{a.value=!1,x.promptStruct=$,l.value="",i.value="在上方输入框输入要求，点击生成提示词",p.value=!0},a=g(!1),$={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},x=Q({promptStruct:$}),R=C=>{l.value=C},b=()=>{if(!l.value)return Z.error("请输入AI 生成提示词");if(d.value)return Z.error("正在生成中...");d.value=!0,Ft({id:_.id,demand:l.value}).then(C=>{x.promptStruct=JSON.parse(C.data.promptStruct),a.value=!0}).finally(()=>{d.value=!1}).catch(C=>{a.value=!1,i.value=C.msg})},S=()=>{if(!a.value)return Z.error("请先生成提示词");y("handleAiSave",x.promptStruct),p.value=!1};return c({show:r}),(C,h)=>{const O=se,F=ue,j=de,q=Ht,P=je,J=Ye,D=Be,W=X;return o(),m("div",null,[t(W,{open:p.value,"onUpdate:open":h[1]||(h[1]=N=>p.value=N),title:"AI 生成提示词",width:746},{footer:s(()=>[t(O,{type:"primary",loading:n.value,onClick:S},{default:s(()=>[L("使用该提示")]),_:1},8,["loading"])]),default:s(()=>[e("div",Ho,[e("div",Ko,[t(F,{style:{width:"100%"},value:l.value,"onUpdate:value":h[0]||(h[0]=N=>l.value=N),size:"large",onPressEnter:b,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:b},[t(j,{name:"ai-mark"}),Wo])]),e("div",Zo,[Yo,(o(),m(T,null,K(w,N=>t(q,{key:N.title,onClick:M=>R(N.title),color:"blue"},{default:s(()=>[L(I(N.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Xo,[t(D,{style:{height:"100%"}},{default:s(()=>[d.value?(o(),m("div",es,[t(P,{tip:"正在生成中..."})])):(o(),m(T,{key:1},[a.value?(o(),m("div",ts,[e("div",os,[e("div",ss,[e("div",ns,I(x.promptStruct.role.subject),1)]),e("div",is,I(x.promptStruct.role.describe),1)]),e("div",as,[e("div",ls,[e("div",cs,I(x.promptStruct.task.subject),1)]),e("div",rs,I(x.promptStruct.task.describe),1)]),e("div",_s,[e("div",ds,[e("div",us,I(x.promptStruct.constraints.subject),1)]),e("div",ps,I(x.promptStruct.constraints.describe),1)]),e("div",ms,[e("div",vs,[e("div",hs,I(x.promptStruct.output.subject),1)]),e("div",fs,I(x.promptStruct.output.describe),1)]),e("div",bs,[e("div",ys,[e("div",ks,I(x.promptStruct.tone.subject),1)]),e("div",gs,I(x.promptStruct.tone.describe),1)]),(o(!0),m(T,null,K(x.promptStruct.custom,(N,M)=>(o(),m("div",{class:"prompt-list",key:M+N.key?N.key:""},[e("div",$s,[e("div",xs,I(N.subject),1)]),e("div",ws,I(N.describe),1)]))),128))])):(o(),m("div",Ss,[t(J,{image:k(v),description:i.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},Cs=B(qs,[["__scopeId","data-v-896a48d0"]]),Ls={__name:"upload-prompt",setup(u,{expose:c}){const f=g(!1),v=Q({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),p=g(null),n=w=>{if(w.prompt_type==0&&!w.prompt)return Z.error("自定义提示为空,无法上传");p.value&&p.value.resetFields();let i={...w};v.title="",v.group_id=0,v.prompt="",v.prompt_struct={},v.prompt_type=i.prompt_type,i.prompt_type==0?v.prompt=i.prompt:v.prompt_struct=JSON.stringify(i.prompt_struct),f.value=!0},_=g([]);(()=>{zt().then(w=>{_.value=[{id:0,group_name:"默认分组"},...w.data]})})();const l=g(!1),d=()=>{p.value.validate().then(()=>{let w={...v};l.value=!0,Dt({...w}).then(()=>{Z.success("保存成功"),f.value=!1}).finally(()=>{l.value=!1})})};return c({show:n}),(w,i)=>{const r=ue,a=at,$=lt,x=ct,R=Ve,b=X;return o(),m("div",null,[t(b,{open:f.value,"onUpdate:open":i[2]||(i[2]=S=>f.value=S),title:"保存到提示词库",width:580,onOk:d,confirmLoading:l.value},{default:s(()=>[t(R,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:p,model:v},{default:s(()=>[t(a,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:s(()=>[t(r,{value:v.title,"onUpdate:value":i[0]||(i[0]=S=>v.title=S),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(a,{name:"group_id",label:"分组"},{default:s(()=>[t(x,{value:v.group_id,"onUpdate:value":i[1]||(i[1]=S=>v.group_id=S),style:{width:"100%"}},{default:s(()=>[(o(!0),m(T,null,K(_.value,S=>(o(),z($,{value:S.id},{default:s(()=>[L(I(S.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},Is={class:"prompt-box"},Rs={class:"tab-header"},Us={key:0,class:"opt-block"},Es={key:1,class:"opt-block"},Os={class:"tip-text"},As={key:0,class:"prompt-list-box"},js={class:"prompt-list"},Ms={class:"prompt-header"},zs={class:"prompt-title"},Ds={key:0,class:"btn-wrapper-box"},Ps={class:"prompt-content"},Ns={class:"prompt-list"},Ts={class:"prompt-header"},Vs={class:"prompt-title"},Bs={key:0,class:"btn-wrapper-box"},Qs={class:"prompt-content"},Fs={class:"prompt-list"},Js={class:"prompt-header"},Gs={class:"prompt-title"},Hs={key:0,class:"btn-wrapper-box"},Ks={class:"prompt-content"},Ws={class:"prompt-list"},Zs={class:"prompt-header"},Ys={class:"prompt-title"},Xs={key:0,class:"btn-wrapper-box"},en={class:"prompt-content"},tn={class:"prompt-list"},on={class:"prompt-header"},sn={class:"prompt-title"},nn={key:0,class:"btn-wrapper-box"},an={class:"swich-item"},ln={class:"swich-item"},cn={class:"prompt-content"},rn={class:"prompt-list"},_n={class:"prompt-header"},dn={class:"prompt-title"},un={key:0,class:"btn-wrapper-box"},pn={class:"prompt-content"},mn={class:"prompt-header"},vn={class:"prompt-title",style:{flex:"1"}},hn={key:0,class:"btn-wrapper-box"},fn=["onClick"],bn={class:"prompt-content"},yn={key:0,class:"add-theme-block"},kn={class:"show-more-block"},gn={key:1,class:"diy-prompt-box"},$n={key:0,class:"diy-switch-box"},xn={class:"swich-item"},wn={class:"swich-item"},le="- 请使用markdown格式回答问题。",ce="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",Sn={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(u){const c=g(!1),{robotInfo:f,updateRobotInfo:v}=ee("robotInfo"),p=u;let n={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const _=g({}),y=g(!1),l=g(!1),d=g(!1),w=g(!1),i=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),r=g(localStorage.getItem("system_prompt_words_ishide")=="1"),a=()=>{r.value=!r.value,localStorage.setItem("system_prompt_words_ishide",r.value?1:0)},$=(V,E)=>V.includes(E),x=g(f.prompt_type);me(()=>f,()=>{i.prompt=f.prompt,i.prompt_struct=f.prompt_struct,_.value=f.prompt_struct_default},{immediate:!0,deep:!0}),me(()=>i.prompt_struct.output.describe,V=>{y.value=$(V,le),l.value=$(V,ce)},{immediate:!0,deep:!0}),me(()=>i.prompt,V=>{d.value=$(V,le),w.value=$(V,ce)},{immediate:!0,deep:!0});const R=(V,E)=>{V?(E=="outSwitch"&&(i.prompt_struct.output.describe?i.prompt_struct.output.describe+=`
`+le:i.prompt_struct.output.describe+=le),E=="imgSwitch"&&(i.prompt_struct.output.describe?i.prompt_struct.output.describe+=`
`+ce:i.prompt_struct.output.describe+=ce)):(E=="outSwitch"&&(i.prompt_struct.output.describe=i.prompt_struct.output.describe.replace(new RegExp(le,"g"),"")),E=="imgSwitch"&&(i.prompt_struct.output.describe=i.prompt_struct.output.describe.replace(new RegExp(ce,"g"),"")),i.prompt_struct.output.describe=i.prompt_struct.output.describe.trim())},b=(V,E)=>{V?(E=="outDiySwitch"&&(i.prompt?i.prompt+=`
`+le:i.prompt+=le),E=="imgDiySwitch"&&(i.prompt?i.prompt+=`
`+ce:i.prompt+=ce)):(E=="outDiySwitch"&&(i.prompt=i.prompt.replace(new RegExp(le,"g"),"")),E=="imgDiySwitch"&&(i.prompt=i.prompt.replace(new RegExp(ce,"g"),"")),i.prompt=i.prompt.trim())},S=V=>{i.prompt_struct[V].describe=_.value[V].describe},C=()=>{let V=f.work_flow_ids.split(","),E=p.robotList.filter(fe=>V.includes(fe.id)),xe=[];xe=E.map(fe=>`- ${fe.robot_name} ${fe.robot_intro}`).join(`
`),i.prompt_struct.skill.describe=xe},h=()=>{i.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),x.value=1},O=V=>{i.prompt_struct.custom.splice(V,1)},F=()=>{v({...Y(i),prompt_type:x.value}),c.value=!1},j=V=>{x.value=1,v({prompt_type:x.value,prompt:i.prompt,prompt_struct:V}),c.value=!1},q=()=>{c.value=!0},P=()=>{c.value=!1},J=g(null),D=()=>{J.value.show()},W=g(null),N=()=>{W.value.show()},M=g(null),$e=()=>{M.value.show({...i,prompt_type:x.value})},Pe=V=>{V.prompt_type==1?(x.value=1,i.prompt_struct=V.prompt_struct):(x.value=0,i.prompt=V.prompt),F()};return(V,E)=>{const xe=_t,fe=rt,We=ne,wt=de,Ie=se,St=qe,ae=Ce,Re=ie,qt=ue;return o(),m("div",Is,[e("div",Rs,[t(fe,{activeKey:x.value,"onUpdate:activeKey":E[0]||(E[0]=A=>x.value=A)},{default:s(()=>[(o(),z(xe,{key:1,tab:"结构化提示词"})),(o(),z(xe,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),c.value?(o(),m("div",Us,[t(We,null,{title:s(()=>[L("将当前编辑的提示词保存到提示词库中")]),default:s(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:$e},[t(k(go)),L("上传 ")])]),_:1}),t(We,null,{title:s(()=>[L("从提示词库导入提示词")]),default:s(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:N},[t(k(Zt)),L("导入 ")])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:D},[t(wt,{name:"ai-mark"}),L(" AI自动生成 ")]),t(St,{gap:8},{default:s(()=>[t(Ie,{size:"small",type:"primary",onClick:F},{default:s(()=>[L("保存")]),_:1}),t(Ie,{size:"small",onClick:P},{default:s(()=>[L("取消")]),_:1})]),_:1})])):(o(),m("div",Es,[e("span",Os,"当前类型："+I(x.value==1?"结构化提示词":"自定义提示词"),1),t(Ie,{size:"small",onClick:q},{default:s(()=>[L("修改")]),_:1})]))]),x.value==1?(o(),m("div",As,[e("div",js,[e("div",Ms,[e("div",zs,I(i.prompt_struct.role.subject),1),c.value?(o(),m("div",Ds,[e("a",{onClick:E[1]||(E[1]=A=>S("role"))},"恢复默认")])):U("",!0)]),e("div",Ps,[t(ae,{bordered:!1,disabled:!c.value,value:i.prompt_struct.role.describe,"onUpdate:value":E[2]||(E[2]=A=>i.prompt_struct.role.describe=A),placeholder:k(n).role},null,8,["disabled","value","placeholder"])])]),e("div",Ns,[e("div",Ts,[e("div",Vs,I(i.prompt_struct.task.subject),1),c.value?(o(),m("div",Bs,[e("a",{onClick:E[3]||(E[3]=A=>S("task"))},"恢复默认")])):U("",!0)]),e("div",Qs,[t(ae,{bordered:!1,disabled:!c.value,value:i.prompt_struct.task.describe,"onUpdate:value":E[4]||(E[4]=A=>i.prompt_struct.task.describe=A),placeholder:k(n).task},null,8,["disabled","value","placeholder"])])]),r.value?(o(),m(T,{key:0},[e("div",Fs,[e("div",Js,[e("div",Gs,I(i.prompt_struct.constraints.subject),1),c.value?(o(),m("div",Hs,[e("a",{onClick:E[5]||(E[5]=A=>S("constraints"))},"恢复默认")])):U("",!0)]),e("div",Ks,[t(ae,{bordered:!1,disabled:!c.value,value:i.prompt_struct.constraints.describe,"onUpdate:value":E[6]||(E[6]=A=>i.prompt_struct.constraints.describe=A),placeholder:k(n).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",Ws,[e("div",Zs,[e("div",Ys,I(i.prompt_struct.skill.subject),1),c.value?(o(),m("div",Xs,[e("a",{onClick:E[7]||(E[7]=A=>C())},"自动导入技能")])):U("",!0)]),e("div",en,[t(ae,{bordered:!1,disabled:!c.value,value:i.prompt_struct.skill.describe,"onUpdate:value":E[8]||(E[8]=A=>i.prompt_struct.skill.describe=A),placeholder:k(n).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",tn,[e("div",on,[e("div",sn,I(i.prompt_struct.output.subject),1),c.value?(o(),m("div",nn,[e("div",an,[L(" 输出markdown： "),t(Re,{onChange:E[9]||(E[9]=A=>R(A,"outSwitch")),checked:y.value,"onUpdate:checked":E[10]||(E[10]=A=>y.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",ln,[L(" 回复图片： "),t(Re,{onChange:E[11]||(E[11]=A=>R(A,"imgSwitch")),checked:l.value,"onUpdate:checked":E[12]||(E[12]=A=>l.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:E[13]||(E[13]=A=>S("output"))},"恢复默认")])):U("",!0)]),e("div",cn,[t(ae,{bordered:!1,disabled:!c.value,value:i.prompt_struct.output.describe,"onUpdate:value":E[14]||(E[14]=A=>i.prompt_struct.output.describe=A),placeholder:k(n).output},null,8,["disabled","value","placeholder"])])]),e("div",rn,[e("div",_n,[e("div",dn,I(i.prompt_struct.tone.subject),1),c.value?(o(),m("div",un,[e("a",{onClick:E[15]||(E[15]=A=>S("tone"))},"恢复默认")])):U("",!0)]),e("div",pn,[t(ae,{bordered:!1,disabled:!c.value,value:i.prompt_struct.tone.describe,"onUpdate:value":E[16]||(E[16]=A=>i.prompt_struct.tone.describe=A),placeholder:k(n).tone},null,8,["disabled","value","placeholder"])])]),(o(!0),m(T,null,K(i.prompt_struct.custom,(A,Ze)=>(o(),m("div",{class:"prompt-list",key:Ze+A.key?A.key:""},[e("div",mn,[e("div",vn,[t(qt,{bordered:!1,disabled:!c.value,style:{width:"100%"},value:A.subject,"onUpdate:value":Ue=>A.subject=Ue,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),c.value?(o(),m("div",hn,[e("div",{class:"hover-btn-box",onClick:Ue=>O(Ze)},[t(k(ve))],8,fn)])):U("",!0)]),e("div",bn,[t(ae,{bordered:!1,disabled:!c.value,value:A.describe,"onUpdate:value":Ue=>A.describe=Ue,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),c.value?(o(),m("div",yn,[t(Ie,{onClick:h,block:"",icon:ot(k(Me))},{default:s(()=>[L("添加主题")]),_:1},8,["icon"])])):U("",!0)],64)):U("",!0),e("div",kn,[e("div",{class:"btn-item",onClick:a},[r.value?(o(),m(T,{key:1},[L("收起"),t(k(Yt))],64)):(o(),m(T,{key:0},[L("展开"),t(k(dt))],64))])])])):(o(),m("div",gn,[c.value?(o(),m("div",$n,[e("div",xn,[L(" 输出markdown： "),t(Re,{size:"small",onChange:E[17]||(E[17]=A=>b(A,"outDiySwitch")),checked:d.value,"onUpdate:checked":E[18]||(E[18]=A=>d.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",wn,[L(" 回复图片： "),t(Re,{size:"small",onChange:E[19]||(E[19]=A=>b(A,"imgDiySwitch")),checked:w.value,"onUpdate:checked":E[20]||(E[20]=A=>w.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):U("",!0),t(ae,{bordered:c.value,value:i.prompt,"onUpdate:value":E[21]||(E[21]=A=>i.prompt=A),disabled:!c.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(Cs,{onHandleAiSave:j,ref_key:"aiCreatePromptRef",ref:J},null,512),t(Kt,{onOk:Pe,ref_key:"importPromptRef",ref:W},null,512),t(Ls,{ref_key:"uploadPromptRef",ref:M},null,512)])}}},qn=B(Sn,[["__scopeId","data-v-c1235ef1"]]),ke=u=>(G("data-v-325217de"),u=u(),H(),u),Cn={class:"actions-box"},Ln={class:"setting-info-block"},In={class:"set-item w-100"},Rn={key:0,class:"set-item-content"},Un=["src"],En={key:1},On={class:"set-item"},An={class:"set-item"},jn={class:"set-item"},Mn={class:"set-item"},zn={class:"form-box"},Dn={class:"form-item"},Pn=ke(()=>e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),Nn={class:"form-item-body"},Tn={class:"form-item"},Vn={class:"form-item-label"},Bn=ke(()=>e("span",null,"温度 ",-1)),Qn={class:"form-item-body"},Fn={class:"number-box"},Jn={class:"number-slider-box"},Gn={class:"number-input-box"},Hn={class:"form-item"},Kn={class:"form-item-label"},Wn=ke(()=>e("span",null,"最大token ",-1)),Zn={class:"form-item-body"},Yn={class:"number-box"},Xn={class:"number-slider-box"},ei={class:"number-input-box"},ti={class:"form-item"},oi={class:"form-item-label"},si=ke(()=>e("span",null,"上下文数量 ",-1)),ni={class:"form-item-body"},ii={class:"number-box"},ai={class:"number-slider-box"},li={class:"number-input-box"},ci={class:"form-item justify-between"},ri={class:"form-item-label"},_i=ke(()=>e("span",null,"显示推理过程 ",-1)),di=ke(()=>e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)),ui={__name:"model-settings",setup(u){const c=["azure","ollama","xinference","openaiAgent","doubao"],f=["doubao"],v=["azure"],p=Q({sm:24,md:24,lg:12,xl:24,xxl:24}),n=g([]),_=g(!1),{robotInfo:y,updateRobotInfo:l}=ee("robotInfo"),d=Q({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),w=g(""),i=g(""),r=g(""),a=h=>{d.use_model=c.includes(h.rawData.model_define)&&h.rawData.deployment_name?h.rawData.show_model_name||h.rawData.deployment_name:h.rawData.name,d.use_model_icon=h.icon,d.use_model_name=h.use_model_name,d.model_config_id=h.rawData.id,w.value=h.rawData.model_define},$=g(!1),x=h=>{h.target.closest(".custom-select")||($.value=!1)};ye(()=>{c.indexOf(w.value)>-1?d.use_model=r.value:d.use_model=y.use_model,document.addEventListener("click",x)}),Lt(()=>{document.removeEventListener("click",x)});const R=()=>{r.value=d.use_model;let h={...Y(d)};v.indexOf(w.value)>-1&&(h.use_model="默认"),l(h),_.value=!1},b=h=>{h||(w.value=i.value),c.indexOf(w.value)>-1?d.use_model=r.value:d.use_model=y.use_model,d.model_config_id=y.model_config_id,d.temperature=y.temperature,d.max_token=y.max_token,d.context_pair=y.context_pair,d.think_switch=Number(y.think_switch),_.value=h};Ae(()=>{d.model_config_id=y.model_config_id,d.temperature=y.temperature,d.max_token=y.max_token,d.context_pair=y.context_pair,d.think_switch=Number(y.think_switch)});function S(h,O,F){const j=new Set(h.map(q=>q.model_define));return O.filter(q=>{let P=q[F];j.has(P)&&h.filter(J=>{if(J.model_define==P)return J.children=Nt(J.children,q.children),!1})}),h}return(()=>{ut({model_type:"LLM"}).then(h=>{r.value=y.use_model;let O=h.data||[],F=[];n.value=O.map(j=>{F=[];for(let q=0;q<j.model_info.llm_model_list.length;q++){const P=j.model_info.llm_model_list[q];c.indexOf(j.model_info.model_define)>-1&&y.model_config_id==j.model_config.id&&(r.value=j.model_config.show_model_name||j.model_config.deployment_name,w.value=j.model_info.model_define,i.value=j.model_info.model_define),F.push({name:P,deployment_name:j.model_config.deployment_name,show_model_name:f.includes(j.model_info.model_define)?j.model_config.show_model_name:"",id:j.model_config.id,model_define:j.model_info.model_define,icon:j.model_info.model_icon_url,use_model_name:j.model_info.model_name})}return{id:j.model_config.id,name:j.model_info.model_name,model_define:j.model_info.model_define,icon:j.model_info.model_icon_url,children:F,deployment_name:j.model_config.deployment_name}}),n.value=S(Pt(n.value,"model_define"),n.value,"model_define"),y.use_model&&y.model_config_id&&n.value.some(j=>j.children.some(q=>{const P=c.includes(q.model_define)&&q.deployment_name?q.deployment_name:q.name;if(c.includes(q.model_define)&&q.deployment_name&&q.id===y.model_config_id)return d.use_model_icon=q.icon,d.use_model_name=q.use_model_name,d.use_model=q.show_model_name||q.deployment_name,!0;if(P===y.use_model&&q.id===y.model_config_id)return d.use_model_icon=q.icon,d.use_model_name=q.use_model_name,!0}))})})(),(h,O)=>{const F=se,j=eo,q=ne,P=pt,J=ze,D=ie,W=to,N=X;return o(),z(te,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:_.value,"onUpdate:isEdit":O[10]||(O[10]=M=>_.value=M)},{extra:s(()=>[e("div",Cn,[t(F,{onClick:O[0]||(O[0]=M=>b(!0)),size:"small"},{default:s(()=>[L("修改")]),_:1})])]),default:s(()=>[e("div",Ln,[e("div",In,[L(" LLM模型： "),d.use_model_icon&&d.use_model_name?(o(),m("span",Rn,[e("img",{src:d.use_model_icon,class:"model-icon"},null,8,Un),L(I(d.use_model_name)+" "+I(d.use_model),1)])):(o(),m("span",En,I(d.use_model),1))]),e("div",On,[L(" 温度： "),e("span",null,I(d.temperature),1)]),e("div",An,[L(" 最大token： "),e("span",null,I(d.max_token),1)]),e("div",jn,[L(" 上下文数量： "),e("span",null,I(d.context_pair),1)]),e("div",Mn,[L(" 显示推理过程： "),e("span",null,I(d.think_switch==1?"开":"关"),1)])]),t(N,{open:_.value,"onUpdate:open":O[9]||(O[9]=M=>_.value=M),width:672,title:"模型设置",onOk:R},{default:s(()=>[e("div",zn,[t(W,{gutter:[32,24]},{default:s(()=>[t(j,we(Se(p)),{default:s(()=>[e("div",Dn,[Pn,e("div",Nn,[t(Xt,{modelValue:d.use_model,"onUpdate:modelValue":O[1]||(O[1]=M=>d.use_model=M),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":d.model_config_id,onChange:a},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(j,we(Se(p)),{default:s(()=>[e("div",Tn,[e("div",Vn,[Bn,t(q,null,{title:s(()=>[L("温度越低，回答越严谨。温度越高，回答越发散。")]),default:s(()=>[t(k(oe),{class:"question-icon"})]),_:1})]),e("div",Qn,[e("div",Fn,[e("div",Jn,[t(P,{class:"custom-slider",value:d.temperature,"onUpdate:value":O[2]||(O[2]=M=>d.temperature=M),min:0,max:2,step:.1},null,8,["value"])]),e("div",Gn,[t(J,{value:d.temperature,"onUpdate:value":O[3]||(O[3]=M=>d.temperature=M),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(j,we(Se(p)),{default:s(()=>[e("div",Hn,[e("div",Kn,[Wn,t(q,null,{title:s(()=>[L("问题+答案的最大token数，如果出现回答被截断，可调高此值")]),default:s(()=>[t(k(oe),{class:"question-icon"})]),_:1})]),e("div",Zn,[e("div",Yn,[e("div",Xn,[t(P,{class:"custom-slider",value:d.max_token,"onUpdate:value":O[4]||(O[4]=M=>d.max_token=M),min:0,max:100*1024},null,8,["value"])]),e("div",ei,[t(J,{value:d.max_token,"onUpdate:value":O[5]||(O[5]=M=>d.max_token=M),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(j,we(Se(p)),{default:s(()=>[e("div",ti,[e("div",oi,[si,t(q,null,{title:s(()=>[L("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")]),default:s(()=>[t(k(oe),{class:"question-icon"})]),_:1})]),e("div",ni,[e("div",ii,[e("div",ai,[t(P,{class:"custom-slider",value:d.context_pair,"onUpdate:value":O[6]||(O[6]=M=>d.context_pair=M),min:0,max:50},null,8,["value"])]),e("div",li,[t(J,{value:d.context_pair,"onUpdate:value":O[7]||(O[7]=M=>d.context_pair=M),min:0,max:50},null,8,["value"])])])])])]),_:1},16),t(j,we(Se(p)),{default:s(()=>[e("div",ci,[e("div",ri,[_i,t(q,null,{title:s(()=>[di]),default:s(()=>[t(k(oe),{class:"question-icon"})]),_:1})]),t(D,{checked:d.think_switch,"onUpdate:checked":O[8]||(O[8]=M=>d.think_switch=M),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},pi=B(ui,[["__scopeId","data-v-325217de"]]),mi={class:"library-checkbox-box"},vi={class:"list-tools"},hi={class:"list-box",ref:"scrollContainer"},fi={class:"library-name"},bi={class:"library-desc"},yi={__name:"library-select-alert",emits:["change"],setup(u,{expose:c,emit:f}){const v=f,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),n=g(!1),_=R=>{r(),p.checkedList=R,n.value=!0},y=()=>{n.value=!1,i()},l=g(""),d=()=>{r()},w=g([]),i=()=>{v("change",[...p.checkedList])},r=async()=>{const R=await nt({library_name:l.value,type:"",show_open_docs:1});if(R){let b=R.data||[];w.value=b}},a=g(!1),$=async()=>{a.value=!0,await r(),a.value=!1,Z.success("刷新完成")},x=()=>{window.open("/#/library/list")};return c({open:_}),(R,b)=>{const S=mt,C=ue,h=se,O=Qe,F=Fe,j=je,q=X;return o(),z(q,{width:"746px",open:n.value,"onUpdate:open":b[2]||(b[2]=P=>n.value=P),title:"关联知识库",onOk:y},{default:s(()=>[e("div",mi,[t(S,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",vi,[e("div",null,[t(C,{style:{width:"282px"},value:l.value,"onUpdate:value":b[0]||(b[0]=P=>l.value=P),placeholder:"请输入知识库名称搜索",onChange:d},{suffix:s(()=>[t(k(oo),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(h,{style:{"margin-right":"8px"},onClick:$},{default:s(()=>[t(k(so)),L(" 刷新 ")]),_:1}),t(h,{type:"primary",ghost:"",onClick:x},{default:s(()=>[L("新建知识库")]),_:1})])]),t(j,{spinning:a.value,delay:100},{default:s(()=>[t(F,{value:p.checkedList,"onUpdate:value":b[1]||(b[1]=P=>p.checkedList=P),style:{width:"100%"}},{default:s(()=>[e("div",hi,[(o(!0),m(T,null,K(w.value,P=>(o(),m("div",{class:"list-item-wraapper",key:P.id},[t(O,{class:"list-item",value:P.id},{default:s(()=>[e("div",fi,I(P.library_name),1),e("div",bi,I(P.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},ki=B(yi,[["__scopeId","data-v-917767e7"]]),De=u=>(G("data-v-a2abcb20"),u=u(),H(),u),gi={class:"recall-settings-box"},$i={class:"form-box"},xi={class:"form-item is-required"},wi=De(()=>e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),Si={class:"form-item-body"},qi={class:"retrieval-mode-items"},Ci=["onClick"],Li={class:"retrieval-mode-title"},Ii={class:"title-text"},Ri={key:0,style:{width:"32px"},src:no,alt:""},Ui={class:"retrieval-mode-desc"},Ei={class:"form-item"},Oi={class:"form-item-label"},Ai=De(()=>e("span",null,"Top K ",-1)),ji={class:"form-item-body"},Mi={class:"number-box"},zi={class:"number-slider-box"},Di={class:"number-input-box"},Pi={key:0,class:"form-item"},Ni={class:"form-item-label"},Ti=De(()=>e("span",null,"相似度阈值 ",-1)),Vi={class:"form-item-body"},Bi={class:"number-box"},Qi={class:"number-slider-box"},Fi={class:"number-input-box"},Ji={class:"form-item"},Gi={class:"form-item-label"},Hi=De(()=>e("span",null,"Rerank模型",-1)),Ki={key:0,class:"form-item-body"},Wi=["src"],Zi={__name:"recall-settings-alert",emits:["change"],setup(u,{expose:c,emit:f}){const v=f,p=g([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),n=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),_=g(!1),y=R=>{x(),n.rerank_status=R.rerank_status||0,n.rerank_use_model=R.rerank_use_model||void 0,n.rerank_model_config_id=R.rerank_model_config_id>0?R.rerank_model_config_id:"",n.top_k=R.top_k,n.similarity=R.similarity,n.search_type=R.search_type,_.value=!0},l=(R,b)=>{if(!R||!b){n.rerank_model_config_id="";return}n.rerank_model_config_id=b.rerank_model_config_id},d=R=>{R==0&&(n.rerank_model_config_id="",n.rerank_use_model="")},w=R=>{n.search_type=R},i=()=>n.rerank_status==1&&!n.rerank_model_config_id,r=()=>{if(i())return Z.error("请选择Rerank模型");_.value=!1,a()},a=()=>{v("change",Y(n))},$=g([]),x=()=>{ut({model_type:"RERANK"}).then(R=>{let b=R.data||[];$.value=b.map(S=>({id:S.model_config.id,name:S.model_info.model_name,icon:S.model_info.model_icon_url,children:S.model_info.rerank_model_list}))})};return c({open:y}),(R,b)=>{const S=de,C=ne,h=pt,O=ze,F=ie,j=lt,q=Wt,P=ct,J=X;return o(),z(J,{width:"746px",open:_.value,"onUpdate:open":b[6]||(b[6]=D=>_.value=D),title:"召回设置",onOk:r},{default:s(()=>[e("div",gi,[e("div",$i,[e("div",xi,[wi,e("div",Si,[e("div",qi,[(o(!0),m(T,null,K(p.value,D=>(o(),m("div",{class:Oe(["retrieval-mode-item",{active:n.search_type==D.value}]),key:D.value,onClick:W=>w(D.value)},[n.search_type==D.value?(o(),z(S,{key:0,class:"check-arrow",name:"check-arrow-filled"})):U("",!0),e("div",Li,[t(S,{name:D.iconName,class:"title-icon"},null,8,["name"]),e("span",Ii,I(D.title),1),D.isRecommendation?(o(),m("img",Ri)):U("",!0)]),e("div",Ui,I(D.desc),1)],10,Ci))),128))])])]),e("div",Ei,[e("div",Oi,[Ai,t(C,null,{title:s(()=>[L("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")]),default:s(()=>[t(k(oe),{class:"question-icon"})]),_:1})]),e("div",ji,[e("div",Mi,[e("div",zi,[t(h,{class:"custom-slider",value:n.top_k,"onUpdate:value":b[0]||(b[0]=D=>n.top_k=D),min:1,max:10},null,8,["value"])]),e("div",Di,[t(O,{value:n.top_k,"onUpdate:value":b[1]||(b[1]=D=>n.top_k=D),min:1,max:10},null,8,["value"])])])])]),n.search_type<=2?(o(),m("div",Pi,[e("div",Ni,[Ti,t(C,null,{title:s(()=>[L("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")]),default:s(()=>[t(k(oe),{class:"question-icon"})]),_:1})]),e("div",Vi,[e("div",Bi,[e("div",Qi,[t(h,{class:"custom-slider",value:n.similarity,"onUpdate:value":b[2]||(b[2]=D=>n.similarity=D),min:0,max:1,step:.01},null,8,["value"])]),e("div",Fi,[t(O,{value:n.similarity,"onUpdate:value":b[3]||(b[3]=D=>n.similarity=D),min:0,max:1,step:.01},null,8,["value"])])])])])):U("",!0),e("div",Ji,[e("div",Gi,[Hi,L("   "),t(F,{checkedValue:1,unCheckedValue:0,checked:n.rerank_status,"onUpdate:checked":b[4]||(b[4]=D=>n.rerank_status=D),onChange:d},null,8,["checked"])]),n.rerank_status==1?(o(),m("div",Ki,[t(P,{allowClear:"",value:n.rerank_use_model,"onUpdate:value":b[5]||(b[5]=D=>n.rerank_use_model=D),placeholder:"请选择Rerank模型",onChange:l,style:{width:"60%"}},{default:s(()=>[(o(!0),m(T,null,K($.value,D=>(o(),z(q,{key:D.id},{label:s(()=>[e("span",null,[e("img",{class:"model-icon",src:D.icon,alt:""},null,8,Wi)])]),default:s(()=>[(o(!0),m(T,null,K(D.children,W=>(o(),z(j,{value:W,rerank_model_config_id:D.id,key:W},{default:s(()=>[e("span",null,I(W),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):U("",!0)])])])]),_:1},8,["open"])}}},Yi=B(Zi,[["__scopeId","data-v-a2abcb20"]]),Xi=u=>(G("data-v-a87bd0fa"),u=u(),H(),u),ea={class:"list-box"},ta=["onClick"],oa={class:"avater-box"},sa=["src"],na={class:"content-box"},ia={class:"title-block"},aa=Xi(()=>e("div",{class:"tag-icon"},"Graph",-1)),la={class:"title-text"},ca={class:"desc-box"},ra={class:"right-icon"},_a={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(u,{expose:c,emit:f}){const v=f,p=u,n=g(!1);me(()=>p.list,()=>{p.list.length==0&&(n.value=!1)},{});const _=()=>{n.value=!0},y=()=>{document.visibilityState==="visible"&&v("refreshList")};ye(()=>{document.addEventListener("visibilitychange",y)}),It(()=>{document.removeEventListener("visibilitychange",y)});const l=d=>{window.open(`/#/library/details/knowledge-config?id=${d.id}`)};return c({show:_}),(d,w)=>{const i=mt,r=Be,a=X;return o(),m("div",null,[t(a,{open:n.value,"onUpdate:open":w[0]||(w[0]=$=>n.value=$),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:s(()=>[t(i,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(r,{scrollbar:!1,style:{height:"400px"}},{default:s(()=>[e("div",ea,[(o(!0),m(T,null,K(p.list,$=>(o(),m("div",{class:"list-item",onClick:x=>l($),key:$.id},[e("div",oa,[e("img",{src:$.avatar,alt:""},null,8,sa)]),e("div",na,[e("div",ia,[aa,e("div",la,I($.library_name),1)]),e("div",ca,I($.library_intro),1)]),e("div",ra,[t(k(io))])],8,ta))),128))])]),_:1})]),_:1},8,["open"])])}}},da=B(_a,[["__scopeId","data-v-a87bd0fa"]]),ua={class:"actions-box"},pa={key:0,class:"library-list"},ma=["onClick"],va=["onClick"],ha={class:"library-name"},fa={class:"library-name-text"},ba={class:"library-intro"},ya={class:"setting-info-block"},ka={class:"set-item"},ga={key:0},$a={key:1},xa={key:2},wa={key:3},Sa={class:"set-item"},qa={key:0,class:"set-item"},Ca={class:"set-item"},La={key:0},Ia={key:1},Ra={__name:"index",setup(u){const{getStorage:c,removeStorage:f}=Vt("localStorage"),v=Tt(),p=be(()=>{var q;return((q=v.companyInfo)==null?void 0:q.neo4j_status)=="true"}),n=g(!1),{robotInfo:_,updateRobotInfo:y}=ee("robotInfo"),l=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),d=g([]),w=g(null),i=be(()=>d.value.filter(q=>l.library_ids.includes(q.id))),r=be(()=>i.value.filter(q=>q.graph_switch==0)),a=q=>{let P=l.library_ids.indexOf(q.id);l.library_ids.splice(P,1),h()},$=q=>{l.library_ids=[...q],h()},x=()=>{w.value.open([...l.library_ids])},R=g(null),b=()=>{R.value.open(Y(l))},S=g(null),C=q=>{l.rerank_status=q.rerank_status,l.rerank_use_model=q.rerank_use_model,l.rerank_model_config_id=q.rerank_model_config_id,l.top_k=q.top_k,l.similarity=q.similarity,l.search_type=q.search_type,(q.search_type==1||q.search_type==4)&&r.value.length>0&&S.value.show(),h()},h=()=>{let q={...Y(l)};q.library_ids=q.library_ids.join(","),y({...q})},O=async()=>{const q=await nt({type:"",show_open_docs:1});q&&(d.value=q.data||[])},F=()=>{X.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){x()}})};l.rerank_use_model=_.rerank_use_model||void 0,Ae(()=>{l.library_ids=_.library_ids.split(","),l.rerank_status=_.rerank_status||0,l.rerank_use_model=_.rerank_use_model||void 0,l.rerank_model_config_id=_.rerank_model_config_id||"",l.top_k=_.top_k,l.similarity=_.similarity,l.search_type=_.search_type});const j=q=>{window.open(`#/library/details/knowledge-document?id=${q.id}`)};return ye(()=>{O(),c("showNoLibraryTip")&&(F(),f("showNoLibraryTip"))}),(q,P)=>{const J=se,D=qe,W=ne;return o(),z(te,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:n.value,"onUpdate:isEdit":P[0]||(P[0]=N=>n.value=N),bodyStyle:{padding:0}},{extra:s(()=>[e("div",ua,[t(D,{gap:8},{default:s(()=>[t(J,{size:"small",onClick:b},{default:s(()=>[L("召回设置")]),_:1}),t(J,{size:"small",onClick:x},{default:s(()=>[L("关联知识库")]),_:1})]),_:1})])]),default:s(()=>[i.value.length>0?(o(),m("div",pa,[(o(!0),m(T,null,K(i.value,N=>(o(),m("div",{class:"library-item",key:N.id,onClick:M=>j(N)},[e("span",{class:"close-btn",onClick:Rt(M=>a(N),["stop"])},[t(k(ve))],8,va),e("div",ha,[p.value?(o(),z(W,{key:0},{title:s(()=>[L(I(N.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:s(()=>[e("div",{class:Oe(["graph-tag",{active:N.graph_switch==1}])},"Graph",2)]),_:2},1024)):U("",!0),e("div",fa,I(N.library_name),1)]),e("div",ba,I(N.library_intro),1)],8,ma))),128))])):U("",!0),e("div",ya,[e("div",ka,[L(" 检索模式： "),l.search_type==1?(o(),m("span",ga,"混合检索")):U("",!0),l.search_type==2?(o(),m("span",$a,"向量检索")):U("",!0),l.search_type==3?(o(),m("span",xa,"全文检索")):U("",!0),l.search_type==4?(o(),m("span",wa,"知识图谱检索")):U("",!0)]),e("div",Sa,[L(" Top K： "),e("span",null,I(l.top_k),1)]),l.search_type<=2?(o(),m("div",qa,[L(" 相似度阈值： "),e("span",null,I(l.similarity),1)])):U("",!0),e("div",Ca,[L(" Rerank模型： "),l.rerank_status==0?(o(),m("span",La,"关")):(o(),m("span",Ia,I(l.rerank_use_model),1))])]),t(ki,{ref_key:"librarySelectAlertRef",ref:w,onChange:$},null,512),t(Yi,{ref_key:"recallSettingsAlertRef",ref:R,onChange:C},null,512),t(da,{list:r.value,onRefreshList:O,ref_key:"noOpenGraphModalRef",ref:S},null,8,["list"])]),_:1},8,["isEdit"])}}},Ua=B(Ra,[["__scopeId","data-v-ede78f9f"]]),Ea=u=>(G("data-v-b559dd08"),u=u(),H(),u),Oa={class:"library-checkbox-box"},Aa={class:"list-box",ref:"scrollContainer"},ja={class:"library-name"},Ma={class:"library-desc"},za={key:0,class:"empty-box"},Da=Ea(()=>e("img",{src:ht,alt:""},null,-1)),Pa={__name:"library-select-alert",emits:["change"],setup(u,{expose:c,emit:f}){const v=f,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),n=g(!1),_=a=>{w(),p.checkedList=a,n.value=!0},y=()=>{n.value=!1,d()};g("");const l=g([]),d=()=>{v("change",[...p.checkedList])},w=async()=>{const a=await vt();if(a){let $=a.data||[];l.value=$}},i=g(!1),r=()=>{window.open("/#/database/list")};return c({open:_}),(a,$)=>{const x=Qe,R=Fe,b=je,S=X;return o(),z(S,{width:"746px",open:n.value,"onUpdate:open":$[1]||($[1]=C=>n.value=C),title:"关联数据表",onOk:y},{default:s(()=>[e("div",Oa,[t(b,{spinning:i.value,delay:100},{default:s(()=>[t(R,{value:p.checkedList,"onUpdate:value":$[0]||($[0]=C=>p.checkedList=C),style:{width:"100%"}},{default:s(()=>[e("div",Aa,[(o(!0),m(T,null,K(l.value,C=>(o(),m("div",{class:"list-item-wraapper",key:C.id},[t(x,{class:"list-item",value:C.id},{default:s(()=>[e("div",ja,I(C.name),1),e("div",Ma,I(C.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!i.value&&!l.value.length?(o(),m("div",za,[Da,e("div",null,[L(" 暂无数据表, 请先去添加数据表 "),e("a",{onClick:r}," 去添加")])])):U("",!0)])]),_:1},8,["open"])}}},Na=B(Pa,[["__scopeId","data-v-b559dd08"]]),Ta=u=>(G("data-v-c40914ca"),u=u(),H(),u),Va=Ta(()=>e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)),Ba={class:"actions-box"},Qa={key:0,class:"library-list"},Fa=["onClick"],Ja={class:"library-name"},Ga={class:"library-intro"},Ha={__name:"index",setup(u){const c=g(!1),{robotInfo:f,updateRobotInfo:v}=ee("robotInfo"),p=Q({form_ids:[]}),n=g([]),_=g(null),y=be(()=>n.value.filter(a=>p.form_ids.includes(a.id))),l=a=>{let $=p.form_ids.indexOf(a.id);p.form_ids.splice($,1),i()},d=a=>{p.form_ids=[...a],i()},w=()=>{_.value.open([...p.form_ids])},i=()=>{let a={...Y(p)};a.form_ids=a.form_ids.join(","),v({...a})};return(async()=>{const a=await vt();a&&(n.value=a.data||[])})(),Ae(()=>{p.form_ids=f.form_ids.split(",")}),(a,$)=>{const x=ne,R=se,b=qe;return o(),z(te,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:c.value,"onUpdate:isEdit":$[0]||($[0]=S=>c.value=S),bodyStyle:{padding:0}},{tip:s(()=>[t(x,{placement:"top"},{title:s(()=>[Va]),default:s(()=>[t(k(oe))]),_:1})]),extra:s(()=>[e("div",Ba,[t(b,{gap:8},{default:s(()=>[t(R,{size:"small",onClick:w},{default:s(()=>[L("关联数据表")]),_:1})]),_:1})])]),default:s(()=>[y.value.length>0?(o(),m("div",Qa,[(o(!0),m(T,null,K(y.value,S=>(o(),m("div",{class:"library-item",key:S.id},[e("span",{class:"close-btn",onClick:C=>l(S)},[t(k(ve))],8,Fa),e("div",Ja,I(S.name),1),e("div",Ga,I(S.description),1)]))),128))])):U("",!0),t(Na,{ref_key:"librarySelectAlertRef",ref:_,onChange:d},null,512)]),_:1},8,["isEdit"])}}},Ka=B(Ha,[["__scopeId","data-v-c40914ca"]]),Wa={class:"form-box"},Za={class:"question-title"},Ya={class:"question-options"},Xa={class:"question-option"},el={class:"drag-btn"},tl={class:"action-box"},ol={class:"robot-info-box"},sl={class:"robot-welcome-content"},nl={class:"robot-welcome-question"},il={__name:"welcome-words",setup(u){const c=g(!1),f=g(!1),{robotInfo:v,updateRobotInfo:p,scrollBoxToBottom:n}=ee("robotInfo"),_=Q({welcomes:{content:"",question:[]}}),y=()=>{let r=!1;if(_.welcomes.question.length>0){for(let a=0;a<_.welcomes.question.length;a++)if(!_.welcomes.question[a].content){r=a+1;break}}return r},l=()=>{_.welcomes.question.push({content:"",id:Ee(8)})},d=r=>{_.welcomes.question.splice(r,1)},w=()=>{if(!_.welcomes.content)return Z.error("请输入欢迎语");if(y())return Z.error("引导问题内容不能为空");p({...Y(_)}),c.value=!1},i=()=>{let r={...v.welcomes},a=[];r.question.forEach(({content:$,id:x})=>{let R={id:x,content:$};R.id||(R.id=Ee(6)),a.push(R)}),_.welcomes.content=r.content,_.welcomes.question=a};return(r,a)=>{const $=Ce,x=de,R=ue;return o(),z(te,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:c.value,"onUpdate:isEdit":a[4]||(a[4]=b=>c.value=b),onSave:w,onEdit:i},{default:s(()=>[re(e("div",Wa,[e("div",Za,[t($,{value:_.welcomes.content,"onUpdate:value":a[0]||(a[0]=b=>_.welcomes.content=b),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",Ya,[t(k(Je),{modelValue:_.welcomes.question,"onUpdate:modelValue":a[1]||(a[1]=b=>_.welcomes.question=b),"item-key":"id",handle:".drag-btn",onStart:a[2]||(a[2]=b=>f.value=!0),onEnd:a[3]||(a[3]=b=>f.value=!1)},{item:s(({element:b,index:S})=>[e("div",Xa,[e("span",el,[t(x,{name:"drag"})]),t(R,{class:"question-option-content",value:b.content,"onUpdate:value":C=>b.content=C,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",tl,[t(k(ve),{class:"del-btn",onClick:C=>d(S)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:l},[t(k(Me),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[_e,c.value]]),re(e("div",ol,[e("div",sl,I(k(v).welcomes.content),1),e("div",nl,[(o(!0),m(T,null,K(k(v).welcomes.question,(b,S)=>(o(),m("div",{class:"question-item",key:S},I(b.content),1))),128))])],512),[[_e,!c.value]])]),_:1},8,["isEdit"])}}},al=B(il,[["__scopeId","data-v-ea227a87"]]),ll=u=>(G("data-v-bc797bf6"),u=u(),H(),u),cl=ll(()=>e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)),rl={class:"form-box"},_l={class:"question-title"},dl={class:"question-options"},ul={class:"question-option"},pl={class:"drag-btn"},ml={class:"action-box"},vl={class:"robot-info-box"},hl={class:"robot-unknown-content"},fl={class:"robot-unknown-question"},bl={__name:"unknown-problem-prompt",setup(u){const c=g(!1),f=g(!1),{robotInfo:v,updateRobotInfo:p,scrollBoxToBottom:n}=ee("robotInfo"),_=Q({unknown_question_prompt:{content:"",question:[]}}),y=()=>{_.unknown_question_prompt.question.push({content:"",id:Ee(8)}),st(()=>{n()})},l=i=>{_.unknown_question_prompt.question.splice(i,1)},d=()=>{p({...Y(_)}),c.value=!1},w=()=>{let i={...v.unknown_question_prompt},r=[];i.question&&i.question.forEach(({content:a,id:$})=>{let x={id:$,content:a};x.id||(x.id=Ee(6)),r.push(x)}),i.content&&(_.unknown_question_prompt.content=i.content),r&&(_.unknown_question_prompt.question=r)};return ye(()=>{}),(i,r)=>{const a=ne,$=Ce,x=de,R=ue;return o(),z(te,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:c.value,"onUpdate:isEdit":r[4]||(r[4]=b=>c.value=b),onSave:d,onEdit:w},{tip:s(()=>[t(a,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[cl]),default:s(()=>[t(k(oe))]),_:1})]),default:s(()=>[re(e("div",rl,[e("div",_l,[t($,{value:_.unknown_question_prompt.content,"onUpdate:value":r[0]||(r[0]=b=>_.unknown_question_prompt.content=b),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",dl,[t(k(Je),{modelValue:_.unknown_question_prompt.question,"onUpdate:modelValue":r[1]||(r[1]=b=>_.unknown_question_prompt.question=b),"item-key":"id",handle:".drag-btn",onStart:r[2]||(r[2]=b=>f.value=!0),onEnd:r[3]||(r[3]=b=>f.value=!1)},{item:s(({element:b,index:S})=>[e("div",ul,[e("span",pl,[t(x,{name:"drag"})]),t(R,{class:"question-option-content",value:b.content,"onUpdate:value":C=>b.content=C,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",ml,[t(k(ve),{class:"del-btn",onClick:C=>l(S)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:y},[t(k(Me),{class:"add-btn-icon"}),L("添加引导问题 ")])])],512),[[_e,c.value]]),re(e("div",vl,[e("div",hl,I(k(v).unknown_question_prompt.content),1),e("div",fl,[(o(!0),m(T,null,K(k(v).unknown_question_prompt.question,(b,S)=>(o(),m("div",{class:"question-item",key:S},I(b.content),1))),128))])],512),[[_e,!c.value]])]),_:1},8,["isEdit"])}}},yl=B(bl,[["__scopeId","data-v-bc797bf6"]]),Le=u=>(G("data-v-a42248ec"),u=u(),H(),u),kl=Le(()=>e("span",null,null,-1)),gl={class:"robot-info-box"},$l=Le(()=>e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),xl=Le(()=>e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)),wl={class:"modal-box",ref:"modalBoxRef"},Sl={class:"modal-item-box"},ql={class:"modal-item"},Cl=Le(()=>e("div",{class:"label"},"模型",-1)),Ll={class:"modal-item"},Il=Le(()=>e("div",{class:"label"},"对话背景",-1)),Rl={__name:"problem-optimization",setup(u){const c=g(!1);g(!1);const{robotInfo:f,updateRobotInfo:v}=ee("robotInfo"),p=g("0"),n=Q({optimize_question_use_model:"",optimize_question_model_config_id:""});ye(()=>{p.value=f.optimize_question_model_config_id!=0?"1":"0",n.optimize_question_use_model=f.optimize_question_use_model,n.optimize_question_model_config_id=f.optimize_question_model_config_id});const _=g([]),y=r=>{_.value=r,st(()=>{(!n.optimize_question_use_model||!Number(n.optimize_question_model_config_id))&&l()})},l=()=>{if(_.value.length>0){let r=null,a=null;for(let $ of _.value)if($.model_define==="tongyi"){r=$;for(let x of r.children)if(x.name==="qwen-max"){a=x;break}break}r||(r=_.value[0],a=r.children[0]),r&&a&&(n.optimize_question_use_model=a.name,n.optimize_question_model_config_id=a.model_config_id)}},d=()=>{c.value=!1,v({...Y(n)})},w=r=>{r!=1&&(n.optimize_question_use_model="",n.optimize_question_model_config_id=0)},i=r=>{v({})};return(r,a)=>{const $=ne,x=ie,R=ft,b=bt,S=Ce,C=X;return o(),z(te,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:s(()=>[kl]),default:s(()=>[e("div",gl,[$l,t($,null,{title:s(()=>[xl]),default:s(()=>[e("div",{class:"dialog-bg-set",onClick:a[0]||(a[0]=h=>c.value=!0)}," 对话背景设置 ")]),_:1})]),t(x,{onChange:i,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(f).enable_question_optimize,"onUpdate:checked":a[1]||(a[1]=h=>k(f).enable_question_optimize=h),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",wl,[t(C,{getContainer:()=>r.$refs.modalBoxRef,open:c.value,"onUpdate:open":a[6]||(a[6]=h=>c.value=h),width:472,title:"用户问题建议设置",onOk:d},{default:s(()=>[e("div",Sl,[e("div",ql,[Cl,t(b,{value:p.value,"onUpdate:value":a[2]||(a[2]=h=>p.value=h),onChange:w},{default:s(()=>[t(R,{value:"0"},{default:s(()=>[L("跟随机器人")]),_:1}),t(R,{value:"1"},{default:s(()=>[L("指定模型")]),_:1})]),_:1},8,["value"]),p.value=="1"?(o(),z(ao,{key:0,modelType:"LLM",modeName:n.optimize_question_use_model,"onUpdate:modeName":a[3]||(a[3]=h=>n.optimize_question_use_model=h),modeId:n.optimize_question_model_config_id,"onUpdate:modeId":a[4]||(a[4]=h=>n.optimize_question_model_config_id=h),style:{width:"100%","margin-top":"8px"},onLoaded:y},null,8,["modeName","modeId"])):U("",!0)]),e("div",Ll,[Il,t(S,{style:{height:"120px"},value:k(f).optimize_question_dialogue_background,"onUpdate:value":a[5]||(a[5]=h=>k(f).optimize_question_dialogue_background=h),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Ul=B(Rl,[["__scopeId","data-v-a42248ec"]]),El=u=>(G("data-v-f6a291d4"),u=u(),H(),u),Ol=El(()=>e("span",null,null,-1)),Al={class:"robot-info-box"},jl={class:"robot-prompt"},Ml={__name:"suggested-issues",setup(u){g(!1);const{robotInfo:c,updateRobotInfo:f}=ee("robotInfo"),v=p=>{f({})};return(p,n)=>{const _=ze,y=ie;return o(),z(te,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:s(()=>[Ol]),default:s(()=>[e("div",Al,[e("div",jl,[L(" 开启后，机器人回答问题后，自动根据对话内容提供 "),t(_,{value:k(c).question_guide_num,"onUpdate:value":n[0]||(n[0]=l=>k(c).question_guide_num=l),style:{width:"80px"},precision:0,min:1,max:10,onBlur:v},null,8,["value"]),L(" 条用户提问建议，最大不超过10条。 ")])]),t(y,{onChange:v,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(c).enable_question_guide,"onUpdate:checked":n[1]||(n[1]=l=>k(c).enable_question_guide=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},zl=B(Ml,[["__scopeId","data-v-f6a291d4"]]),Dl=u=>(G("data-v-56c388e6"),u=u(),H(),u),Pl=Dl(()=>e("span",null,null,-1)),Nl={__name:"sensitive-words",setup(u){g(!1);const{robotInfo:c,updateRobotInfo:f}=ee("robotInfo");Q({prompt:""});const v=()=>{window.open("/#/user/sensitive-words")},p=n=>{f({})};return(n,_)=>{const y=ie;return o(),z(te,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:s(()=>[Pl]),default:s(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[L(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，"),e("span",{onClick:v,style:{cursor:"pointer"}},"设置敏词 >")])]),t(y,{onChange:p,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(c).sensitive_words_switch,"onUpdate:checked":_[0]||(_[0]=l=>k(c).sensitive_words_switch=l),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Tl=B(Nl,[["__scopeId","data-v-56c388e6"]]),He=u=>(G("data-v-a0ec9e93"),u=u(),H(),u),Vl={class:"direct-title"},Bl={class:"direct-desc"},Ql={class:"qa"},Fl={class:"prompt-form-item-label"},Jl=He(()=>e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),Gl={class:"direct-switch"},Hl={class:"similarity"},Kl=He(()=>e("span",null,"相似度超过",-1)),Wl={class:"number-input-box"},Zl=He(()=>e("span",null,"时直接回复答案",-1)),Yl={__name:"chat-edit-alert",emits:["save"],setup(u,{expose:c,emit:f}){const v=f,p=g(1),n=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],_=Q(n()),y=g(!1),l=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),d=()=>{l.chat_type=p.value.toString(),_.forEach(r=>{r.chat_type==p.value&&(l.chat_type=="3"?(l.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch==1?"true":"false",l.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score.toString()):l.chat_type=="1"&&(l.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch==1?"true":"false",l.library_qa_direct_reply_score=r.library_qa_direct_reply_score.toString()))}),w(),Object.assign(_,n()),y.value=!1},w=()=>{v("save",Y(l))};ye(()=>{});const i=r=>{p.value=parseInt(r.chat_type),l.chat_type=r.chat_type,l.library_qa_direct_reply_score=r.library_qa_direct_reply_score,l.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch,l.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score,l.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch,_.forEach(a=>{a.chat_type=="3"?(a.mixture_qa_direct_reply_score=r.mixture_qa_direct_reply_score,a.mixture_qa_direct_reply_switch=r.mixture_qa_direct_reply_switch=="true"?1:0):a.chat_type=="1"&&(a.library_qa_direct_reply_score=r.library_qa_direct_reply_score,a.library_qa_direct_reply_switch=r.library_qa_direct_reply_switch=="true"?1:0)}),y.value=!0};return me(()=>y.value,r=>{r===!1&&Object.assign(_,n())},{immediate:!0}),c({open:i}),(r,a)=>{const $=ne,x=ie,R=ze,b=ft,S=bt,C=X;return o(),z(C,{width:"746px",open:y.value,"onUpdate:open":a[1]||(a[1]=h=>y.value=h),title:"聊天模式设置",onOk:d},{default:s(()=>[t(S,{class:"direct-box",value:p.value,"onUpdate:value":a[0]||(a[0]=h=>p.value=h)},{default:s(()=>[(o(!0),m(T,null,K(_,h=>(o(),z(b,{class:Oe(["direct-item",{active:p.value==h.direct_id}]),value:h.direct_id,key:h.direct_id},{default:s(()=>[e("div",Vl,I(h.direct_title),1),e("div",Bl,I(h.direct_desc),1),re(e("div",Ql,[e("div",Fl,[Jl,t($,null,Ut({default:s(()=>[t(k(oe),{class:"question-icon"})]),_:2},[h.chat_type=="1"?{name:"title",fn:s(()=>[L("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"0"}:h.chat_type=="3"?{name:"title",fn:s(()=>[L("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。")]),key:"1"}:void 0]),1024),e("div",Gl,[h.chat_type=="1"?(o(),z(x,{key:0,checkedValue:1,unCheckedValue:0,checked:h.library_qa_direct_reply_switch,"onUpdate:checked":O=>h.library_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):h.chat_type=="3"?(o(),z(x,{key:1,checkedValue:1,unCheckedValue:0,checked:h.mixture_qa_direct_reply_switch,"onUpdate:checked":O=>h.mixture_qa_direct_reply_switch=O},null,8,["checked","onUpdate:checked"])):U("",!0)])])],512),[[_e,h.isQaDirectReply&&p.value==h.direct_id]]),re(e("div",Hl,[Kl,e("div",Wl,[h.chat_type=="1"?(o(),z(R,{key:0,value:h.library_qa_direct_reply_score,"onUpdate:value":O=>h.library_qa_direct_reply_score=O,disabled:!h.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):h.chat_type=="3"?(o(),z(R,{key:1,value:h.mixture_qa_direct_reply_score,"onUpdate:value":O=>h.mixture_qa_direct_reply_score=O,disabled:!h.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):U("",!0)]),Zl],512),[[_e,h.isQaDirectReply&&p.value==h.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},Xl=B(Yl,[["__scopeId","data-v-a0ec9e93"]]),Ke=u=>(G("data-v-5b59ec9b"),u=u(),H(),u),ec=Ke(()=>e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1)),tc=Ke(()=>e("br",null,null,-1)),oc=Ke(()=>e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)),sc={class:"actions-box"},nc={class:"setting-info-block"},ic={class:"set-item"},ac={key:0},lc={key:1},cc={key:2},rc={class:"set-item"},_c={key:0,class:"set-item"},dc={class:"set-item"},uc={key:0,class:"set-item"},pc={class:"form-box"},mc={__name:"index",setup(u){const c=g(!1),f=g(null),{robotInfo:v,updateRobotInfo:p}=ee("robotInfo"),n=Q({chat_type:v.chat_type,library_qa_direct_reply_score:v.library_qa_direct_reply_score,library_qa_direct_reply_switch:v.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:v.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:v.mixture_qa_direct_reply_switch}),_=d=>{n.chat_type=d.chat_type,n.library_qa_direct_reply_score=d.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=d.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=d.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=d.mixture_qa_direct_reply_switch,y()},y=()=>{p({...Y(n)}),c.value=!1},l=()=>{f.value.open(Y(n)),c.value=!0};return(d,w)=>{const i=ne,r=se;return o(),z(te,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:c.value,"onUpdate:isEdit":w[1]||(w[1]=a=>c.value=a),bodyStyle:{padding:0}},{tip:s(()=>[t(i,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>[ec,tc,oc]),default:s(()=>[t(k(oe))]),_:1})]),extra:s(()=>[e("div",sc,[t(r,{size:"small",onClick:w[0]||(w[0]=a=>l(!0))},{default:s(()=>[L("修改")]),_:1})])]),default:s(()=>[e("div",nc,[e("div",ic,[L(" 聊天模式： "),k(v).chat_type=="1"?(o(),m("span",ac,"仅知识库")):U("",!0),k(v).chat_type=="2"?(o(),m("span",lc,"直连模式")):U("",!0),k(v).chat_type=="3"?(o(),m("span",cc,"混合模式")):U("",!0)]),k(v).chat_type=="1"?(o(),m(T,{key:0},[e("div",rc,[L(" QA文档直接回复答案： "),e("span",null,I(k(v).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(v).library_qa_direct_reply_switch=="true"?(o(),m("div",_c,[L(" 相似度值： "),e("span",null,I(k(v).library_qa_direct_reply_score),1)])):U("",!0)],64)):U("",!0),k(v).chat_type=="3"?(o(),m(T,{key:1},[e("div",dc,[L(" QA文档直接回复答案： "),e("span",null,I(k(v).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),k(v).mixture_qa_direct_reply_switch=="true"?(o(),m("div",uc,[L(" 相似度值： "),e("span",null,I(k(v).mixture_qa_direct_reply_score),1)])):U("",!0)],64)):U("",!0)]),e("div",pc,[t(Xl,{ref_key:"ChatEditAlertRef",ref:f,onSave:_},null,512)])]),_:1},8,["isEdit"])}}},vc=B(mc,[["__scopeId","data-v-5b59ec9b"]]),hc=u=>(G("data-v-8d185d5f"),u=u(),H(),u),fc={class:"switch-box"},bc={class:"switch-box-body"},yc={class:"switch-box-header"},kc={class:"left-box"},gc={class:"switch-box-title"},$c={key:0,class:"title-tip"},xc={class:"right-box"},wc={class:"extra-box"},Sc=hc(()=>e("div",{class:"extra-box"},null,-1)),qc={class:"switch-desc"},Cc={class:"switch-box-right"},Lc={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(u,{emit:c}){const f=c,v=u,p=g(v.value),n=_=>{f("update:value",_),f("change",_)};return(_,y)=>{const l=de,d=ie;return o(),m("div",fc,[e("div",bc,[e("div",yc,[e("div",kc,[t(l,{class:"switch-box-icon",name:v.iconName},null,8,["name"]),e("span",gc,I(v.title),1),_.$slots.tip?(o(),m("span",$c,[pe(_.$slots,"tip",{},void 0,!0)])):U("",!0)]),e("div",xc,[e("div",wc,[pe(_.$slots,"extra",{},()=>[Sc],!0)])])]),e("div",qc,[pe(_.$slots,"default",{},void 0,!0)])]),e("div",Cc,[t(d,{checked:p.value,"onUpdate:checked":y[0]||(y[0]=w=>p.value=w),onChange:n,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Ic=B(Lc,[["__scopeId","data-v-8d185d5f"]]),Rc="/assets/img/empty-Bx9z1cwf.png",Uc="/assets/img/phone-head-CDwwPhYa.png",Ec="/assets/img/phone-body-CbEf8GZP.png",Oc="/assets/img/phone-footer-ClQtNpln.png",he=u=>(G("data-v-5125783f"),u=u(),H(),u),Ac={class:"common-problem-box"},jc={class:"left-content-box"},Mc={key:0,class:"empty-box"},zc=he(()=>e("img",{src:Rc,alt:""},null,-1)),Dc=he(()=>e("div",{class:"title"},"暂无数据",-1)),Pc=he(()=>e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),Nc={key:1,class:"lists-box"},Tc={class:"drag-btn"},Vc={class:"title"},Bc={class:"opration-box"},Qc={class:"preview-box"},Fc=he(()=>e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Uc,alt:""})],-1)),Jc={class:"phone-body"},Gc=he(()=>e("div",null,[e("img",{class:"body-img",src:Ec,alt:""})],-1)),Hc={key:0,class:"question-box"},Kc=he(()=>e("div",{class:"name"},"常见问题",-1)),Wc=he(()=>e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Oc,alt:""})],-1)),Zc={__name:"common-problem",setup(u){g(!1);const{robotInfo:c,updateRobotInfo:f}=ee("robotInfo"),v=be(()=>c.common_question_list?JSON.parse(c.common_question_list):[]),p=g([]);p.value=v.value,me(v,()=>{p.value=v.value});const n=Ve.useForm,_=g(!1),y=g("添加问题"),l=Q({question:"",index:-1}),d=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:w,validate:i,validateInfos:r}=n(l,d),a=()=>{if(v.value.length>=10)return Z.error("最多设置10条常用问题");_.value=!0,w(),l.question="",l.index=-1},$=(C,h)=>{_.value=!0,w(),l.question=C,l.index=h},x=C=>{let h=[];h=v.value.filter((O,F)=>C!=F),X.confirm({title:"提醒",icon:t(Te),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){f({common_question_list:JSON.stringify(h)})},onCancel(){}})},R=()=>{i().then(()=>{let C=[];l.index>=0?C=v.value.map((h,O)=>O===l.index?l.question:h):C=[l.question,...v.value],f({common_question_list:JSON.stringify(C)}),_.value=!1})},b=C=>{f({})},S=C=>{f({common_question_list:JSON.stringify(p.value)})};return(C,h)=>{const O=ne,F=ie,j=lo,q=se,P=de,J=ue,D=at,W=Ve,N=X;return o(),m("div",Ac,[e("div",jc,[t(te,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:s(()=>[t(O,null,{title:s(()=>[L("最多10条。开启后，常见问题会显示在每条问答后面")]),default:s(()=>[t(k(oe),{class:"quess-icon"})]),_:1})]),extra:s(()=>[t(F,{onChange:b,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:k(c).enable_common_question,"onUpdate:checked":h[0]||(h[0]=M=>k(c).enable_common_question=M),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(j,{type:"vertical"}),t(q,{type:"primary",size:"small",onClick:a},{default:s(()=>[L("添加")]),_:1})]),default:s(()=>[v.value.length==0?(o(),m("div",Mc,[zc,Dc,Pc,t(q,{onClick:a,type:"primary"},{default:s(()=>[L("立即添加")]),_:1})])):(o(),m("div",Nc,[t(k(Je),{modelValue:p.value,"onUpdate:modelValue":h[1]||(h[1]=M=>p.value=M),handle:".drag-btn","item-key":"index",onEnd:S},{item:s(({element:M,index:$e})=>[(o(),m("div",{class:"list-item",key:$e},[e("span",Tc,[t(P,{name:"drag"})]),e("div",Vc,I(M),1),e("div",Bc,[t(k(yt),{onClick:Pe=>$(M,$e)},null,8,["onClick"]),t(k(ve),{onClick:Pe=>x($e)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Qc,[Fc,e("div",Jc,[Gc,v.value.length&&k(c).enable_common_question=="true"?(o(),m("div",Hc,[Kc,(o(!0),m(T,null,K(v.value,M=>(o(),m("div",{class:"list-item",key:M},I(M),1))),128))])):U("",!0)]),Wc]),t(N,{open:_.value,"onUpdate:open":h[3]||(h[3]=M=>_.value=M),title:y.value,onOk:R,width:"476px"},{default:s(()=>[t(W,{class:"form-box",layout:"vertical"},{default:s(()=>[t(D,Et({label:"问题名称"},k(r).question),{default:s(()=>[t(J,{maxLength:100,value:l.question,"onUpdate:value":h[2]||(h[2]=M=>l.question=M),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Yc=B(Zc,[["__scopeId","data-v-5125783f"]]),Xc=e("span",null,null,-1),er=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1),tr={__name:"display-aitations",setup(u){const{robotInfo:c,updateRobotInfo:f}=ee("robotInfo"),v=g(!1);me(()=>c.answer_source_switch,n=>{v.value=n=="true"},{immediate:!0});const p=()=>{f({answer_source_switch:v.value?"true":"false"})};return(n,_)=>(o(),z(Ic,{title:"显示引文","icon-name":"jibenpeizhi",value:v.value,"onUpdate:value":_[0]||(_[0]=y=>v.value=y),onChange:p},{extra:s(()=>[Xc]),default:s(()=>[er]),_:1},8,["value"]))}},$t=u=>(G("data-v-4948feb9"),u=u(),H(),u),or=$t(()=>e("span",null,null,-1)),sr=$t(()=>e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),nr={__name:"show-like",setup(u){const{robotInfo:c,updateRobotInfo:f}=ee("robotInfo"),v=p=>{f({})};return(p,n)=>{const _=ie;return o(),z(te,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:s(()=>[or]),default:s(()=>[sr,t(_,{onChange:v,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:k(c).feedback_switch,"onUpdate:checked":n[0]||(n[0]=y=>k(c).feedback_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},ir=B(nr,[["__scopeId","data-v-4948feb9"]]),ge=u=>(G("data-v-93184c86"),u=u(),H(),u),ar={class:"content-box"},lr={key:0,class:"add-btn-block"},cr={class:"list-content"},rr={key:0,class:"user-block"},_r={class:"name-box"},dr={class:"name"},ur={class:"remark-text"},pr={key:0,class:"hover-btn-box"},mr={key:0},vr={key:1},hr={key:2},fr={key:1,class:"hover-btn-box"},br={class:"role-menu-box"},yr=["onClick"],kr={class:"menu-header"},gr=ge(()=>e("span",{class:"title"},"管理",-1)),$r=ge(()=>e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),xr={key:0,class:"check-box"},wr=["onClick"],Sr={class:"menu-header"},qr=ge(()=>e("span",{class:"title"},"编辑",-1)),Cr=ge(()=>e("div",{class:"desc"},"可编辑，可查看",-1)),Lr={key:0,class:"check-box"},Ir=["onClick"],Rr={class:"menu-header"},Ur=ge(()=>e("span",{class:"title"},"查看",-1)),Er=ge(()=>e("div",{class:"desc"},"仅查看",-1)),Or={key:0,class:"check-box"},Ar={class:"hover-btn-box"},jr={key:0},Mr={key:1},zr={key:2},Dr=["onClick"],Pr={__name:"role-permission",setup(u){const c=tt().query,f=g(Bt(c.id)),v=g([]),p=Q({object_id:c.id,object_type:1}),n=()=>{ro({...p}).then(i=>{let r=i.data||[];v.value=r})};n();const _=g(null),y=()=>{_.value.show(v.value,[{object_id:+c.id,object_type:1,operate_rights:4}])},l=(i,r)=>{let a=r==4?"管理":r==2?"编辑":"查看";X.confirm({title:"提示?",icon:t(Te),content:"确认修改该协作者权限为【"+a+"】",okText:"确认",cancelText:"取消",onOk:()=>{let $=[{object_id:+i.object_id,object_type:+i.object_type,operate_rights:+r}];_o({identity_ids:i.identity_id,identity_type:i.identity_type,object_array:JSON.stringify($)}).then(x=>{Z.success("修改成功"),n()})},onCancel(){}})},d=i=>{X.confirm({title:"提示?",icon:t(Te),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{uo({identity_id:i.identity_id,identity_type:i.identity_type,object_id:i.object_id,object_type:i.object_type}).then(r=>{Z.success("删除成功"),n()})},onCancel(){}})},w=g([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(i,r)=>{const a=se,$=mo,x=ho,R=fo,b=Be;return o(),z(b,null,{default:s(()=>[e("div",ar,[f.value==4?(o(),m("div",lr,[t(a,{type:"primary",onClick:y,icon:ot(k(Me))},{default:s(()=>[L("添加协助者")]),_:1},8,["icon"])])):U("",!0),e("div",cr,[t(R,{columns:w.value,"data-source":v.value,pagination:!1},{bodyCell:s(({column:S,record:C})=>[S.key==="name"?(o(),m("div",rr,[t($,{shape:"square",src:C.avatar,size:40},{icon:s(()=>[C.avatar?U("",!0):(o(),z(k(Xe),{key:0}))]),_:2},1032,["src"]),e("div",_r,[e("div",dr,I(C.user_name),1),e("div",ur,I(C.name),1)])])):U("",!0),S.key==="operate_rights"?(o(),m(T,{key:1},[f.value==2?(o(),m("div",pr,[C.operate_rights==4?(o(),m("span",mr,"管理")):U("",!0),C.operate_rights==2?(o(),m("span",vr,"编辑")):U("",!0),C.operate_rights==1?(o(),m("span",hr,"查看")):U("",!0)])):C.role_type==1||C.is_creator==1?(o(),m("div",fr,"管理")):(o(),z(x,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:s(()=>[e("div",br,[e("div",{class:"role-menu",onClick:h=>l(C,4)},[e("div",kr,[t(k(Xe)),gr]),$r,C.operate_rights==4?(o(),m("div",xr,[t(k(Ne))])):U("",!0)],8,yr),e("div",{class:"role-menu",onClick:h=>l(C,2)},[e("div",Sr,[t(k(yt)),qr]),Cr,C.operate_rights==2?(o(),m("div",Lr,[t(k(Ne))])):U("",!0)],8,wr),e("div",{class:"role-menu",onClick:h=>l(C,1)},[e("div",Rr,[t(k(vo)),Ur]),Er,C.operate_rights==1?(o(),m("div",Or,[t(k(Ne))])):U("",!0)],8,Ir)])]),default:s(()=>[e("div",Ar,[C.operate_rights==4?(o(),m("span",jr,"管理")):U("",!0),C.operate_rights==2?(o(),m("span",Mr,"编辑")):U("",!0),C.operate_rights==1?(o(),m("span",zr,"查看")):U("",!0),t(k(dt))])]),_:2},1024))],64)):U("",!0),S.key==="action"?(o(),m(T,{key:2},[f.value==4?(o(),m(T,{key:0},[C.role_type!=1&&C.is_creator!=1?(o(),m("a",{key:0,onClick:h=>d(C)},"移除",8,Dr)):U("",!0)],64)):U("",!0)],64)):U("",!0)]),_:1},8,["columns","data-source"])])]),t(po,{onOk:n,ref_key:"addCollaboratorRef",ref:_},null,512)]),_:1})}}},Nr=B(Pr,[["__scopeId","data-v-93184c86"]]),xt=u=>(G("data-v-e4519b11"),u=u(),H(),u),Tr={class:"library-checkbox-box"},Vr={class:"list-box",ref:"scrollContainer"},Br={class:"library-name"},Qr={key:0,class:"library-desc"},Fr={class:"library-desc"},Jr={key:0,class:"empty-box"},Gr=xt(()=>e("img",{src:ht,alt:""},null,-1)),Hr=xt(()=>e("div",null,"暂无数据表, 请先去添加数据表",-1)),Kr=[Gr,Hr],Wr={__name:"robot-select-alert",emits:["change"],setup(u,{expose:c,emit:f}){const v=f,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),n=g(!1),_=r=>{w(),p.checkedList=r,n.value=!0},y=()=>{n.value=!1,d()};g("");const l=g([]),d=()=>{v("change",[...p.checkedList])},w=async()=>{const r=await it({application_type:1});if(r){let a=r.data||[];l.value=a}},i=g(!1);return c({open:_}),(r,a)=>{const $=Qe,x=Fe,R=je,b=X;return o(),z(b,{width:"746px",open:n.value,"onUpdate:open":a[1]||(a[1]=S=>n.value=S),title:"添加技能",onOk:y},{default:s(()=>[e("div",Tr,[t(R,{spinning:i.value,delay:100},{default:s(()=>[t(x,{value:p.checkedList,"onUpdate:value":a[0]||(a[0]=S=>p.checkedList=S),style:{width:"100%"}},{default:s(()=>[e("div",Vr,[(o(!0),m(T,null,K(l.value,S=>(o(),m("div",{class:"list-item-wraapper",key:S.id},[t($,{class:"list-item",disabled:S.start_node_key==="",value:S.id},{default:s(()=>[e("div",Br,[L(I(S.robot_name)+" ",1),S.start_node_key===""?(o(),m("span",Qr," (未发布)")):U("",!0)]),e("div",Fr,I(S.robot_intro),1)]),_:2},1032,["disabled","value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!i.value&&!l.value.length?(o(),m("div",Jr,Kr)):U("",!0)])]),_:1},8,["open"])}}},Zr=B(Wr,[["__scopeId","data-v-e4519b11"]]),Yr=u=>(G("data-v-13cb67dc"),u=u(),H(),u),Xr=Yr(()=>e("span",null,"支持关联工作流",-1)),e_={class:"actions-box"},t_={key:0,class:"library-list"},o_=["onClick"],s_={class:"library-name"},n_={class:"library-intro"},i_={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(u){const c=g(!1),{robotInfo:f,getRobot:v}=ee("robotInfo"),p=u,n=Q({work_flow_ids:[]}),_=g(null),y=be(()=>p.robotList.filter(r=>n.work_flow_ids.includes(r.id))),l=r=>{let a=n.work_flow_ids.indexOf(r.id);n.work_flow_ids.splice(a,1),i()},d=r=>{n.work_flow_ids=[...r],i()},w=()=>{_.value.open([...n.work_flow_ids])},i=()=>{let r={...Y(n)};r.work_flow_ids=r.work_flow_ids.join(","),Jt({id:f.id,...r}).then(a=>{Z.success("保存成功"),v(f.id)})};return Ae(()=>{n.work_flow_ids=f.work_flow_ids.split(",")}),(r,a)=>{const $=ne,x=se,R=qe;return o(),z(te,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:c.value,"onUpdate:isEdit":a[0]||(a[0]=b=>c.value=b),bodyStyle:{padding:0}},{tip:s(()=>[t($,{placement:"top"},{title:s(()=>[Xr]),default:s(()=>[t(k(oe))]),_:1})]),extra:s(()=>[e("div",e_,[t(R,{gap:8},{default:s(()=>[t(x,{size:"small",onClick:w},{default:s(()=>[L("添加技能")]),_:1})]),_:1})])]),default:s(()=>[y.value.length>0?(o(),m("div",t_,[(o(!0),m(T,null,K(y.value,b=>(o(),m("div",{class:"library-item",key:b.id},[e("span",{class:"close-btn",onClick:S=>l(b)},[t(k(ve))],8,o_),e("div",s_,I(b.robot_name),1),e("div",n_,I(b.robot_intro),1)]))),128))])):U("",!0),t(Zr,{ref_key:"robotSelectAlertRef",ref:_,onChange:d},null,512)]),_:1},8,["isEdit"])}}},a_=B(i_,[["__scopeId","data-v-13cb67dc"]]),l_={key:0,class:"robot-config-page"},c_={class:"setting-box"},r_={class:"setting-box"},__={class:"setting-box"},d_={class:"setting-box"},u_={class:"setting-box"},p_={class:"setting-box"},m_={class:"setting-box"},v_={class:"setting-box"},h_={class:"setting-box"},f_={class:"setting-box"},b_={class:"setting-box"},y_={class:"setting-box"},k_={class:"setting-box"},g_={class:"setting-box"},$_={key:1,class:"robot-config-page"},x_={key:2,class:"robot-config-page"},w_={__name:"index",setup(u){const c=co(),f=g(null),{robotInfo:v}=Ot(c),{getRobot:p}=c,n=()=>{f.value.scrollTop=f.value.scrollHeight},_=g(1),y=g(!1),l=Q(v.value),d=a=>{let $=JSON.parse(JSON.stringify(a));a.robot_avatar&&($.robot_avatar=new File([a.robot_avatar],a.robot_avatar.name)),Object.assign(l,$),r()},w=g([]);(()=>{it({application_type:1}).then(a=>{w.value=a.data||[]})})(),At("robotInfo",{robotInfo:l,updateRobotInfo:d,scrollBoxToBottom:n,getRobot:p});const r=()=>{let a;l.robot_avatar&&(a=new File([l.robot_avatar],l.robot_avatar.name));let $=JSON.parse(JSON.stringify(Y(l)));a&&($.robot_avatar=a);let x=$.welcomes;x.question=x.question.map(b=>b.content),$.welcomes=JSON.stringify(x),$.prompt_struct=JSON.stringify($.prompt_struct);let R=$.unknown_question_prompt;R.question=R.question.map(b=>b.content),$.unknown_question_prompt=JSON.stringify(R),delete $.robot_avatar_url,y.value=!0,Gt($).then(b=>{if(b.res!=0)return Z.error(b.msg);y.value=!1,Z.success("保存成功"),p(l.id)}).catch(()=>{y.value=!1})};return(a,$)=>{const x=_t,R=rt;return o(),m(T,null,[t(R,{class:"tab-wrapper",activeKey:_.value,"onUpdate:activeKey":$[0]||($[0]=b=>_.value=b)},{default:s(()=>[(o(),z(x,{key:1,tab:"基础配置"})),(o(),z(x,{key:3,tab:"权限管理"})),(o(),z(x,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),_.value==1?(o(),m("div",l_,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:f},[e("div",c_,[t(Go)]),e("div",r_,[t(Ua)]),e("div",__,[t(pi)]),e("div",d_,[t(vc)]),e("div",u_,[t(qn,{robotList:w.value},null,8,["robotList"])]),e("div",p_,[t(a_,{robotList:w.value},null,8,["robotList"])]),e("div",m_,[t(Ka)]),e("div",v_,[t(al)]),e("div",h_,[t(yl)]),e("div",f_,[t(Tl)]),e("div",b_,[t(Ul)]),e("div",y_,[t(zl)]),e("div",k_,[t(tr)]),e("div",g_,[t(ir)])],512)])):U("",!0),_.value==2?(o(),m("div",$_,[t(Yc)])):U("",!0),_.value==3?(o(),m("div",x_,[t(Nr)])):U("",!0)],64)}}},eu=B(w_,[["__scopeId","data-v-6f46d4b4"]]);export{eu as default};
