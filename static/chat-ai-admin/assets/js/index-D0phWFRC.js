import{_ as at}from"./cu-scroll-CSP3phOX.js";import{a3 as W,d as y,ag as nt,N as c,O as l,j as o,U as n,_ as p,X as i,a6 as P,H as A,F as E,a1 as H,Z as f,S as R,u as v,Y as U,a0 as G,z as lt}from"./vue-chunks-BRsu9_To.js";import{S as X,a as rt,c as Y,C as ut,b as ct,E as _t}from"./edit-subsection-BqDvmJmK.js";import{b as tt,a2 as pt,bs as dt,dn as mt,dp as vt,k as et,M as Z,dq as ft,E as gt,dr as K,B as ht,ds as yt}from"../../index-CRscgXfx.js";import{C as kt}from"./ClockCircleFilled-C8Srzt9c.js";import{S as bt}from"./index-BJIaPIed.js";import"./index-BlBVtNBL.js";import{D as St}from"./dropdown-BHoAAsqQ.js";import{M as Ct,_ as xt}from"./index-SJnDd6Rt.js";import{S as Lt}from"./SettingOutlined-w6g_aHaa.js";import{S as qt}from"./SyncOutlined-B48sHOdT.js";import{M as wt}from"./MoreOutlined-CHUGTR7O.js";import{_ as Mt,a as Ot}from"./index-D1E7SziE.js";import{_ as Et}from"./index-1HwKIEyy.js";import{_ as $t}from"./index-BVnAXR9n.js";import{S as It}from"./index-DXTWDqAJ.js";import{S as Dt,a as Nt}from"./index-CVagTbWa.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./index-8qL8QPop.js";import"./index-CxTVzuqL.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./DownloadOutlined-Cs6WKIxY.js";import"./pick-OzLIok56.js";import"./index-V4Jlr1g1.js";import"./Trigger-D-LMK5CQ.js";import"./isPlainObject-DRl1_5Z2.js";import"./responsiveObserve-B2v9U3jv.js";import"./collapseMotion-Brd6xpAT.js";import"./QuestionCircleOutlined-DKLyIfpc.js";import"./FormItemContext-DiOlYi_l.js";import"./CheckOutlined-BnY3VuYw.js";import"./PlusOutlined-Bx_uxzSh.js";import"./slide-Cad5dMPr.js";import"./index-CuQqX42V.js";import"./Input-tyEnRv5y.js";import"./index-BbckQ73x.js";import"./inputProps-QKn333yB.js";import"./Search-Dt3FbMlF.js";import"./SearchOutlined-CoZBl7jN.js";import"./TextArea-K98swN5P.js";import"./Password-Bmz-BBqy.js";import"./index-Bcl7lC2R.js";import"./index-CRufPZma.js";import"./index-DlRXMuhZ.js";import"./index-EGty8niG.js";import"./index-C6-J9yG8.js";import"./index-BMSQkwth.js";import"./LeftOutlined-uIrzY1Cj.js";import"./index-B8WxZfGn.js";import"./index-DNhtS_r9.js";import"./UpOutlined-DO_UwGzj.js";import"./DownOutlined-h1NhriVT.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./RightOutlined-lY7LuswZ.js";import"./move-l5WLgE3F.js";import"./colors-GzwEvaOH.js";import"./shallowequal-C0xnIuy8.js";import"./index-B8SodJ6b.js";import"./useMaxLevel-CYfr9rO5.js";import"./CaretDownFilled-BpWA4j__.js";import"./index-Ce309YPQ.js";import"./fromPairs-Dx9PT-t0.js";import"./index-Crw1ZBO9.js";import"./Checkbox-BVj74R9p.js";import"./index-B6iWcNlt.js";import"./RadioButton-IT2uDinU.js";import"./CaretDownOutlined-nlIRj18D.js";import"./index-BY4zatuG.js";const Pt={class:"subsection-box"},Bt=["onClick"],Ft={key:1,class:"file-name-text",style:{color:"#F40"}},zt={key:2,class:"qa-list-box"},Rt={class:"list-item"},Ht={class:"list-content"},Jt={key:0,class:"list-item"},Vt={class:"list-content"},Qt={class:"list-item"},Tt={class:"list-content"},jt={class:"fragment-img"},At=["src"],Ut={key:3,class:"common-list-box"},Gt={class:"top-block"},Xt={class:"title"},Yt={class:"title"},Zt=["innerHTML"],Kt={class:"fragment-img"},Wt=["src"],te={key:0,class:"status-tag"},ee={key:1,class:"status-tag complete"},se={class:"status-tag status-error"},oe={key:3,class:"status-tag running"},ie={class:"right-opration"},ae={class:"hover-btn-box"},ne=["onClick"],le=["onClick"],re={class:"hover-btn-box"},ue=["onClick"],ce=["onClick"],_e={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup($,{expose:j,emit:B}){const L=B,_=$,F=W().query,I=(r,a)=>{let{id:d,title:b,content:N,question:M,answer:h,images:S,category_id:C,library_id:x}=r,s=r.similar_questions||[];Z.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${a+1}】吗?`,onOk(){return new Promise((t,u)=>{ft({id:d,library_id:x,title:b,content:N,question:M,answer:h,images:S,category_id:C,similar_questions:JSON.stringify(s)}).then(e=>{L("handleConvert",r),t()}).catch(()=>{t()})})},onCancel(){}})},q=r=>{L("openEditSubscription",r)},z=r=>{Z.confirm({title:"提示",icon:o(gt),content:"是否取消该标记?",onOk(){w(r,{})},onCancel(){}})},m=y([]),g=()=>{mt({library_id:F.id}).then(r=>{m.value=r.data||[],L("getStatrList",r.data||[])})};g();const D=y(null),J=()=>{D.value.show()},V=r=>{var d;let a=(d=m.value.filter(b=>b.id==r.category_id)[0])==null?void 0:d.type;return a?Y[a]:"#F4EA2A"},w=(r,a={})=>{vt({id:r.id,category_id:a.id||0}).then(d=>{et.success("修改成功"),a.id?r.category_id=a.id:L("handleDelParagraph",r.id),g()})},Q=r=>{window.open(`/#/library/preview?id=${r.file_id}`)};return j({handleOpenEditModal:q}),(r,a)=>{const d=Mt,b=Et,N=bt,M=$t,h=xt,S=Ct,C=St,x=Ot,s=nt("viewer");return l(),c("div",Pt,[o(x,{"data-source":$.paragraphLists,pagination:!1},{default:n(()=>[o(d,{key:"id","data-index":"id",width:1148},{title:n(()=>[$.isQaLibray?(l(),c(E,{key:0},[f(" 问答（共"+p(_.total)+"个） ",1)],64)):(l(),c(E,{key:1},[f("分段 （共"+p(_.total)+"个分段）",1)],64))]),default:n(({record:t,index:u})=>[t.file_name?(l(),c("a",{key:0,class:"file-name-text",onClick:e=>Q(t)},p(t.file_name),9,Bt)):(l(),c("div",Ft,"原文档已删除")),$.isQaLibray?(l(),c("div",zt,[i("div",Rt,[a[0]||(a[0]=i("div",{class:"list-label"},"问题",-1)),i("div",Ht,p(t.question),1)]),t.similar_questions&&t.similar_questions.length?(l(),c("div",Jt,[a[1]||(a[1]=i("div",{class:"list-label"},"相似问法",-1)),i("div",Vt,p(t.similar_questions.join("/")),1)])):P("",!0),i("div",Qt,[a[2]||(a[2]=i("div",{class:"list-label"},"答案",-1)),i("div",Tt,p(t.answer),1)]),A((l(),c("div",jt,[(l(!0),c(E,null,H(t.images,(e,O)=>(l(),c("img",{key:O,src:e,alt:""},null,8,At))),128))])),[[s]])])):(l(),c("div",Ut,[i("div",Gt,[i("div",Xt,"分段"+p(u+1),1),i("div",Yt,p(t.title),1),i("span",null,"共"+p(t.word_total)+"个字符",1)]),i("div",{class:"content-box",innerHTML:t.content},null,8,Zt),A((l(),c("div",Kt,[(l(!0),c(E,null,H(t.images,(e,O)=>(l(),c("img",{key:O,src:e,alt:""},null,8,Wt))),128))])),[[s]])]))]),_:1}),o(d,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:n(({record:t})=>[t.status==0?(l(),c("span",te,[o(v(kt)),a[3]||(a[3]=f(" 未转换"))])):P("",!0),t.status==1?(l(),c("span",ee,[o(v(pt)),a[4]||(a[4]=f(" 已转换"))])):P("",!0),t.status==2?(l(),R(b,{key:2,placement:"top"},{title:n(()=>[i("span",null,p(t.errmsg),1)]),default:n(()=>[i("span",null,[i("span",se,[o(v(dt)),a[5]||(a[5]=f(" 转换异常"))])])]),_:2},1024)):P("",!0),t.status==3?(l(),c("span",oe,[o(N,{size:"small"}),a[6]||(a[6]=f(" 转换中"))])):P("",!0)]),_:1}),o(d,{title:"操作",key:"action","data-index":"action",width:120},{default:n(({record:t,index:u})=>[i("div",ie,[o(C,null,{overlay:n(()=>[o(S,null,{default:n(()=>[(l(!0),c(E,null,H(m.value,e=>(l(),R(h,{key:e.id},{default:n(()=>[i("div",{class:"start-item",onClick:O=>w(t,e)},[o(v(X),{style:U({color:v(Y)[e.type]})},null,8,["style"]),i("div",null,p(e.name||"-"),1)],8,ne)]),_:2},1024))),128)),o(h,null,{default:n(()=>[i("div",{class:"start-item",onClick:J},[o(v(Lt)),a[7]||(a[7]=i("div",null,"标记设置",-1))])]),_:1})]),_:2},1024)]),default:n(()=>[i("div",ae,[t.category_id>0?(l(),R(M,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:e=>w(t,{})},{default:n(()=>[o(v(X),{style:U({color:V(t),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(l(),R(v(rt),{key:1,onClick:e=>w(t,m.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),o(b,null,{title:n(()=>a[8]||(a[8]=[f("重新转换")])),default:n(()=>[i("div",{class:"hover-btn-box",onClick:e=>I(t,u)},[o(v(qt))],8,le)]),_:2},1024),o(C,{placement:"bottomRight"},{overlay:n(()=>[o(S,null,{default:n(()=>[o(h,null,{default:n(()=>[i("div",{onClick:G(e=>q(t),["stop"])},"编辑",8,ue)]),_:2},1024),o(h,null,{default:n(()=>[i("div",{onClick:G(e=>z(t),["stop"])},"删除",8,ce)]),_:2},1024)]),_:2},1024)]),default:n(()=>[i("div",re,[o(v(wt))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),o(ut,{onOk:g,ref_key:"classificationMarkModalRef",ref:D},null,512)])}}},pe=tt(_e,[["__scopeId","data-v-a02e9965"]]),de={class:"robot-page"},me={class:"search-content-block"},ve={class:"selct-star-box"},fe={class:"scroll-box"},ge={class:"content-block"},he={__name:"index",setup($){const B=W().query,L=y([]),_=y([]),k=y(0),F={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},I={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},q=y({}),z=s=>{L.value=s},m=y({page:1,size:10}),g=lt({status:-1,category_id:-1,library_id:B.id}),D=()=>{m.value.page=1,k.value=0,_.value=[],x()},J=s=>{g.category_id=s,D()},V=()=>{yt({id:B.id}).then(()=>et.success("操作完成"))},w=y(null),Q=s=>{w.value.showModal(JSON.parse(JSON.stringify(s)))},r=s=>{if(!s.id){m.value.page=1,x();return}let t=_.value,u=t.findIndex(e=>e.id==s.id);if(u>-1){let e=t[u];e.title=s.title,e.content=s.content,e.question=s.question,e.answer=s.answer,e.answer=s.answer,e.images=s.images,e.category_id=s.category_id,e.word_total=s.question.length+s.answer.length+s.content.length,e.similar_questions=JSON.parse(s.similar_questions),t.splice(u,1,e),_.value=t}},a=s=>{let t=_.value,u=t.findIndex(e=>e.id==s);u>-1&&(t.splice(u,1),_.value=t,k.value=--k.value,k.value)},d=()=>{C.value||_.value.length>=k.value||b()},b=()=>{m.value.page++,x()},N=()=>{h()};function M(){clearInterval(S),_.value.filter(t=>t.status==3).length?S=setInterval(()=>{h()},5e3):clearInterval(S)}const h=()=>{K({page:1,size:_.value.length,...g}).then(s=>{let u=s.data.list||[];u.forEach(e=>{e.status_text=I[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),_.value=u,M()})};let S=null;const C=y(!1),x=()=>{C.value=!0,K({...m.value,...g}).then(s=>{C.value=!1;let t=s.data,u=t.list||[];t.info&&(q.value={...t.info,is_qa_doc:t.info.type==2?1:0}),q.value={...t.info,is_qa_doc:t.info.type==2?1:0},u.forEach(e=>{e.status_text=I[e.status],e.graph_status_text=F[e.graph_status],e.similar_questions&&(e.similar_questions=JSON.parse(e.similar_questions))}),m.value.page==1&&(_.value=[]),_.value=[..._.value,...u],k.value=t.total,M()})};return x(),(s,t)=>{const u=Nt,e=Dt,O=ht,st=It,ot=at;return l(),c("div",de,[i("div",me,[i("div",ve,[o(ct,{hideId:[0],startLists:L.value,onChange:J},null,8,["startLists"])]),o(st,null,{default:n(()=>[o(e,{value:g.status,"onUpdate:value":t[0]||(t[0]=T=>g.status=T),placeholder:"请选择",style:{width:"160px"},onChange:D},{default:n(()=>[o(u,{value:-1},{default:n(()=>t[1]||(t[1]=[f("全部嵌入状态")])),_:1,__:[1]}),(l(),c(E,null,H(I,(T,it)=>o(u,{value:it},{default:n(()=>[f(p(T),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),o(O,{onClick:V},{default:n(()=>t[2]||(t[2]=[f("重新嵌入向量")])),_:1,__:[2]})]),_:1})]),i("div",fe,[o(ot,{scrollbar:{minSize:0},onOnScrollEnd:d},{default:n(()=>[i("div",ge,[o(pe,{ref:"subsectionBoxRef",isQaLibray:q.value.is_qa_doc,total:k.value,paragraphLists:_.value,onOpenEditSubscription:Q,onHandleDelParagraph:a,onHandleConvert:N,onGetStatrList:z},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),o(_t,{detailsInfo:q.value,onHandleEdit:r,onHandleStatrList:z,ref_key:"editSubscriptionRef",ref:w},null,8,["detailsInfo"])])}}},Fs=tt(he,[["__scopeId","data-v-ea13d700"]]);export{Fs as default};
