import{b as W,l as Y,k as w,a2 as Z,d as G,M as H}from"../../index-CfxQ5aRu.js";import{e as K,c as X}from"./index-OIK33vUW.js";import{F as U,_ as ee}from"./index-xqeVJHPz.js";import"./index-DPiF7UEG.js";import{R as te,_ as ae}from"./RadioButton-_iRIgmgW.js";import{A as oe}from"./index-DjukszQZ.js";import{C as se,_ as ne}from"./index-CxLzlFzW.js";import{b as le,e as d,B as j,M as r,N as u,k as n,S as s,W as _,Y as c,a7 as v,F as A,$ as N,Q as h,u as re,Z as g}from"./vue-chunks-BjMuQ6KD.js";import{U as ie}from"./UserOutlined-kSSEuP4H.js";const _e={class:"form-box"},ue={key:0,class:"form-tip"},de={key:0,class:"list-box"},ce=["onClick"],pe={class:"user-block"},ve={class:"name-box"},me={class:"name"},fe={class:"remark-text"},ye={key:1,class:"checkbox-list"},he={class:"checklist-item"},ge={__name:"add-collaborator",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(ke,{expose:F,emit:M}){const k=le(()=>Y().role_permission||[]),S=M,B=U.useForm,m=d(!1),l=j({identity_type:"1",operate_rights:"4"}),i=d([]),p=d([]),O=t=>{t.role_type!=1&&(i.value.includes(t.id)?i.value=i.value.filter(a=>a!=t.id):i.value.push(t.id))},V=j({});B(l,V);let f=[];const q=(t,a)=>{D(),P(),i.value=[],p.value=[],t.forEach(o=>{o.identity_type==1&&i.value.push(o.identity_id),o.identity_type==2&&p.value.push(o.identity_id)}),l.operate_rights="4",l.identity_type="1",f=a,m.value=!0},y=d(!1),z=()=>{f=f.map(o=>({object_id:+o.object_id,object_type:+o.object_type,operate_rights:+l.operate_rights}));let t=[];if(l.identity_type==1?t=i.value:t=p.value,t.length==0){w.error("请选择成员或成员组织");return}let a={identity_type:l.identity_type,object_array:JSON.stringify(f),identity_ids:t.join(",")};y.value=!0,K(a).then(o=>{w.success("保存成功"),m.value=!1,S("ok")}).finally(()=>{y.value=!1})},b=d([]),D=()=>{Z({page:1,size:200}).then(t=>{b.value=t.data.list})},x=d([]),P=()=>{X().then(t=>{let a=t.data||[];x.value=a})},R=()=>{window.open("/#/user/manage")};return F({show:q}),(t,a)=>{const o=te,C=ae,L=ee,$=oe,E=G,I=se,T=ne,J=U,Q=H;return r(),u("div",null,[n(Q,{open:m.value,"onUpdate:open":a[3]||(a[3]=e=>m.value=e),title:"添加协作者",onOk:z,width:746,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"500px","overflow-y":"auto"},confirmLoading:y.value},{default:s(()=>[_("div",_e,[n(J,{layout:"vertical"},{default:s(()=>[n(L,{label:"协作权限",required:""},{default:s(()=>[n(C,{value:l.operate_rights,"onUpdate:value":a[0]||(a[0]=e=>l.operate_rights=e)},{default:s(()=>[n(o,{value:"4"},{default:s(()=>[c("管理")]),_:1}),n(o,{value:"2"},{default:s(()=>[c("编辑")]),_:1}),n(o,{value:"1"},{default:s(()=>[c("查看")]),_:1})]),_:1},8,["value"])]),_:1}),n(L,{label:"协作者",required:""},{default:s(()=>[n(C,{value:l.identity_type,"onUpdate:value":a[1]||(a[1]=e=>l.identity_type=e)},{default:s(()=>[n(o,{value:"1"},{default:s(()=>[c("按成员选")]),_:1}),n(o,{value:"2"},{default:s(()=>[c("按组织架构")]),_:1})]),_:1},8,["value"]),k.value&&k.value.includes("TeamManage")?(r(),u("div",ue,[c(" 如果协作者没有账号，请先到团队管理中添加账号 "),_("a",{onClick:R},"去添加")])):v("",!0)]),_:1}),l.identity_type==1?(r(),u("div",de,[(r(!0),u(A,null,N(b.value,e=>(r(),u("div",{class:"type-item",key:e.value,onClick:be=>O(e)},[_("div",pe,[n($,{shape:"square",src:e.avatar,size:40},{icon:s(()=>[e.avatar?v("",!0):(r(),h(re(ie),{key:0}))]),_:2},1032,["src"]),_("div",ve,[_("div",me,g(e.user_name),1),_("div",fe,g(e.nick_name),1)])]),i.value.includes(e.id)?(r(),h(E,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],8,ce))),128))])):v("",!0),l.identity_type==2?(r(),u("div",ye,[n(T,{value:p.value,"onUpdate:value":a[2]||(a[2]=e=>p.value=e),style:{width:"100%"}},{default:s(()=>[_("div",he,[(r(!0),u(A,null,N(x.value,e=>(r(),h(I,{key:e.id,value:e.id},{default:s(()=>[_("div",null,g(e.department_name),1)]),_:2},1032,["value"]))),128))])]),_:1},8,["value"])])):v("",!0)]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},Me=W(ge,[["__scopeId","data-v-fc1952f5"]]);export{Me as A};
