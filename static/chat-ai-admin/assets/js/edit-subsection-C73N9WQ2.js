import{A as he,b as te,dl as ge,dq as Ve,k as M,M as ye,dk as Be,dr as Ee,ds as Ne,B as Te,d as Re}from"../../index-CfxQ5aRu.js";import{_ as be,T as xe}from"./index-BMYKVcHu.js";import{k as r,e as _,M as v,N as g,S as p,Q as V,Y as S,W as t,u as F,a7 as C,F as ee,$ as Ge,X as ae,Z as D,B as de,w as He,a5 as Ke,G as _e,H as me,a6 as Qe,z as We,a1 as Je,a2 as Ze}from"./vue-chunks-BjMuQ6KD.js";import"./index-DcUUFn-g.js";import{I as we}from"./Input-C5WaaE9Z.js";import{_ as Xe,a as Ye}from"./index-P3IiyBCy.js";import{U as et}from"./index-CL2f_cnE.js";import{C as tt}from"./index-BWdnNCYH.js";import{M as at}from"./index-BMSQkwth.js";import{L as nt}from"./LeftOutlined-qzkQKHcF.js";import{_ as st}from"./index-DJgb7gGJ.js";import{_ as ot}from"./TextArea-CN_AI7y7.js";import{_ as lt}from"./index-QsoU6-T8.js";var it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"};const rt=it;function ve(e){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(l){return Object.getOwnPropertyDescriptor(o,l).enumerable}))),i.forEach(function(l){ct(e,l,o[l])})}return e}function ct(e,s,o){return s in e?Object.defineProperty(e,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[s]=o,e}var ne=function(s,o){var i=ve({},s,o.attrs);return r(he,ve({},i,{icon:rt}),null)};ne.displayName="StarFilled";ne.inheritAttrs=!1;const se=ne;var ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};const dt=ut;function pe(e){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},i=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(l){return Object.getOwnPropertyDescriptor(o,l).enumerable}))),i.forEach(function(l){_t(e,l,o[l])})}return e}function _t(e,s,o){return s in e?Object.defineProperty(e,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[s]=o,e}var oe=function(s,o){var i=pe({},s,o.attrs);return r(he,pe({},i,{icon:dt}),null)};oe.displayName="StarOutlined";oe.inheritAttrs=!1;const Se=oe,le={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},mt={class:"star-select-box"},vt={class:"star-item"},pt={class:"star-item"},ft={key:0},ht={__name:"selct-star-box",props:{startLists:{type:Array,default:()=>[]},hideId:{type:[Number,String,Array],default:()=>[]}},emits:["change"],setup(e,{emit:s}){const o=s,i=e,l=_(-1),y=()=>{o("change",l.value)};return(x,w)=>{const d=be,P=xe;return v(),g("div",mt,[r(P,{activeKey:l.value,"onUpdate:activeKey":w[0]||(w[0]=f=>l.value=f),size:"small",onChange:y},{default:p(()=>[(v(),V(d,{key:-1},{tab:p(()=>[S("全部")]),_:1})),e.hideId.includes(0)?C("",!0):(v(),V(d,{key:0},{tab:p(()=>[t("div",vt,[r(F(Se)),S("未精选")])]),_:1})),(v(!0),g(ee,null,Ge(i.startLists,f=>(v(),V(d,{key:f.id},{tab:p(()=>[t("div",pt,[r(F(se),{style:ae({color:F(le)[f.type]})},null,8,["style"]),S(" "+D(f.name||"-")+" ",1),f.data_count>0?(v(),g("span",ft,"("+D(f.data_count)+")",1)):C("",!0)])]),_:2},1024))),128))]),_:1},8,["activeKey"])])}}},nn=te(ht,[["__scopeId","data-v-e555fc42"]]),gt={class:"modal-box"},yt={class:"list-box"},bt={__name:"classification-mark-modal",emits:["ok"],setup(e,{expose:s,emit:o}){const i=_(!1),l=o,y=_([]),x=()=>{w(),i.value=!0},w=()=>{ge().then(P=>{y.value=P.data})},d=()=>{let P=y.value.map(f=>({id:+f.id,name:f.name}));Ve({data:JSON.stringify(P)}).then(f=>{M.success("保存成功"),l("ok"),i.value=!1})};return s({show:x}),(P,f)=>{const A=Xe,z=we,W=Ye,B=ye;return v(),g("div",null,[r(B,{open:i.value,"onUpdate:open":f[0]||(f[0]=k=>i.value=k),title:"精选设置",onOk:d,width:586},{default:p(()=>[t("div",gt,[t("div",yt,[r(W,{"data-source":y.value,pagination:!1},{default:p(()=>[r(A,{key:"tags",title:"图标","data-index":"tags",width:200},{default:p(({record:k})=>[r(F(se),{class:"start-icon",style:ae({color:F(le)[k.type]})},null,8,["style"])]),_:1}),r(A,{key:"name",title:"备注","data-index":"name",width:200},{default:p(({record:k})=>[r(z,{value:k.name,"onUpdate:value":E=>k.name=E,maxLength:4,placeholder:"请设置,最多4个字"},null,8,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source"])])])]),_:1},8,["open"])])}}},sn=te(bt,[["__scopeId","data-v-52814820"]]);var u={},ie;Object.defineProperty(u,"__esModule",{value:!0});u.controlDefaultValue=u.capitalize=u.camelize=u.cacheStringFunction=void 0;u.getDataAndAriaProps=Mt;u.isSymbol=u.isString=u.isOn=u.isObject=u.isFunction=ie=u.isArray=u.hyphenate=void 0;u.renderHelper=Ft;u.resolvePropValue=At;u.toPx=Dt;u.wrapPromiseFn=$t;const ke=e=>typeof e=="function";u.isFunction=ke;u.controlDefaultValue=Symbol("controlDefaultValue");ie=u.isArray=Array.isArray;const xt=e=>typeof e=="string";u.isString=xt;const wt=e=>typeof e=="symbol";u.isSymbol=wt;const St=e=>e!==null&&typeof e=="object";u.isObject=St;const kt=/^on[^a-z]/,Ot=e=>kt.test(e);u.isOn=Ot;const Q=e=>{const s=Object.create(null);return o=>s[o]||(s[o]=e(o))};u.cacheStringFunction=Q;const Lt=/-(\w)/g;u.camelize=Q(e=>e.replace(Lt,(s,o)=>o?o.toUpperCase():""));const Ct=/\B([A-Z])/g;u.hyphenate=Q(e=>e.replace(Ct,"-$1").toLowerCase());u.capitalize=Q(e=>e.charAt(0).toUpperCase()+e.slice(1));const Pt=Object.prototype.hasOwnProperty,fe=(e,s)=>Pt.call(e,s);function At(e,s,o,i){const l=e[o];if(l!=null){const y=fe(l,"default");if(y&&i===void 0){const x=l.default;i=l.type!==Function&&ke(x)?x():x}l.type===Boolean&&(!fe(s,o)&&!y?i=!1:i===""&&(i=!0))}return i}function Mt(e){return Object.keys(e).reduce((s,o)=>((o.startsWith("data-")||o.startsWith("aria-"))&&(s[o]=e[o]),s),{})}function Dt(e){return typeof e=="number"?`${e}px`:e}function Ft(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return typeof e=="function"?e(s):e??o}function $t(e){let s;const o=new Promise(l=>{s=e(()=>{l(!0)})}),i=()=>{s==null||s()};return i.then=(l,y)=>o.then(l,y),i.promise=o,i}const h=e=>(Je("data-v-da2dc230"),e=e(),Ze(),e),jt={class:"custom-modal-header"},qt={class:"form-box-wrapper"},zt={class:"form-item"},It=h(()=>t("div",{class:"form-label"},"分段标题：",-1)),Ut={class:"form-content"},Vt={class:"form-item"},Bt=h(()=>t("div",{class:"form-label"},"分段分类标记",-1)),Et={class:"form-content"},Nt={class:"star-item-box"},Tt={key:2},Rt={class:"form-item"},Gt=h(()=>t("div",{class:"form-label required"},"分段问题：",-1)),Ht={class:"form-content"},Kt={class:"form-item"},Qt={class:"form-label-box"},Wt=h(()=>t("div",{class:"form-label required"},"相似问法",-1)),Jt=h(()=>t("div",{class:"ai-generate-text"},"AI自动生成",-1)),Zt={class:"form-content"},Xt=h(()=>t("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1)),Yt={class:"form-item"},ea=h(()=>t("div",{class:"form-label required"},"分段答案：",-1)),ta={class:"form-content"},aa={key:0,class:"error-tip"},na={key:1,class:"form-item"},sa=h(()=>t("div",{class:"form-label required"},"分段内容：",-1)),oa={class:"form-content"},la={key:0,class:"error-tip"},ia={class:"form-item"},ra=h(()=>t("div",{class:"form-label"},"附件",-1)),ca={class:"form-content"},ua={class:"upload-box-wrapper"},da={key:0},_a={class:"ai-generate-wrapper"},ma={class:"form-box-wrapper ai-generate-wrapper-box"},va={class:"ai-generate-wrapper-left"},pa={class:"form-box-wrapper-options"},fa={class:"form-item flex1"},ha=h(()=>t("div",{class:"form-label required"},"相似问法模型：",-1)),ga={class:"form-content"},ya={class:"form-item flex1"},ba={class:"form-content dual-inputs"},xa={class:"input-group"},wa=h(()=>t("div",{class:"form-label required"},"问题个数：",-1)),Sa={class:"form-label-input-box"},ka={class:"form-box-wrapper-content"},Oa={class:"problem-box"},La=h(()=>t("div",{class:"problem"},"问题",-1)),Ca={class:"problem-content"},Pa={class:"problem-box"},Aa=h(()=>t("div",{class:"problem"},"答案",-1)),Ma={class:"problem-content"},Da={class:"form-item generate-btn-box"},Fa={class:"result-nav"},$a={key:0,class:"tip"},ja={key:1,class:"result-nav-text"},qa={key:0,class:"container"},za=h(()=>t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1)),Ia=h(()=>t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1)),Ua=h(()=>t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)),Va=[za,Ia,Ua],Ba={class:"result-container"},Ea=["innerHTML"],Na={class:"result-footer"},Ta={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(e,{expose:s,emit:o}){const i=_(!1),l=_(!1),y=_(!1),x=_(!1),w=_(!1),d=de({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5}),P=new at({html:!0,linkify:!0,typographer:!0}),f=_(""),A=de({finish:"",content:""});He(()=>A.content,()=>{f.value=P.render(A.content)});const z=Ke(),W=z.query,B=z.name,k=e,E=o,Oe=_(""),Le=["azure","ollama","xinference","openaiAgent"],re=_("1"),I=_(!1),T=_(""),$=_(""),O=_(""),j=_(""),L=_(""),U=_([]),N=_(0),J=_(""),q=_(!1),Ce=n=>{l.value=!1,y.value=!1,w.value=!1,T.value=n.title||"",$.value=n.content||"",J.value=n.id||"",O.value=n.answer||"",U.value=n.images||[],j.value=n.question||"",L.value=n.similar_questions?n.similar_questions.join(`
`):"",q.value=k.detailsInfo.is_qa_doc=="1",N.value=n.category_id||0,X(),I.value=!0},Z=_([]),X=()=>{ge({file_id:W.id}).then(n=>{let a=n.data||[];a=a.map(m=>({value:m.id,payload:{...m,color:le[m.type]}})),B=="categaryManages"?Z.value=[...a]:Z.value=[{value:0,payload:{id:0,name:"未标记"}},...a],E("handleStatrList",n.data||[])})},ce=()=>{if(ue(),!$.value&&!q.value)return M.error("请输入分段内容");if(!j.value&&q.value)return M.error("请输入分段问题");if(!O.value&&q.value)return M.error("请输入分段答案");if(q.value&&O.value.length>1e4||!q.value&&$.value.length>1e4)return;if(B=="categaryManages"&&N.value<=0)return M.error("请选择分类标记");let n={title:T.value,content:$.value,question:j.value,answer:O.value,images:U.value,category_id:N.value},a=L.value.trim();a?(a=a.split(`
`),n.similar_questions=JSON.stringify(a)):n.similar_questions="[]",J.value?n.id=J.value:n.file_id=z.query.id;let m=new FormData;for(let b in n)ie(n[b])?n[b].forEach(Y=>{m.append(b,Y)}):m.append(b,n[b]);B=="categaryManages"?(m.delete("file_id"),m.append("library_id",z.query.id),Be(m).then(b=>{M.success(n.id?"修改成功":"添加成功"),I.value=!1,E("handleEdit",{...n}),X()})):Ee(m).then(b=>{M.success(n.id?"修改成功":"添加成功"),I.value=!1,E("handleEdit",{...n}),X()})},Pe=()=>{l.value=!0},R=_(""),Ae=async()=>{A.content="",R.value="",x.value=!0,w.value=!0;try{let n={library_id:k.detailsInfo.library_id,model_config_id:d.model_config_id,use_model:d.use_model,num:d.count,question:j.value,answer:O.value};const a=await Ne(n);R.value=a.data.map(m=>m).join(`
`),A.content=a.data.map((m,b)=>`<div class="dialog-message">${b+1}. ${m}</div>`).join(""),y.value=!0}finally{x.value=!1}},Me=()=>{L.value?L.value+=`
${R.value}`:L.value+=R.value,M.success("保存成功"),y.value=!1,l.value=!1,w.value=!1},De=n=>{d.use_model=Le.includes(n.rawData.model_define)&&n.rawData.deployment_name?n.rawData.deployment_name:n.rawData.name,d.use_model_icon=n.icon,d.use_model_name=n.use_model_name,d.model_config_id=n.rawData.id,Oe.value=n.rawData.model_define},G=_([]),Fe=n=>{G.value=n,We(()=>{(!d.ai_chunk_model||!Number(d.ai_chunk_model_config_id))&&$e()})},$e=()=>{if(G.value.length>0){let n=null,a=null;for(let m of G.value)if(m.model_define==="tongyi"){n=m;for(let b of n.children)if(b.name==="qwen-max"){a=b;break}break}n||(n=G.value[0],a=n.children[0]),n&&a&&(d.use_model=a.name,d.model_config_id=a.model_config_id,d.ai_chunk_model=a.name,d.ai_chunk_model_config_id=a.model_config_id)}};function je(n){return n.split(`
`).map(a=>a.trim()).filter(a=>a).join(`
`)}const ue=()=>{L.value=je(L.value)};return s({showModal:Ce}),(n,a)=>{const m=Te,b=we,Y=st,H=ot,K=Re,qe=be,ze=xe,Ie=lt,Ue=ye;return v(),g("div",null,[r(Ue,{open:I.value,"onUpdate:open":a[12]||(a[12]=c=>I.value=c),onOk:ce,width:l.value?w.value?"944px":"472px":"746px","ok-button-props":{style:{display:l.value?"none":"block"}}},{title:p(()=>[t("div",jt,[l.value?(v(),V(m,{key:0,type:"text",class:"back-button",onClick:a[0]||(a[0]=c=>l.value=!1)},{icon:p(()=>[r(F(nt),{style:{"font-size":"12px"}})]),_:1})):C("",!0),t("span",null,D(l.value?"AI生成相似问法":"编辑分段"),1)])]),footer:p(()=>[l.value?C("",!0):(v(),g(ee,{key:0},[r(m,{onClick:a[11]||(a[11]=c=>I.value=!1)},{default:p(()=>[S("取消")]),_:1}),r(m,{type:"primary",onClick:ce},{default:p(()=>[S("确定")]),_:1})],64))]),default:p(()=>[_e(t("div",qt,[t("div",zt,[It,t("div",Ut,[r(b,{maxLength:25,value:T.value,"onUpdate:value":a[1]||(a[1]=c=>T.value=c),placeholder:"请输入分段标题"},null,8,["value"])])]),t("div",Vt,[Bt,t("div",Et,[r(Y,{value:N.value,"onUpdate:value":a[2]||(a[2]=c=>N.value=c),options:Z.value},{label:p(({payload:c})=>[t("div",Nt,[c.id>0?(v(),V(F(se),{key:0,style:ae({color:c.color})},null,8,["style"])):(v(),V(F(Se),{key:1})),t("div",null,D(c.name||"-"),1),S(),c.data_count>0?(v(),g("span",Tt,"("+D(c.data_count)+")",1)):C("",!0)])]),_:1},8,["value","options"])])]),q.value?(v(),g(ee,{key:0},[t("div",Rt,[Gt,t("div",Ht,[r(H,{placeholder:"请输入分段问题",value:j.value,"onUpdate:value":a[3]||(a[3]=c=>j.value=c),style:{height:"100px"}},null,8,["value"])])]),t("div",Kt,[t("div",Qt,[Wt,t("div",{class:"ai-generate",onClick:Pe},[r(K,{name:"ai-generate",style:{"font-size":"14px"}}),Jt])]),t("div",Zt,[r(H,{placeholder:"请输入相似问法",value:L.value,"onUpdate:value":a[4]||(a[4]=c=>L.value=c),style:{height:"100px"},onBlur:ue},null,8,["value"]),Xt])]),t("div",Yt,[ea,t("div",ta,[r(H,{placeholder:"请输入分段答案",value:O.value,"onUpdate:value":a[5]||(a[5]=c=>O.value=c),style:{height:"100px"}},null,8,["value"]),O.value.length>1e4?(v(),g("div",aa,"分段答案最多支持10000个字符")):C("",!0)])])],64)):(v(),g("div",na,[sa,t("div",oa,[r(H,{style:{height:"150px"},value:$.value,"onUpdate:value":a[6]||(a[6]=c=>$.value=c),placeholder:"请输入分段内容"},null,8,["value"]),$.value.length>1e4?(v(),g("div",la,"分段内容最多支持10000个字符")):C("",!0)])])),t("div",ia,[ra,t("div",ca,[t("div",ua,[r(ze,{activeKey:re.value,"onUpdate:activeKey":a[7]||(a[7]=c=>re.value=c),size:"small"},{default:p(()=>[r(qe,{key:"1"},{tab:p(()=>[t("span",null,[r(K,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),S(" 图片 "),U.value.length?(v(),g("span",da,"("+D(U.value.length)+")",1)):C("",!0)])]),_:1})]),_:1},8,["activeKey"]),r(et,{value:U.value,"onUpdate:value":a[8]||(a[8]=c=>U.value=c)},null,8,["value"])])])])],512),[[me,!l.value]]),_e(t("div",_a,[t("div",ma,[t("div",va,[t("div",pa,[t("div",fa,[ha,t("div",ga,[r(tt,{modelValue:d.use_model,"onUpdate:modelValue":a[9]||(a[9]=c=>d.use_model=c),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":d.model_config_id,onChange:De,onLoaded:Fe},null,8,["modelValue","model-config-id"])])]),t("div",ya,[t("div",ba,[t("div",xa,[wa,t("div",Sa,[r(Ie,{value:d.count,"onUpdate:value":a[10]||(a[10]=c=>d.count=c),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),S("个 ")])])])])]),t("div",ka,[t("div",Oa,[La,t("div",Ca,D(j.value),1)]),t("div",Pa,[Aa,t("div",Ma,D(O.value),1)])]),t("div",Da,[r(m,{onClick:Ae,loading:x.value,class:"generate-btn"},{default:p(()=>[r(K,{name:"ai-generate-white",style:{"font-size":"16px"}}),S(" 开始生成 ")]),_:1},8,["loading"])])]),t("div",{class:Qe(["ai-generate-wrapper-right",{"show-result":w.value}])},[t("div",Fa,[r(K,{name:"generate-icon",style:{"font-size":"14px"}}),x.value?(v(),g("span",$a,"相似问法生成中...")):(v(),g("div",ja,"相似问法生成完毕"))]),!A.content&&x.value&&!i.value?(v(),g("div",qa,Va)):C("",!0),t("div",Ba,[t("div",{class:"dialog-content",innerHTML:f.value},null,8,Ea)]),t("div",Na,[r(m,{class:"result-footer-btn",type:"primary",onClick:Me},{default:p(()=>[S("保存相似问法")]),_:1})])],2)])],512),[[me,l.value]])]),_:1},8,["open","width","ok-button-props"])])}}},on=te(Ta,[["__scopeId","data-v-da2dc230"]]);export{sn as C,on as E,se as S,Se as a,nn as b,le as c};
