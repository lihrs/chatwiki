import{b as E,V as ee,k as F,M as P,br as te,aw as ae,ax as oe,aC as re}from"../../index-CfxQ5aRu.js";import{c as le}from"./index-d7geF-HW.js";import{h as ne,k as se}from"./index-W8wCYhw3.js";import{e as v,w as ie,M as s,N as B,k as g,S as c,X as $,Q as d,u as y,W as L,a1 as H,a2 as J,a5 as ue,a4 as _e,B as N,b as q,x as pe,V as U,a7 as W,l as ce}from"./vue-chunks-BjMuQ6KD.js";import{F as V,_ as de}from"./index-xqeVJHPz.js";import{P as ve}from"./PlusOutlined-xiVHYVI8.js";import{_ as me}from"./index-DqFgAaLP.js";import{u as fe}from"./robot-Buya70Kq.js";import"./index-DcUUFn-g.js";import{I as be}from"./Input-C5WaaE9Z.js";import{_ as ge}from"./TextArea-CN_AI7y7.js";const ye=l=>(H("data-v-34012a20"),l=l(),J(),l),he={class:"avatar-uploader"},we=["src"],ke={key:1},xe=ye(()=>L("div",{class:"ant-upload-text"},"上传照片",-1)),Le=["src"],Ce={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(l,{emit:M}){function C(t){return new Promise((i,x)=>{const u=new FileReader;u.readAsDataURL(t),u.onload=()=>i(u.result),u.onerror=A=>x(A)})}const O=M,_=l,m=v([]),h=v(!1),I=v("");ie(()=>_.value,t=>{I.value=t},{immediate:!0});const n=V.useInjectFormItemContext(),w=()=>{let t={imageUrl:I.value,file:m.value[0].originFileObj};O("change",t),O("update:value",t.imageUrl),n.onFieldChange()},k=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(m.value=[t],C(t).then(u=>{I.value=u,h.value=!1,w()}),!1):(F.error("机器人头像图片大小不能超过100kb"),!1):(F.error("机器人头像只支持JPG、PNG格式的图片"),!1),e=v(!1),S=v(""),f=v(""),R=()=>{e.value=!1,f.value=""},T=async t=>{!t.url&&!t.preview&&(t.preview=await C(t.originFileObj)),S.value=t.url||t.preview,e.value=!0,f.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,i)=>{const x=me,u=P;return s(),B("div",he,[g(x,{"file-list":m.value,"onUpdate:fileList":i[0]||(i[0]=A=>m.value=A),"list-type":_.listType,"show-upload-list":!1,"before-upload":k,accept:".jpg,.png,.jpeg",onPreview:T,style:$(_.style)},{default:c(()=>[l.value?(s(),B("img",{key:0,class:"avatar",style:$(_.style),src:l.value,alt:"avatar"},null,12,we)):(s(),B("div",ke,[h.value?(s(),d(y(ee),{key:0})):(s(),d(y(ve),{key:1})),xe]))]),_:1},8,["file-list","list-type","style"]),g(u,{open:e.value,title:f.value,footer:null,onCancel:R},{default:c(()=>[L("img",{alt:"example",style:{width:"100%"},src:S.value},null,8,Le)]),_:1},8,["open","title"])])}}},D=E(Ce,[["__scopeId","data-v-34012a20"]]),K=l=>(H("data-v-706047e6"),l=l(),J(),l),Ie={class:"form-box"},Ae={class:"robot-avatar-box"},Ue=K(()=>L("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Oe=K(()=>L("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1)),Se={__name:"add-robot-alert",setup(l,{expose:M}){const C=fe(),{setStorage:O}=re("localStorage");let _="";const m=ue(),h=_e(),I=V.useForm,n=v(!1),w=v(!1),k=v(!1),e=N({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0}),S=q(()=>e.application_type==0?"新建聊天机器人":n.value?"编辑工作流基本信息":"新建工作流"),f=q(()=>C.robotInfo),{getRobot:R}=C,T=N({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:t,validateInfos:i,clearValidate:x}=I(e,T),u=o=>{e.robot_avatar=o.file},A=()=>{let o={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||_};k.value=!0;let a=ne,b="机器人创建成功";n.value&&(a=se,o.id=m.query.id,b="机器人编辑成功",o.robot_avatar==_&&delete o.robot_avatar),a(o,e.application_type).then(p=>{if(k.value=!1,p.res!=0)return F.error(p.msg);F.success(b),n.value?(R(m.query.id),w.value=!1):e.application_type==0?(O("showNoLibraryTip",!0),h.push("/robot/config/basic-config?id="+p.data.id+"&robot_key="+p.data.robot_key)):h.push("/robot/config/workflow?id="+p.data.id+"&robot_key="+p.data.robot_key)}).catch(()=>{k.value=!1})},z=async()=>{let o=await le({model_type:"LLM"});return!o||o.data.length==0?(P.confirm({title:"请先添加LLM模型服务商?",icon:ce(te,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){h.push("/user/model")},onCancel(){}}),!1):!0},G=async o=>{o==0?_=ae:_=oe,await z()&&(e.robot_avatar="",e.robot_avatar_url=_,e.robot_name="",e.robot_intro="",e.application_type=o,w.value=!0,n.value&&f.value&&(e.robot_name=f.value.robot_name,e.robot_intro=f.value.robot_intro,e.robot_avatar_url=f.value.robot_avatar_url))},Z=()=>{x()},Q=()=>{t().then(()=>{A()}).catch(o=>{})};return pe(()=>{m.query.id&&(n.value=!0)}),M({open:G}),(o,a)=>{const b=de,p=be,j=ge,X=V,Y=P;return s(),d(Y,{width:n.value?"472px":"746px",open:w.value,"onUpdate:open":a[6]||(a[6]=r=>w.value=r),confirmLoading:k.value,title:S.value,onOk:Q,onCancel:Z},{default:c(()=>[L("div",Ie,[g(X,{layout:"vertical"},{default:c(()=>[n.value?(s(),d(b,U({key:0,ref:"name",label:""},y(i).robot_avatar_url),{default:c(()=>[L("div",Ae,[g(D,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":a[0]||(a[0]=r=>e.robot_avatar_url=r),onChange:u},null,8,["value"]),Ue])]),_:1},16)):W("",!0),n.value?(s(),d(b,U({key:2,ref:"name",label:"工作流名称"},y(i).robot_name),{default:c(()=>[g(p,{value:e.robot_name,"onUpdate:value":a[2]||(a[2]=r=>e.robot_name=r),placeholder:"请输入机器人名称，最多20个字"},null,8,["value"])]),_:1},16)):(s(),d(b,U({key:1,ref:"name",label:"应用名称"},y(i).robot_name),{default:c(()=>[g(p,{value:e.robot_name,"onUpdate:value":a[1]||(a[1]=r=>e.robot_name=r),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16)),g(b,U({label:"简介"},y(i).robot_intro),{default:c(()=>[n.value?(s(),d(j,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":a[4]||(a[4]=r=>e.robot_intro=r),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大预言模型提供 ZHIMA CHATAI 产品帮助"},null,8,["value"])):(s(),d(j,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":a[3]||(a[3]=r=>e.robot_intro=r),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"]))]),_:1},16),n.value?W("",!0):(s(),d(b,U({key:3,ref:"name",label:"机器人头像"},y(i).robot_avatar_url),{default:c(()=>[g(D,{value:e.robot_avatar_url,"onUpdate:value":a[5]||(a[5]=r=>e.robot_avatar_url=r),onChange:u},null,8,["value"]),Oe]),_:1},16))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},We=E(Se,[["__scopeId","data-v-706047e6"]]);export{We as A};
