import{b as H,W as X,M as B,k as M,bs as Y,ax as Q,ay as ee,aE as te}from"../../index-cxyImiCC.js";import{h as ae}from"./index-B-6n0NRu.js";import{i as oe,m as re}from"./index-wira7xGQ.js";import{d as v,w as le,N as P,O as s,j as b,U as _,Y as q,S as d,X as x,u as g,z as N,b as W,q as ne,a3 as se,a6 as E,W as I,k as ie,a2 as ue}from"./vue-chunks-BRsu9_To.js";import{F as j,_ as pe}from"./index-CCDGpMly.js";import{P as _e}from"./PlusOutlined-BDVmv0Jd.js";import{_ as de}from"./index-qUh5_MZD.js";import{u as ve}from"./robot-BYhfC7bx.js";import"./index-CAqTjfbp.js";import{I as ce}from"./Input-QJtsuZ9z.js";import{_ as me}from"./TextArea-BJCvjKgG.js";const fe={class:"avatar-uploader"},be=["src"],ge={key:1},ye=["src"],he={__name:"avatar-input",props:{value:{type:String,default:""},listType:{type:String,default:"picture-card"},style:{type:Object,default:()=>{}}},emits:["update:value","change"],setup(U,{emit:R}){function L(t){return new Promise((r,k)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>r(i.result),i.onerror=A=>k(A)})}const O=R,u=U,c=v([]),y=v(!1),C=v("");le(()=>u.value,t=>{C.value=t},{immediate:!0});const n=j.useInjectFormItemContext(),h=()=>{let t={imageUrl:C.value,file:c.value[0].originFileObj};O("change",t),O("update:value",t.imageUrl),n.onFieldChange()},w=t=>t.type==="image/jpeg"||t.type==="image/png"?t.size/1024<100?(c.value=[t],L(t).then(i=>{C.value=i,y.value=!1,h()}),!1):(M.error("机器人头像图片大小不能超过100kb"),!1):(M.error("机器人头像只支持JPG、PNG格式的图片"),!1),e=v(!1),F=v(""),m=v(""),T=()=>{e.value=!1,m.value=""},S=async t=>{!t.url&&!t.preview&&(t.preview=await L(t.originFileObj)),F.value=t.url||t.preview,e.value=!0,m.value=t.name||t.url.substring(t.url.lastIndexOf("/")+1)};return(t,r)=>{const k=de,i=B;return s(),P("div",fe,[b(k,{"file-list":c.value,"onUpdate:fileList":r[0]||(r[0]=A=>c.value=A),"list-type":u.listType,"show-upload-list":!1,"before-upload":w,accept:".jpg,.png,.jpeg",onPreview:S,style:q(u.style)},{default:_(()=>[U.value?(s(),P("img",{key:0,class:"avatar",style:q(u.style),src:U.value,alt:"avatar"},null,12,be)):(s(),P("div",ge,[y.value?(s(),d(g(X),{key:0})):(s(),d(g(_e),{key:1})),r[1]||(r[1]=x("div",{class:"ant-upload-text"},"上传照片",-1))]))]),_:1},8,["file-list","list-type","style"]),b(i,{open:e.value,title:m.value,footer:null,onCancel:T},{default:_(()=>[x("img",{alt:"example",style:{width:"100%"},src:F.value},null,8,ye)]),_:1},8,["open","title"])])}}},D=H(he,[["__scopeId","data-v-61828ec5"]]),we={class:"form-box"},ke={class:"robot-avatar-box"},xe={__name:"add-robot-alert",setup(U,{expose:R}){const L=ve(),{setStorage:O}=te("localStorage");let u="";const c=se(),y=ue(),C=j.useForm,n=v(!1),h=v(!1),w=v(!1),e=N({robot_name:"",robot_intro:"",robot_avatar:void 0,robot_avatar_url:"",application_type:0}),F=W(()=>e.application_type==0?"新建聊天机器人":n.value?"编辑工作流基本信息":"新建工作流"),m=W(()=>L.robotInfo),{getRobot:T}=L,S=N({robot_name:[{required:!0,message:"请输入机器人名称",trigger:"change"},{min:1,max:20,message:"最多20个字",trigger:"change"}]}),{validate:t,validateInfos:r,clearValidate:k}=C(e,S),i=o=>{e.robot_avatar=o.file},A=()=>{let o={robot_name:e.robot_name,robot_intro:e.robot_intro,robot_avatar:e.robot_avatar||u};w.value=!0;let a=oe,f="机器人创建成功";n.value&&(a=re,o.id=c.query.id,f="机器人编辑成功",o.robot_avatar==u&&delete o.robot_avatar),a(o,e.application_type).then(p=>{if(w.value=!1,p.res!=0)return M.error(p.msg);M.success(f),n.value?(T(c.query.id),h.value=!1):e.application_type==0?(O("showNoLibraryTip",!0),y.push("/robot/config/basic-config?id="+p.data.id+"&robot_key="+p.data.robot_key)):y.push("/robot/config/workflow?id="+p.data.id+"&robot_key="+p.data.robot_key)}).catch(()=>{w.value=!1})},$=async()=>{let o=await ae({model_type:"LLM"});return!o||o.data.length==0?(B.confirm({title:"请先添加LLM模型服务商?",icon:ie(Y,{style:{color:"red"}}),content:"机器人聊天基于LLM(大语言模型)，请先完成LLM服务商配置",onOk(){y.push("/user/model")},onCancel(){}}),!1):!0},z=async o=>{o==0?u=Q:u=ee,await $()&&(e.robot_avatar="",e.robot_avatar_url=u,e.robot_name="",e.robot_intro="",e.application_type=o,h.value=!0,n.value&&m.value&&(e.robot_name=m.value.robot_name,e.robot_intro=m.value.robot_intro,e.robot_avatar_url=m.value.robot_avatar_url))},J=()=>{k()},K=()=>{t().then(()=>{A()}).catch(o=>{})};return ne(()=>{c.query.id&&(n.value=!0)}),R({open:z}),(o,a)=>{const f=pe,p=ce,V=me,G=j,Z=B;return s(),d(Z,{width:n.value?"472px":"746px",open:h.value,"onUpdate:open":a[6]||(a[6]=l=>h.value=l),confirmLoading:w.value,title:F.value,onOk:K,onCancel:J},{default:_(()=>[x("div",we,[b(G,{layout:"vertical"},{default:_(()=>[n.value?(s(),d(f,I({key:0,ref:"name",label:""},g(r).robot_avatar_url),{default:_(()=>[x("div",ke,[b(D,{listType:"picture",style:{width:"62px",height:"62px",borderRadius:"16px"},value:e.robot_avatar_url,"onUpdate:value":a[0]||(a[0]=l=>e.robot_avatar_url=l),onChange:i},null,8,["value"]),a[7]||(a[7]=x("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))])]),_:1},16)):E("",!0),n.value?(s(),d(f,I({key:2,ref:"name",label:"工作流名称"},g(r).robot_name),{default:_(()=>[b(p,{value:e.robot_name,"onUpdate:value":a[2]||(a[2]=l=>e.robot_name=l),placeholder:"请输入机器人名称，最多20个字"},null,8,["value"])]),_:1},16)):(s(),d(f,I({key:1,ref:"name",label:"应用名称"},g(r).robot_name),{default:_(()=>[b(p,{value:e.robot_name,"onUpdate:value":a[1]||(a[1]=l=>e.robot_name=l),placeholder:"请输入应用名称"},null,8,["value"])]),_:1},16)),b(f,I({label:"简介"},g(r).robot_intro),{default:_(()=>[n.value?(s(),d(V,{key:1,rows:3,value:e.robot_intro,"onUpdate:value":a[4]||(a[4]=l=>e.robot_intro=l),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大预言模型提供 ZHIMA CHATAI 产品帮助"},null,8,["value"])):(s(),d(V,{key:0,rows:3,value:e.robot_intro,"onUpdate:value":a[3]||(a[3]=l=>e.robot_intro=l),placeholder:"请输入机器人简介，比如ChatWiki产品帮助机器人，可以通过提问获取ChatWiki的使用帮助，比如如何创建机器人，如何新建知识库，如何添加模型等。"},null,8,["value"]))]),_:1},16),n.value?E("",!0):(s(),d(f,I({key:3,ref:"name",label:"机器人头像"},g(r).robot_avatar_url),{default:_(()=>[b(D,{value:e.robot_avatar_url,"onUpdate:value":a[5]||(a[5]=l=>e.robot_avatar_url=l),onChange:i},null,8,["value"]),a[8]||(a[8]=x("div",{class:"form-item-tip"},"请上传机器人头像，建议尺寸为100*100px,大小不超过100KB",-1))]),_:1,__:[8]},16))]),_:1})])]),_:1},8,["width","open","confirmLoading","title"])}}},Pe=H(xe,[["__scopeId","data-v-09ece2ef"]]);export{Pe as A};
