import{b as Z,l as G,d as H,M as K,a2 as Q,k as w}from"../../index-CvfGQnmW.js";import{c as W,e as Y}from"./index-C_N0YJ9k.js";import{F as U,_ as ee}from"./index-CeLDnZbi.js";import"./index-ESeBgLel.js";import{_ as te,R as ae}from"./RadioButton-Bh1r7hrP.js";import{A as oe}from"./index-CE26VU2J.js";import{U as se}from"./UserOutlined-CvUaVWRq.js";import{_ as ne,C as le}from"./index-C_DWe9ZR.js";import{b as ie,d as u,z as j,N as d,O as i,j as n,U as s,X as _,a6 as v,Z as p,F as A,a1 as F,S as g,u as re,_ as k}from"./vue-chunks-BRsu9_To.js";const _e={class:"form-box"},de={key:0,class:"form-tip"},ue={key:0,class:"list-box"},pe=["onClick"],ce={class:"user-block"},ve={class:"name-box"},me={class:"name"},fe={class:"remark-text"},ye={key:1,class:"checkbox-list"},ge={class:"checklist-item"},ke={__name:"add-collaborator",props:{libraryInfo:{type:Object,default:()=>{}}},emits:["ok"],setup(he,{expose:N,emit:O}){const h=ie(()=>G().role_permission||[]),S=O,M=U.useForm,m=u(!1),l=j({identity_type:"1",operate_rights:"4"}),r=u([]),c=u([]),z=a=>{a.role_type!=1&&(r.value.includes(a.id)?r.value=r.value.filter(e=>e!=a.id):r.value.push(a.id))},B=j({}),{resetFields:be,validate:xe,validateInfos:Ce}=M(l,B);let f=[];const V=(a,e)=>{D(),I(),r.value=[],c.value=[],a.forEach(o=>{o.identity_type==1&&r.value.push(o.identity_id),o.identity_type==2&&c.value.push(o.identity_id)}),l.operate_rights="4",l.identity_type="1",f=e,m.value=!0},y=u(!1),q=()=>{f=f.map(o=>({object_id:+o.object_id,object_type:+o.object_type,operate_rights:+l.operate_rights}));let a=[];if(l.identity_type==1?a=r.value:a=c.value,a.length==0){w.error("请选择成员或成员组织");return}let e={identity_type:l.identity_type,object_array:JSON.stringify(f),identity_ids:a.join(",")};y.value=!0,Y(e).then(o=>{w.success("保存成功"),m.value=!1,S("ok")}).finally(()=>{y.value=!1})},b=u([]),D=()=>{Q({page:1,size:200}).then(a=>{b.value=a.data.list})},x=u([]),I=()=>{W().then(a=>{let e=a.data||[];x.value=e})},P=()=>{window.open("/#/user/manage")};return N({show:V}),(a,e)=>{const o=ae,C=te,L=ee,R=oe,E=H,T=le,$=ne,J=U,X=K;return i(),d("div",null,[n(X,{open:m.value,"onUpdate:open":e[3]||(e[3]=t=>m.value=t),title:"添加协作者",onOk:q,width:746,wrapClassName:"no-padding-modal",bodyStyle:{"max-height":"500px","overflow-y":"auto"},confirmLoading:y.value},{default:s(()=>[_("div",_e,[n(J,{layout:"vertical"},{default:s(()=>[n(L,{label:"协作权限",required:""},{default:s(()=>[n(C,{value:l.operate_rights,"onUpdate:value":e[0]||(e[0]=t=>l.operate_rights=t)},{default:s(()=>[n(o,{value:"4"},{default:s(()=>e[4]||(e[4]=[p("管理")])),_:1,__:[4]}),n(o,{value:"2"},{default:s(()=>e[5]||(e[5]=[p("编辑")])),_:1,__:[5]}),n(o,{value:"1"},{default:s(()=>e[6]||(e[6]=[p("查看")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1}),n(L,{label:"协作者",required:""},{default:s(()=>[n(C,{value:l.identity_type,"onUpdate:value":e[1]||(e[1]=t=>l.identity_type=t)},{default:s(()=>[n(o,{value:"1"},{default:s(()=>e[7]||(e[7]=[p("按成员选")])),_:1,__:[7]}),n(o,{value:"2"},{default:s(()=>e[8]||(e[8]=[p("按组织架构")])),_:1,__:[8]})]),_:1},8,["value"]),h.value&&h.value.includes("TeamManage")?(i(),d("div",de,[e[9]||(e[9]=p(" 如果协作者没有账号，请先到团队管理中添加账号 ")),_("a",{onClick:P},"去添加")])):v("",!0)]),_:1}),l.identity_type==1?(i(),d("div",ue,[(i(!0),d(A,null,F(b.value,t=>(i(),d("div",{class:"type-item",key:t.value,onClick:Le=>z(t)},[_("div",ce,[n(R,{shape:"square",src:t.avatar,size:40},{icon:s(()=>[t.avatar?v("",!0):(i(),g(re(se),{key:0}))]),_:2},1032,["src"]),_("div",ve,[_("div",me,k(t.user_name),1),_("div",fe,k(t.nick_name),1)])]),r.value.includes(t.id)?(i(),g(E,{key:0,class:"check-arrow",name:"check-arrow-filled",style:{"font-size":"24px",color:"#fff"}})):v("",!0)],8,pe))),128))])):v("",!0),l.identity_type==2?(i(),d("div",ye,[n($,{value:c.value,"onUpdate:value":e[2]||(e[2]=t=>c.value=t),style:{width:"100%"}},{default:s(()=>[_("div",ge,[(i(!0),d(A,null,F(x.value,t=>(i(),g(T,{key:t.id,value:t.id},{default:s(()=>[_("div",null,k(t.department_name),1)]),_:2},1032,["value"]))),128))])]),_:1},8,["value"])])):v("",!0)]),_:1})])]),_:1},8,["open","confirmLoading"])])}}},ze=Z(ke,[["__scopeId","data-v-7d5673e1"]]);export{ze as A};
