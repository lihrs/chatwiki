import{d as p,b as L,w as J,q as W,o as z,N as d,O as s,X as g,H as U,F as K,a6 as h,Z as V,_ as y,I as Y,a1 as x,a0 as T}from"./vue-chunks-BRsu9_To.js";import{b as Z,aA as Q,aB as j}from"../../index-DGlN_gTP.js";import{c as ee}from"./index-D9KRCCIf.js";const le={class:"selected-item"},oe=["src"],ne={key:0},te={key:1,class:"placeholder"},ae={key:0,class:"option-group"},de=["src"],se=["onClick"],ie={__name:"index",props:{modelValue:[String,Number],modelType:{type:String,validator:a=>["TEXT EMBEDDING","RERAN","LLM"].includes(a),required:!0},isOffline:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择模型"},groupLabelKey:{type:String,default:"groupLabel"},groupIconKey:{type:String,default:"groupIcon"},iconKey:{type:String,default:"icon"},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"},showValue:{type:Boolean,default:!0},modelConfigId:{type:String,default:""}},emits:["update:modelValue","change","loaded"],setup(a,{emit:C}){const m=a,w=C,f=p(!1),b=p(m.placeholder),I=p([]),k=["azure","ollama","xinference","openaiAgent","doubao"],R=["doubao"],M=L(()=>I.value.map(e=>({groupLabel:e.name,groupIcon:e.icon,children:e.children.map(l=>({icon:l.icon,use_model_name:l.use_model_name,show_model_name:l.show_model_name,value:l.show_model_name?l.show_model_name:k.includes(l.model_define)&&l.deployment_name?l.deployment_name:l.name,rawData:l}))}))),r=L(()=>{const{modelConfigId:e,modelValue:l}=m;let n={};if(!(!e&&!l))return A.value.find(o=>{const{rawData:t}=o;k.includes(t.model_define)&&t.deployment_name?(t.deployment_name===l||t.id===e)&&(n=o):t.name===l&&t.id===e&&(n=o)}),n}),A=L(()=>M.value.reduce((e,l)=>e.concat(l.children||[]),[]));function H(e,l,n){const o=new Set(e.map(t=>t.model_define));return l.filter(t=>{let i=t[n];o.has(i)&&e.filter(c=>{if(c.model_define==i)return c.children=j(c.children,t.children),!1})}),e}const u=p(0),$=p(!1),q=e=>{const l=e.currentTarget,n=e.deltaY,o=l.scrollHeight-l.clientHeight,t=u.value+n<=0,i=u.value+n>=o;e.stopPropagation(),!t&&!i?(l.scrollTop+=n,e.preventDefault()):u.value===0&&n<0||u.value===o&&n>0?$.value=!1:(l.scrollTop=Math.max(0,Math.min(o,u.value+n)),e.preventDefault()),u.value=l.scrollTop},P=()=>{f.value=!f.value},X=e=>{w("update:modelValue",e[m.valueKey]),w("change",e),f.value=!1},N=e=>{e.target.closest(".custom-select")||(f.value=!1)},O=()=>{ee({model_type:m.modelType,is_offline:m.isOffline}).then(e=>{let n=(e.data||[]).map(o=>{let{model_define:t,deployment_name:i,id:c}=o.model_config,F=`${t}-${i||""}-${c}`,_=[],D=[];m.modelType=="TEXT EMBEDDING"?_=o.model_info.vector_model_list:m.modelType=="RERANK"?_=o.model_info.rerank_model_list:m.modelType=="LLM"&&(_=o.model_info.llm_model_list);for(let S=0;S<_.length;S++){let v=_[S],E=v,G=c+"-"+v;k.indexOf(o.model_config.model_define)>-1&&o.model_config.deployment_name&&(E=o.model_config.deployment_name);let B="";R.includes(o.model_config.model_define)&&(B=o.model_config.show_model_name),D.push({key:c+"_"+v,label:E,name:v,deployment_name:i,model_config_id:c,model_define:t,value:G,id:o.model_config.id,show_model_name:B,icon:o.model_info.model_icon_url,use_model_name:o.model_info.model_name})}return{key:F,model_define:t,children:D,model_config_id:c,deployment_name:i,name:o.model_info.model_name,icon:o.model_info.model_icon_url}});n=H(Q(n,"model_define"),n,"model_define"),n.length===0&&(b.value="无可用模型"),I.value=[...n],w("loaded",JSON.parse(JSON.stringify(n)))})};return J(()=>m.isOffline,()=>{O()}),W(()=>{O(),document.addEventListener("click",N)}),z(()=>{document.removeEventListener("click",N)}),(e,l)=>(s(),d("div",{class:"custom-select",onClick:T(P,["stop"])},[g("div",le,[r.value?(s(),d(K,{key:0},[r.value[a.iconKey]?(s(),d("img",{key:0,src:r.value[a.iconKey],class:"model-icon"},null,8,oe)):h("",!0),g("span",null,[V(y(r.value[a.labelKey])+" ",1),a.showValue&&r.value[a.valueKey]?(s(),d("span",ne,y(r.value[a.valueKey]),1)):h("",!0)])],64)):(s(),d("span",te,y(b.value),1))]),U(g("div",{class:"custom-options",onWheel:T(q,["prevent"])},[(s(!0),d(K,null,x(M.value,(n,o)=>(s(),d("div",{key:o},[n.groupLabel?(s(),d("div",ae,[n[a.groupIconKey]?(s(),d("img",{key:0,src:n[a.groupIconKey],class:"model-icon"},null,8,de)):h("",!0),V(" "+y(n[a.groupLabelKey]),1)])):h("",!0),(s(!0),d(K,null,x(n.children,(t,i)=>(s(),d("div",{key:i,class:"option-item",onClick:T(c=>X(t),["stop"])},[g("span",null,y(t[a.valueKey]),1)],8,se))),128))]))),128))],544),[[Y,f.value]])]))}},ue=Z(ie,[["__scopeId","data-v-bcdfd6df"]]);export{ue as C};
