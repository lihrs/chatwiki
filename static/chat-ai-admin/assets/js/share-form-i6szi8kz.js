import{b as E,dL as G,B as K,d as M,b$ as X,k as u,dj as Z,ad as A}from"../../index-CptKfSUC.js";import{u as H}from"./index-C0kilmAu.js";import{a3 as J,b as L,d as f,z as Q,N as _,O as l,X as d,a6 as c,j as r,U as o,S as y,u as b,Z as p,F as Y,a1 as ee,_ as te,G as ae}from"./vue-chunks-BRsu9_To.js";import"./index-B0iUyVGC.js";import{_ as oe,R as re}from"./RadioButton-e2BmC77e.js";import{S as se,a as le}from"./index-R3fGpy-Z.js";import{_ as ne}from"./index-CrGpUfGH.js";import{I as ie}from"./Input-BFAHe0DY.js";import{_ as ue,F as _e}from"./index-BdXFo1Yi.js";const de={class:"share-form-body"},ce={class:"share-url-box",style:{width:"100",overflow:"hidden"}},pe={key:0,target:"_blank",href:"/#/user/domain"},me={key:0,class:"form-box-bottom"},fe={__name:"share-form",props:{baseUrl:{type:String,default:"/open/doc"},hideCopy:{type:Boolean,default:!1},layout:{type:String,default:"horizontal"},labelCol:{type:Object,default:()=>{}},wrapperCol:{type:Object,default:()=>{}},libraryId:{type:[Number,String],default:""},libraryKey:{type:String,default:""}},emits:["success"],setup(n,{expose:B,emit:N}){const R=N,{operate_rights:m}=G(),U=n,{toClipboard:j}=H(),F=J(),I=L(()=>F.query.library_id),v=f(""),g=f(null),a=Q({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""}),h=L(()=>U.baseUrl+"/"+v.value),O=async()=>{try{const t=await Z({id:I.value});Object.assign(a,t.data)}catch(t){u.error("获取数据失败"),console.error("获取知识库信息失败:",t)}},i=f([]),D=()=>{A().then(t=>{i.value=t.data||[],a.share_url||(i.value.length>0?a.share_url=i.value[0].url:a.share_url=window.location.origin)})},k=async()=>{a.share_url||u.error("请选择自定义域名");let t=a.share_url+h.value;try{await j(t),u.success("复制成功")}catch{u.error("复制失败")}},C=async()=>{let t={...ae(a)};delete t.library_key,t.avatar_file?(t.avatar=t.avatar_file,delete t.avatar_file):(delete t.avatar,delete t.avatar_file);try{let e=await X(t);R("success",e)}catch{}};return B({init:async t=>{try{v.value=t.doc_key,await O(),D()}catch{}}}),(t,e)=>{const w=re,V=oe,S=ue,$=le,z=se,P=ie,T=ne,x=K,W=_e,q=M;return l(),_("div",{class:"share-form",ref_key:"formWrapRef",ref:g},[d("div",de,[r(W,{model:a,layout:n.layout,"label-col":n.labelCol,"wrapper-col":n.wrapperCol,autocomplete:"off"},{default:o(()=>[r(S,{label:"访问权限"},{default:o(()=>[r(V,{value:a.access_rights,"onUpdate:value":e[0]||(e[0]=s=>a.access_rights=s),onChange:C,disabled:b(m)==2},{default:o(()=>[r(w,{value:"0"},{default:o(()=>e[4]||(e[4]=[p("私有，仅能与应用关联，作为应用知识库")])),_:1,__:[4]}),r(w,{value:"1"},{default:o(()=>e[5]||(e[5]=[p("公开，发布到互联网，所有人可访问")])),_:1,__:[5]})]),_:1},8,["value","disabled"])]),_:1}),a.access_rights==1?(l(),y(S,{key:0,label:"分享链接"},{default:o(()=>[d("div",ce,[r(T,{compact:""},{default:o(()=>[r(z,{style:{width:"50%"},value:a.share_url,"onUpdate:value":e[1]||(e[1]=s=>a.share_url=s),placeholder:"请选择自定义域名",getPopupContainer:()=>g.value,onChange:C,disabled:b(m)==2},{default:o(()=>[(l(!0),_(Y,null,ee(i.value,s=>(l(),y($,{value:s.url,key:s.id},{default:o(()=>[p(te(s.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","getPopupContainer","disabled"]),r(P,{disabled:!0,value:h.value,style:{width:"50%"}},null,8,["value"])]),_:1}),n.hideCopy?c("",!0):(l(),y(x,{key:0,class:"copy-btn",onClick:e[2]||(e[2]=s=>k())},{default:o(()=>e[6]||(e[6]=[p("复制")])),_:1,__:[6]}))]),d("div",null,[b(m)==4?(l(),_("a",pe,"添加自定义域名")):c("",!0)])]),_:1})):c("",!0)]),_:1},8,["model","layout","label-col","wrapper-col"])]),n.hideCopy?(l(),_("div",me,[r(x,{type:"primary",ghost:"",onClick:e[3]||(e[3]=s=>k())},{default:o(()=>[r(q,{name:"link-left",style:{"font-size":"16px",color:"#2475fc","margin-right":"4px"}}),e[7]||(e[7]=d("span",null,"复制链接",-1))]),_:1,__:[7]})])):c("",!0)],512)}}},Le=E(fe,[["__scopeId","data-v-60b773ef"]]);export{Le as S};
