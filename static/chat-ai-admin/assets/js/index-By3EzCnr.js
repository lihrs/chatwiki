import{b as U,M as C,h as ye,B as ge,dk as Ae,dO as ee,dU as ke,k as K,dV as be,d as we,dW as he,dL as Ee,dX as Se}from"../../index-CRscgXfx.js";import{d as r,z as B,S as R,O as _,U as d,X as s,j as a,G as Q,N as S,V as xe,b as te,a3 as Le,q as Be,o as Te,a6 as J,_ as Ce,Z as O,u as Re}from"./vue-chunks-BRsu9_To.js";import{_ as j,F as z}from"./index-V4Jlr1g1.js";import{_ as G}from"./TextArea-K98swN5P.js";import{_ as Ue,S as De}from"./share-popup-C0kYHTsN.js";import{C as qe}from"./CheckOutlined-BnY3VuYw.js";import{_ as Ie,a as Me}from"./RadioButton-IT2uDinU.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./Trigger-D-LMK5CQ.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./isPlainObject-DRl1_5Z2.js";import"./responsiveObserve-B2v9U3jv.js";import"./collapseMotion-Brd6xpAT.js";import"./index-1HwKIEyy.js";import"./colors-GzwEvaOH.js";import"./QuestionCircleOutlined-DKLyIfpc.js";import"./FormItemContext-DiOlYi_l.js";import"./index-BbckQ73x.js";import"./index-CxTVzuqL.js";import"./inputProps-QKn333yB.js";import"./index-CuQqX42V.js";import"./Input-tyEnRv5y.js";import"./Search-Dt3FbMlF.js";import"./SearchOutlined-CoZBl7jN.js";import"./Password-Bmz-BBqy.js";import"./index-DK5GTTeF.js";import"./share-form-DkhpawNt.js";import"./index-C0kilmAu.js";import"./index-B6iWcNlt.js";import"./index-CVagTbWa.js";import"./slide-Cad5dMPr.js";import"./DownOutlined-h1NhriVT.js";import"./move-l5WLgE3F.js";import"./index-BY4zatuG.js";import"./Checkbox-BVj74R9p.js";const Je={class:"upload-ssl-form"},Oe={__name:"edit-title",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(k,{expose:f,emit:b}){const g=b,w=k,m=r(),n=B({title:""}),p={title:[{required:!0,message:"请输入标题"}]},t=r(!1),v=l=>{n.title=l.title,t.value=!0},c=()=>{t.value=!1},h=()=>{m.value.validate().then(()=>{g("ok",Q(n))}).catch(l=>{})};return f({open:v,close:c}),(l,i)=>{const x=G,A=j,y=z,L=C;return _(),R(L,{open:t.value,"onUpdate:open":i[1]||(i[1]=u=>t.value=u),title:"编辑标题",onOk:h,confirmLoading:w.confirmLoading,"ok-text":"保 存"},{default:d(()=>[s("div",Je,[a(y,{ref_key:"formRef",ref:m,model:n,rules:p,autocomplete:"off",layout:"vertical"},{default:d(()=>[a(A,{label:"",name:"title"},{default:d(()=>[a(x,{rows:5,value:n.title,"onUpdate:value":i[0]||(i[0]=u=>n.title=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},Ye=U(Oe,[["__scopeId","data-v-1e4426a0"]]),Ne={class:"upload-ssl-form"},Xe={__name:"edit-desc",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(k,{expose:f,emit:b}){const g=b,w=k,m=r(),n=B({content:""}),p={},t=r(!1),v=l=>{n.content=l.content,t.value=!0},c=()=>{t.value=!1},h=()=>{m.value.validate().then(()=>{g("ok",Q(n))}).catch(l=>{})};return f({open:v,close:c}),(l,i)=>{const x=G,A=j,y=z,L=C;return _(),R(L,{open:t.value,"onUpdate:open":i[1]||(i[1]=u=>t.value=u),title:"编辑描述",onOk:h,confirmLoading:w.confirmLoading,"ok-text":"保 存"},{default:d(()=>[s("div",Ne,[a(y,{ref_key:"formRef",ref:m,model:n,rules:p,autocomplete:"off",layout:"vertical"},{default:d(()=>[a(A,{label:"",name:"content"},{default:d(()=>[a(x,{rows:5,value:n.content,"onUpdate:value":i[0]||(i[0]=u=>n.content=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},Ve=U(Xe,[["__scopeId","data-v-b1aa5d26"]]),Ke={class:"upload-ssl-form"},Qe={__name:"edit-question-guide",props:{confirmLoading:{type:Boolean,default:!1}},emits:["ok"],setup(k,{expose:f,emit:b}){const g=b,w=k,m=r(),n=B({question:""}),p={question:[{required:!0,message:"请输入问题引导"}]},t=r(!1),v=l=>{n.question=l.question,t.value=!0},c=()=>{t.value=!1},h=()=>{m.value.validate().then(()=>{g("ok",Q(n))}).catch(l=>{})};return f({open:v,close:c}),(l,i)=>{const x=G,A=j,y=z,L=C;return _(),R(L,{open:t.value,"onUpdate:open":i[1]||(i[1]=u=>t.value=u),title:"编辑问题引导",onOk:h,confirmLoading:w.confirmLoading,"ok-text":"保 存"},{default:d(()=>[s("div",Ke,[a(y,{ref_key:"formRef",ref:m,model:n,rules:p,autocomplete:"off",layout:"vertical"},{default:d(()=>[a(A,{label:"",name:"question"},{default:d(()=>[a(x,{rows:5,value:n.question,"onUpdate:value":i[0]||(i[0]=u=>n.question=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},je=U(Qe,[["__scopeId","data-v-54075d5d"]]),ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXcAAAAsCAYAAACe/vh+AAAAAXNSR0IArs4c6QAABsBJREFUeF7tnFeIbTUYhb9rwYoVKyJ2sTxYUVGs2L1WLIgNexcRRB9E1CcLCqKCgqig2BXELmLBXhCxYkHFhr0rdrPg37AZz5y7z87MnUxm5W1mkkzyJWfl3yv/PrNwMQETMAETqI7ArOpm5AmZgAmYgAlgcfcmMAETMIEKCVjcK1xUT8kETMAELO7eAyZgAiZQIQGLe4WL6imZgAmYgMXde8AETMAEKiRgca9wUT0lEzABE7C4ew+YgAmYQIUELO4VLqqnZAImYAIWd+8BEzABE6iQgMW9wkX1lEzABEzA4u49YAImYAIVErC4V7ionpIJmIAJWNy9B0zABEygQgIW9woX1VMyARMwAYu794AJmIAJVEjA4l7honpKJjCDCawDrA+8AbzZgcNGwHbAmsBSwG/Ah8CLwCPA7x36WBpYFVigQ91hVf4FfgTeAf7I7Mvf554L0O1NwASKIvADsBjwPbDkOCObBzgEOBNYb8joJbRXAxcC34xTT/9Dh8NbwC+ZJBRsLwssAzwE/J3TX4mR+xLp5DoY0AmsBbonTtGu89wzFvfGMQ3U797A43Eyd+3P9UzABKYPAUW/TRmkbyulKPsGYPtWvU+BV4Cvk5AvFNqj6F+HgMpXwOHAAwMwbByirkj73Gjfl9a70ccOMZ4v+3akdqWJ+2rAY8DKgIBLkPWoc1o60a7qMNF9gLsC9qKt+tsC18Sj1wHptL69Q1+uYgImUDaB04FLgJ+BzSN6npO4y65ZN6Z1J3Ax8PyAaa4AnJoi9lNSnUWAv4ANgdfH1N0S+Dhp6XkpaDxiAnDtHtbMR9Fv7y5LE/eH4xFnL+D+gHoboJNsDeCTITOVZ/YSsHD4ZI24PwjsHF6aTmWLe+/t4oYmUBQBacP+MaLmcz0ncVegd0uKxk8CJO4KKI8Ctk4WjARdVsyrUUfWyOrJw78j/HfZOGNLI+46ZJqx5EDSPD4LYdd4dG/wU58OSxJ3nY4C+yiwU2sygvcUcFZ4X7sCusBo2y4S8meBz4F/gK3Sid6I+3NxUAjQpRb3PtvEbUxgygnoKf6isFwvTxrxTIrA+4i7JjJ/sj90CCjalmDPN87sngQOBb4YcrE6meK+VgSlT/ehX5K4a/G+A+4FZrcmI09LEbmslGPD/9JibJLqvRz1bgpB1++uT9bONi1xb7o6MV1UXGlx77NN3MYEppzAfhFBayC3AgdliLv62AB4IYRejoDs3PcjY2aX5K9vFjOWj37+kNlb3DtujfeA5QK8QOtC44p0cp4Q0bdEX6e1bqh1carb6ZOBy+KxStH7fRb3jrRdzQTKJSA/fYt4ItfnW5aHPvsqCvRkX/SN3JtZK8FCdszZEZnLtlXqo57+Dwwf/4z4eTxSkynusmWUhSNHY+RSUuSuwUuw5YMJsOyUFWNGypxR1oy8+HbR4uvRSRtBh4CKxX3kbeAGJlAcAaUBKriT0M47SeLeTHrHCBCVFqkMPR0mw6L1NqxG3C8ADpsAiruFx17dharYbJq88+MigtfNtPJMP0iPS/LZlDXTLrr4kJ2jR6emSOjXBo4HXmtZN7ZlJmDnuQsTmEsExl6MTkbk3kxlj7Bl5MWrXAcc2XGesoLlICggPSeSQDo2/V+1JhVSefPStqpSIfeNU7qdqtikNypqV/TeLhL9VYaQVJpTc8Ntce+75dzOBOY+Ad2/KXCTJbE4oOha2XQq16bMuaMjvfmY+J18cmW3jG3XdeSyaKQ7StRQ9oyeGLoUJXfojk9ZLb92aTCkjpyU5cP3V5Zf+4AbuevSbJmbw0vTSaoXBpSmpFeA9Yim3FSN94mI6nXhoROzedGgmbxsHWXLyLvXiwV/xh8s7iNvDzcwgSkjIItEn3mJpnLTVZTSrCw4vQvzbYi/0qR1AEgnVJp2euqXXz1KUfKGImbltI9SdAcorVpwlEYD6krMlbP/do1fPyBvXeKt12/1tlhzcsuH0osGeq1Yjyp6sUmLOOi7I+y5Z+4wNzcBE5j+BEqL3EVUwi57Rl/Eo/xSvXCg/PWmKIVJp7dy3wcVRe3q4+4xf9TLCPqSIGXUDHsZavqvqmdgAiYw4wmUKO4zflEMwARMwARyCVjccwm6vQmYgAkUSMDiXuCieEgmYAImkEvA4p5L0O1NwARMoEACFvcCF8VDMgETMIFcAhb3XIJubwImYAIFErC4F7goHpIJmIAJ5BKwuOcSdHsTMAETKJCAxb3ARfGQTMAETCCXgMU9l6Dbm4AJmECBBCzuBS6Kh2QCJmACuQQs7rkE3d4ETMAECiRgcS9wUTwkEzABE8gl8B9/hxs87rUYvwAAAABJRU5ErkJggg==",Ge={},Pe={class:"phone-wrapper"},Fe={class:"phone-box"},We={class:"phone-body"};function He(k,f){return _(),S("div",Pe,[s("div",Fe,[f[0]||(f[0]=s("div",{class:"phone-header"},[s("img",{class:"navbar",src:ze,alt:""})],-1)),s("div",We,[xe(k.$slots,"default",{},void 0,!0)]),f[1]||(f[1]=s("div",{class:"phone-footer"},null,-1))])])}const Ze=U(Ge,[["render",He],["__scopeId","data-v-1f171414"]]),$e={class:"home-preview"},et={class:"toolbar-wrapper"},tt={class:"toolbar-left"},ot={class:"toolbar-item"},nt={class:"toolbar-right"},at={key:0,class:"edit-user"},st=["src"],it={class:"user-name"},lt={class:"action-item"},rt={key:1,class:"action-item"},dt={class:"action-item"},ct={class:"preview-box"},ut={key:0,class:"mobile-box"},mt=["src"],_t={key:1,class:"pc-box"},ft=["src"],pt={__name:"index",setup(k){const f=Le(),{getToken:b,user_id:g}=ye(),w=te(()=>f.query.library_id),m=r(null),n=r(new Date().getTime()),p=r(!1),t=B({doc_id:"",title:"",content:"",library_intro:"",library_name:"",library_key:""}),v=B({doc_id:"",is_pub:"",doc_key:"",seo_title:"",seo_desc:"",seo_keywords:""}),c=B({show:!1,user_name:"",avatar:"",nick_name:""}),h=async e=>{let o=await be({id:e});return c.avatar=o.data.avatar,c.user_name=o.data.user_name,c.nick_name=o.data.nick_name,o},l=r(null),i=r(!1),x=e=>{t.title=e.title,i.value=!0,P().then(()=>{i.value=!1,l.value.close()}).catch(()=>{i.value=!1})},A=r(null),y=r(!1),L=e=>{t.content=e.content,y.value=!0,P().then(()=>{y.value=!1,A.value.close()}).catch(()=>{y.value=!1})},u=async()=>await Ee({library_key:t.library_key,doc_id:t.doc_id,title:t.title,content:t.content,is_index:1}).then(o=>(t.doc_id=o.data.doc_id,v.doc_id=o.data.doc_id,n.value=new Date().getTime(),o)),P=async()=>{await u()&&K.success("保存成功")},D=r(!1),oe=()=>{let e={library_key:t.library_key,doc_id:t.doc_id,title:t.title,content:t.content,is_index:1};D.value=!0,Se(e).then(o=>{t.doc_id=o.data.doc_id,v.doc_id=o.data.doc_id,D.value=!1,K.success("发布成功"),I(!1),n.value=new Date().getTime()}).catch(()=>{D.value=!1})},F=r(null),ne=()=>{let e={library_key:t.library_key,seo_title:v.seo_title,seo_desc:v.seo_desc,seo_keywords:v.seo_keywords,doc_id:t.doc_id};F.value.open(e)},ae=()=>{H(),n.value=new Date().getTime()},Y=r(null),q=r(!1),E=B({id:"",question:""}),se=e=>{E.question=e.question,q.value=!0,he({library_key:t.library_key,id:E.id||"",question:E.question}).then(()=>{n.value=new Date().getTime(),q.value=!1,Y.value.close()}).catch(()=>{q.value=!1})},N=r("pc");let ie="";const W=te(()=>`${ie}/manage/libDocHome/${t.library_key}?&v=${n.value}&token=${b}`),le=()=>{Ae({id:w.value}).then(e=>{Object.assign(t,e.data)})},H=()=>{ee({doc_id:t.doc_id,library_key:t.library_key}).then(e=>{Object.assign(v,e.data);let o=e.data.edit_user&&e.data.edit_user!=0;o&&e.data.edit_user!=g&&(c.show=!0,h(e.data.edit_user)),o&&e.data.edit_user==g?I(!0):I(!1)})},re=e=>{t.doc_id=e.doc_id,t.title=e.title,t.content=e.content,H()},de=e=>{t.title=e.title,t.content=e.content,l.value.open(e)},ce=e=>{t.title=e.title,t.content=e.content,A.value.open(e)},Z=e=>{E.id=e.id,E.question=e.question,Y.value.open(e)},ue=e=>{E.id=e.id,E.question=e.question,C.confirm({title:"删除问题引导",content:"确定要删除该问题引导吗？",okText:"确定",cancelText:"取消",onOk(){ke({library_key:t.library_key,id:E.id}).then(()=>{K.success("删除成功"),n.value=new Date().getTime()})}})},me=e=>{e.key=="title"&&de(e.data),e.key=="content"&&ce(e.data),e.key=="question"&&Z(e.data)},_e=e=>{e.key=="question"&&Z(e.data)},fe=e=>{e.key=="question"&&ue(e.data)},pe=async()=>{try{let e=await ee({doc_id:t.doc_id,library_key:t.library_key});if(e.data.edit_user&&e.data.edit_user!=0&&e.data.edit_user!=g){let T=await h(e.data.edit_user),X=T.data.nick_name||T.data.user_name;c.show=!0,C.warning({title:X+"正在编辑此文档",content:"需要其他协作者结束编辑并发布后才可以继续编辑",okText:"知道了"});return}u(),p.value=!0,c.show=!1}catch{return}},I=e=>{p.value=e,m.value.contentWindow.postMessage({action:"setEditStatus",data:{type:p.value}},"*")},$=e=>{const o=e.data;o.action==="check_preview"&&m.value.contentWindow.postMessage({action:"setPreview",token:b},"*"),o.action==="init"&&(re(o.data),p.value&&I(!0)),o.action==="edit"&&me(o),o.action==="add"&&_e(o),o.action==="delete"&&fe(o)};return Be(()=>{le(),window.addEventListener("message",$)}),Te(()=>{window.removeEventListener("message",$)}),(e,o)=>{const T=Me,X=Ie,V=we,M=ge;return _(),S("div",$e,[s("div",et,[s("div",tt,[s("div",ot,[a(X,{value:N.value,"onUpdate:value":o[0]||(o[0]=ve=>N.value=ve)},{default:d(()=>[a(T,{value:"pc"},{default:d(()=>o[1]||(o[1]=[O("PC端样式")])),_:1,__:[1]}),a(T,{value:"mobile"},{default:d(()=>o[2]||(o[2]=[O("移动端样式")])),_:1,__:[2]})]),_:1},8,["value"])])]),s("div",nt,[c.show&&c.user_name?(_(),S("div",at,[s("img",{class:"user-avatar",src:c.avatar,alt:""},null,8,st),s("span",it,Ce(c.nick_name||c.user_name),1),o[3]||(o[3]=s("span",{class:"edit-status-text"},"编辑中...",-1))])):J("",!0),s("div",lt,[a(Ue,{ref:"sharePopupRef","base-url":"/open/home",docKey:t.library_key,libraryId:w.value},{default:d(()=>[a(M,null,{default:d(()=>[a(V,{class:"action-icon",name:"share",style:{"font-size":"16px"}}),o[4]||(o[4]=O(" 分享"))]),_:1,__:[4]})]),_:1},8,["docKey","libraryId"])]),p.value?(_(),S("div",rt,[a(M,{onClick:ne},{default:d(()=>[a(V,{class:"action-icon",name:"jibenpeizhi",style:{"font-size":"16px",color:"#595959"}}),o[5]||(o[5]=s("span",null,"SEO设置",-1))]),_:1,__:[5]})])):J("",!0),s("div",dt,[p.value?(_(),R(M,{key:0,type:"primary",loading:D.value,onClick:oe},{default:d(()=>[a(Re(qe)),o[6]||(o[6]=O(" 发布"))]),_:1,__:[6]},8,["loading"])):(_(),R(M,{key:1,type:"primary",onClick:pe},{default:d(()=>[a(V,{class:"action-icon",name:"edit",style:{"font-size":"16px",color:"#fff"}}),o[7]||(o[7]=s("span",null,"编辑",-1))]),_:1,__:[7]}))])])]),s("div",ct,[N.value=="mobile"?(_(),S("div",ut,[a(Ze,null,{default:d(()=>[t.library_key?(_(),S("iframe",{key:0,ref_key:"iframeRef",ref:m,class:"iframe",src:W.value,frameborder:"0"},null,8,mt)):J("",!0)]),_:1})])):(_(),S("div",_t,[t.library_key?(_(),S("iframe",{key:0,ref_key:"iframeRef",ref:m,class:"iframe",src:W.value,frameborder:"0"},null,8,ft)):J("",!0)]))]),a(Ye,{ref_key:"editTitleRef",ref:l,onOk:x,"confirm-loading":i.value},null,8,["confirm-loading"]),a(Ve,{ref_key:"editDescRef",ref:A,onOk:L,"confirm-loading":y.value},null,8,["confirm-loading"]),a(je,{ref_key:"editQuestionGuideRef",ref:Y,onOk:se,"confirm-loading":q.value},null,8,["confirm-loading"]),a(De,{ref_key:"seoSettingRef",ref:F,onOk:ae},null,512)])}}},eo=U(pt,[["__scopeId","data-v-fb02ebad"]]);export{eo as default};
