import{I as X,b as D,B as Z,d as E,k as q,df as J}from"../../index-CvfGQnmW.js";import{_ as K}from"./cu-scroll-B_WJBedC.js";import{_ as W}from"./empty-DkpCLaix.js";import{j as i,a3 as F,d as g,z as Y,b as ee,N as a,O as n,X as e,a6 as k,U as _,Z as y,S as x,u as w,F as R,a1 as z,a5 as te,_ as u,a2 as se}from"./vue-chunks-BRsu9_To.js";import{_ as oe}from"./recommendation-AQ4_FPQ9.js";import{c as ne}from"./index-CiT4vUhP.js";import{D as ie}from"./DownOutlined-DKJ0lkJp.js";import{U as le}from"./UpOutlined-BZVglKCC.js";import{Q as V}from"./QuestionCircleOutlined-DsT-V90y.js";import{i as ae,a as re,S as de}from"./index-Bic_ld4j.js";import{_ as ce}from"./TextArea-B40Dha8W.js";import{_ as _e}from"./index-B-ykUzgY.js";import{_ as ue}from"./index-WowefPIW.js";import{_ as me}from"./index-D2a_iSIQ.js";import{_ as pe}from"./index-ChS1NVDw.js";import{S as ve}from"./index-MLftqXg-.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./Trigger-C5a0DMKm.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-B0doyz59.js";import"./slide-vrDadJH3.js";import"./index-DaOSj_2K.js";import"./CheckOutlined-N7bppPAu.js";import"./SearchOutlined-B9P7O4A9.js";import"./FormItemContext-CFzzmp00.js";import"./move-CunrTozH.js";import"./inputProps-DJXIqADS.js";import"./colors-Cy2bPHOW.js";var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function j(m){for(var d=1;d<arguments.length;d++){var r=arguments[d]!=null?Object(arguments[d]):{},c=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(r).filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable}))),c.forEach(function(p){ye(m,p,r[p])})}return m}function ye(m,d,r){return d in m?Object.defineProperty(m,d,{value:r,enumerable:!0,configurable:!0,writable:!0}):m[d]=r,m}var M=function(d,r){var c=j({},d,r.attrs);return i(X,j({},c,{icon:fe}),null)};M.displayName="LinkOutlined";M.inheritAttrs=!1;const ke={class:"recall-settings-box"},ge={class:"form-box"},be={class:"form-item"},he={class:"form-item-body"},xe={class:"form-item"},$e={class:"form-item"},we={class:"form-item-label"},Le={class:"form-item-body"},Oe={class:"retrieval-mode-items"},Re=["onClick"],ze={class:"retrieval-mode-title"},Ce={class:"title-text"},Se={key:0,style:{width:"32px"},src:oe,alt:""},Ne={class:"retrieval-mode-desc"},qe={class:"form-item"},Me={class:"form-item-label"},Ue={class:"form-item-body"},Te={class:"number-box"},Be={class:"number-slider-box"},Pe={class:"number-input-box"},Ve={key:0,class:"form-item"},je={class:"form-item-label"},De={class:"form-item-body"},Ee={class:"number-box"},Fe={class:"number-slider-box"},Ie={class:"number-input-box"},Ae={class:"form-item"},He={class:"form-item-label"},Qe={class:"form-item-body"},Ge=["src"],Xe={__name:"recall-testing-form",emits:["save","load"],setup(m,{expose:d,emit:r}){const c=F(),p=g(!1),$=r,b=g(!0),f=g([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),s=Y({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1,question:"",similarity:.6,size:5,id:c.query.id}),L=ee(()=>b.value?f.value.filter(v=>v.value==s.search_type):f.value),C=(v,t)=>{s.rerank_model_config_id=t.rerank_model_config_id},S=v=>{s.search_type=v},l=()=>{if(!s.similarity)return q.error("请输入相似度");if(!s.size)return q.error("请输入分段数");if(!s.question)return q.error("请输入测试问题");let v={id:s.id,question:s.question,size:s.size,similarity:s.similarity,search_type:s.search_type};s.rerank_status==1&&(v.rerank_model_config_id=s.rerank_model_config_id),p.value=!0,$("load"),J(v).then(t=>{$("save",t.data)}).catch(()=>{$("save",[])}).finally(()=>{p.value=!1})},N=g([]);return(()=>{ne({model_type:"RERANK"}).then(v=>{let t=v.data||[];N.value=t.map(h=>({id:h.model_config.id,name:h.model_info.model_name,icon:h.model_info.model_icon_url,children:h.model_info.rerank_model_list}))})})(),d({open}),(v,t)=>{const h=ce,I=Z,U=E,T=_e,B=ue,P=me,A=pe,H=re,Q=ae,G=de;return n(),a("div",ke,[t[16]||(t[16]=e("div",{class:"alert-box"}," 用户提问时，会将召回的文档分段传递给大模型，大模型会根据传递的分段回答用户提问。您可以通过召回测试，输入问题查看匹配的文档分段和相似度 ",-1)),e("div",ge,[e("div",be,[e("div",he,[i(h,{style:{height:"76px"},value:s.question,"onUpdate:value":t[0]||(t[0]=o=>s.question=o),placeholder:"请输入测试问题"},null,8,["value"])])]),e("div",xe,[i(I,{loading:p.value,onClick:l,type:"primary",block:""},{default:_(()=>t[8]||(t[8]=[y("测试")])),_:1,__:[8]},8,["loading"])]),e("div",$e,[e("div",we,[e("div",{class:"hover-label",onClick:t[1]||(t[1]=o=>b.value=!b.value)},[t[9]||(t[9]=y(" 检索模式 ")),b.value?(n(),x(w(ie),{key:0})):(n(),x(w(le),{key:1}))])]),e("div",Le,[e("div",Oe,[(n(!0),a(R,null,z(L.value,o=>(n(),a("div",{class:te(["retrieval-mode-item",{active:s.search_type==o.value}]),key:o.value,onClick:O=>S(o.value)},[s.search_type==o.value?(n(),x(U,{key:0,class:"check-arrow",name:"check-arrow-filled"})):k("",!0),e("div",ze,[i(U,{name:o.iconName,class:"title-icon"},null,8,["name"]),e("span",Ce,u(o.title),1),o.isRecommendation?(n(),a("img",Se)):k("",!0)]),e("div",Ne,u(o.desc),1)],10,Re))),128))])])]),e("div",qe,[e("div",Me,[t[11]||(t[11]=e("span",null,"Top K ",-1)),i(T,null,{title:_(()=>t[10]||(t[10]=[y("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:_(()=>[i(w(V),{class:"question-icon"})]),_:1})]),e("div",Ue,[e("div",Te,[e("div",Be,[i(B,{class:"custom-slider",value:s.size,"onUpdate:value":t[2]||(t[2]=o=>s.size=o),min:1,max:10},null,8,["value"])]),e("div",Pe,[i(P,{value:s.size,"onUpdate:value":t[3]||(t[3]=o=>s.size=o),min:1,max:10},null,8,["value"])])])])]),s.search_type<=2?(n(),a("div",Ve,[e("div",je,[t[13]||(t[13]=e("span",null,"相似度阈值 ",-1)),i(T,null,{title:_(()=>t[12]||(t[12]=[y("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:_(()=>[i(w(V),{class:"question-icon"})]),_:1})]),e("div",De,[e("div",Ee,[e("div",Fe,[i(B,{class:"custom-slider",value:s.similarity,"onUpdate:value":t[4]||(t[4]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])]),e("div",Ie,[i(P,{value:s.similarity,"onUpdate:value":t[5]||(t[5]=o=>s.similarity=o),min:0,max:1,step:.01},null,8,["value"])])])])])):k("",!0),e("div",Ae,[e("div",He,[t[14]||(t[14]=e("span",null,"Rerank模型",-1)),t[15]||(t[15]=y("   ")),i(A,{checkedValue:1,unCheckedValue:0,checked:s.rerank_status,"onUpdate:checked":t[6]||(t[6]=o=>s.rerank_status=o)},null,8,["checked"])]),e("div",Qe,[i(G,{value:s.rerank_use_model,"onUpdate:value":t[7]||(t[7]=o=>s.rerank_use_model=o),placeholder:"请选择Rerank模型",onChange:C,style:{width:"320px"}},{default:_(()=>[(n(!0),a(R,null,z(N.value,o=>(n(),x(Q,{key:o.id},{label:_(()=>[e("span",null,[e("img",{class:"model-icon",src:o.icon,alt:""},null,8,Ge)])]),default:_(()=>[(n(!0),a(R,null,z(o.children,O=>(n(),x(H,{value:O,rerank_model_config_id:o.id,key:O},{default:_(()=>[e("span",null,u(O),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])])])])}}},Ze=D(Xe,[["__scopeId","data-v-5c23dca3"]]),Je={class:"recall-testing-box"},Ke={class:"recall-from-box"},We={class:"content-list-box"},Ye={key:0,class:"empty-box"},et={class:"top-block"},tt={class:"title"},st={key:0,class:"ml4"},ot={class:"info-block"},nt=["onClick"],it={key:0},lt={class:"gray-text"},at={key:0,class:"content-box"},rt={key:1,class:"content-box"},dt=["innerHTML"],ct={key:2,class:"loading-box"},_t={__name:"recall-testing",setup(m){F(),se();const d=g(!1),r=g(!1),c=g([]),p=f=>{r.value=!1,c.value=f||[]},$=()=>{r.value=!0},b=f=>{if(!f.file_name){window.open(`/#/library/details/categary-manage?id=${f.library_id}`);return}window.open(`/#/library/preview?id=${f.file_id}`)};return(f,s)=>{const L=K,C=E,S=ve;return n(),a("div",Je,[e("div",Ke,[i(L,null,{default:_(()=>[i(Ze,{onLoad:$,onSave:p})]),_:1})]),e("div",We,[d.value||c.value.length===0?(n(),a("div",Ye,s[0]||(s[0]=[e("img",{src:W,alt:""},null,-1),e("div",{class:"title"},"暂无结果，请重试",-1)]))):(n(),x(L,{key:1},{default:_(()=>[(n(!0),a(R,null,z(c.value,l=>(n(),a("div",{class:"list-item",key:l.id},[e("div",et,[e("div",tt,[y(" id："+u(l.id)+" ",1),l.title?(n(),a("div",st,u(l.title),1)):k("",!0),e("span",null,"共"+u(l.word_total)+"个字符",1)])]),e("div",ot,[s[2]||(s[2]=e("span",{class:"gray-text"},"来自：",-1)),e("div",{class:"link-text",onClick:N=>b(l)},[i(w(M)),y(" "+u(l.file_name)+" ",1),l.file_name?k("",!0):(n(),a("span",it,u(l.library_name)+"-精选",1))],8,nt),s[3]||(s[3]=e("span",{class:"v-line"},null,-1)),e("span",lt,[s[1]||(s[1]=y("相似度： ")),i(C,{name:"similarity",style:{"font-size":"16px"}}),y(" "+u(l.similarity),1)])]),l.question?(n(),a("div",at,"Q："+u(l.question),1)):k("",!0),l.answer?(n(),a("div",rt,"A："+u(l.answer),1)):k("",!0),e("div",{class:"content-box",innerHTML:l.content},null,8,dt)]))),128))]),_:1})),r.value?(n(),a("div",ct,[i(S)])):k("",!0)])])}}},Qt=D(_t,[["__scopeId","data-v-d45df884"]]);export{Qt as default};
