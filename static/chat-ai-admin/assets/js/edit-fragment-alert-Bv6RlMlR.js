import{_ as Ie}from"./empty-CzGZrENG.js";import{b as ee,bL as Ce,k as ve,d9 as Pe,d as le,B as fe,M as he,bD as Se,V as Ue,E as ze}from"../../index-CfxQ5aRu.js";import{M as l,N as m,a1 as re,a2 as ce,W as e,e as $,B as X,b as ge,w as te,k as n,S as i,a6 as M,Y as d,a7 as P,z as ke,F as T,$ as Z,Q as V,Z as U,G as ae,H as me,u as G,aa as ye,ai as Le,V as oe}from"./vue-chunks-BjMuQ6KD.js";import{M as ue}from"./model-select-c6lAzYs5.js";import{C as De}from"./index-BWdnNCYH.js";import{M as je}from"./index-BMSQkwth.js";import{_ as Fe}from"./index-Capld-U4.js";import{_ as be}from"./index-QsoU6-T8.js";import{F as ie,_ as Ne}from"./index-xqeVJHPz.js";import"./index-DcUUFn-g.js";import{I as xe}from"./Input-C5WaaE9Z.js";import{Q as pe}from"./QuestionCircleOutlined-Deh272L3.js";import{S as Me,_ as Te}from"./index-BuS_bfCI.js";import{_ as Oe}from"./index-D8Y0HnA5.js";import{_ as we}from"./index-D1MiuDW_.js";import{_ as $e}from"./TextArea-CN_AI7y7.js";import{_ as Ee}from"./index-Qxwv7brO.js";import{U as Ae}from"./index-CL2f_cnE.js";import{_ as Ve,T as Be}from"./index-BMYKVcHu.js";const Qe={},_e=k=>(re("data-v-ba7325cb"),k=k(),ce(),k),Re={class:"empty-box"},Ge=_e(()=>e("img",{src:Ie,alt:""},null,-1)),He=_e(()=>e("div",{class:"title"},"暂无分段",-1)),Ke=_e(()=>e("div",{class:"info"},"左侧进行分段设置后，点击“生成分段预览",-1)),Je=[Ge,He,Ke];function We(k,O){return l(),m("div",Re,Je)}const Ho=ee(Qe,[["render",We],["__scopeId","data-v-ba7325cb"]]),Y=k=>(re("data-v-18e54e78"),k=k(),ce(),k),Xe=Y(()=>e("div",{class:"custom-modal-header"},[e("span",null,"AI生成提示词")],-1)),Ye={class:"ai-generate-wrapper"},Ze={class:"ai-generate-wrapper-left"},et={class:"form-box-wrapper-options"},tt={class:"form-item flex1"},st=Y(()=>e("div",{class:"form-label required"},"选择模型：",-1)),ot={class:"form-content"},nt={class:"form-item flex1"},at={class:"form-content dual-inputs"},it={class:"input-group"},lt=Y(()=>e("div",{class:"form-label required"},"根据文档内容前：",-1)),rt={class:"form-label-input-box"},ct={class:"form-item generate-btn-box"},_t={class:"result-nav"},dt={key:0,class:"tip"},mt={key:1,class:"result-nav-text"},ut={key:0,class:"container"},pt=Y(()=>e("div",{class:"rect-container rect1"},[e("div",{class:"rect"})],-1)),vt=Y(()=>e("div",{class:"rect-container rect2"},[e("div",{class:"rect"})],-1)),ft=Y(()=>e("div",{class:"rect-container rect3"},[e("div",{class:"rect"})],-1)),ht=[pt,vt,ft],gt={class:"result-container"},kt=["innerHTML"],yt={class:"result-footer"},bt={__name:"ai-generate-modal",props:{detailsInfo:{type:Object}},emits:["handleEdit"],setup(k,{expose:O,emit:E}){const f=Ce(),I=$(!1),v=$(!1),s=$(!1),r=$(!1),u=X({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:1e3}),H=new je({html:!0,linkify:!0,typographer:!0}),F=$(""),C=X({content:""}),z=ge(()=>f.initDocumentFragmentList);te(()=>C.content,()=>{F.value=H.render(C.content)});const D=E,B=$(""),j=["azure","ollama","xinference","openaiAgent"],_=$(!1),Q=()=>{v.value=!1,r.value=!1,_.value=!0},w=()=>{ve.success("操作成功"),v.value=!1,r.value=!1,_.value=!1,D("handleEdit",q.value)},q=$("");function N(p,g){let a="",t=0;for(const x of p){if(t>=g)break;const h=x.content.trim()||"",y=g-t;if(h.length<=y)a+=h,t+=h.length;else{a+=h.slice(0,y),t=g;break}}return a}const R=async()=>{C.content="",q.value="",s.value=!0,r.value=!0;try{const p=await N(z.value,u.count);let g={ai_prompt_model_config_id:u.model_config_id,ai_prompt_model:u.use_model,ai_prompt_question:p};const a=await Pe(g);q.value=a.data,C.content=`<div class="dialog-message">${a.data}</div>`,v.value=!0}finally{s.value=!1}},A=p=>{u.use_model=j.includes(p.rawData.model_define)&&p.rawData.deployment_name?p.rawData.deployment_name:p.rawData.name,u.use_model_icon=p.icon,u.use_model_name=p.use_model_name,u.model_config_id=p.rawData.id,B.value=p.rawData.model_define},S=$([]),K=p=>{S.value=p,ke(()=>{(!u.ai_chunk_model||!Number(u.ai_chunk_model_config_id))&&b()})},b=()=>{if(S.value.length>0){let p=null,g=null;for(let a of S.value)if(a.model_define==="tongyi"){p=a;for(let t of p.children)if(t.name==="qwen-max"){g=t;break}break}p||(p=S.value[0],g=p.children[0]),p&&g&&(u.use_model=g.name,u.model_config_id=g.model_config_id,u.ai_chunk_model=g.name,u.ai_chunk_model_config_id=g.model_config_id)}};return O({showModal:Q}),(p,g)=>{const a=Fe,t=be,x=le,h=fe,y=he;return l(),m("div",null,[n(y,{open:_.value,"onUpdate:open":g[2]||(g[2]=L=>_.value=L),onOk:w,maskClosable:!1,width:r.value?"944px":"472px","ok-button-props":{style:{display:"none"}}},{title:i(()=>[Xe]),footer:i(()=>[]),default:i(()=>[e("div",Ye,[e("div",{class:M(["form-box-wrapper ai-generate-wrapper-box",{"show-generate":r.value}])},[e("div",Ze,[n(a,{class:"alert-box",message:"根据导入的文档的内容生成AI分段的提示词，支持设置导入文档的字数。",type:"info"}),e("div",et,[e("div",tt,[st,e("div",ot,[n(De,{modelValue:u.use_model,"onUpdate:modelValue":g[0]||(g[0]=L=>u.use_model=L),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":u.model_config_id,onChange:A,onLoaded:K},null,8,["modelValue","model-config-id"])])]),e("div",nt,[e("div",at,[e("div",it,[lt,e("div",rt,[n(t,{value:u.count,"onUpdate:value":g[1]||(g[1]=L=>u.count=L),min:1,max:1e4,style:{width:"137px"}},null,8,["value"]),d("个字，自动生成提示词 ")])])])])]),e("div",ct,[n(h,{onClick:R,loading:s.value,class:"generate-btn"},{default:i(()=>[n(x,{name:"ai-generate-white",style:{"font-size":"16px"}}),d(" 开始生成 ")]),_:1},8,["loading"])])]),e("div",{class:M(["ai-generate-wrapper-right",{"show-result":r.value}])},[e("div",_t,[n(x,{name:"generate-icon",style:{"font-size":"14px"}}),s.value?(l(),m("span",dt,"提示词生成中...")):(l(),m("div",mt,"提示词生成完毕"))]),!C.content&&s.value&&!I.value?(l(),m("div",ut,ht)):P("",!0),e("div",gt,[e("div",{class:"dialog-content",innerHTML:F.value},null,8,kt)]),e("div",yt,[n(h,{class:"result-footer-btn",disabled:q.value=="",type:"primary",onClick:w},{default:i(()=>[d("使用该提示词")]),_:1},8,["disabled"])])],2)],2)])]),_:1},8,["open","width"])])}}},xt=ee(bt,[["__scopeId","data-v-18e54e78"]]),c=k=>(re("data-v-a8cefe0b"),k=k(),ce(),k),wt={class:"segmentation-setting"},$t={class:"setting-items"},qt={class:"setting-item intelligent-setting active"},It={class:"setting-item-body"},Ct=c(()=>e("div",{class:"sub-setting-item-name"},"文件切分",-1)),Pt={key:0,class:"custom-setting-form excel-qa-form"},St={class:"form-item"},Ut={class:"form-item-box"},zt=c(()=>e("div",{class:"form-item-label"},"问题所在列：",-1)),Lt={class:"form-item-body"},Dt={class:"form-item-box"},jt=c(()=>e("div",{class:"form-item-label not-required"},"相似问法所在列：",-1)),Ft={class:"form-item-body"},Nt={class:"form-item-box"},Mt=c(()=>e("div",{class:"form-item-label"},"答案所在列：",-1)),Tt={class:"form-item-body"},Ot=c(()=>e("div",{class:"sub-setting-item-name"},"索引方式",-1)),Et={class:"indexing-methods-box"},At={class:"list-title-block"},Vt=c(()=>e("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),Bt={class:"list-title-block"},Qt=c(()=>e("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),Rt=c(()=>e("div",{class:"btn-box-block"},null,-1)),Gt={class:"btn-box-block"},Ht={key:1,class:"custom-setting-form excel-qa-form"},Kt={class:"form-item"},Jt={class:"form-item-box"},Wt=c(()=>e("div",{class:"form-item-label"},"问题开始标识符：",-1)),Xt={class:"form-item-body"},Yt={class:"form-item-box"},Zt=c(()=>e("div",{class:"form-item-label not-required"},"相似问法开始标识符：",-1)),es={class:"form-item-body"},ts={class:"form-item-box"},ss=c(()=>e("div",{class:"form-item-label"},"答案开始标识符：",-1)),os={class:"form-item-body"},ns=c(()=>e("div",{class:"sub-setting-item-name"},"索引方式",-1)),as={class:"indexing-methods-box"},is={class:"list-title-block"},ls=c(()=>e("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题和答案一起对比相似度，根据相似度高的问题和答案回复 ",-1)),rs={class:"list-title-block"},cs=c(()=>e("div",{class:"list-content"}," 回答用户提问时，将用户提问与导入的问题一起对比相似度，再根据相似度高的问题和对应的答案来回复 ",-1)),_s=c(()=>e("div",{class:"btn-box-block"},null,-1)),ds={class:"btn-box-block"},ms={key:0,class:"custom-setting-form subsection-form"},us={class:"form-item"},ps={key:0,class:"form-item-title"},vs=c(()=>e("div",{class:"form-item-label"},"分段方式：",-1)),fs={class:"form-item-body"},hs=c(()=>e("div",{class:"form-item-tip"}," 提示：语义分段更适合没有排版过的文章，即没有明显换行符号的文本，否则更推荐使用普通分段 ",-1)),gs={class:"select-card-box"},ks={class:"card-title"},ys=c(()=>e("div",{class:"card-desc"}," 基于文章中句号、空行，或者自定义符号进行分段，不会消耗模型token ",-1)),bs={class:"card-title"},xs=c(()=>e("div",{class:"card-desc"}," 将文章拆分成句子后，通过语句向量相似度进行分段，会消耗模型token ",-1)),ws={class:"card-title"},$s=c(()=>e("div",{class:"card-desc"}," 将文章提交给大模型，大模型基于设定的提示词进行分段，会消耗大量模型token ",-1)),qs={class:"form-item",style:{"margin-bottom":"18px"}},Is=c(()=>e("div",{class:"form-item-label"},"分段标识符：",-1)),Cs={class:"form-item-body"},Ps={class:"form-item"},Ss=c(()=>e("div",{class:"form-item-label"},"分段最大长度：",-1)),Us={class:"form-item-body"},zs=c(()=>e("span",{class:"unit-text"},"字符",-1)),Ls={class:"form-item"},Ds=c(()=>e("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),js={class:"form-item-body"},Fs=c(()=>e("span",{class:"unit-text"},"字符",-1)),Ns={class:"form-item",style:{"margin-bottom":"16px"}},Ms=c(()=>e("div",{class:"form-item-label"},"嵌入模型：",-1)),Ts={class:"form-item-body"},Os={class:"form-item",style:{"margin-bottom":"16px"}},Es={class:"form-item-label"},As={class:"form-item-body"},Vs={class:"form-item"},Bs=c(()=>e("div",{class:"form-item-label"},"分段最大长度：",-1)),Qs={class:"form-item-body"},Rs=c(()=>e("span",{class:"unit-text"},"字符",-1)),Gs={class:"form-item"},Hs=c(()=>e("div",{class:"form-item-label not-required"},"分段重叠长度：",-1)),Ks={class:"form-item-body"},Js=c(()=>e("span",{class:"unit-text"},"字符",-1)),Ws={class:"form-item",style:{"margin-bottom":"16px"}},Xs=c(()=>e("div",{class:"form-item-label"},"AI大模型：",-1)),Ys={class:"form-item-body"},Zs={class:"form-item",style:{"margin-bottom":"16px"}},eo=c(()=>e("div",{class:"form-item-label-box"},[e("div",{class:"form-item-label"},"提示词设置：")],-1)),to={class:"form-item-body"},so={class:"form-item",style:{"margin-bottom":"16px"}},oo={class:"form-item-label"},no={class:"form-item-body form-item-inptu-numbner-box"},ao={class:"btn-box-block"},io={class:"btn-box-block"},ne="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",lo={__name:"segmentation-setting",props:{mode:{type:Number,default:0},excellQaLists:{type:Array,default:()=>[]},libFileInfo:{type:Object,default:()=>{}},library_type:{default:0},hideSave:{type:Boolean,default:!1},status:{type:String,default:""}},emits:["change","validate","save","changeChunkType"],setup(k,{expose:O,emit:E}){const f=ie.useForm,I=E,v=k;ge(()=>v.libFileInfo.doc_type=="1"&&(v.libFileInfo.file_ext=="docx"||v.libFileInfo.file_ext=="html")),te(v,a=>{let t=a.libFileInfo,x=t.separators_no?t.separators_no.split(","):[11,12];s.separators_no=x.map(h=>+h),s.chunk_size=+t.chunk_size||512,s.ai_chunk_size=+t.ai_chunk_size||5e3,s.chunk_overlap=+t.chunk_overlap||50,s.question_lable=t.question_lable,s.similar_label=t.similar_label,s.answer_lable=t.answer_lable,s.question_column=t.question_column||void 0,s.answer_column=t.answer_column||void 0,s.similar_column=t.similar_column||void 0,s.qa_index_type=+t.qa_index_type,s.enable_extract_image=t.enable_extract_image=="true",s.chunk_type=+t.chunk_type,s.semantic_chunk_size=+t.semantic_chunk_size||512,s.semantic_chunk_overlap=+t.semantic_chunk_overlap||50,s.semantic_chunk_threshold=+t.semantic_chunk_threshold||90,s.semantic_chunk_use_model=t.semantic_chunk_use_model||"",s.ai_chunk_prumpt=t.ai_chunk_prumpt||ne,s.ai_chunk_model=t.ai_chunk_model||"",s.semantic_chunk_model_config_id=t.semantic_chunk_model_config_id>0?t.semantic_chunk_model_config_id:"",s.ai_chunk_model_config_id=t.ai_chunk_model_config_id>0?t.ai_chunk_model_config_id:"",setTimeout(()=>{s.semantic_chunk_use_model=t.semantic_chunk_use_model||"",s.semantic_chunk_model_config_id=t.semantic_chunk_model_config_id>0?t.semantic_chunk_model_config_id:""},200),t.chunk_type==0&&(x=t.normal_chunk_default_separators_no?t.normal_chunk_default_separators_no.split(","):[11,12],s.separators_no=x.map(h=>+h),s.chunk_size=+t.normal_chunk_default_chunk_size||512,s.chunk_overlap=+t.normal_chunk_default_chunk_overlap||50,s.chunk_type=+t.default_chunk_type,s.semantic_chunk_size=+t.semantic_chunk_default_chunk_size||512,s.semantic_chunk_overlap=+t.semantic_chunk_default_chunk_overlap||50,s.semantic_chunk_threshold=+t.semantic_chunk_default_threshold||90,setTimeout(()=>{s.semantic_chunk_use_model=t.default_use_model,s.semantic_chunk_model_config_id=t.default_model_config_id>0?t.default_model_config_id:""},100)),s.is_qa_doc=v.library_type==2?1:0});const s=X({separators_no:[],chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",question_column:void 0,answer_column:void 0,similar_column:void 0,qa_index_type:1,enable_extract_image:!0,chunk_type:1,semantic_chunk_size:512,semantic_chunk_overlap:50,semantic_chunk_threshold:90,semantic_chunk_use_model:"",semantic_chunk_model_config_id:"",ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:ne});let r={};setTimeout(()=>{r=JSON.parse(JSON.stringify(s))},500);const u=$([]),H=$(null),F=a=>{u.value=a,ke(()=>{(!s.ai_chunk_model||!Number(s.ai_chunk_model_config_id))&&C()})},C=()=>{if(u.value.length>0){let a=null,t=null;for(let x of u.value)if(x.model_define==="tongyi"){a=x;for(let h of a.children)if(h.name==="qwen-max"){t=h;break}break}a||(a=u.value[0],t=a.children[0]),a&&t&&(s.ai_chunk_model=t.name,s.ai_chunk_model_config_id=t.model_config_id)}},z=()=>{Object.assign(s,r)},D=()=>{I("save")},B=X({question_lable:[{message:"请输入问题开始标识符",validator:async(a,t)=>s.is_qa_doc==1&&v.mode==0?t?Promise.resolve():Promise.reject("请输入问题开始标识符"):Promise.resolve()}],semantic_chunk_model_config_id:[{message:"请选择嵌入模型",validator:async(a,t)=>s.is_qa_doc==0&&s.chunk_type==2?t?Promise.resolve():Promise.reject("请选择嵌入模型"):Promise.resolve()}],ai_chunk_model_config_id:[{message:"请选择AI大模型",validator:async(a,t)=>s.is_qa_doc==0&&s.chunk_type==3?t?Promise.resolve():Promise.reject("请选择AI大模型"):Promise.resolve()}],answer_lable:[{message:"请输入答案开始标识符",validator:async(a,t)=>s.is_qa_doc==1&&v.mode==0?t?Promise.resolve():Promise.reject("请输入答案开始标识符"):Promise.resolve()}],separators_no:[{message:"请选择分段标识符",validator:async(a,t)=>v.mode!=1&&s.is_qa_doc==0&&t.length==0&&s.chunk_type==1?Promise.reject("请选择分段标识符"):Promise.resolve()}],chunk_size:[{validator:async(a,t)=>{if(v.mode!=1&&s.chunk_type==1)if(t){if(t>1e4)return Promise.reject("最大分段长最大值不得超过10000")}else return Promise.reject("请输入分段最大长度");else if(s.chunk_type==3&&!t)return Promise.reject("请输入分段最大长度");return Promise.resolve()}}],ai_chunk_size:[{validator:async(a,t)=>s.chunk_type==3&&!t?Promise.reject("请输入分段最大长度"):Promise.resolve()}],ai_chunk_prumpt:[{validator:async(a,t)=>!s.ai_chunk_prumpt&&!t?Promise.reject("请输入提示词"):Promise.resolve()}],chunk_overlap:[{validator:async(a,t)=>v.mode!=1&&s.chunk_type==1&&t>parseInt(s.chunk_size/2)?Promise.reject("分段重叠长度最大不得超过最大分段长度的50%"):Promise.resolve()}],question_column:[{message:"请选择问题所在列",validator:async(a,t)=>v.mode==1&&s.is_qa_doc==1?t?Promise.resolve():Promise.reject("请选择问题所在列"):Promise.resolve()}],answer_column:[{message:"请选择答案所在列",validator:async(a,t)=>v.mode==1&&s.is_qa_doc==1?t?Promise.resolve():Promise.reject("请选择答案所在列"):Promise.resolve()}]}),{resetFields:j,validate:_,validateInfos:Q}=f(s,B),w=$(!1),q=$(!1),N=()=>{w.value=!0,s.chunk_type!=3&&(q.value=!0),R()},R=(a=!0)=>{let t=ye(s);_().then(()=>{I("change",{...t}),I("validate","")}).catch(x=>{const{errorFields:h}=x;if(h.length>0){a&&h[0].name,ve.error(h[0].errors[0]),I("validate",h[0].errors[0]),w.value=!1,q.value=!1;return}I("validate",""),I("change",{...t})})};let A=null;const S=()=>{A&&(clearTimeout(A),A=null),A=setTimeout(()=>{R()},500)},K=$([]);(()=>{Se().then(a=>{K.value=a.data||[]})})();const p=a=>{a!=s.qa_index_type&&(s.qa_index_type=a,R())},g=a=>{s.ai_chunk_prumpt=a};return te(()=>s.chunk_type,a=>{I("changeChunkType",a)}),te(()=>w.value,a=>{}),O({formState:s,reLoading:w,saveLoading:q,reChange:N}),(a,t)=>{const x=Me,h=Te,y=le,L=fe,se=xe,J=be,W=Oe,de=we,qe=$e;return l(),m("div",wt,[e("div",$t,[e("div",qt,[e("div",It,[P("",!0),s.is_qa_doc==1?(l(),m(T,{key:1},[Ct,v.mode==1?(l(),m("div",Pt,[e("div",St,[e("div",Ut,[zt,e("div",Lt,[n(h,{value:s.question_column,"onUpdate:value":t[2]||(t[2]=o=>s.question_column=o),onChange:S,placeholder:"请选择列名",style:{width:"100%"}},{default:i(()=>[(l(!0),m(T,null,Z(v.excellQaLists,o=>(l(),V(x,{value:o.value,key:o.value},{default:i(()=>[d(U(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Dt,[jt,e("div",Ft,[n(h,{allowClear:"",value:s.similar_column,"onUpdate:value":t[3]||(t[3]=o=>s.similar_column=o),onChange:S,placeholder:"请选择相似问法列名",style:{width:"100%"}},{default:i(()=>[(l(!0),m(T,null,Z(v.excellQaLists,o=>(l(),V(x,{value:o.value,key:o.value},{default:i(()=>[d(U(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),e("div",Nt,[Mt,e("div",Tt,[n(h,{value:s.answer_column,"onUpdate:value":t[4]||(t[4]=o=>s.answer_column=o),onChange:S,placeholder:"请选择答案所在列",style:{width:"100%"}},{default:i(()=>[(l(!0),m(T,null,Z(v.excellQaLists,o=>(l(),V(x,{value:o.value,key:o.value},{default:i(()=>[d(U(o.lable),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),Ot,e("div",Et,[e("div",{class:M(["list-item",{active:s.qa_index_type==1}]),onClick:t[5]||(t[5]=o=>p(1))},[n(y,{class:"check-icon",name:"check-arrow-filled"}),e("div",At,[n(y,{name:"file-search"}),d(" 问题与答案一起生成索引 ")]),Vt],2),e("div",{class:M(["list-item",{active:s.qa_index_type==2}]),onClick:t[6]||(t[6]=o=>p(2))},[n(y,{class:"check-icon",name:"check-arrow-filled"}),e("div",Bt,[n(y,{name:"comment-search"}),d(" 仅对问题生成索引 ")]),Qt],2),Rt,e("div",Gt,[n(L,{type:"primary",block:"",onClick:D},{default:i(()=>[d("保存")]),_:1})])])])):(l(),m("div",Ht,[e("div",Kt,[e("div",Jt,[Wt,e("div",Xt,[n(se,{placeholder:"请输入标识符",value:s.question_lable,"onUpdate:value":t[7]||(t[7]=o=>s.question_lable=o),onChange:S},null,8,["value"])])]),e("div",Yt,[Zt,e("div",es,[n(se,{placeholder:"请输入标识符",value:s.similar_label,"onUpdate:value":t[8]||(t[8]=o=>s.similar_label=o),onChange:S},null,8,["value"])])]),e("div",ts,[ss,e("div",os,[n(se,{placeholder:"请输入标识符",value:s.answer_lable,"onUpdate:value":t[9]||(t[9]=o=>s.answer_lable=o),onChange:S},null,8,["value"])])])]),ns,e("div",as,[e("div",{class:M(["list-item",{active:s.qa_index_type==1}]),onClick:t[10]||(t[10]=o=>p(1))},[n(y,{class:"check-icon",name:"check-arrow-filled"}),e("div",is,[n(y,{name:"file-search"}),d(" 问题与答案一起生成索引 ")]),ls],2),e("div",{class:M(["list-item",{active:s.qa_index_type==2}]),onClick:t[11]||(t[11]=o=>p(2))},[n(y,{class:"check-icon",name:"check-arrow-filled"}),e("div",rs,[n(y,{name:"comment-search"}),d(" 仅对问题生成索引 ")]),cs],2),_s,e("div",ds,[n(L,{type:"primary",block:"",onClick:D},{default:i(()=>[d("保存")]),_:1})])])]))],64)):(l(),m(T,{key:2},[v.mode!=1?(l(),m("div",ms,[e("div",us,[k.status==="paragraphsSegmented"?(l(),m("div",ps,"分段及清洗规则")):P("",!0),vs,e("div",fs,[hs,e("div",gs,[e("div",{class:M(["select-card-item",{active:s.chunk_type==1}]),onClick:t[12]||(t[12]=o=>s.chunk_type=1)},[n(y,{class:"check-arrow",name:"check-arrow-filled"}),e("div",ks,[n(y,{name:"ordinary-segmentation",class:"title-icon"}),d(" 普通分段 ")]),ys],2),e("div",{class:M(["select-card-item",{active:s.chunk_type==2}]),onClick:t[13]||(t[13]=o=>s.chunk_type=2)},[n(y,{class:"check-arrow",name:"check-arrow-filled"}),e("div",bs,[n(y,{name:"semantic-segmentation",class:"title-icon"}),d(" 语义分段 ")]),xs],2),e("div",{class:M(["select-card-item",{active:s.chunk_type==3}]),onClick:t[14]||(t[14]=o=>s.chunk_type=3)},[n(y,{class:"check-arrow",name:"check-arrow-filled"}),e("div",ws,[n(y,{name:"semantic-segmentation",class:"title-icon"}),d(" AI分段 ")]),$s],2)])])]),s.chunk_type==1?(l(),m(T,{key:0},[e("div",qs,[Is,e("div",Cs,[n(h,{placeholder:"请选择",style:{width:"100%"},mode:"multiple",value:s.separators_no,"onUpdate:value":t[15]||(t[15]=o=>s.separators_no=o)},{default:i(()=>[(l(!0),m(T,null,Z(K.value,o=>(l(),V(x,{value:o.no,key:o.no},{default:i(()=>[d(U(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),n(W,{gap:16},{default:i(()=>[e("div",Ps,[Ss,e("div",Us,[n(W,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.chunk_size,"onUpdate:value":t[16]||(t[16]=o=>s.chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),zs]),_:1})])]),e("div",Ls,[Ds,e("div",js,[n(W,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.chunk_overlap,"onUpdate:value":t[17]||(t[17]=o=>s.chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Fs]),_:1})])])]),_:1})],64)):P("",!0),ae(e("div",null,[e("div",Ns,[Ms,e("div",Ts,[n(ue,{modelType:"TEXT EMBEDDING",modeName:s.semantic_chunk_use_model,"onUpdate:modeName":t[18]||(t[18]=o=>s.semantic_chunk_use_model=o),modeId:s.semantic_chunk_model_config_id,"onUpdate:modeId":t[19]||(t[19]=o=>s.semantic_chunk_model_config_id=o),style:{width:"100%"},onLoaded:F},null,8,["modeName","modeId"])])]),e("div",Os,[e("div",Es,[d(" 分段阈值 "),n(de,null,{title:i(()=>[d("用于控制分段拆分的标准，数值0~100,数值越大，分段越少，数值越小，分段越多。")]),default:i(()=>[n(G(pe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),d("： ")]),e("div",As,[n(J,{style:{width:"100%"},value:s.semantic_chunk_threshold,"onUpdate:value":t[20]||(t[20]=o=>s.semantic_chunk_threshold=o),placeholder:"请输入分段阈值",precision:0,min:0,max:100},null,8,["value"])])]),n(W,{gap:16},{default:i(()=>[e("div",Vs,[Bs,e("div",Qs,[n(W,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.semantic_chunk_size,"onUpdate:value":t[21]||(t[21]=o=>s.semantic_chunk_size=o),placeholder:"分段最大长度",min:200,max:1e4,precision:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Rs]),_:1})])]),e("div",Gs,[Hs,e("div",Ks,[n(W,{align:"center",gap:8},{default:i(()=>[n(J,{style:{flex:"1"},value:s.semantic_chunk_overlap,"onUpdate:value":t[22]||(t[22]=o=>s.semantic_chunk_overlap=o),placeholder:"分段重叠长度",min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),Js]),_:1})])])]),_:1})],512),[[me,s.chunk_type==2]]),ae(e("div",null,[e("div",Ws,[Xs,e("div",Ys,[n(ue,{modelType:"LLM",placeholder:"请选择AI大模型",modeName:s.ai_chunk_model,"onUpdate:modeName":t[23]||(t[23]=o=>s.ai_chunk_model=o),modeId:s.ai_chunk_model_config_id,"onUpdate:modeId":t[24]||(t[24]=o=>s.ai_chunk_model_config_id=o),style:{width:"100%"},onLoaded:F},null,8,["modeName","modeId"])])]),e("div",Zs,[eo,e("div",to,[n(qe,{maxLength:500,style:{height:"80px"},value:s.ai_chunk_prumpt,"onUpdate:value":t[25]||(t[25]=o=>s.ai_chunk_prumpt=o),placeholder:ne},null,8,["value"])])]),e("div",so,[e("div",oo,[d(" 单次最大字符数 "),n(de,null,{title:i(()=>[d("由于大模型支持的上下文数量有限制，如果上传的文档较大，会按照最大字符数先拆分成多个分段，再提交给大模型进行分段。")]),default:i(()=>[n(G(pe),{style:{cursor:"pointer","margin-left":"2px"}})]),_:1}),d("： ")]),e("div",no,[n(J,{class:"form-item-inptu-numbner",value:s.ai_chunk_size,"onUpdate:value":t[26]||(t[26]=o=>s.ai_chunk_size=o),placeholder:"请输入单次最大字符数",precision:0,min:0,formatter:o=>parseInt(o),parser:o=>parseInt(o)},null,8,["value","formatter","parser"]),d(" 字符 ")])])],512),[[me,s.chunk_type==3]]),e("div",ao,[n(L,{onClick:z,style:{flex:"1"}},{default:i(()=>[d("重置")]),_:1}),n(L,{onClick:N,loading:w.value,style:{flex:"1"},type:"primary",ghost:""},{default:i(()=>[d("生成分段预览")]),_:1},8,["loading"])]),e("div",io,[v.hideSave?P("",!0):(l(),V(L,{key:0,type:"primary",block:"",disabled:q.value,onClick:D},{default:i(()=>[d("保存")]),_:1},8,["disabled"]))])])):P("",!0)],64))])])]),n(xt,{ref_key:"aiGenerateRef",ref:H,onHandleEdit:g},null,512)])}}},Ko=ee(lo,[["__scopeId","data-v-a8cefe0b"]]),ro={class:"document-fragment"},co={class:"fragment-header"},_o={class:"fragment-info"},mo={class:"fragment-number"},uo={key:0,class:"fragment-title"},po={class:"fragment-content-lenght"},vo={key:1,class:"fragment-content-status"},fo={class:"cfb363f"},ho={class:"fragment-action"},go={class:"fragment-content"},ko={key:0,class:"fragment-content"},yo={key:1,class:"fragment-content"},bo={key:2,class:"fragment-content"},xo={class:"fragment-img"},wo=["src"],$o={__name:"document-fragment",props:{number:{type:[Number,String]},total:{type:[Number,String]},title:{type:[Number,String]},content:{type:[Number,String]},question:{type:[Number,String]},answer:{type:[Number,String]},images:{type:[Array,String]},similar_question_list:{type:[Array,String]},status:{type:String,default:""},currentData:{type:Object,default:()=>{}}},emits:["edit","delete"],setup(k,{emit:O}){const E=O,f=k,I=()=>{E("edit")},v=()=>{E("delete")};return(s,r)=>{var C,z,D;const u=we,H=Ee,F=Le("viewer");return l(),m("div",ro,[e("div",co,[e("div",_o,[e("span",mo,"#"+U(f.number),1),f.title?(l(),m("span",uo,U(f.title),1)):P("",!0),e("span",po,"共"+U(f.total)+"个字符",1),f.status==="paragraphsSegmented"?(l(),m("span",vo,[d(U(((C=f.currentData)==null?void 0:C.status_text)||"-"),1),((z=f.currentData)==null?void 0:z.status)==3?(l(),V(G(Ue),{key:0})):P("",!0),((D=f.currentData)==null?void 0:D.status)==2&&f.currentData.errmsg?(l(),V(u,{key:1,title:f.currentData.errmsg},{default:i(()=>[e("strong",fo,[d("原因"),n(G(ze),{class:"err-icon cfb363f"})])]),_:1},8,["title"])):P("",!0)])):P("",!0)]),e("div",ho,[e("a",{onClick:I},"编辑"),n(H,{type:"vertical"}),e("a",{onClick:v},"删除")])]),e("div",go,U(f.content),1),f.question?(l(),m("div",ko,"Q："+U(f.question),1)):P("",!0),f.similar_question_list&&f.similar_question_list.join("")?(l(),m("div",yo," 相似问法："+U(f.similar_question_list.join("/")),1)):P("",!0),f.answer?(l(),m("div",bo,"A："+U(f.answer),1)):P("",!0),ae((l(),m("div",xo,[(l(!0),m(T,null,Z(f.images,(B,j)=>(l(),m("img",{key:j,src:B,alt:""},null,8,wo))),128))])),[[F]])])}}},Jo=ee($o,[["__scopeId","data-v-7fd6ee67"]]),qo={class:"upload-box-wrapper"},Io={key:0},Co={__name:"edit-fragment-alert",emits:["ok"],setup(k,{expose:O,emit:E}){const f=E,I=$("1"),v=ie.useForm,s=$(!1),r=X({title:"",content:"",question:"",answer:"",similar_question_list:"",images:[]}),u=X({content:[{message:"请输入分段内容",validator:async(j,_)=>z.value||_?Promise.resolve():Promise.reject("请输入分段内容")}],question:[{message:"请输入分段问题",validator:async(j,_)=>z.value?_?Promise.resolve():Promise.reject("请输入分段问题"):Promise.resolve()}],answer:[{message:"请输入分段答案",validator:async(j,_)=>z.value?_?Promise.resolve():Promise.reject("请输入分段答案"):Promise.resolve()}]}),{resetFields:H,validate:F,validateInfos:C}=v(r,u),z=$(!1),D=({title:j,content:_,question:Q,answer:w,images:q,similar_question_list:N})=>{r.title=j,r.content=_,r.question=Q,r.answer=w,r.images=q||[],r.similar_question_list=N?N.join(`
`):"",z.value=Q!="",s.value=!0},B=()=>{F().then(()=>{s.value=!1,f("ok",ye(r))})};return O({open:D}),(j,_)=>{const Q=xe,w=Ne,q=$e,N=le,R=Ve,A=Be,S=ie,K=he;return l(),m("div",null,[n(K,{open:s.value,"onUpdate:open":_[7]||(_[7]=b=>s.value=b),title:"编辑分段",onOk:B,width:"746px"},{default:i(()=>[n(S,{layout:"vertical"},{default:i(()=>[n(w,{label:"分段标题："},{default:i(()=>[n(Q,{type:"text",placeholder:"请输入分段标题",value:r.title,"onUpdate:value":_[0]||(_[0]=b=>r.title=b)},null,8,["value"])]),_:1}),z.value?(l(),m(T,{key:0},[n(w,oe({label:"分段问题："},G(C).question),{default:i(()=>[n(q,{placeholder:"请输入分段问题",value:r.question,"onUpdate:value":_[1]||(_[1]=b=>r.question=b),style:{height:"100px"}},null,8,["value"])]),_:1},16),n(w,{label:"相似问法（一行一个，最多可添加100个相似问法）"},{default:i(()=>[n(q,{placeholder:"请输入相似问法",value:r.similar_question_list,"onUpdate:value":_[2]||(_[2]=b=>r.similar_question_list=b),style:{height:"100px"}},null,8,["value"])]),_:1}),n(w,oe({label:"分段答案："},G(C).answer),{default:i(()=>[n(q,{placeholder:"请输入分段答案",value:r.answer,"onUpdate:value":_[3]||(_[3]=b=>r.answer=b),style:{height:"140px"}},null,8,["value"])]),_:1},16)],64)):(l(),V(w,oe({key:1,label:"分段内容："},G(C).content),{default:i(()=>[n(q,{placeholder:"请输入分段内容",value:r.content,"onUpdate:value":_[4]||(_[4]=b=>r.content=b),style:{height:"150px"}},null,8,["value"])]),_:1},16)),n(w,{label:"附件"},{default:i(()=>[e("div",qo,[n(A,{activeKey:I.value,"onUpdate:activeKey":_[5]||(_[5]=b=>I.value=b),size:"small"},{default:i(()=>[n(R,{key:"1"},{tab:i(()=>[e("span",null,[n(N,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),d(" 图片 "),r.images.length?(l(),m("span",Io,"("+U(r.images.length)+")",1)):P("",!0)])]),_:1})]),_:1},8,["activeKey"]),n(Ae,{value:r.images,"onUpdate:value":_[6]||(_[6]=b=>r.images=b)},null,8,["value"])])]),_:1})]),_:1})]),_:1},8,["open"])])}}},Wo=ee(Co,[["__scopeId","data-v-50ea1591"]]);export{Jo as D,Wo as E,Ko as S,Ho as a};
