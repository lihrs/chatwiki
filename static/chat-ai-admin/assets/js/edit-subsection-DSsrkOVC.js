import{I as _e,b as se,M as fe,dn as ge,dt as Me,k as $,d as Ue,B as Fe,du as ze,dq as $e,dv as Ie}from"../../index-D5kWFI_D.js";import{_ as ye,T as be}from"./index-C564__T8.js";import{j as s,d as m,N as w,O as f,U as b,S as R,a6 as F,Z as A,X as t,u as E,F as ae,a1 as Ee,Y as oe,_ as I,z as ue,w as Ve,a3 as Be,H as de,I as ce,a5 as Ne,x as Te}from"./vue-chunks-BRsu9_To.js";import"./index-Ca1EG28E.js";import{I as he}from"./Input-BnGlJfeo.js";import{a as Re,_ as He}from"./index-DzIdf_3n.js";import{U as Ge}from"./index-BxtV5ueZ.js";import{C as Ke}from"./index-Db0Pk3Ky.js";import{M as Qe}from"./index-BMSQkwth.js";import{L as Je}from"./LeftOutlined-DQvF1y9x.js";import{_ as We}from"./index-DFT5721i.js";import{_ as Ze}from"./TextArea-BjyvIBLl.js";import{_ as Xe}from"./index-zi4hwqKG.js";var Ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"};function me(d){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?Object(arguments[l]):{},p=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(u).filter(function(i){return Object.getOwnPropertyDescriptor(u,i).enumerable}))),p.forEach(function(i){et(d,i,u[i])})}return d}function et(d,l,u){return l in d?Object.defineProperty(d,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):d[l]=u,d}var K=function(l,u){var p=me({},l,u.attrs);return s(_e,me({},p,{icon:Ye}),null)};K.displayName="StarFilled";K.inheritAttrs=!1;var tt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"};function ve(d){for(var l=1;l<arguments.length;l++){var u=arguments[l]!=null?Object(arguments[l]):{},p=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(u).filter(function(i){return Object.getOwnPropertyDescriptor(u,i).enumerable}))),p.forEach(function(i){nt(d,i,u[i])})}return d}function nt(d,l,u){return l in d?Object.defineProperty(d,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):d[l]=u,d}var X=function(l,u){var p=ve({},l,u.attrs);return s(_e,ve({},p,{icon:tt}),null)};X.displayName="StarOutlined";X.inheritAttrs=!1;const le={a:"#F00000",b:"#2475FC",c:"#03B615",d:"#F59A23",e:"#F4EA2A"},at={class:"star-select-box"},st={class:"star-item"},ot={class:"star-item"},lt={key:0},it={__name:"selct-star-box",props:{startLists:{type:Array,default:()=>[]},hideId:{type:[Number,String,Array],default:()=>[]}},emits:["change"],setup(d,{emit:l}){const u=l,p=d,i=m(-1),L=()=>{u("change",i.value)};return(S,h)=>{const c=ye,q=be;return f(),w("div",at,[s(q,{activeKey:i.value,"onUpdate:activeKey":h[0]||(h[0]=g=>i.value=g),size:"small",onChange:L},{default:b(()=>[(f(),R(c,{key:-1},{tab:b(()=>h[1]||(h[1]=[A("全部")])),_:1})),d.hideId.includes(0)?F("",!0):(f(),R(c,{key:0},{tab:b(()=>[t("div",st,[s(E(X)),h[2]||(h[2]=A("未精选"))])]),_:1})),(f(!0),w(ae,null,Ee(p.startLists,g=>(f(),R(c,{key:g.id},{tab:b(()=>[t("div",ot,[s(E(K),{style:oe({color:E(le)[g.type]})},null,8,["style"]),A(" "+I(g.name||"-")+" ",1),g.data_count>0?(f(),w("span",lt,"("+I(g.data_count)+")",1)):F("",!0)])]),_:2},1024))),128))]),_:1},8,["activeKey"])])}}},hn=se(it,[["__scopeId","data-v-5867ce9a"]]),rt={class:"modal-box"},ut={class:"list-box"},dt={__name:"classification-mark-modal",emits:["ok"],setup(d,{expose:l,emit:u}){const p=m(!1),i=u,L=m([]),S=()=>{h(),p.value=!0},h=()=>{ge().then(q=>{L.value=q.data})},c=()=>{let q=L.value.map(g=>({id:+g.id,name:g.name}));Me({data:JSON.stringify(q)}).then(g=>{$.success("保存成功"),i("ok"),p.value=!1})};return l({show:S}),(q,g)=>{const j=He,z=he,H=Re,V=fe;return f(),w("div",null,[s(V,{open:p.value,"onUpdate:open":g[0]||(g[0]=C=>p.value=C),title:"精选设置",onOk:c,width:586},{default:b(()=>[t("div",rt,[t("div",ut,[s(H,{"data-source":L.value,pagination:!1},{default:b(()=>[s(j,{key:"tags",title:"图标","data-index":"tags",width:200},{default:b(({record:C})=>[s(E(K),{class:"start-icon",style:oe({color:E(le)[C.type]})},null,8,["style"])]),_:1}),s(j,{key:"name",title:"备注","data-index":"name",width:200},{default:b(({record:C})=>[s(z,{value:C.name,"onUpdate:value":a=>C.name=a,maxLength:4,placeholder:"请设置,最多4个字"},null,8,["value","onUpdate:value"])]),_:1})]),_:1},8,["data-source"])])])]),_:1},8,["open"])])}}},xn=se(dt,[["__scopeId","data-v-7bfe71a9"]]);var o={},pe;function ct(){if(pe)return o;pe=1,Object.defineProperty(o,"__esModule",{value:!0}),o.controlDefaultValue=o.capitalize=o.camelize=o.cacheStringFunction=void 0,o.getDataAndAriaProps=z,o.isSymbol=o.isString=o.isOn=o.isObject=o.isFunction=o.isArray=o.hyphenate=void 0,o.renderHelper=V,o.resolvePropValue=j,o.toPx=H,o.wrapPromiseFn=C;const d=a=>typeof a=="function";o.isFunction=d,o.controlDefaultValue=Symbol("controlDefaultValue"),o.isArray=Array.isArray;const l=a=>typeof a=="string";o.isString=l;const u=a=>typeof a=="symbol";o.isSymbol=u;const p=a=>a!==null&&typeof a=="object";o.isObject=p;const i=/^on[^a-z]/,L=a=>i.test(a);o.isOn=L;const S=a=>{const y=Object.create(null);return _=>y[_]||(y[_]=a(_))};o.cacheStringFunction=S;const h=/-(\w)/g;o.camelize=S(a=>a.replace(h,(y,_)=>_?_.toUpperCase():""));const c=/\B([A-Z])/g;o.hyphenate=S(a=>a.replace(c,"-$1").toLowerCase()),o.capitalize=S(a=>a.charAt(0).toUpperCase()+a.slice(1));const q=Object.prototype.hasOwnProperty,g=(a,y)=>q.call(a,y);function j(a,y,_,k){const x=a[_];if(x!=null){const D=g(x,"default");if(D&&k===void 0){const P=x.default;k=x.type!==Function&&d(P)?P():P}x.type===Boolean&&(!g(y,_)&&!D?k=!1:k===""&&(k=!0))}return k}function z(a){return Object.keys(a).reduce((y,_)=>((_.startsWith("data-")||_.startsWith("aria-"))&&(y[_]=a[_]),y),{})}function H(a){return typeof a=="number"?`${a}px`:a}function V(a){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;return typeof a=="function"?a(y):a??_}function C(a){let y;const _=new Promise(x=>{y=a(()=>{x(!0)})}),k=()=>{y==null||y()};return k.then=(x,D)=>_.then(x,D),k.promise=_,k}return o}var mt=ct();const vt={class:"custom-modal-header"},pt={class:"form-box-wrapper"},_t={class:"form-item"},ft={class:"form-content"},gt={class:"form-item"},yt={class:"form-content"},bt={class:"star-item-box"},ht={key:2},xt={class:"form-item"},wt={class:"form-content"},kt={class:"form-item"},Ot={class:"form-label-box"},St={class:"form-content"},Lt={class:"form-item"},Ct={class:"form-content"},Pt={key:0,class:"error-tip"},qt={key:1,class:"form-item"},jt={class:"form-content"},At={key:0,class:"error-tip"},Dt={class:"form-item"},Mt={class:"form-content"},Ut={class:"upload-box-wrapper"},Ft={key:0},zt={class:"ai-generate-wrapper"},$t={class:"form-box-wrapper ai-generate-wrapper-box"},It={class:"ai-generate-wrapper-left"},Et={class:"form-box-wrapper-options"},Vt={class:"form-item flex1"},Bt={class:"form-content"},Nt={class:"form-item flex1"},Tt={class:"form-content dual-inputs"},Rt={class:"input-group"},Ht={class:"form-label-input-box"},Gt={class:"form-box-wrapper-content"},Kt={class:"problem-box"},Qt={class:"problem-content"},Jt={class:"problem-box"},Wt={class:"problem-content"},Zt={class:"form-item generate-btn-box"},Xt={class:"result-nav"},Yt={key:0,class:"tip"},en={key:1,class:"result-nav-text"},tn={key:0,class:"container"},nn={class:"result-container"},an=["innerHTML"],sn={class:"result-footer"},on={__name:"edit-subsection",props:{detailsInfo:{type:Object}},emits:["handleEdit","handleStatrList"],setup(d,{expose:l,emit:u}){const p=m(!1),i=m(!1),L=m(!1),S=m(!1),h=m(!1),c=ue({use_model:"",use_model_icon:"",use_model_name:"",is_offline:"",model_config_id:"",count:5}),q=new Qe({html:!0,linkify:!0,typographer:!0}),g=m(""),j=ue({finish:"",content:""});Ve(()=>j.content,()=>{g.value=q.render(j.content)});const z=Be(),H=z.query,V=z.name,C=d,a=u,y=m(""),_=["azure","ollama","xinference","openaiAgent"],k=m("1"),x=m(!1),D=m(""),P=m(""),M=m(""),B=m(""),U=m(""),T=m([]),G=m(0),Y=m(""),N=m(!1),xe=n=>{i.value=!1,L.value=!1,h.value=!1,D.value=n.title||"",P.value=n.content||"",Y.value=n.id||"",M.value=n.answer||"",T.value=n.images||[],B.value=n.question||"",U.value=n.similar_questions?n.similar_questions.join(`
`):"",N.value=C.detailsInfo.is_qa_doc=="1",G.value=n.category_id||0,te(),x.value=!0},ee=m([]),te=()=>{ge({file_id:H.id}).then(n=>{let e=n.data||[];e=e.map(v=>({value:v.id,payload:{...v,color:le[v.type]}})),V=="categaryManages"?ee.value=[...e]:ee.value=[{value:0,payload:{id:0,name:"未标记"}},...e],a("handleStatrList",n.data||[])})},ie=()=>{if(re(),!P.value&&!N.value)return $.error("请输入分段内容");if(!B.value&&N.value)return $.error("请输入分段问题");if(!M.value&&N.value)return $.error("请输入分段答案");if(N.value&&M.value.length>1e4||!N.value&&P.value.length>1e4)return;if(V=="categaryManages"&&G.value<=0)return $.error("请选择分类标记");let n={title:D.value,content:P.value,question:B.value,answer:M.value,images:T.value,category_id:G.value},e=U.value.trim();e?(e=e.split(`
`),n.similar_questions=JSON.stringify(e)):n.similar_questions="[]",Y.value?n.id=Y.value:n.file_id=z.query.id;let v=new FormData;for(let O in n)mt.isArray(n[O])?n[O].forEach(ne=>{v.append(O,ne)}):v.append(O,n[O]);V=="categaryManages"?(v.delete("file_id"),v.append("library_id",z.query.id),$e(v).then(O=>{$.success(n.id?"修改成功":"添加成功"),x.value=!1,a("handleEdit",{...n}),te()})):Ie(v).then(O=>{$.success(n.id?"修改成功":"添加成功"),x.value=!1,a("handleEdit",{...n}),te()})},we=()=>{i.value=!0},Q=m(""),ke=async()=>{j.content="",Q.value="",S.value=!0,h.value=!0;try{let n={library_id:C.detailsInfo.library_id,model_config_id:c.model_config_id,use_model:c.use_model,num:c.count,question:B.value,answer:M.value};const e=await ze(n);Q.value=e.data.map(v=>v).join(`
`),j.content=e.data.map((v,O)=>`<div class="dialog-message">${O+1}. ${v}</div>`).join(""),L.value=!0}finally{S.value=!1}},Oe=()=>{U.value?U.value+=`
${Q.value}`:U.value+=Q.value,$.success("保存成功"),L.value=!1,i.value=!1,h.value=!1},Se=n=>{c.use_model=_.includes(n.rawData.model_define)&&n.rawData.deployment_name?n.rawData.deployment_name:n.rawData.name,c.use_model_icon=n.icon,c.use_model_name=n.use_model_name,c.model_config_id=n.rawData.id,y.value=n.rawData.model_define},J=m([]),Le=n=>{J.value=n,Te(()=>{(!c.ai_chunk_model||!Number(c.ai_chunk_model_config_id))&&Ce()})},Ce=()=>{if(J.value.length>0){let n=null,e=null;for(let v of J.value)if(v.model_define==="tongyi"){n=v;for(let O of n.children)if(O.name==="qwen-max"){e=O;break}break}n||(n=J.value[0],e=n.children[0]),n&&e&&(c.use_model=e.name,c.model_config_id=e.model_config_id,c.ai_chunk_model=e.name,c.ai_chunk_model_config_id=e.model_config_id)}};function Pe(n){return n.split(`
`).map(e=>e.trim()).filter(e=>e).join(`
`)}const re=()=>{U.value=Pe(U.value)};return l({showModal:xe}),(n,e)=>{const v=Fe,O=he,ne=We,W=Ze,Z=Ue,qe=ye,je=be,Ae=Xe,De=fe;return f(),w("div",null,[s(De,{open:x.value,"onUpdate:open":e[12]||(e[12]=r=>x.value=r),onOk:ie,width:i.value?h.value?"944px":"472px":"746px","ok-button-props":{style:{display:i.value?"none":"block"}}},{title:b(()=>[t("div",vt,[i.value?(f(),R(v,{key:0,type:"text",class:"back-button",onClick:e[0]||(e[0]=r=>i.value=!1)},{icon:b(()=>[s(E(Je),{style:{"font-size":"12px"}})]),_:1})):F("",!0),t("span",null,I(i.value?"AI生成相似问法":"编辑分段"),1)])]),footer:b(()=>[i.value?F("",!0):(f(),w(ae,{key:0},[s(v,{onClick:e[11]||(e[11]=r=>x.value=!1)},{default:b(()=>e[32]||(e[32]=[A("取消")])),_:1,__:[32]}),s(v,{type:"primary",onClick:ie},{default:b(()=>e[33]||(e[33]=[A("确定")])),_:1,__:[33]})],64))]),default:b(()=>[de(t("div",pt,[t("div",_t,[e[13]||(e[13]=t("div",{class:"form-label"},"分段标题：",-1)),t("div",ft,[s(O,{maxLength:25,value:D.value,"onUpdate:value":e[1]||(e[1]=r=>D.value=r),placeholder:"请输入分段标题"},null,8,["value"])])]),t("div",gt,[e[15]||(e[15]=t("div",{class:"form-label"},"分段分类标记",-1)),t("div",yt,[s(ne,{value:G.value,"onUpdate:value":e[2]||(e[2]=r=>G.value=r),options:ee.value},{label:b(({payload:r})=>[t("div",bt,[r.id>0?(f(),R(E(K),{key:0,style:oe({color:r.color})},null,8,["style"])):(f(),R(E(X),{key:1})),t("div",null,I(r.name||"-"),1),e[14]||(e[14]=A()),r.data_count>0?(f(),w("span",ht,"("+I(r.data_count)+")",1)):F("",!0)])]),_:1},8,["value","options"])])]),N.value?(f(),w(ae,{key:0},[t("div",xt,[e[16]||(e[16]=t("div",{class:"form-label required"},"分段问题：",-1)),t("div",wt,[s(W,{placeholder:"请输入分段问题",value:B.value,"onUpdate:value":e[3]||(e[3]=r=>B.value=r),style:{height:"100px"}},null,8,["value"])])]),t("div",kt,[t("div",Ot,[e[18]||(e[18]=t("div",{class:"form-label required"},"相似问法",-1)),t("div",{class:"ai-generate",onClick:we},[s(Z,{name:"ai-generate",style:{"font-size":"14px"}}),e[17]||(e[17]=t("div",{class:"ai-generate-text"},"AI自动生成",-1))])]),t("div",St,[s(W,{placeholder:"请输入相似问法",value:U.value,"onUpdate:value":e[4]||(e[4]=r=>U.value=r),style:{height:"100px"},onBlur:re},null,8,["value"]),e[19]||(e[19]=t("div",{class:"form-content-tip"},"一行一个，最多可添加100个相似问法",-1))])]),t("div",Lt,[e[20]||(e[20]=t("div",{class:"form-label required"},"分段答案：",-1)),t("div",Ct,[s(W,{placeholder:"请输入分段答案",value:M.value,"onUpdate:value":e[5]||(e[5]=r=>M.value=r),style:{height:"100px"}},null,8,["value"]),M.value.length>1e4?(f(),w("div",Pt,"分段答案最多支持10000个字符")):F("",!0)])])],64)):(f(),w("div",qt,[e[21]||(e[21]=t("div",{class:"form-label required"},"分段内容：",-1)),t("div",jt,[s(W,{style:{height:"150px"},value:P.value,"onUpdate:value":e[6]||(e[6]=r=>P.value=r),placeholder:"请输入分段内容"},null,8,["value"]),P.value.length>1e4?(f(),w("div",At,"分段内容最多支持10000个字符")):F("",!0)])])),t("div",Dt,[e[23]||(e[23]=t("div",{class:"form-label"},"附件",-1)),t("div",Mt,[t("div",Ut,[s(je,{activeKey:k.value,"onUpdate:activeKey":e[7]||(e[7]=r=>k.value=r),size:"small"},{default:b(()=>[s(qe,{key:"1"},{tab:b(()=>[t("span",null,[s(Z,{name:"img-icon",style:{"font-size":"14px",color:"#2475fc"}}),e[22]||(e[22]=A(" 图片 ")),T.value.length?(f(),w("span",Ft,"("+I(T.value.length)+")",1)):F("",!0)])]),_:1})]),_:1},8,["activeKey"]),s(Ge,{value:T.value,"onUpdate:value":e[8]||(e[8]=r=>T.value=r)},null,8,["value"])])])])],512),[[ce,!i.value]]),de(t("div",zt,[t("div",$t,[t("div",It,[t("div",Et,[t("div",Vt,[e[24]||(e[24]=t("div",{class:"form-label required"},"相似问法模型：",-1)),t("div",Bt,[s(Ke,{modelValue:c.use_model,"onUpdate:modelValue":e[9]||(e[9]=r=>c.use_model=r),"label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":c.model_config_id,onChange:Se,onLoaded:Le},null,8,["modelValue","model-config-id"])])]),t("div",Nt,[t("div",Tt,[t("div",Rt,[e[26]||(e[26]=t("div",{class:"form-label required"},"问题个数：",-1)),t("div",Ht,[s(Ae,{value:c.count,"onUpdate:value":e[10]||(e[10]=r=>c.count=r),min:1,max:20,style:{width:"100%",padding:"2px 11px"}},null,8,["value"]),e[25]||(e[25]=A("个 "))])])])])]),t("div",Gt,[t("div",Kt,[e[27]||(e[27]=t("div",{class:"problem"},"问题",-1)),t("div",Qt,I(B.value),1)]),t("div",Jt,[e[28]||(e[28]=t("div",{class:"problem"},"答案",-1)),t("div",Wt,I(M.value),1)])]),t("div",Zt,[s(v,{onClick:ke,loading:S.value,class:"generate-btn"},{default:b(()=>[s(Z,{name:"ai-generate-white",style:{"font-size":"16px"}}),e[29]||(e[29]=A(" 开始生成 "))]),_:1,__:[29]},8,["loading"])])]),t("div",{class:Ne(["ai-generate-wrapper-right",{"show-result":h.value}])},[t("div",Xt,[s(Z,{name:"generate-icon",style:{"font-size":"14px"}}),S.value?(f(),w("span",Yt,"相似问法生成中...")):(f(),w("div",en,"相似问法生成完毕"))]),!j.content&&S.value&&!p.value?(f(),w("div",tn,e[30]||(e[30]=[t("div",{class:"rect-container rect1"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect2"},[t("div",{class:"rect"})],-1),t("div",{class:"rect-container rect3"},[t("div",{class:"rect"})],-1)]))):F("",!0),t("div",nn,[t("div",{class:"dialog-content",innerHTML:g.value},null,8,an)]),t("div",sn,[s(v,{class:"result-footer-btn",type:"primary",onClick:Oe},{default:b(()=>e[31]||(e[31]=[A("保存相似问法")])),_:1,__:[31]})])],2)])],512),[[ce,i.value]])]),_:1},8,["open","width","ok-button-props"])])}}},wn=se(on,[["__scopeId","data-v-d1d1df8f"]]);export{xn as C,wn as E,K as S,X as a,hn as b,le as c};
