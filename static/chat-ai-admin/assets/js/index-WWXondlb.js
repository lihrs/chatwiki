import{b as H,d as G,B as K,ac as me,k as O,M as fe,a2 as ve,dP as ee,h as be,dQ as ye,dR as he,di as ge,b_ as ke}from"../../index-CvfGQnmW.js";import{z as T,b as W,d as x,w as xe,q as Q,N as b,O as c,X as a,j as t,U as s,S as M,a6 as P,Z as k,F as E,a1 as te,_ as D,a as ae,a7 as we,a5 as Se,H as Ce,I as Le,u as V,x as $e,a0 as Z,a3 as De,G as Ue,p as J}from"./vue-chunks-BRsu9_To.js";import{C as Ie}from"./config-page-menu-GpmoLGlQ.js";import{u as Re}from"./index-C0kilmAu.js";import"./index-ESeBgLel.js";import{_ as oe,R as se}from"./RadioButton-Bh1r7hrP.js";import{S as Oe,a as Me}from"./index-Bic_ld4j.js";import{_ as Pe}from"./index-DUS5CIPm.js";import{I as ze}from"./Input-DT-w6V-X.js";import{_ as le,F as re}from"./index-CeLDnZbi.js";import{B as q,P as Be,S as je,M as Fe}from"./pull-up.esm-D94Swpvl.js";import{d as ne}from"./role_avatar-DL0r08JY.js";import{A as ie}from"./index-CE26VU2J.js";import{P as Ae}from"./PlusOutlined-BsYDRa8m.js";import"./index-XnBLv09r.js";import{D as Te}from"./dropdown-JwPNtE5e.js";import{D as Ne}from"./DownOutlined-DKJ0lkJp.js";import{M as qe,_ as Ve}from"./index-Cn6_tPQQ.js";import{S as Ee}from"./index-CKbLlG46.js";import{_ as He}from"./index-pUNme1Ic.js";import{a as We}from"./index-SYniNczA.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-CFzzmp00.js";import"./Checkbox-CD3yZxoG.js";import"./Trigger-C5a0DMKm.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./index-B0doyz59.js";import"./slide-vrDadJH3.js";import"./index-DaOSj_2K.js";import"./CheckOutlined-N7bppPAu.js";import"./SearchOutlined-B9P7O4A9.js";import"./move-CunrTozH.js";import"./Search-BVbdzfe3.js";import"./isPlainObject-C_BoBcyP.js";import"./inputProps-DJXIqADS.js";import"./TextArea-B40Dha8W.js";import"./Password-Bl0n4Nu8.js";import"./responsiveObserve-4wudV-W8.js";import"./collapseMotion-Brd6xpAT.js";import"./index-B-ykUzgY.js";import"./colors-Cy2bPHOW.js";import"./QuestionCircleOutlined-DsT-V90y.js";import"./index-CteniEgA.js";import"./useMaxLevel-CGODDmyb.js";import"./CaretDownFilled-D2jjQ2Qs.js";import"./index-BNsyVryY.js";import"./index-Cj1xldbi.js";import"./RightOutlined-DQOW11d0.js";import"./shallowequal-C0xnIuy8.js";import"./fromPairs-Dx9PT-t0.js";import"./index-MLftqXg-.js";import"./LeftOutlined-CaA0Q_W1.js";import"./index-C_DWe9ZR.js";import"./CaretDownOutlined-CGSacOH8.js";const Ge={class:"form-box"},Qe={class:"form-box-header"},Xe={class:"form-box-label"},Ye={class:"share-url-box"},Ze={__name:"permissions-form",props:{value:{type:Object,default:()=>({})},saveLoading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(z,{emit:U}){const{toClipboard:$}=Re(),f=U,C=z,l=T({access_rights:"0",share_url:void 0,library_key:""}),m=W(()=>l.share_url+"/open/home/"+l.library_key),y=()=>{f("submit",l)},o=x([]),d=()=>{me().then(u=>{o.value=u.data||[],l.share_url||(o.value.length>0?l.share_url=o.value[0].url:l.share_url=window.location.origin)})},I=u=>{l.access_rights=u.access_rights,l.share_url=u.share_url,l.library_key=u.library_key,(o.value.length==0||!l.share_url)&&d()},B=async()=>{l.share_url||O.error("请选择自定义域名");let u=m.value;try{await $(u),O.success("复制成功")}catch{O.error("复制失败")}};return xe(C.value,u=>{I({...u})}),Q(()=>{d()}),(u,n)=>{const h=G,L=se,i=oe,e=le,g=Me,p=Oe,j=ze,R=Pe,F=K,A=re;return c(),b("div",Ge,[a("div",Qe,[a("div",Xe,[t(h,{name:"auth",style:{"font-size":"14px",color:"#333"}}),n[2]||(n[2]=a("span",{class:"form-box-label-text"},"访问权限",-1))]),n[3]||(n[3]=a("div",null,null,-1))]),t(A,{"label-col":{span:4},style:{width:"750px"}},{default:s(()=>[t(e,{label:"访问权限"},{default:s(()=>[t(i,{value:l.access_rights,"onUpdate:value":n[0]||(n[0]=w=>l.access_rights=w),onChange:y},{default:s(()=>[t(L,{value:"0"},{default:s(()=>n[4]||(n[4]=[k("私有，仅能与应用关联，作为应用知识库")])),_:1,__:[4]}),t(L,{value:"1"},{default:s(()=>n[5]||(n[5]=[k("公开，发布到互联网，所有人可访问")])),_:1,__:[5]})]),_:1},8,["value"])]),_:1}),l.access_rights==1?(c(),M(e,{key:0,label:"分享链接"},{default:s(()=>[a("div",Ye,[t(R,{compact:"",style:{width:"460px"}},{default:s(()=>[t(p,{style:{width:"45%"},value:l.share_url,"onUpdate:value":n[1]||(n[1]=w=>l.share_url=w),placeholder:"请选择自定义域名",onChange:y},{default:s(()=>[(c(!0),b(E,null,te(o.value,w=>(c(),M(g,{value:w.url,key:w.id},{default:s(()=>[k(D(w.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),t(j,{disabled:!0,value:"/open/home/"+l.library_key,style:{width:"55%"}},null,8,["value"])]),_:1}),t(F,{class:"copy-btn",onClick:B},{default:s(()=>n[6]||(n[6]=[k("复制")])),_:1,__:[6]})]),n[7]||(n[7]=a("div",null,[a("a",{href:"/#/user/domain"},"添加自定义域名")],-1))]),_:1,__:[7]})):P("",!0)]),_:1})])}}},Je=H(Ze,[["__scopeId","data-v-4dd4332d"]]),Ke={class:"form-box"},et={class:"collaborator-list-tip"},tt={class:"list-content"},at={class:"collaborator-grid"},ot=["onClick"],st={class:"user-info"},lt={class:"user-details"},rt={class:"user-name"},nt={class:"user-nickname"},it={key:0,class:"loading-more"},_t={key:1,class:"no-more"},ct={__name:"add-collaborator",props:{excludedIds:{type:Array,default:()=>[]}},emits:["ok"],setup(z,{expose:U,emit:$}){q.use(Be),q.use(je),q.use(Fe);const f=$,C=z,l=ae("libraryState",{}),m=x(!1),y=x(null),o=x(!1),d=T({permission:"2",collaborators:[]}),I={permission:[{required:!0,message:"请选择协作权限"}],collaborators:[{required:!0,message:"请选择协作者",type:"array",min:1}]},B=_=>{let r=d.collaborators.indexOf(_.id);r>-1?d.collaborators.splice(r,1):d.collaborators.push(_.id)},u=x([]),n=W(()=>u.value.filter(_=>!C.excludedIds.includes(_.id))),h=T({page:1,size:20,total:0,search:""}),L=x(null),i=x(!1),e=x(!1);let g=x(null);const p=()=>{if(g.value){g.value.refresh();return}g.value=new q(L.value,{probeType:2,click:!0,scrollY:!0,bounce:!1,pullUpLoad:!0,scrollbar:{fade:!1,interactive:!0},mouseWheel:{speed:20,invert:!1,easeTime:300}}),g.value.on("pullingUp",j)},j=async()=>{i.value||e.value||(h.page=h.page+1,i.value=!0,await R(),g.value.finishPullUp(),i.value=!1)},R=async()=>{let _={page:h.page,size:h.size,search:h.search};return ve(_).then(r=>{let v=r.data.list||[];return h.page==1?u.value=u.value=v:u.value=u.value.concat(v),h.total=+r.data.total,u.value.length>=h.total&&(e.value=!0),$e(()=>{g.value&&g.value.refresh()}),r})},F=()=>{let _={operate_rights:d.permission,user_ids:d.collaborators.join(","),type:1,library_key:l.library_key};o.value=!0,ee(_).then(()=>{m.value=!1,o.value=!1,f("ok",_),O.success("添加成功")}).catch(()=>{o.value=!1})},A=async()=>{var _;try{await((_=y.value)==null?void 0:_.validate()),F()}catch(r){console.error("表单验证失败:",r)}},w=()=>{var _;(_=y.value)==null||_.resetFields(),m.value=!1};return U({open:()=>{var _;m.value=!0,(_=y.value)==null||_.resetFields(),h.page=1,R(),setTimeout(()=>{p()},200)}}),(_,r)=>{const v=se,N=oe,Y=le,_e=we("RouterLink"),ce=G,ue=ie,de=re,pe=fe;return c(),M(pe,{open:m.value,"onUpdate:open":r[1]||(r[1]=S=>m.value=S),title:"添加协作者",width:"760px",confirmLoading:o.value,onOk:A,onCancel:w},{default:s(()=>[a("div",Ke,[t(de,{layout:"vertical",model:d,rules:I,ref_key:"formRef",ref:y},{default:s(()=>[t(Y,{name:"permission",label:"协作权限"},{default:s(()=>[t(N,{value:d.permission,"onUpdate:value":r[0]||(r[0]=S=>d.permission=S)},{default:s(()=>[t(v,{value:"4"},{default:s(()=>r[2]||(r[2]=[k("可管理")])),_:1,__:[2]}),t(v,{value:"2"},{default:s(()=>r[3]||(r[3]=[k("可编辑")])),_:1,__:[3]})]),_:1},8,["value"])]),_:1}),t(Y,{name:"collaborators",label:"协作者"},{default:s(()=>[a("div",et,[r[5]||(r[5]=k(" 如果协作者没有账号，请先到团队管理中添加账号 ")),t(_e,{to:"/user/manage",target:"_blank"},{default:s(()=>r[4]||(r[4]=[k("去添加")])),_:1,__:[4]})]),a("div",{class:"collaborator-list",ref_key:"listRef",ref:L},[a("div",tt,[a("div",at,[(c(!0),b(E,null,te(n.value,S=>(c(),b("div",{class:Se(["collaborator-item",{active:d.collaborators.includes(S.id)}]),key:S.id,onClick:Ot=>B(S)},[Ce(t(ce,{name:"check-arrow-filled",class:"check-icon"},null,512),[[Le,d.collaborators.includes(S.id)]]),a("div",st,[t(ue,{class:"user-avatar",src:S.avatar||V(ne)},null,8,["src"]),a("div",lt,[a("div",rt,D(S.user_name),1),a("div",nt,D(S.nick_name),1)])])],10,ot))),128))]),i.value?(c(),b("div",it,"加载中...")):P("",!0),e.value?(c(),b("div",_t,"没有更多了")):P("",!0)])],512)]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},ut=H(ct,[["__scopeId","data-v-49f98487"]]),dt={class:"collaborator-list-box"},pt={class:"list-tools-box"},mt={class:"list-label"},ft={class:"label-text"},vt={class:"tools-box-right"},bt={class:"list-box"},yt={key:0,class:"name-cell"},ht={class:"user-info"},gt={class:"username"},kt={class:"nickname"},xt={key:0,class:"role-cell"},wt={key:1,class:"role-cell"},St={key:1},Ct={__name:"collaborator-list",setup(z){const U=be(),$=ae("libraryState",{}),f=x(null),C=[{title:"姓名",key:"name",width:"40%"},{title:"角色",dataIndex:"role",key:"role",width:"40%"},{title:"操作",key:"action",width:"20%"}],l={4:{label:"可管理",value:"4"},2:{label:"可编辑",value:"2"}},m=T({current:1,pageSize:999,total:0}),y=x([]),o=W(()=>y.value.map(i=>i.user_id)),d=(i,e)=>{e.operate_rights=i.key*1,e.operate_rights_label=l[e.operate_rights].label||"",I(e)},I=i=>{let e={operate_rights:i.operate_rights,user_ids:i.user_id,type:2,library_key:$.library_key};ee(e).then(()=>{O.success("修改成功")}).catch(()=>{})},B=()=>{f.value.open()},u=i=>{let e={id:i.id,library_key:$.library_key};he(e).then(()=>{O.success("移除成功"),L()}).catch(()=>{})},n=()=>{L()},h=i=>{Object.assign(m,i),L()},L=()=>{ye({library_key:$.library_key,page:m.current,size:m.pageSize}).then(i=>{let e=i.data.list||[],{user_id:g}=U.userInfo;m.total=i.data.total,e.forEach(p=>{p.showDelete=!0,g==p.user_id&&(p.showDelete=!1),p.role_type==1&&(p.showDelete=!1),p.operate_rights=p.operate_rights*1,p.operate_rights_label="无权限",l[p.operate_rights]&&(p.operate_rights_label=l[p.operate_rights].label)}),y.value=e})};return Q(()=>{L()}),(i,e)=>{const g=G,p=K,j=ie,R=Ve,F=qe,A=Te,w=He,X=Ee,_=We;return c(),b("div",dt,[a("div",pt,[a("div",mt,[t(g,{name:"collaborator"}),a("span",ft,"协助权限 ("+D(m.total)+")",1)]),a("div",vt,[t(p,{type:"primary",size:"small",onClick:B},{default:s(()=>[t(V(Ae)),e[2]||(e[2]=k(" 添加协助者"))]),_:1,__:[2]})])]),a("div",bt,[t(_,{columns:C,"data-source":y.value,pagination:m,onChange:h},{bodyCell:s(({column:r,record:v})=>[r.key==="name"?(c(),b("div",yt,[t(j,{class:"avatar",src:v.avatar||V(ne)},null,8,["src"]),a("div",ht,[a("div",gt,D(v.user_name),1),a("div",kt,D(v.nick_name),1)])])):P("",!0),r.key==="role"?(c(),b(E,{key:1},[v.showDelete?(c(),b("div",xt,[t(A,null,{overlay:s(()=>[t(F,{onClick:N=>d(N,v)},{default:s(()=>[(c(),M(R,{key:4},{default:s(()=>e[3]||(e[3]=[k("可管理")])),_:1,__:[3]})),(c(),M(R,{key:2},{default:s(()=>e[4]||(e[4]=[k("可编辑")])),_:1,__:[4]}))]),_:2},1032,["onClick"])]),default:s(()=>[a("a",{class:"dropdown-label",onClick:e[0]||(e[0]=Z(()=>{},["prevent"]))},[k(D(v.operate_rights_label)+" ",1),t(V(Ne),{style:{"font-size":"12px"}})])]),_:2},1024)])):(c(),b("div",wt,[a("a",{class:"dropdown-label disabled",onClick:e[1]||(e[1]=Z(()=>{},["prevent"]))},D(v.operate_rights_label),1)]))],64)):P("",!0),r.key==="action"?(c(),b(E,{key:2},[v.showDelete?(c(),M(X,{key:0},{default:s(()=>[t(w,{title:"确定要移除此协作者吗?","ok-text":"确定","cancel-text":"取消",onConfirm:N=>u(v)},{default:s(()=>e[5]||(e[5]=[a("a",{href:"#"},"移除",-1)])),_:2,__:[5]},1032,["onConfirm"])]),_:2},1024)):(c(),b("span",St,[t(p,{style:{padding:"0"},type:"link",disabled:""},{default:s(()=>e[6]||(e[6]=[k("移除")])),_:1,__:[6]})]))],64)):P("",!0)]),_:1},8,["data-source","pagination"])]),t(ut,{excludedIds:o.value,ref_key:"addCollaboratorRef",ref:f,onOk:n},null,8,["excludedIds"])])}}},Lt=H(Ct,[["__scopeId","data-v-bd0b2d18"]]),$t={class:"permissions-page"},Dt={class:"page-container"},Ut={class:"form-box-wrapper"},It={class:"collaborator-list-wrapper"},Rt={__name:"index",setup(z){const U=De(),$=W(()=>U.query.library_id),f=T({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""});J("libraryState",f),J("updateState",o=>{Object.assign(f,o)});const C=x(!1),l=o=>{Object.assign(f,o),C.value=!0,m().then(()=>{C.value=!1}).catch(()=>{C.value=!1})},m=async()=>{let o={...Ue(f)};delete o.library_key,o.avatar_file?(o.avatar=o.avatar_file,delete o.avatar_file):(delete o.avatar,delete o.avatar_file),await ke(o),O.success("修改成功")},y=()=>{ge({id:$.value}).then(o=>{Object.assign(f,o.data)})};return Q(()=>{y()}),(o,d)=>(c(),b("div",$t,[t(Ie),a("div",Dt,[a("div",Ut,[t(Je,{value:f,"onUpdate:value":d[0]||(d[0]=I=>f=I),saveLoading:C.value,onSubmit:l},null,8,["value","saveLoading"])]),a("div",It,[f.library_key?(c(),M(Lt,{key:0})):P("",!0)])])]))}},Ba=H(Rt,[["__scopeId","data-v-8b81102f"]]);export{Ba as default};
