import{j as t,N as v,O as n,X as e,a6 as U,Z as S,_ as I,V as ve,S as P,U as s,Y as vt,a5 as Le,d as w,a as X,z as G,H as _e,I as ce,u as $,G as Z,a3 as He,F as B,a1 as K,w as fe,k as Ke,b as de,q as ge,o as ft,h as Ie,ae as me,af as ke,W as We,D as bt,a0 as ht,x as Ze,aa as yt,a8 as kt,p as gt}from"./vue-chunks-BRsu9_To.js";import{I as xt,b as J,d as ue,B as oe,aB as $t,aq as Fe,M as Y,k as W,ao as wt,at as qt,as as be,aC as St,aD as Ct,a1 as Ye,e as Lt,aE as It,aF as Ce,E as Ae,h as Ut,aA as Rt}from"../../index-CbM0qccj.js";import{_ as xe}from"./index-CF1bX7HW.js";import{C as Et}from"./cu-upload-CgGClRO6.js";import"./index-DO7J6xZI.js";import{I as pe}from"./Input-D_KQrLFV.js";import{_ as $e}from"./TextArea-DKZz8aSm.js";import{_ as Me}from"./cu-scroll-C25JoRm3.js";import{f as Ot,g as Xe,h as At,i as jt}from"./index-DEggegHT.js";import{T as Mt}from"./index-VV5fDi3n.js";import{S as Ue}from"./index-BhAWLImr.js";import{I as zt}from"./index-DMNfWVFJ.js";import{F as je,_ as et}from"./index-Bom7-Zfn.js";import{S as tt,a as ot,i as Dt}from"./index-COrrDFD4.js";import{_ as st,T as nt}from"./index-DJIEsO5p.js";import{D as Pt}from"./DownloadOutlined-CqUDGUkh.js";import{P as Re}from"./PlusOutlined-DzqTjbWo.js";import{D as it}from"./DownOutlined-1SYVU9mx.js";import{U as Nt}from"./UpOutlined-zAGcK8OC.js";import{_ as se}from"./index-B45goIcH.js";import{_ as ne}from"./index-CbwlRwZs.js";import{h as lt}from"./index-CouxJwbb.js";import{C as Vt}from"./index-79FVWO01.js";import"./index-CZpzcZAF.js";import{_ as ze,R as De}from"./RadioButton-c_YfeD6h.js";import{Q as ee}from"./QuestionCircleOutlined-DAN3cK41.js";import{_ as at}from"./index-Bb-sLq2n.js";import{_ as Ee}from"./index-BxSmnBhf.js";import{_ as Tt,a as Bt}from"./index-B2lJjPPd.js";import{S as Qt}from"./SearchOutlined-Cx-fYxwR.js";import{S as Ft}from"./SyncOutlined-XXFwszys.js";import{_ as Pe,C as Ne}from"./index-CX8r5mKl.js";import{_ as rt}from"./index-6hYtYllH.js";import{_ as Jt}from"./recommendation-AQ4_FPQ9.js";import{R as Gt}from"./RightOutlined-CgINgq5G.js";import{g as dt}from"./index-5Vu5XYCy.js";import{_ as _t}from"./empty-CzGZrENG.js";import{d as Ve}from"./vuedraggable.umd-CIIT_a56.js";import{M as Ht}from"./model-select-DqyA85p0.js";import{E as ct}from"./EditOutlined--nKnl9x7.js";import{_ as Kt}from"./index-Bvfv6BAA.js";import{u as Wt}from"./robot-Dr_W0Hv8.js";import{i as Zt,e as Yt,f as Xt}from"./index-BhUIyoqM.js";import{A as eo}from"./add-collaborator-DvaQ5RiC.js";import{A as to}from"./index-CoLfCKUi.js";import{U as Je}from"./UserOutlined-Dbbqo1St.js";import{C as Oe}from"./CheckOutlined-SkhEuqvE.js";import{E as oo}from"./Password-DPDqvIJe.js";import{_ as so}from"./index-BZboQCb-.js";import{a as no}from"./index-CC2DWmEb.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-BeebXrYO.js";import"./index-HsVdjVrn.js";import"./Search-DZduAnXW.js";import"./isPlainObject-DC4y5mMn.js";import"./inputProps-BMAUs6L6.js";import"./index-BgnEJwOh.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./colors-NG3gZ969.js";import"./Trigger-DVan7LyJ.js";import"./responsiveObserve-tL10I9d-.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-OTRsfSPM.js";import"./move-CEOd1o_x.js";import"./index-o1sx7Ger.js";import"./shallowequal-C0xnIuy8.js";import"./dropdown-5yUGsinK.js";import"./pick-i7ivO79Z.js";import"./Checkbox-DsO9D5Eq.js";import"./index-B7tou5PT.js";import"./index-CynC_YDY.js";import"./useMaxLevel-DASumFxg.js";import"./CaretDownFilled-CEBa5hp0.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-DJrr2Itp.js";import"./index-B5X6HQAK.js";import"./CaretDownOutlined-BKuBAAyA.js";var io={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885 780H165c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM400 325.7h73.9V664c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V325.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 171a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13z"}}]},name:"to-top",theme:"outlined"};function Ge(z){for(var _=1;_<arguments.length;_++){var k=arguments[_]!=null?Object(arguments[_]):{},f=Object.keys(k);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(k).filter(function(u){return Object.getOwnPropertyDescriptor(k,u).enumerable}))),f.forEach(function(u){lo(z,u,k[u])})}return z}function lo(z,_,k){return _ in z?Object.defineProperty(z,_,{value:k,enumerable:!0,configurable:!0,writable:!0}):z[_]=k,z}var Te=function(_,k){var f=Ge({},_,k.attrs);return t(xt,Ge({},f,{icon:io}),null)};Te.displayName="ToTopOutlined";Te.inheritAttrs=!1;const ao={class:"edit-box-header"},ro={class:"left-box"},_o={class:"edit-box-title"},co={key:0},uo={key:0,class:"title-tip"},po={class:"right-box"},mo={class:"extra-box"},vo={class:"actions-box"},fo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(z,{emit:_}){const k=_,f=z,u=a=>{k("edit"),k("update:isEdit",a)},i=()=>{k("save")};return(a,y)=>{const r=ue,l=oe,x=xe;return n(),v("div",{class:Le(["edit-box",{"is-edit":z.isEdit}])},[e("div",ao,[e("div",ro,[t(r,{class:"edit-box-icon",name:f.iconName},null,8,["name"]),e("span",_o,[S(I(f.title)+" ",1),a.$slots.icon?(n(),v("span",co,[ve(a.$slots,"icon",{},void 0,!0)])):U("",!0)]),a.$slots.tip?(n(),v("span",uo,[ve(a.$slots,"tip",{},void 0,!0)])):U("",!0)]),e("div",po,[e("div",mo,[ve(a.$slots,"extra",{},()=>[e("div",vo,[f.isEdit?(n(),P(x,{key:0,gap:8},{default:s(()=>[t(l,{onClick:i,size:"small",type:"primary"},{default:s(()=>y[2]||(y[2]=[S("保存")])),_:1,__:[2]}),t(l,{onClick:y[0]||(y[0]=d=>u(!1)),size:"small"},{default:s(()=>y[3]||(y[3]=[S("取消")])),_:1,__:[3]})]),_:1})):(n(),P(l,{key:1,onClick:y[1]||(y[1]=d=>u(!0)),size:"small"},{default:s(()=>y[4]||(y[4]=[S("修改")])),_:1,__:[4]}))])],!0)])])]),e("div",{class:"edit-box-body",style:vt({...z.bodyStyle})},[ve(a.$slots,"default",{},void 0,!0)],4)],2)}}},te=J(fo,[["__scopeId","data-v-1b63f826"]]),bo={class:"robot-form-box"},ho={class:"form-item"},yo={class:"form-item-body robot-name-item"},ko={class:"robot-avetar-upload"},go=["src"],xo={class:"robot-name-box"},$o={class:"form-item"},wo={class:"form-item-body"},qo={class:"robot-info-box"},So={class:"robot-name-box"},Co=["src"],Lo={class:"robot-name"},Io={class:"robot-intro"},Uo={__name:"basic-config",setup(z){const _=w(!1),{robotInfo:k,updateRobotInfo:f}=X("robotInfo"),u=G({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),i=()=>{f({...Z(u)}),_.value=!1},a=r=>{let l=r[0];return u.robot_avatar=l,$t(l).then(x=>{u.robot_avatar_url=x}),!1},y=()=>{u.robot_name=k.robot_name,u.robot_intro=k.robot_intro,u.robot_avatar=k.robot_avatar,u.robot_avatar_url=k.robot_avatar_url};return(r,l)=>{const x=pe,d=$e;return n(),P(te,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:_.value,"onUpdate:isEdit":l[2]||(l[2]=c=>_.value=c),onSave:i,onEdit:y},{default:s(()=>[_e(e("div",bo,[e("div",ho,[l[3]||(l[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",yo,[t(Et,{accept:"image/*",onChange:a},{default:s(()=>[e("div",ko,[u.robot_avatar_url?(n(),v("img",{key:0,class:"robot-avetar",src:u.robot_avatar_url},null,8,go)):U("",!0)])]),_:1}),e("div",xo,[t(x,{value:u.robot_name,"onUpdate:value":l[0]||(l[0]=c=>u.robot_name=c),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",$o,[l[4]||(l[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",wo,[t(d,{rows:3,value:u.robot_intro,"onUpdate:value":l[1]||(l[1]=c=>u.robot_intro=c),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[ce,_.value]]),_e(e("div",qo,[e("div",So,[e("img",{class:"robot-avatar",src:$(k).robot_avatar_url,alt:""},null,8,Co),e("span",Lo,I($(k).robot_name),1)]),e("div",Io,I($(k).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[ce,!_.value]])]),_:1},8,["isEdit"])}}},Ro=J(Uo,[["__scopeId","data-v-c384f413"]]),Eo={class:"ai-create-box"},Oo={class:"input-box"},Ao={class:"quick-tags-box"},jo={class:"ai-list-box"},Mo={key:0,class:"loading-box"},zo={key:0,class:"prompt-list-box"},Do={class:"prompt-list"},Po={class:"prompt-header"},No={class:"prompt-title"},Vo={class:"prompt-content"},To={class:"prompt-list"},Bo={class:"prompt-header"},Qo={class:"prompt-title"},Fo={class:"prompt-content"},Jo={class:"prompt-list"},Go={class:"prompt-header"},Ho={class:"prompt-title"},Ko={class:"prompt-content"},Wo={class:"prompt-list"},Zo={class:"prompt-header"},Yo={class:"prompt-title"},Xo={class:"prompt-content"},es={class:"prompt-list"},ts={class:"prompt-header"},os={class:"prompt-title"},ss={class:"prompt-content"},ns={class:"prompt-header"},is={class:"prompt-title"},ls={class:"prompt-content"},as={key:1,class:"empty-box"},rs={__name:"ai-create-prompt",emits:["handleAiSave"],setup(z,{expose:_,emit:k}){const f=Fe.PRESENTED_IMAGE_SIMPLE,u=w(!1),i=w(!1),a=He().query,y=k,r=w(""),l=w(!1),x=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],d=w("在上方输入框输入要求，点击生成提示词"),c=()=>{o.value=!1,q.promptStruct=h,r.value="",d.value="在上方输入框输入要求，点击生成提示词",u.value=!0},o=w(!1),h={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},q=G({promptStruct:h}),L=R=>{r.value=R},p=()=>{if(!r.value)return W.error("请输入AI 生成提示词");if(l.value)return W.error("正在生成中...");l.value=!0,Ot({id:a.id,demand:r.value}).then(R=>{q.promptStruct=JSON.parse(R.data.promptStruct),o.value=!0}).finally(()=>{l.value=!1}).catch(R=>{o.value=!1,d.value=R.msg})},C=()=>{if(!o.value)return W.error("请先生成提示词");y("handleAiSave",q.promptStruct),u.value=!1};return _({show:c}),(R,b)=>{const E=oe,H=pe,N=ue,m=Mt,M=Ue,A=Fe,V=Me,O=Y;return n(),v("div",null,[t(O,{open:u.value,"onUpdate:open":b[1]||(b[1]=D=>u.value=D),title:"AI 生成提示词",width:746},{footer:s(()=>[t(E,{type:"primary",loading:i.value,onClick:C},{default:s(()=>b[2]||(b[2]=[S("使用该提示")])),_:1,__:[2]},8,["loading"])]),default:s(()=>[e("div",Eo,[e("div",Oo,[t(H,{style:{width:"100%"},value:r.value,"onUpdate:value":b[0]||(b[0]=D=>r.value=D),size:"large",onPressEnter:p,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:p},[t(N,{name:"ai-mark"}),b[3]||(b[3]=e("span",null,"生成",-1))])]),e("div",Ao,[b[4]||(b[4]=e("div",{class:"quick-label"},"快捷生成：",-1)),(n(),v(B,null,K(x,D=>t(m,{key:D.title,onClick:F=>L(D.title),color:"blue"},{default:s(()=>[S(I(D.title),1)]),_:2},1032,["onClick"])),64))]),e("div",jo,[t(V,{style:{height:"100%"}},{default:s(()=>[l.value?(n(),v("div",Mo,[t(M,{tip:"正在生成中..."})])):(n(),v(B,{key:1},[o.value?(n(),v("div",zo,[e("div",Do,[e("div",Po,[e("div",No,I(q.promptStruct.role.subject),1)]),e("div",Vo,I(q.promptStruct.role.describe),1)]),e("div",To,[e("div",Bo,[e("div",Qo,I(q.promptStruct.task.subject),1)]),e("div",Fo,I(q.promptStruct.task.describe),1)]),e("div",Jo,[e("div",Go,[e("div",Ho,I(q.promptStruct.constraints.subject),1)]),e("div",Ko,I(q.promptStruct.constraints.describe),1)]),e("div",Wo,[e("div",Zo,[e("div",Yo,I(q.promptStruct.output.subject),1)]),e("div",Xo,I(q.promptStruct.output.describe),1)]),e("div",es,[e("div",ts,[e("div",os,I(q.promptStruct.tone.subject),1)]),e("div",ss,I(q.promptStruct.tone.describe),1)]),(n(!0),v(B,null,K(q.promptStruct.custom,(D,F)=>(n(),v("div",{class:"prompt-list",key:F+D.key?D.key:""},[e("div",ns,[e("div",is,I(D.subject),1)]),e("div",ls,I(D.describe),1)]))),128))])):(n(),v("div",as,[t(A,{image:$(f),description:d.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},ds=J(rs,[["__scopeId","data-v-87ba79c2"]]),_s={__name:"upload-prompt",setup(z,{expose:_}){const k=w(!1),f=G({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),u=w(null),i=x=>{if(x.prompt_type==0&&!x.prompt)return W.error("自定义提示为空,无法上传");u.value&&u.value.resetFields();let d={...x};f.title="",f.group_id=0,f.prompt="",f.prompt_struct={},f.prompt_type=d.prompt_type,d.prompt_type==0?f.prompt=d.prompt:f.prompt_struct=JSON.stringify(d.prompt_struct),k.value=!0},a=w([]);(()=>{wt().then(x=>{a.value=[{id:0,group_name:"默认分组"},...x.data]})})();const r=w(!1),l=()=>{u.value.validate().then(()=>{let x={...f};r.value=!0,qt({...x}).then(()=>{W.success("保存成功"),k.value=!1}).finally(()=>{r.value=!1})})};return _({show:i}),(x,d)=>{const c=pe,o=et,h=ot,q=tt,L=je,p=Y;return n(),v("div",null,[t(p,{open:k.value,"onUpdate:open":d[2]||(d[2]=C=>k.value=C),title:"保存到提示词库",width:580,onOk:l,confirmLoading:r.value},{default:s(()=>[t(L,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:u,model:f},{default:s(()=>[t(o,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:s(()=>[t(c,{value:f.title,"onUpdate:value":d[0]||(d[0]=C=>f.title=C),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(o,{name:"group_id",label:"分组"},{default:s(()=>[t(q,{value:f.group_id,"onUpdate:value":d[1]||(d[1]=C=>f.group_id=C),style:{width:"100%"}},{default:s(()=>[(n(!0),v(B,null,K(a.value,C=>(n(),P(h,{value:C.id},{default:s(()=>[S(I(C.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},cs={class:"prompt-box"},us={class:"tab-header"},ps={key:0,class:"opt-block"},ms={key:1,class:"opt-block"},vs={class:"tip-text"},fs={key:0,class:"prompt-list-box"},bs={class:"prompt-list"},hs={class:"prompt-header"},ys={class:"prompt-title"},ks={key:0,class:"btn-wrapper-box"},gs={class:"prompt-content"},xs={class:"prompt-list"},$s={class:"prompt-header"},ws={class:"prompt-title"},qs={key:0,class:"btn-wrapper-box"},Ss={class:"prompt-content"},Cs={class:"prompt-list"},Ls={class:"prompt-header"},Is={class:"prompt-title"},Us={key:0,class:"btn-wrapper-box"},Rs={class:"prompt-content"},Es={class:"prompt-list"},Os={class:"prompt-header"},As={class:"prompt-title"},js={key:0,class:"btn-wrapper-box"},Ms={class:"prompt-content"},zs={class:"prompt-list"},Ds={class:"prompt-header"},Ps={class:"prompt-title"},Ns={key:0,class:"btn-wrapper-box"},Vs={class:"swich-item"},Ts={class:"swich-item"},Bs={class:"prompt-content"},Qs={class:"prompt-list"},Fs={class:"prompt-header"},Js={class:"prompt-title"},Gs={key:0,class:"btn-wrapper-box"},Hs={class:"prompt-content"},Ks={class:"prompt-header"},Ws={class:"prompt-title",style:{flex:"1"}},Zs={key:0,class:"btn-wrapper-box"},Ys=["onClick"],Xs={class:"prompt-content"},en={key:0,class:"add-theme-block"},tn={class:"show-more-block"},on={key:1,class:"diy-prompt-box"},sn={key:0,class:"diy-switch-box"},nn={class:"swich-item"},ln={class:"swich-item"},ae="- 请使用markdown格式回答问题。",re="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",an={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(z){const _=w(!1),{robotInfo:k,updateRobotInfo:f}=X("robotInfo"),u=z;let i={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const a=w({}),y=w(!1),r=w(!1),l=w(!1),x=w(!1),d=G({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),c=w(localStorage.getItem("system_prompt_words_ishide")=="1"),o=()=>{c.value=!c.value,localStorage.setItem("system_prompt_words_ishide",c.value?1:0)},h=(Q,g)=>Q.includes(g),q=w(k.prompt_type);fe(()=>k,()=>{d.prompt=k.prompt,d.prompt_struct=k.prompt_struct,a.value=k.prompt_struct_default},{immediate:!0,deep:!0}),fe(()=>d.prompt_struct.output.describe,Q=>{y.value=h(Q,ae),r.value=h(Q,re)},{immediate:!0,deep:!0}),fe(()=>d.prompt,Q=>{l.value=h(Q,ae),x.value=h(Q,re)},{immediate:!0,deep:!0});const L=(Q,g)=>{Q?(g=="outSwitch"&&(d.prompt_struct.output.describe?d.prompt_struct.output.describe+=`
`+ae:d.prompt_struct.output.describe+=ae),g=="imgSwitch"&&(d.prompt_struct.output.describe?d.prompt_struct.output.describe+=`
`+re:d.prompt_struct.output.describe+=re)):(g=="outSwitch"&&(d.prompt_struct.output.describe=d.prompt_struct.output.describe.replace(new RegExp(ae,"g"),"")),g=="imgSwitch"&&(d.prompt_struct.output.describe=d.prompt_struct.output.describe.replace(new RegExp(re,"g"),"")),d.prompt_struct.output.describe=d.prompt_struct.output.describe.trim())},p=(Q,g)=>{Q?(g=="outDiySwitch"&&(d.prompt?d.prompt+=`
`+ae:d.prompt+=ae),g=="imgDiySwitch"&&(d.prompt?d.prompt+=`
`+re:d.prompt+=re)):(g=="outDiySwitch"&&(d.prompt=d.prompt.replace(new RegExp(ae,"g"),"")),g=="imgDiySwitch"&&(d.prompt=d.prompt.replace(new RegExp(re,"g"),"")),d.prompt=d.prompt.trim())},C=Q=>{d.prompt_struct[Q].describe=a.value[Q].describe},R=()=>{let Q=k.work_flow_ids.split(","),g=u.robotList.filter(ye=>Q.includes(ye.id)),T=[];T=g.map(ye=>`- ${ye.robot_name} ${ye.robot_intro}`).join(`
`),d.prompt_struct.skill.describe=T},b=()=>{d.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),q.value=1},E=Q=>{d.prompt_struct.custom.splice(Q,1)},H=()=>{f({...Z(d),prompt_type:q.value}),_.value=!1},N=Q=>{q.value=1,f({prompt_type:q.value,prompt:d.prompt,prompt_struct:Q}),_.value=!1},m=()=>{_.value=!0},M=()=>{_.value=!1},A=w(null),V=()=>{A.value.show()},O=w(null),D=()=>{O.value.show()},F=w(null),ie=()=>{F.value.show({...d,prompt_type:q.value})},he=Q=>{Q.prompt_type==1?(q.value=1,d.prompt_struct=Q.prompt_struct):(q.value=0,d.prompt=Q.prompt),H()};return(Q,g)=>{const T=st,ye=nt,Be=se,ut=ue,we=oe,pt=xe,le=$e,qe=ne,mt=pe;return n(),v("div",cs,[e("div",us,[t(ye,{activeKey:q.value,"onUpdate:activeKey":g[0]||(g[0]=j=>q.value=j)},{default:s(()=>[(n(),P(T,{key:1,tab:"结构化提示词"})),(n(),P(T,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),_.value?(n(),v("div",ps,[t(Be,null,{title:s(()=>g[22]||(g[22]=[S("将当前编辑的提示词保存到提示词库中")])),default:s(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:ie},[t($(Te)),g[23]||(g[23]=S("上传 "))])]),_:1}),t(Be,null,{title:s(()=>g[24]||(g[24]=[S("从提示词库导入提示词")])),default:s(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:D},[t($(Pt)),g[25]||(g[25]=S("导入 "))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:V},[t(ut,{name:"ai-mark"}),g[26]||(g[26]=S(" AI自动生成 "))]),t(pt,{gap:8},{default:s(()=>[t(we,{size:"small",type:"primary",onClick:H},{default:s(()=>g[27]||(g[27]=[S("保存")])),_:1,__:[27]}),t(we,{size:"small",onClick:M},{default:s(()=>g[28]||(g[28]=[S("取消")])),_:1,__:[28]})]),_:1})])):(n(),v("div",ms,[e("span",vs,"当前类型："+I(q.value==1?"结构化提示词":"自定义提示词"),1),t(we,{size:"small",onClick:m},{default:s(()=>g[29]||(g[29]=[S("修改")])),_:1,__:[29]})]))]),q.value==1?(n(),v("div",fs,[e("div",bs,[e("div",hs,[e("div",ys,I(d.prompt_struct.role.subject),1),_.value?(n(),v("div",ks,[e("a",{onClick:g[1]||(g[1]=j=>C("role"))},"恢复默认")])):U("",!0)]),e("div",gs,[t(le,{bordered:!1,disabled:!_.value,value:d.prompt_struct.role.describe,"onUpdate:value":g[2]||(g[2]=j=>d.prompt_struct.role.describe=j),placeholder:$(i).role},null,8,["disabled","value","placeholder"])])]),e("div",xs,[e("div",$s,[e("div",ws,I(d.prompt_struct.task.subject),1),_.value?(n(),v("div",qs,[e("a",{onClick:g[3]||(g[3]=j=>C("task"))},"恢复默认")])):U("",!0)]),e("div",Ss,[t(le,{bordered:!1,disabled:!_.value,value:d.prompt_struct.task.describe,"onUpdate:value":g[4]||(g[4]=j=>d.prompt_struct.task.describe=j),placeholder:$(i).task},null,8,["disabled","value","placeholder"])])]),c.value?(n(),v(B,{key:0},[e("div",Cs,[e("div",Ls,[e("div",Is,I(d.prompt_struct.constraints.subject),1),_.value?(n(),v("div",Us,[e("a",{onClick:g[5]||(g[5]=j=>C("constraints"))},"恢复默认")])):U("",!0)]),e("div",Rs,[t(le,{bordered:!1,disabled:!_.value,value:d.prompt_struct.constraints.describe,"onUpdate:value":g[6]||(g[6]=j=>d.prompt_struct.constraints.describe=j),placeholder:$(i).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",Es,[e("div",Os,[e("div",As,I(d.prompt_struct.skill.subject),1),_.value?(n(),v("div",js,[e("a",{onClick:g[7]||(g[7]=j=>R())},"自动导入技能")])):U("",!0)]),e("div",Ms,[t(le,{bordered:!1,disabled:!_.value,value:d.prompt_struct.skill.describe,"onUpdate:value":g[8]||(g[8]=j=>d.prompt_struct.skill.describe=j),placeholder:$(i).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",zs,[e("div",Ds,[e("div",Ps,I(d.prompt_struct.output.subject),1),_.value?(n(),v("div",Ns,[e("div",Vs,[g[30]||(g[30]=S(" 输出markdown： ")),t(qe,{onChange:g[9]||(g[9]=j=>L(j,"outSwitch")),checked:y.value,"onUpdate:checked":g[10]||(g[10]=j=>y.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Ts,[g[31]||(g[31]=S(" 回复图片： ")),t(qe,{onChange:g[11]||(g[11]=j=>L(j,"imgSwitch")),checked:r.value,"onUpdate:checked":g[12]||(g[12]=j=>r.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:g[13]||(g[13]=j=>C("output"))},"恢复默认")])):U("",!0)]),e("div",Bs,[t(le,{bordered:!1,disabled:!_.value,value:d.prompt_struct.output.describe,"onUpdate:value":g[14]||(g[14]=j=>d.prompt_struct.output.describe=j),placeholder:$(i).output},null,8,["disabled","value","placeholder"])])]),e("div",Qs,[e("div",Fs,[e("div",Js,I(d.prompt_struct.tone.subject),1),_.value?(n(),v("div",Gs,[e("a",{onClick:g[15]||(g[15]=j=>C("tone"))},"恢复默认")])):U("",!0)]),e("div",Hs,[t(le,{bordered:!1,disabled:!_.value,value:d.prompt_struct.tone.describe,"onUpdate:value":g[16]||(g[16]=j=>d.prompt_struct.tone.describe=j),placeholder:$(i).tone},null,8,["disabled","value","placeholder"])])]),(n(!0),v(B,null,K(d.prompt_struct.custom,(j,Qe)=>(n(),v("div",{class:"prompt-list",key:Qe+j.key?j.key:""},[e("div",Ks,[e("div",Ws,[t(mt,{bordered:!1,disabled:!_.value,style:{width:"100%"},value:j.subject,"onUpdate:value":Se=>j.subject=Se,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),_.value?(n(),v("div",Zs,[e("div",{class:"hover-btn-box",onClick:Se=>E(Qe)},[t($(be))],8,Ys)])):U("",!0)]),e("div",Xs,[t(le,{bordered:!1,disabled:!_.value,value:j.describe,"onUpdate:value":Se=>j.describe=Se,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),_.value?(n(),v("div",en,[t(we,{onClick:b,block:"",icon:Ke($(Re))},{default:s(()=>g[32]||(g[32]=[S("添加主题")])),_:1,__:[32]},8,["icon"])])):U("",!0)],64)):U("",!0),e("div",tn,[e("div",{class:"btn-item",onClick:o},[c.value?(n(),v(B,{key:1},[g[34]||(g[34]=S("收起")),t($(Nt))],64)):(n(),v(B,{key:0},[g[33]||(g[33]=S("展开")),t($(it))],64))])])])):(n(),v("div",on,[_.value?(n(),v("div",sn,[e("div",nn,[g[35]||(g[35]=S(" 输出markdown： ")),t(qe,{size:"small",onChange:g[17]||(g[17]=j=>p(j,"outDiySwitch")),checked:l.value,"onUpdate:checked":g[18]||(g[18]=j=>l.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",ln,[g[36]||(g[36]=S(" 回复图片： ")),t(qe,{size:"small",onChange:g[19]||(g[19]=j=>p(j,"imgDiySwitch")),checked:x.value,"onUpdate:checked":g[20]||(g[20]=j=>x.value=j),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):U("",!0),t(le,{bordered:_.value,value:d.prompt,"onUpdate:value":g[21]||(g[21]=j=>d.prompt=j),disabled:!_.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(ds,{onHandleAiSave:N,ref_key:"aiCreatePromptRef",ref:A},null,512),t(zt,{onOk:he,ref_key:"importPromptRef",ref:O},null,512),t(_s,{ref_key:"uploadPromptRef",ref:F},null,512)])}}},rn=J(an,[["__scopeId","data-v-f95249d5"]]),dn={class:"actions-box"},_n={class:"setting-info-block"},cn={class:"set-item w-100"},un={key:0,class:"set-item-content"},pn=["src"],mn={key:1},vn={class:"set-item"},fn={class:"set-item"},bn={class:"set-item"},hn={class:"set-item"},yn={class:"form-box"},kn={class:"form-item"},gn={class:"form-item-body"},xn={class:"form-item",style:{display:"flex","align-items":"center"}},$n={class:"form-item"},wn={class:"form-item-label"},qn={class:"form-item-body"},Sn={class:"number-box"},Cn={class:"number-slider-box"},Ln={class:"number-input-box"},In={class:"form-item"},Un={class:"form-item-label"},Rn={class:"form-item-body"},En={class:"number-box"},On={class:"number-slider-box"},An={class:"number-input-box"},jn={class:"form-item"},Mn={class:"form-item-label"},zn={class:"form-item-body"},Dn={class:"number-box"},Pn={class:"number-slider-box"},Nn={class:"number-input-box"},Vn={class:"form-item justify-between"},Tn={class:"form-item-label"},Bn={class:"form-item justify-between"},Qn={class:"form-item-label"},Fn={__name:"model-settings",setup(z){const _=["azure","ollama","xinference","openaiAgent","doubao"],k=["doubao"],f=["azure"],u=G({sm:24,md:24,lg:12,xl:24,xxl:24}),i=w([]),a=w(!1),{robotInfo:y,updateRobotInfo:r}=X("robotInfo"),l=G({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1,prompt_role_type:"0",enable_thinking:0}),x=w(""),d=w(""),c=w(""),o=N=>{l.use_model=_.includes(N.rawData.model_define)&&N.rawData.deployment_name?N.rawData.show_model_name||N.rawData.deployment_name:N.rawData.name,l.use_model_icon=N.icon,l.use_model_name=N.use_model_name,l.model_config_id=N.rawData.id,x.value=N.rawData.model_define,l.use_model&&l.use_model.toLowerCase().includes("deepseek-r1")?l.prompt_role_type="1":l.prompt_role_type="0"},h=w({}),q=(N,m)=>{h.value=m},L=de(()=>{if(!l.model_config_id)return!1;let N=l.model_config_id+"#"+l.use_model;return h.value[N]}),p=w(!1),C=N=>{N.target.closest(".custom-select")||(p.value=!1)};ge(()=>{_.indexOf(x.value)>-1?l.use_model=c.value:l.use_model=y.use_model,document.addEventListener("click",C)}),ft(()=>{document.removeEventListener("click",C)});const R=()=>{c.value=l.use_model;let N={...Z(l)};f.indexOf(x.value)>-1&&(N.use_model="默认"),r(N),a.value=!1},b=N=>{_.indexOf(x.value)>-1?l.use_model=c.value:l.use_model=y.use_model,l.model_config_id=y.model_config_id,l.temperature=y.temperature,l.max_token=y.max_token,l.context_pair=y.context_pair,l.think_switch=Number(y.think_switch),l.prompt_role_type=y.prompt_role_type,l.enable_thinking=y.enable_thinking,a.value=N};Ie(()=>{l.model_config_id=y.model_config_id,l.temperature=y.temperature,l.max_token=y.max_token,l.context_pair=y.context_pair,l.think_switch=Number(y.think_switch),l.prompt_role_type=y.prompt_role_type,l.enable_thinking=y.enable_thinking});function E(N,m,M){const A=new Set(N.map(V=>V.model_define));return m.filter(V=>{let O=V[M];A.has(O)&&N.filter(D=>{if(D.model_define==O)return D.children=Ct(D.children,V.children),!1})}),N}return(()=>{lt({model_type:"LLM"}).then(N=>{c.value=y.use_model;let m=N.data||[],M=[];i.value=m.map(A=>{M=[];for(let V=0;V<A.model_info.llm_model_list.length;V++){const O=A.model_info.llm_model_list[V];_.indexOf(A.model_info.model_define)>-1&&y.model_config_id==A.model_config.id&&(c.value=A.model_config.show_model_name||A.model_config.deployment_name,x.value=A.model_info.model_define,d.value=A.model_info.model_define),M.push({name:O,deployment_name:A.model_config.deployment_name,show_model_name:k.includes(A.model_info.model_define)?A.model_config.show_model_name:"",id:A.model_config.id,model_define:A.model_info.model_define,icon:A.model_info.model_icon_url,use_model_name:A.model_info.model_name})}return{id:A.model_config.id,name:A.model_info.model_name,model_define:A.model_info.model_define,icon:A.model_info.model_icon_url,children:M,deployment_name:A.model_config.deployment_name}}),i.value=E(St(i.value,"model_define"),i.value,"model_define"),y.use_model&&y.model_config_id&&i.value.some(A=>A.children.some(V=>{const O=_.includes(V.model_define)&&V.deployment_name?V.deployment_name:V.name;if(_.includes(V.model_define)&&V.deployment_name&&V.id===y.model_config_id)return l.use_model_icon=V.icon,l.use_model_name=V.use_model_name,l.use_model=V.show_model_name||V.deployment_name,!0;if(O===y.use_model&&V.id===y.model_config_id)return l.use_model_icon=V.icon,l.use_model_name=V.use_model_name,!0}))})})(),(N,m)=>{const M=oe,A=Bt,V=De,O=ze,D=se,F=at,ie=Ee,he=ne,Q=Tt,g=Y;return n(),P(te,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:a.value,"onUpdate:isEdit":m[12]||(m[12]=T=>a.value=T)},{extra:s(()=>[e("div",dn,[t(M,{onClick:m[0]||(m[0]=T=>b(!0)),size:"small"},{default:s(()=>m[13]||(m[13]=[S("修改")])),_:1,__:[13]})])]),default:s(()=>[e("div",_n,[e("div",cn,[m[14]||(m[14]=S(" LLM模型： ")),l.use_model_icon&&l.use_model_name?(n(),v("span",un,[e("img",{src:l.use_model_icon,class:"model-icon"},null,8,pn),S(I(l.use_model_name)+" "+I(l.use_model),1)])):(n(),v("span",mn,I(l.use_model),1))]),e("div",vn,[m[15]||(m[15]=S(" 温度： ")),e("span",null,I(l.temperature),1)]),e("div",fn,[m[16]||(m[16]=S(" 最大token： ")),e("span",null,I(l.max_token),1)]),e("div",bn,[m[17]||(m[17]=S(" 上下文数量： ")),e("span",null,I(l.context_pair),1)]),e("div",hn,[m[18]||(m[18]=S(" 显示推理过程： ")),e("span",null,I(l.think_switch==1?"开":"关"),1)])]),t(g,{open:a.value,"onUpdate:open":m[11]||(m[11]=T=>a.value=T),width:672,title:"模型设置",onOk:R},{default:s(()=>[e("div",yn,[t(Q,{gutter:[32,24]},{default:s(()=>[t(A,me(ke(u)),{default:s(()=>[e("div",kn,[m[19]||(m[19]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",gn,[t(Vt,{modelValue:l.use_model,"onUpdate:modelValue":m[1]||(m[1]=T=>l.use_model=T),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":l.model_config_id,onChange:o,onLoaded:q},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(A,me(ke(u)),{default:s(()=>[e("div",xn,[m[22]||(m[22]=e("div",{class:"form-item-label mb12"},[e("span",null,"提示词所属角色： ")],-1)),e("div",null,[t(O,{value:l.prompt_role_type,"onUpdate:value":m[2]||(m[2]=T=>l.prompt_role_type=T)},{default:s(()=>[t(V,{value:"0"},{default:s(()=>m[20]||(m[20]=[S("系统角色（System）")])),_:1,__:[20]}),t(V,{value:"1"},{default:s(()=>m[21]||(m[21]=[S("用户角色（User）")])),_:1,__:[21]})]),_:1},8,["value"])])])]),_:1},16),t(A,me(ke(u)),{default:s(()=>[e("div",$n,[e("div",wn,[m[24]||(m[24]=e("span",null,"温度 ",-1)),t(D,null,{title:s(()=>m[23]||(m[23]=[S("温度越低，回答越严谨。温度越高，回答越发散。")])),default:s(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",qn,[e("div",Sn,[e("div",Cn,[t(F,{class:"custom-slider",value:l.temperature,"onUpdate:value":m[3]||(m[3]=T=>l.temperature=T),min:0,max:2,step:.1},null,8,["value"])]),e("div",Ln,[t(ie,{value:l.temperature,"onUpdate:value":m[4]||(m[4]=T=>l.temperature=T),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(A,me(ke(u)),{default:s(()=>[e("div",In,[e("div",Un,[m[26]||(m[26]=e("span",null,"最大token ",-1)),t(D,null,{title:s(()=>m[25]||(m[25]=[S("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:s(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",Rn,[e("div",En,[e("div",On,[t(F,{class:"custom-slider",value:l.max_token,"onUpdate:value":m[5]||(m[5]=T=>l.max_token=T),min:0,max:100*1024},null,8,["value"])]),e("div",An,[t(ie,{value:l.max_token,"onUpdate:value":m[6]||(m[6]=T=>l.max_token=T),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(A,me(ke(u)),{default:s(()=>[e("div",jn,[e("div",Mn,[m[28]||(m[28]=e("span",null,"上下文数量 ",-1)),t(D,null,{title:s(()=>m[27]||(m[27]=[S("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:s(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",zn,[e("div",Dn,[e("div",Pn,[t(F,{class:"custom-slider",value:l.context_pair,"onUpdate:value":m[7]||(m[7]=T=>l.context_pair=T),min:0,max:50},null,8,["value"])]),e("div",Nn,[t(ie,{value:l.context_pair,"onUpdate:value":m[8]||(m[8]=T=>l.context_pair=T),min:0,max:50},null,8,["value"])])])])])]),_:1},16),L.value?(n(),P(A,me(We({key:0},u)),{default:s(()=>[e("div",Vn,[e("div",Tn,[m[30]||(m[30]=e("span",null,"深度思考 ",-1)),t(D,null,{title:s(()=>m[29]||(m[29]=[e("span",null,"开启时，调用大模型时会指定走深度思考模式",-1)])),default:s(()=>[t($(ee),{class:"question-icon"})]),_:1})]),t(he,{checked:l.enable_thinking,"onUpdate:checked":m[9]||(m[9]=T=>l.enable_thinking=T),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)):U("",!0),t(A,me(ke(u)),{default:s(()=>[e("div",Bn,[e("div",Qn,[m[32]||(m[32]=e("span",null,"显示推理过程 ",-1)),t(D,null,{title:s(()=>m[31]||(m[31]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])),default:s(()=>[t($(ee),{class:"question-icon"})]),_:1})]),t(he,{checked:l.think_switch,"onUpdate:checked":m[10]||(m[10]=T=>l.think_switch=T),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Jn=J(Fn,[["__scopeId","data-v-69e712da"]]),Gn={class:"library-checkbox-box"},Hn={class:"list-tools"},Kn={class:"list-box",ref:"scrollContainer"},Wn={class:"library-name"},Zn={class:"library-desc"},Yn={__name:"library-select-alert",emits:["change"],setup(z,{expose:_,emit:k}){const f=k,u=G({indeterminate:!1,checkAll:!1,checkedList:[]}),i=w(!1),a=L=>{c(),u.checkedList=L,i.value=!0},y=()=>{i.value=!1,d()},r=w(""),l=()=>{c()},x=w([]),d=()=>{f("change",[...u.checkedList])},c=async()=>{const L=await Ye({library_name:r.value,type:"",show_open_docs:1});if(L){let p=L.data||[];x.value=p}},o=w(!1),h=async()=>{o.value=!0,await c(),o.value=!1,W.success("刷新完成")},q=()=>{window.open("/#/library/list")};return _({open:a}),(L,p)=>{const C=rt,R=pe,b=oe,E=Ne,H=Pe,N=Ue,m=Y;return n(),P(m,{width:"746px",open:i.value,"onUpdate:open":p[2]||(p[2]=M=>i.value=M),title:"关联知识库",onOk:y},{default:s(()=>[e("div",Gn,[t(C,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",Hn,[e("div",null,[t(R,{style:{width:"282px"},value:r.value,"onUpdate:value":p[0]||(p[0]=M=>r.value=M),placeholder:"请输入知识库名称搜索",onChange:l},{suffix:s(()=>[t($(Qt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(b,{style:{"margin-right":"8px"},onClick:h},{default:s(()=>[t($(Ft)),p[3]||(p[3]=S(" 刷新 "))]),_:1,__:[3]}),t(b,{type:"primary",ghost:"",onClick:q},{default:s(()=>p[4]||(p[4]=[S("新建知识库")])),_:1,__:[4]})])]),t(N,{spinning:o.value,delay:100},{default:s(()=>[t(H,{value:u.checkedList,"onUpdate:value":p[1]||(p[1]=M=>u.checkedList=M),style:{width:"100%"}},{default:s(()=>[e("div",Kn,[(n(!0),v(B,null,K(x.value,M=>(n(),v("div",{class:"list-item-wraapper",key:M.id},[t(E,{class:"list-item",value:M.id},{default:s(()=>[e("div",Wn,I(M.library_name),1),e("div",Zn,I(M.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},Xn=J(Yn,[["__scopeId","data-v-81c2223e"]]),ei={class:"recall-settings-box"},ti={class:"form-box"},oi={class:"form-item is-required"},si={class:"form-item-body"},ni={class:"retrieval-mode-items"},ii=["onClick"],li={class:"retrieval-mode-title"},ai={class:"title-text"},ri={key:0,style:{width:"32px"},src:Jt,alt:""},di={class:"retrieval-mode-desc"},_i={class:"form-item"},ci={class:"form-item-label"},ui={class:"form-item-body"},pi={class:"number-box"},mi={class:"number-slider-box"},vi={class:"number-input-box"},fi={key:0,class:"form-item"},bi={class:"form-item-label"},hi={class:"form-item-body"},yi={class:"number-box"},ki={class:"number-slider-box"},gi={class:"number-input-box"},xi={class:"form-item"},$i={class:"form-item-label"},wi={key:0,class:"form-item-body"},qi=["src"],Si={__name:"recall-settings-alert",emits:["change"],setup(z,{expose:_,emit:k}){const f=k,u=w([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),i=G({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),a=w(!1),y=L=>{q(),i.rerank_status=L.rerank_status||0,i.rerank_use_model=L.rerank_use_model||void 0,i.rerank_model_config_id=L.rerank_model_config_id>0?L.rerank_model_config_id:"",i.top_k=L.top_k,i.similarity=L.similarity,i.search_type=L.search_type,a.value=!0},r=(L,p)=>{if(!L||!p){i.rerank_model_config_id="";return}i.rerank_model_config_id=p.rerank_model_config_id},l=L=>{L==0&&(i.rerank_model_config_id="",i.rerank_use_model="")},x=L=>{i.search_type=L},d=()=>i.rerank_status==1&&!i.rerank_model_config_id,c=()=>{if(d())return W.error("请选择Rerank模型");a.value=!1,o()},o=()=>{f("change",Z(i))},h=w([]),q=()=>{lt({model_type:"RERANK"}).then(L=>{let p=L.data||[];h.value=p.map(C=>({id:C.model_config.id,name:C.model_info.model_name,icon:C.model_info.model_icon_url,children:C.model_info.rerank_model_list}))})};return _({open:y}),(L,p)=>{const C=ue,R=se,b=at,E=Ee,H=ne,N=xe,m=ot,M=Dt,A=tt,V=Y;return n(),P(V,{width:"746px",open:a.value,"onUpdate:open":p[6]||(p[6]=O=>a.value=O),title:"召回设置",onOk:c},{default:s(()=>[e("div",ei,[e("div",ti,[e("div",oi,[p[7]||(p[7]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",si,[e("div",ni,[(n(!0),v(B,null,K(u.value,O=>(n(),v("div",{class:Le(["retrieval-mode-item",{active:i.search_type==O.value}]),key:O.value,onClick:D=>x(O.value)},[i.search_type==O.value?(n(),P(C,{key:0,class:"check-arrow",name:"check-arrow-filled"})):U("",!0),e("div",li,[t(C,{name:O.iconName,class:"title-icon"},null,8,["name"]),e("span",ai,I(O.title),1),O.isRecommendation?(n(),v("img",ri)):U("",!0)]),e("div",di,I(O.desc),1)],10,ii))),128))])])]),e("div",_i,[e("div",ci,[p[9]||(p[9]=e("span",null,"Top K ",-1)),t(R,null,{title:s(()=>p[8]||(p[8]=[S("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:s(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",ui,[e("div",pi,[e("div",mi,[t(b,{class:"custom-slider",value:i.top_k,"onUpdate:value":p[0]||(p[0]=O=>i.top_k=O),min:1,max:10},null,8,["value"])]),e("div",vi,[t(E,{value:i.top_k,"onUpdate:value":p[1]||(p[1]=O=>i.top_k=O),min:1,max:10},null,8,["value"])])])])]),i.search_type<=2?(n(),v("div",fi,[e("div",bi,[p[11]||(p[11]=e("span",null,"相似度阈值 ",-1)),t(R,null,{title:s(()=>p[10]||(p[10]=[S("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:s(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",hi,[e("div",yi,[e("div",ki,[t(b,{class:"custom-slider",value:i.similarity,"onUpdate:value":p[2]||(p[2]=O=>i.similarity=O),min:0,max:1,step:.01},null,8,["value"])]),e("div",gi,[t(E,{value:i.similarity,"onUpdate:value":p[3]||(p[3]=O=>i.similarity=O),min:0,max:1,step:.01},null,8,["value"])])])])])):U("",!0),e("div",xi,[e("div",$i,[p[12]||(p[12]=e("span",null,"Rerank模型",-1)),p[13]||(p[13]=S("   ")),t(H,{checkedValue:1,unCheckedValue:0,checked:i.rerank_status,"onUpdate:checked":p[4]||(p[4]=O=>i.rerank_status=O),onChange:l},null,8,["checked"])]),i.rerank_status==1?(n(),v("div",wi,[t(A,{allowClear:"",value:i.rerank_use_model,"onUpdate:value":p[5]||(p[5]=O=>i.rerank_use_model=O),placeholder:"请选择Rerank模型",onChange:r,style:{width:"60%"}},{default:s(()=>[(n(!0),v(B,null,K(h.value,O=>(n(),P(M,{key:O.id},{label:s(()=>[t(N,{align:"center",gap:8},{default:s(()=>[e("img",{class:"model-icon",src:O.icon,alt:""},null,8,qi),S(I(O.name),1)]),_:2},1024)]),default:s(()=>[(n(!0),v(B,null,K(O.children,D=>(n(),P(m,{value:D,rerank_model_config_id:O.id,key:D},{default:s(()=>[e("span",null,I(D),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):U("",!0)])])])]),_:1},8,["open"])}}},Ci=J(Si,[["__scopeId","data-v-86a6e39d"]]),Li={class:"list-box"},Ii=["onClick"],Ui={class:"avater-box"},Ri=["src"],Ei={class:"content-box"},Oi={class:"title-block"},Ai={class:"title-text"},ji={class:"desc-box"},Mi={class:"right-icon"},zi={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(z,{expose:_,emit:k}){const f=k,u=z,i=w(!1);fe(()=>u.list,()=>{u.list.length==0&&(i.value=!1)},{});const a=()=>{i.value=!0},y=()=>{document.visibilityState==="visible"&&f("refreshList")};ge(()=>{document.addEventListener("visibilitychange",y)}),bt(()=>{document.removeEventListener("visibilitychange",y)});const r=l=>{window.open(`/#/library/details/knowledge-config?id=${l.id}`)};return _({show:a}),(l,x)=>{const d=rt,c=Me,o=Y;return n(),v("div",null,[t(o,{open:i.value,"onUpdate:open":x[0]||(x[0]=h=>i.value=h),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:s(()=>[t(d,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(c,{scrollbar:!1,style:{height:"400px"}},{default:s(()=>[e("div",Li,[(n(!0),v(B,null,K(u.list,h=>(n(),v("div",{class:"list-item",onClick:q=>r(h),key:h.id},[e("div",Ui,[e("img",{src:h.avatar,alt:""},null,8,Ri)]),e("div",Ei,[e("div",Oi,[x[1]||(x[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",Ai,I(h.library_name),1)]),e("div",ji,I(h.library_intro),1)]),e("div",Mi,[t($(Gt))])],8,Ii))),128))])]),_:1})]),_:1},8,["open"])])}}},Di=J(zi,[["__scopeId","data-v-0ebe0aeb"]]),Pi={class:"actions-box"},Ni={key:0,class:"library-list"},Vi=["onClick"],Ti=["onClick"],Bi={class:"library-name"},Qi={class:"library-name-text"},Fi={class:"library-intro"},Ji={class:"setting-info-block"},Gi={class:"set-item"},Hi={key:0},Ki={key:1},Wi={key:2},Zi={key:3},Yi={class:"set-item"},Xi={key:0,class:"set-item"},el={class:"set-item"},tl={key:0},ol={key:1},sl={__name:"index",setup(z){const{getStorage:_,removeStorage:k}=It("localStorage"),f=Lt(),u=de(()=>{var m;return((m=f.companyInfo)==null?void 0:m.neo4j_status)=="true"}),i=w(!1),{robotInfo:a,updateRobotInfo:y}=X("robotInfo"),r=G({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),l=w([]),x=w(null),d=de(()=>l.value.filter(m=>r.library_ids.includes(m.id))),c=de(()=>d.value.filter(m=>m.graph_switch==0)),o=m=>{let M=r.library_ids.indexOf(m.id);r.library_ids.splice(M,1),b()},h=m=>{r.library_ids=[...m],b()},q=()=>{x.value.open([...r.library_ids])},L=w(null),p=()=>{L.value.open(Z(r))},C=w(null),R=m=>{r.rerank_status=m.rerank_status,r.rerank_use_model=m.rerank_use_model,r.rerank_model_config_id=m.rerank_model_config_id,r.top_k=m.top_k,r.similarity=m.similarity,r.search_type=m.search_type,(m.search_type==1||m.search_type==4)&&c.value.length>0&&C.value.show(),b()},b=()=>{let m={...Z(r)};m.library_ids=m.library_ids.join(","),y({...m})},E=async()=>{const m=await Ye({type:"",show_open_docs:1});m&&(l.value=m.data||[])},H=()=>{Y.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){q()}})};r.rerank_use_model=a.rerank_use_model||void 0,Ie(()=>{r.library_ids=a.library_ids.split(","),r.rerank_status=a.rerank_status||0,r.rerank_use_model=a.rerank_use_model||void 0,r.rerank_model_config_id=a.rerank_model_config_id||"",r.top_k=a.top_k,r.similarity=a.similarity,r.search_type=a.search_type});const N=m=>{window.open(`#/library/details/knowledge-document?id=${m.id}`)};return ge(()=>{E(),_("showNoLibraryTip")&&(H(),k("showNoLibraryTip"))}),(m,M)=>{const A=oe,V=xe,O=se;return n(),P(te,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:i.value,"onUpdate:isEdit":M[0]||(M[0]=D=>i.value=D),bodyStyle:{padding:0}},{extra:s(()=>[e("div",Pi,[t(V,{gap:8},{default:s(()=>[t(A,{size:"small",onClick:p},{default:s(()=>M[1]||(M[1]=[S("召回设置")])),_:1,__:[1]}),t(A,{size:"small",onClick:q},{default:s(()=>M[2]||(M[2]=[S("关联知识库")])),_:1,__:[2]})]),_:1})])]),default:s(()=>[d.value.length>0?(n(),v("div",Ni,[(n(!0),v(B,null,K(d.value,D=>(n(),v("div",{class:"library-item",key:D.id,onClick:F=>N(D)},[e("span",{class:"close-btn",onClick:ht(F=>o(D),["stop"])},[t($(be))],8,Ti),e("div",Bi,[u.value?(n(),P(O,{key:0},{title:s(()=>[S(I(D.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:s(()=>[e("div",{class:Le(["graph-tag",{active:D.graph_switch==1}])},"Graph",2)]),_:2},1024)):U("",!0),e("div",Qi,I(D.library_name),1)]),e("div",Fi,I(D.library_intro),1)],8,Vi))),128))])):U("",!0),e("div",Ji,[e("div",Gi,[M[3]||(M[3]=S(" 检索模式： ")),r.search_type==1?(n(),v("span",Hi,"混合检索")):U("",!0),r.search_type==2?(n(),v("span",Ki,"向量检索")):U("",!0),r.search_type==3?(n(),v("span",Wi,"全文检索")):U("",!0),r.search_type==4?(n(),v("span",Zi,"知识图谱检索")):U("",!0)]),e("div",Yi,[M[4]||(M[4]=S(" Top K： ")),e("span",null,I(r.top_k),1)]),r.search_type<=2?(n(),v("div",Xi,[M[5]||(M[5]=S(" 相似度阈值： ")),e("span",null,I(r.similarity),1)])):U("",!0),e("div",el,[M[6]||(M[6]=S(" Rerank模型： ")),r.rerank_status==0?(n(),v("span",tl,"关")):(n(),v("span",ol,I(r.rerank_use_model),1))])]),t(Xn,{ref_key:"librarySelectAlertRef",ref:x,onChange:h},null,512),t(Ci,{ref_key:"recallSettingsAlertRef",ref:L,onChange:R},null,512),t(Di,{list:c.value,onRefreshList:E,ref_key:"noOpenGraphModalRef",ref:C},null,8,["list"])]),_:1},8,["isEdit"])}}},nl=J(sl,[["__scopeId","data-v-7e4fe84e"]]),il={class:"library-checkbox-box"},ll={class:"list-box",ref:"scrollContainer"},al={class:"library-name"},rl={class:"library-desc"},dl={key:0,class:"empty-box"},_l={__name:"library-select-alert",emits:["change"],setup(z,{expose:_,emit:k}){const f=k,u=G({indeterminate:!1,checkAll:!1,checkedList:[]}),i=w(!1),a=o=>{x(),u.checkedList=o,i.value=!0},y=()=>{i.value=!1,l()};w("");const r=w([]),l=()=>{f("change",[...u.checkedList])},x=async()=>{const o=await dt();if(o){let h=o.data||[];r.value=h}},d=w(!1),c=()=>{window.open("/#/database/list")};return _({open:a}),(o,h)=>{const q=Ne,L=Pe,p=Ue,C=Y;return n(),P(C,{width:"746px",open:i.value,"onUpdate:open":h[1]||(h[1]=R=>i.value=R),title:"关联数据表",onOk:y},{default:s(()=>[e("div",il,[t(p,{spinning:d.value,delay:100},{default:s(()=>[t(L,{value:u.checkedList,"onUpdate:value":h[0]||(h[0]=R=>u.checkedList=R),style:{width:"100%"}},{default:s(()=>[e("div",ll,[(n(!0),v(B,null,K(r.value,R=>(n(),v("div",{class:"list-item-wraapper",key:R.id},[t(q,{class:"list-item",value:R.id},{default:s(()=>[e("div",al,I(R.name),1),e("div",rl,I(R.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!d.value&&!r.value.length?(n(),v("div",dl,[h[3]||(h[3]=e("img",{src:_t,alt:""},null,-1)),e("div",null,[h[2]||(h[2]=S(" 暂无数据表, 请先去添加数据表 ")),e("a",{onClick:c}," 去添加")])])):U("",!0)])]),_:1},8,["open"])}}},cl=J(_l,[["__scopeId","data-v-890ab853"]]),ul={class:"actions-box"},pl={key:0,class:"library-list"},ml=["onClick"],vl={class:"library-name"},fl={class:"library-intro"},bl={__name:"index",setup(z){const _=w(!1),{robotInfo:k,updateRobotInfo:f}=X("robotInfo"),u=G({form_ids:[]}),i=w([]),a=w(null),y=de(()=>i.value.filter(o=>u.form_ids.includes(o.id))),r=o=>{let h=u.form_ids.indexOf(o.id);u.form_ids.splice(h,1),d()},l=o=>{u.form_ids=[...o],d()},x=()=>{a.value.open([...u.form_ids])},d=()=>{let o={...Z(u)};o.form_ids=o.form_ids.join(","),f({...o})};return(async()=>{const o=await dt();o&&(i.value=o.data||[])})(),Ie(()=>{u.form_ids=k.form_ids.split(",")}),(o,h)=>{const q=se,L=oe,p=xe;return n(),P(te,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:_.value,"onUpdate:isEdit":h[0]||(h[0]=C=>_.value=C),bodyStyle:{padding:0}},{tip:s(()=>[t(q,{placement:"top"},{title:s(()=>h[1]||(h[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])),default:s(()=>[t($(ee))]),_:1})]),extra:s(()=>[e("div",ul,[t(p,{gap:8},{default:s(()=>[t(L,{size:"small",onClick:x},{default:s(()=>h[2]||(h[2]=[S("关联数据表")])),_:1,__:[2]})]),_:1})])]),default:s(()=>[y.value.length>0?(n(),v("div",pl,[(n(!0),v(B,null,K(y.value,C=>(n(),v("div",{class:"library-item",key:C.id},[e("span",{class:"close-btn",onClick:R=>r(C)},[t($(be))],8,ml),e("div",vl,I(C.name),1),e("div",fl,I(C.description),1)]))),128))])):U("",!0),t(cl,{ref_key:"librarySelectAlertRef",ref:a,onChange:l},null,512)]),_:1},8,["isEdit"])}}},hl=J(bl,[["__scopeId","data-v-077d8df6"]]),yl={class:"form-box"},kl={class:"question-title"},gl={class:"question-options"},xl={class:"question-option"},$l={class:"drag-btn"},wl={class:"action-box"},ql={class:"robot-info-box"},Sl={class:"robot-welcome-content"},Cl={class:"robot-welcome-question"},Ll={__name:"welcome-words",setup(z){const _=w(!1),k=w(!1),{robotInfo:f,updateRobotInfo:u,scrollBoxToBottom:i}=X("robotInfo"),a=G({welcomes:{content:"",question:[]}}),y=()=>{let c=!1;if(a.welcomes.question.length>0){for(let o=0;o<a.welcomes.question.length;o++)if(!a.welcomes.question[o].content){c=o+1;break}}return c},r=()=>{a.welcomes.question.push({content:"",id:Ce(8)})},l=c=>{a.welcomes.question.splice(c,1)},x=()=>{if(!a.welcomes.content)return W.error("请输入欢迎语");if(y())return W.error("引导问题内容不能为空");u({...Z(a)}),_.value=!1},d=()=>{let c={...f.welcomes},o=[];c.question.forEach(({content:h,id:q})=>{let L={id:q,content:h};L.id||(L.id=Ce(6)),o.push(L)}),a.welcomes.content=c.content,a.welcomes.question=o};return(c,o)=>{const h=$e,q=ue,L=pe;return n(),P(te,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:_.value,"onUpdate:isEdit":o[4]||(o[4]=p=>_.value=p),onSave:x,onEdit:d},{default:s(()=>[_e(e("div",yl,[e("div",kl,[t(h,{value:a.welcomes.content,"onUpdate:value":o[0]||(o[0]=p=>a.welcomes.content=p),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",gl,[t($(Ve),{modelValue:a.welcomes.question,"onUpdate:modelValue":o[1]||(o[1]=p=>a.welcomes.question=p),"item-key":"id",handle:".drag-btn",onStart:o[2]||(o[2]=p=>k.value=!0),onEnd:o[3]||(o[3]=p=>k.value=!1)},{item:s(({element:p,index:C})=>[e("div",xl,[e("span",$l,[t(q,{name:"drag"})]),t(L,{class:"question-option-content",value:p.content,"onUpdate:value":R=>p.content=R,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",wl,[t($(be),{class:"del-btn",onClick:R=>l(C)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:r},[t($(Re),{class:"add-btn-icon"}),o[5]||(o[5]=S("添加引导问题 "))])])],512),[[ce,_.value]]),_e(e("div",ql,[e("div",Sl,I($(f).welcomes.content),1),e("div",Cl,[(n(!0),v(B,null,K($(f).welcomes.question,(p,C)=>(n(),v("div",{class:"question-item",key:C},I(p.content),1))),128))])],512),[[ce,!_.value]])]),_:1},8,["isEdit"])}}},Il=J(Ll,[["__scopeId","data-v-9b840ded"]]),Ul={class:"form-box"},Rl={class:"question-title"},El={class:"question-options"},Ol={class:"question-option"},Al={class:"drag-btn"},jl={class:"action-box"},Ml={class:"robot-info-box"},zl={class:"robot-unknown-content"},Dl={class:"robot-unknown-question"},Pl={__name:"unknown-problem-prompt",setup(z){const _=w(!1),k=w(!1),{robotInfo:f,updateRobotInfo:u,scrollBoxToBottom:i}=X("robotInfo"),a=G({unknown_question_prompt:{content:"",question:[]}}),y=()=>{a.unknown_question_prompt.question.push({content:"",id:Ce(8)}),Ze(()=>{i()})},r=d=>{a.unknown_question_prompt.question.splice(d,1)},l=()=>{u({...Z(a)}),_.value=!1},x=()=>{let d={...f.unknown_question_prompt},c=[];d.question&&d.question.forEach(({content:o,id:h})=>{let q={id:h,content:o};q.id||(q.id=Ce(6)),c.push(q)}),d.content&&(a.unknown_question_prompt.content=d.content),c&&(a.unknown_question_prompt.question=c)};return ge(()=>{}),(d,c)=>{const o=se,h=$e,q=ue,L=pe;return n(),P(te,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:_.value,"onUpdate:isEdit":c[4]||(c[4]=p=>_.value=p),onSave:l,onEdit:x},{tip:s(()=>[t(o,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>c[5]||(c[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])),default:s(()=>[t($(ee))]),_:1})]),default:s(()=>[_e(e("div",Ul,[e("div",Rl,[t(h,{value:a.unknown_question_prompt.content,"onUpdate:value":c[0]||(c[0]=p=>a.unknown_question_prompt.content=p),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",El,[t($(Ve),{modelValue:a.unknown_question_prompt.question,"onUpdate:modelValue":c[1]||(c[1]=p=>a.unknown_question_prompt.question=p),"item-key":"id",handle:".drag-btn",onStart:c[2]||(c[2]=p=>k.value=!0),onEnd:c[3]||(c[3]=p=>k.value=!1)},{item:s(({element:p,index:C})=>[e("div",Ol,[e("span",Al,[t(q,{name:"drag"})]),t(L,{class:"question-option-content",value:p.content,"onUpdate:value":R=>p.content=R,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",jl,[t($(be),{class:"del-btn",onClick:R=>r(C)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:y},[t($(Re),{class:"add-btn-icon"}),c[6]||(c[6]=S("添加引导问题 "))])])],512),[[ce,_.value]]),_e(e("div",Ml,[e("div",zl,I($(f).unknown_question_prompt.content),1),e("div",Dl,[(n(!0),v(B,null,K($(f).unknown_question_prompt.question,(p,C)=>(n(),v("div",{class:"question-item",key:C},I(p.content),1))),128))])],512),[[ce,!_.value]])]),_:1},8,["isEdit"])}}},Nl=J(Pl,[["__scopeId","data-v-aca01d0e"]]),Vl={class:"robot-info-box"},Tl={class:"modal-box",ref:"modalBoxRef"},Bl={class:"modal-item-box"},Ql={class:"modal-item"},Fl={class:"modal-item"},Jl={__name:"problem-optimization",setup(z){const _=w(!1);w(!1);const{robotInfo:k,updateRobotInfo:f}=X("robotInfo"),u=w("0"),i=G({optimize_question_use_model:"",optimize_question_model_config_id:""});ge(()=>{u.value=k.optimize_question_model_config_id!=0?"1":"0",i.optimize_question_use_model=k.optimize_question_use_model,i.optimize_question_model_config_id=k.optimize_question_model_config_id});const a=w([]),y=c=>{a.value=c,Ze(()=>{(!i.optimize_question_use_model||!Number(i.optimize_question_model_config_id))&&r()})},r=()=>{if(a.value.length>0){let c=null,o=null;for(let h of a.value)if(h.model_define==="tongyi"){c=h;for(let q of c.children)if(q.name==="qwen-max"){o=q;break}break}c||(c=a.value[0],o=c.children[0]),c&&o&&(i.optimize_question_use_model=o.name,i.optimize_question_model_config_id=o.model_config_id)}},l=()=>{_.value=!1,f({...Z(i)})},x=c=>{c!=1&&(i.optimize_question_use_model="",i.optimize_question_model_config_id=0)},d=c=>{f({})};return(c,o)=>{const h=se,q=ne,L=De,p=ze,C=$e,R=Y;return n(),P(te,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:s(()=>o[7]||(o[7]=[e("span",null,null,-1)])),default:s(()=>[e("div",Vl,[o[9]||(o[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),t(h,null,{title:s(()=>o[8]||(o[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])),default:s(()=>[e("div",{class:"dialog-bg-set",onClick:o[0]||(o[0]=b=>_.value=!0)}," 对话背景设置 ")]),_:1})]),t(q,{onChange:d,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(k).enable_question_optimize,"onUpdate:checked":o[1]||(o[1]=b=>$(k).enable_question_optimize=b),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",Tl,[t(R,{getContainer:()=>c.$refs.modalBoxRef,open:_.value,"onUpdate:open":o[6]||(o[6]=b=>_.value=b),width:472,title:"用户问题建议设置",onOk:l},{default:s(()=>[e("div",Bl,[e("div",Ql,[o[12]||(o[12]=e("div",{class:"label"},"模型",-1)),t(p,{value:u.value,"onUpdate:value":o[2]||(o[2]=b=>u.value=b),onChange:x},{default:s(()=>[t(L,{value:"0"},{default:s(()=>o[10]||(o[10]=[S("跟随机器人")])),_:1,__:[10]}),t(L,{value:"1"},{default:s(()=>o[11]||(o[11]=[S("指定模型")])),_:1,__:[11]})]),_:1},8,["value"]),u.value=="1"?(n(),P(Ht,{key:0,modelType:"LLM",modeName:i.optimize_question_use_model,"onUpdate:modeName":o[3]||(o[3]=b=>i.optimize_question_use_model=b),modeId:i.optimize_question_model_config_id,"onUpdate:modeId":o[4]||(o[4]=b=>i.optimize_question_model_config_id=b),style:{width:"100%","margin-top":"8px"},onLoaded:y},null,8,["modeName","modeId"])):U("",!0)]),e("div",Fl,[o[13]||(o[13]=e("div",{class:"label"},"对话背景",-1)),t(C,{style:{height:"120px"},value:$(k).optimize_question_dialogue_background,"onUpdate:value":o[5]||(o[5]=b=>$(k).optimize_question_dialogue_background=b),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Gl=J(Jl,[["__scopeId","data-v-13ab9369"]]),Hl={class:"robot-info-box"},Kl={class:"robot-prompt"},Wl={__name:"suggested-issues",setup(z){w(!1);const{robotInfo:_,updateRobotInfo:k}=X("robotInfo"),f=u=>{k({})};return(u,i)=>{const a=Ee,y=ne;return n(),P(te,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:s(()=>i[2]||(i[2]=[e("span",null,null,-1)])),default:s(()=>[e("div",Hl,[e("div",Kl,[i[3]||(i[3]=S(" 开启后，机器人回答问题后，自动根据对话内容提供 ")),t(a,{value:$(_).question_guide_num,"onUpdate:value":i[0]||(i[0]=r=>$(_).question_guide_num=r),style:{width:"80px"},precision:0,min:1,max:10,onBlur:f},null,8,["value"]),i[4]||(i[4]=S(" 条用户提问建议，最大不超过10条。 "))])]),t(y,{onChange:f,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(_).enable_question_guide,"onUpdate:checked":i[1]||(i[1]=r=>$(_).enable_question_guide=r),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Zl=J(Wl,[["__scopeId","data-v-bec632a5"]]),Yl={__name:"sensitive-words",setup(z){w(!1);const{robotInfo:_,updateRobotInfo:k}=X("robotInfo");G({prompt:""});const f=()=>{window.open("/#/user/sensitive-words")},u=i=>{k({})};return(i,a)=>{const y=ne;return n(),P(te,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:s(()=>a[1]||(a[1]=[e("span",null,null,-1)])),default:s(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[a[2]||(a[2]=S(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，")),e("span",{onClick:f,style:{cursor:"pointer"}},"设置敏词 >")])]),t(y,{onChange:u,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:$(_).sensitive_words_switch,"onUpdate:checked":a[0]||(a[0]=r=>$(_).sensitive_words_switch=r),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Xl=J(Yl,[["__scopeId","data-v-f1e5ad50"]]),ea={class:"direct-title"},ta={class:"direct-desc"},oa={class:"qa"},sa={class:"prompt-form-item-label"},na={class:"direct-switch"},ia={class:"similarity"},la={class:"number-input-box"},aa={__name:"chat-edit-alert",emits:["save"],setup(z,{expose:_,emit:k}){const f=k,u=w(1),i=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],a=G(i()),y=w(!1),r=G({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),l=()=>{r.chat_type=u.value.toString(),a.forEach(c=>{c.chat_type==u.value&&(r.chat_type=="3"?(r.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch==1?"true":"false",r.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score.toString()):r.chat_type=="1"&&(r.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch==1?"true":"false",r.library_qa_direct_reply_score=c.library_qa_direct_reply_score.toString()))}),x(),Object.assign(a,i()),y.value=!1},x=()=>{f("save",Z(r))};ge(()=>{});const d=c=>{u.value=parseInt(c.chat_type),r.chat_type=c.chat_type,r.library_qa_direct_reply_score=c.library_qa_direct_reply_score,r.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch,r.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,r.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch,a.forEach(o=>{o.chat_type=="3"?(o.mixture_qa_direct_reply_score=c.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=c.mixture_qa_direct_reply_switch=="true"?1:0):o.chat_type=="1"&&(o.library_qa_direct_reply_score=c.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=c.library_qa_direct_reply_switch=="true"?1:0)}),y.value=!0};return fe(()=>y.value,c=>{c===!1&&Object.assign(a,i())},{immediate:!0}),_({open:d}),(c,o)=>{const h=se,q=ne,L=Ee,p=De,C=ze,R=Y;return n(),P(R,{width:"746px",open:y.value,"onUpdate:open":o[1]||(o[1]=b=>y.value=b),title:"聊天模式设置",onOk:l},{default:s(()=>[t(C,{class:"direct-box",value:u.value,"onUpdate:value":o[0]||(o[0]=b=>u.value=b)},{default:s(()=>[(n(!0),v(B,null,K(a,b=>(n(),P(p,{class:Le(["direct-item",{active:u.value==b.direct_id}]),value:b.direct_id,key:b.direct_id},{default:s(()=>[e("div",ea,I(b.direct_title),1),e("div",ta,I(b.direct_desc),1),_e(e("div",oa,[e("div",sa,[o[4]||(o[4]=e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),t(h,null,yt({default:s(()=>[t($(ee),{class:"question-icon"})]),_:2},[b.chat_type=="1"?{name:"title",fn:s(()=>[o[2]||(o[2]=S("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"0"}:b.chat_type=="3"?{name:"title",fn:s(()=>[o[3]||(o[3]=S("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"1"}:void 0]),1024),e("div",na,[b.chat_type=="1"?(n(),P(q,{key:0,checkedValue:1,unCheckedValue:0,checked:b.library_qa_direct_reply_switch,"onUpdate:checked":E=>b.library_qa_direct_reply_switch=E},null,8,["checked","onUpdate:checked"])):b.chat_type=="3"?(n(),P(q,{key:1,checkedValue:1,unCheckedValue:0,checked:b.mixture_qa_direct_reply_switch,"onUpdate:checked":E=>b.mixture_qa_direct_reply_switch=E},null,8,["checked","onUpdate:checked"])):U("",!0)])])],512),[[ce,b.isQaDirectReply&&u.value==b.direct_id]]),_e(e("div",ia,[o[5]||(o[5]=e("span",null,"相似度超过",-1)),e("div",la,[b.chat_type=="1"?(n(),P(L,{key:0,value:b.library_qa_direct_reply_score,"onUpdate:value":E=>b.library_qa_direct_reply_score=E,disabled:!b.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):b.chat_type=="3"?(n(),P(L,{key:1,value:b.mixture_qa_direct_reply_score,"onUpdate:value":E=>b.mixture_qa_direct_reply_score=E,disabled:!b.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):U("",!0)]),o[6]||(o[6]=e("span",null,"时直接回复答案",-1))],512),[[ce,b.isQaDirectReply&&u.value==b.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},ra=J(aa,[["__scopeId","data-v-fc008010"]]),da={class:"actions-box"},_a={class:"setting-info-block"},ca={class:"set-item"},ua={key:0},pa={key:1},ma={key:2},va={class:"set-item"},fa={key:0,class:"set-item"},ba={class:"set-item"},ha={key:0,class:"set-item"},ya={class:"form-box"},ka={__name:"index",setup(z){const _=w(!1),k=w(null),{robotInfo:f,updateRobotInfo:u}=X("robotInfo"),i=G({chat_type:f.chat_type,library_qa_direct_reply_score:f.library_qa_direct_reply_score,library_qa_direct_reply_switch:f.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:f.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:f.mixture_qa_direct_reply_switch}),a=l=>{i.chat_type=l.chat_type,i.library_qa_direct_reply_score=l.library_qa_direct_reply_score,i.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch,i.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score,i.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch,y()},y=()=>{u({...Z(i)}),_.value=!1},r=()=>{k.value.open(Z(i)),_.value=!0};return(l,x)=>{const d=se,c=oe;return n(),P(te,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:_.value,"onUpdate:isEdit":x[1]||(x[1]=o=>_.value=o),bodyStyle:{padding:0}},{tip:s(()=>[t(d,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:s(()=>x[2]||(x[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])),default:s(()=>[t($(ee))]),_:1})]),extra:s(()=>[e("div",da,[t(c,{size:"small",onClick:x[0]||(x[0]=o=>r(!0))},{default:s(()=>x[3]||(x[3]=[S("修改")])),_:1,__:[3]})])]),default:s(()=>[e("div",_a,[e("div",ca,[x[4]||(x[4]=S(" 聊天模式： ")),$(f).chat_type=="1"?(n(),v("span",ua,"仅知识库")):U("",!0),$(f).chat_type=="2"?(n(),v("span",pa,"直连模式")):U("",!0),$(f).chat_type=="3"?(n(),v("span",ma,"混合模式")):U("",!0)]),$(f).chat_type=="1"?(n(),v(B,{key:0},[e("div",va,[x[5]||(x[5]=S(" QA文档直接回复答案： ")),e("span",null,I($(f).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),$(f).library_qa_direct_reply_switch=="true"?(n(),v("div",fa,[x[6]||(x[6]=S(" 相似度值： ")),e("span",null,I($(f).library_qa_direct_reply_score),1)])):U("",!0)],64)):U("",!0),$(f).chat_type=="3"?(n(),v(B,{key:1},[e("div",ba,[x[7]||(x[7]=S(" QA文档直接回复答案： ")),e("span",null,I($(f).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),$(f).mixture_qa_direct_reply_switch=="true"?(n(),v("div",ha,[x[8]||(x[8]=S(" 相似度值： ")),e("span",null,I($(f).mixture_qa_direct_reply_score),1)])):U("",!0)],64)):U("",!0)]),e("div",ya,[t(ra,{ref_key:"ChatEditAlertRef",ref:k,onSave:a},null,512)])]),_:1},8,["isEdit"])}}},ga=J(ka,[["__scopeId","data-v-be544020"]]),xa={class:"switch-box"},$a={class:"switch-box-body"},wa={class:"switch-box-header"},qa={class:"left-box"},Sa={class:"switch-box-title"},Ca={key:0,class:"title-tip"},La={class:"right-box"},Ia={class:"extra-box"},Ua={class:"switch-desc"},Ra={class:"switch-box-right"},Ea={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(z,{emit:_}){const k=_,f=z,u=w(f.value),i=a=>{k("update:value",a),k("change",a)};return(a,y)=>{const r=ue,l=ne;return n(),v("div",xa,[e("div",$a,[e("div",wa,[e("div",qa,[t(r,{class:"switch-box-icon",name:f.iconName},null,8,["name"]),e("span",Sa,I(f.title),1),a.$slots.tip?(n(),v("span",Ca,[ve(a.$slots,"tip",{},void 0,!0)])):U("",!0)]),e("div",La,[e("div",Ia,[ve(a.$slots,"extra",{},()=>[y[1]||(y[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",Ua,[ve(a.$slots,"default",{},void 0,!0)])]),e("div",Ra,[t(l,{checked:u.value,"onUpdate:checked":y[0]||(y[0]=x=>u.value=x),onChange:i,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Oa=J(Ea,[["__scopeId","data-v-0548f52d"]]),Aa="/assets/img/empty-Bx9z1cwf.png",ja="/assets/img/phone-head-CDwwPhYa.png",Ma="/assets/img/phone-body-CbEf8GZP.png",za="/assets/img/phone-footer-ClQtNpln.png",Da={class:"common-problem-box"},Pa={class:"left-content-box"},Na={key:0,class:"empty-box"},Va={key:1,class:"lists-box"},Ta={class:"drag-btn"},Ba={class:"title"},Qa={class:"opration-box"},Fa={class:"preview-box"},Ja={class:"phone-body"},Ga={key:0,class:"question-box"},Ha={__name:"common-problem",setup(z){w(!1);const{robotInfo:_,updateRobotInfo:k}=X("robotInfo"),f=de(()=>_.common_question_list?JSON.parse(_.common_question_list):[]),u=w([]);u.value=f.value,fe(f,()=>{u.value=f.value});const i=je.useForm,a=w(!1),y=w("添加问题"),r=G({question:"",index:-1}),l=G({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:x,validate:d,validateInfos:c}=i(r,l),o=()=>{if(f.value.length>=10)return W.error("最多设置10条常用问题");a.value=!0,x(),r.question="",r.index=-1},h=(R,b)=>{a.value=!0,x(),r.question=R,r.index=b},q=R=>{let b=[];b=f.value.filter((E,H)=>R!=H),Y.confirm({title:"提醒",icon:t(Ae),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){k({common_question_list:JSON.stringify(b)})},onCancel(){}})},L=()=>{d().then(()=>{let R=[];r.index>=0?R=f.value.map((b,E)=>E===r.index?r.question:b):R=[r.question,...f.value],k({common_question_list:JSON.stringify(R)}),a.value=!1})},p=R=>{k({})},C=R=>{k({common_question_list:JSON.stringify(u.value)})};return(R,b)=>{const E=se,H=ne,N=Kt,m=oe,M=ue,A=pe,V=et,O=je,D=Y;return n(),v("div",Da,[e("div",Pa,[t(te,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:s(()=>[t(E,null,{title:s(()=>b[4]||(b[4]=[S("最多10条。开启后，常见问题会显示在每条问答后面")])),default:s(()=>[t($(ee),{class:"quess-icon"})]),_:1})]),extra:s(()=>[t(H,{onChange:p,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(_).enable_common_question,"onUpdate:checked":b[0]||(b[0]=F=>$(_).enable_common_question=F),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(N,{type:"vertical"}),t(m,{type:"primary",size:"small",onClick:o},{default:s(()=>b[5]||(b[5]=[S("添加")])),_:1,__:[5]})]),default:s(()=>[f.value.length==0?(n(),v("div",Na,[b[7]||(b[7]=e("img",{src:Aa,alt:""},null,-1)),b[8]||(b[8]=e("div",{class:"title"},"暂无数据",-1)),b[9]||(b[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),t(m,{onClick:o,type:"primary"},{default:s(()=>b[6]||(b[6]=[S("立即添加")])),_:1,__:[6]})])):(n(),v("div",Va,[t($(Ve),{modelValue:u.value,"onUpdate:modelValue":b[1]||(b[1]=F=>u.value=F),handle:".drag-btn","item-key":"index",onEnd:C},{item:s(({element:F,index:ie})=>[(n(),v("div",{class:"list-item",key:ie},[e("span",Ta,[t(M,{name:"drag"})]),e("div",Ba,I(F),1),e("div",Qa,[t($(ct),{onClick:he=>h(F,ie)},null,8,["onClick"]),t($(be),{onClick:he=>q(ie)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Fa,[b[12]||(b[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:ja,alt:""})],-1)),e("div",Ja,[b[11]||(b[11]=e("div",null,[e("img",{class:"body-img",src:Ma,alt:""})],-1)),f.value.length&&$(_).enable_common_question=="true"?(n(),v("div",Ga,[b[10]||(b[10]=e("div",{class:"name"},"常见问题",-1)),(n(!0),v(B,null,K(f.value,F=>(n(),v("div",{class:"list-item",key:F},I(F),1))),128))])):U("",!0)]),b[13]||(b[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:za,alt:""})],-1))]),t(D,{open:a.value,"onUpdate:open":b[3]||(b[3]=F=>a.value=F),title:y.value,onOk:L,width:"476px"},{default:s(()=>[t(O,{class:"form-box",layout:"vertical"},{default:s(()=>[t(V,We({label:"问题名称"},$(c).question),{default:s(()=>[t(A,{maxLength:100,value:r.question,"onUpdate:value":b[2]||(b[2]=F=>r.question=F),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Ka=J(Ha,[["__scopeId","data-v-dce83f0d"]]),Wa={__name:"display-aitations",setup(z){const{robotInfo:_,updateRobotInfo:k}=X("robotInfo"),f=w(!1);fe(()=>_.answer_source_switch,i=>{f.value=i=="true"},{immediate:!0});const u=()=>{k({answer_source_switch:f.value?"true":"false"})};return(i,a)=>(n(),P(Oa,{title:"显示引文","icon-name":"jibenpeizhi",value:f.value,"onUpdate:value":a[0]||(a[0]=y=>f.value=y),onChange:u},{extra:s(()=>a[1]||(a[1]=[e("span",null,null,-1)])),default:s(()=>[a[2]||(a[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1,__:[2]},8,["value"]))}},Za={__name:"show-like",setup(z){const{robotInfo:_,updateRobotInfo:k}=X("robotInfo"),f=u=>{k({})};return(u,i)=>{const a=ne;return n(),P(te,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:s(()=>i[1]||(i[1]=[e("span",null,null,-1)])),default:s(()=>[i[2]||(i[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),t(a,{onChange:f,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:$(_).feedback_switch,"onUpdate:checked":i[0]||(i[0]=y=>$(_).feedback_switch=y),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[2]})}}},Ya=J(Za,[["__scopeId","data-v-73894b10"]]),Xa={class:"content-box"},er={key:0,class:"add-btn-block"},tr={class:"list-content"},or={key:0,class:"user-block"},sr={class:"name-box"},nr={class:"name"},ir={class:"remark-text"},lr={key:0,class:"hover-btn-box"},ar={key:0},rr={key:1},dr={key:2},_r={key:1,class:"hover-btn-box"},cr={class:"role-menu-box"},ur=["onClick"],pr={class:"menu-header"},mr={key:0,class:"check-box"},vr=["onClick"],fr={class:"menu-header"},br={key:0,class:"check-box"},hr=["onClick"],yr={class:"menu-header"},kr={key:0,class:"check-box"},gr={class:"hover-btn-box"},xr={key:0},$r={key:1},wr={key:2},qr=["onClick"],Sr={__name:"role-permission",setup(z){const _=Ut(),k=de(()=>_.user_name),f=He().query,u=w(Rt(f.id)),i=w([]),a=G({object_id:f.id,object_type:1}),y=()=>{Zt({...a}).then(o=>{let h=o.data||[];i.value=h})};y();const r=w(null),l=()=>{r.value.show(i.value,[{object_id:+f.id,object_type:1,operate_rights:4}])},x=(o,h)=>{let q=h==4?"管理":h==2?"编辑":"查看";Y.confirm({title:"提示?",icon:t(Ae),content:"确认修改该协作者权限为【"+q+"】",okText:"确认",cancelText:"取消",onOk:()=>{let L=[{object_id:+o.object_id,object_type:+o.object_type,operate_rights:+h}];Yt({identity_ids:o.identity_id,identity_type:o.identity_type,object_array:JSON.stringify(L)}).then(p=>{W.success("修改成功"),y()})},onCancel(){}})},d=o=>{Y.confirm({title:"提示?",icon:t(Ae),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{Xt({identity_id:o.identity_id,identity_type:o.identity_type,object_id:o.object_id,object_type:o.object_type}).then(h=>{W.success("删除成功"),y()})},onCancel(){}})},c=w([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(o,h)=>{const q=oe,L=to,p=so,C=no,R=Me;return n(),P(R,null,{default:s(()=>[e("div",Xa,[u.value==4?(n(),v("div",er,[t(q,{type:"primary",onClick:l,icon:Ke($(Re))},{default:s(()=>h[0]||(h[0]=[S("添加协助者")])),_:1,__:[0]},8,["icon"])])):U("",!0),e("div",tr,[t(C,{columns:c.value,"data-source":i.value,pagination:!1},{bodyCell:s(({column:b,record:E})=>[b.key==="name"?(n(),v("div",or,[t(L,{shape:"square",src:E.avatar,size:40},{icon:s(()=>[E.avatar?U("",!0):(n(),P($(Je),{key:0}))]),_:2},1032,["src"]),e("div",sr,[e("div",nr,I(E.user_name),1),e("div",ir,I(E.name),1)])])):U("",!0),b.key==="operate_rights"?(n(),v(B,{key:1},[u.value==2||E.user_name==k.value?(n(),v("div",lr,[E.operate_rights==4?(n(),v("span",ar,"管理")):U("",!0),E.operate_rights==2?(n(),v("span",rr,"编辑")):U("",!0),E.operate_rights==1?(n(),v("span",dr,"查看")):U("",!0)])):E.role_type==1||E.is_creator==1?(n(),v("div",_r,"管理")):(n(),P(p,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:s(()=>[e("div",cr,[e("div",{class:"role-menu",onClick:H=>x(E,4)},[e("div",pr,[t($(Je)),h[1]||(h[1]=e("span",{class:"title"},"管理",-1))]),h[2]||(h[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),E.operate_rights==4?(n(),v("div",mr,[t($(Oe))])):U("",!0)],8,ur),e("div",{class:"role-menu",onClick:H=>x(E,2)},[e("div",fr,[t($(ct)),h[3]||(h[3]=e("span",{class:"title"},"编辑",-1))]),h[4]||(h[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),E.operate_rights==2?(n(),v("div",br,[t($(Oe))])):U("",!0)],8,vr),e("div",{class:"role-menu",onClick:H=>x(E,1)},[e("div",yr,[t($(oo)),h[5]||(h[5]=e("span",{class:"title"},"查看",-1))]),h[6]||(h[6]=e("div",{class:"desc"},"仅查看",-1)),E.operate_rights==1?(n(),v("div",kr,[t($(Oe))])):U("",!0)],8,hr)])]),default:s(()=>[e("div",gr,[E.operate_rights==4?(n(),v("span",xr,"管理")):U("",!0),E.operate_rights==2?(n(),v("span",$r,"编辑")):U("",!0),E.operate_rights==1?(n(),v("span",wr,"查看")):U("",!0),t($(it))])]),_:2},1024))],64)):U("",!0),b.key==="action"?(n(),v(B,{key:2},[u.value==4&&E.user_name!=k.value?(n(),v(B,{key:0},[E.role_type!=1&&E.is_creator!=1?(n(),v("a",{key:0,onClick:H=>d(E)},"移除",8,qr)):U("",!0)],64)):U("",!0)],64)):U("",!0)]),_:1},8,["columns","data-source"])])]),t(eo,{onOk:y,ref_key:"addCollaboratorRef",ref:r},null,512)]),_:1})}}},Cr=J(Sr,[["__scopeId","data-v-64f2a2fa"]]),Lr={class:"library-checkbox-box"},Ir={class:"list-box",ref:"scrollContainer"},Ur={class:"library-name"},Rr={key:0,class:"library-desc"},Er={class:"library-desc"},Or={key:0,class:"empty-box"},Ar={__name:"robot-select-alert",emits:["change"],setup(z,{expose:_,emit:k}){const f=k,u=G({indeterminate:!1,checkAll:!1,checkedList:[]}),i=w(!1),a=c=>{x(),u.checkedList=c,i.value=!0},y=()=>{i.value=!1,l()};w("");const r=w([]),l=()=>{f("change",[...u.checkedList])},x=async()=>{const c=await Xe({application_type:1});if(c){let o=c.data||[];r.value=o}},d=w(!1);return _({open:a}),(c,o)=>{const h=Ne,q=Pe,L=Ue,p=Y;return n(),P(p,{width:"746px",open:i.value,"onUpdate:open":o[1]||(o[1]=C=>i.value=C),title:"添加技能",onOk:y},{default:s(()=>[e("div",Lr,[t(L,{spinning:d.value,delay:100},{default:s(()=>[t(q,{value:u.checkedList,"onUpdate:value":o[0]||(o[0]=C=>u.checkedList=C),style:{width:"100%"}},{default:s(()=>[e("div",Ir,[(n(!0),v(B,null,K(r.value,C=>(n(),v("div",{class:"list-item-wraapper",key:C.id},[t(h,{class:"list-item",disabled:C.start_node_key==="",value:C.id},{default:s(()=>[e("div",Ur,[S(I(C.robot_name)+" ",1),C.start_node_key===""?(n(),v("span",Rr," (未发布)")):U("",!0)]),e("div",Er,I(C.robot_intro),1)]),_:2},1032,["disabled","value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!d.value&&!r.value.length?(n(),v("div",Or,o[2]||(o[2]=[e("img",{src:_t,alt:""},null,-1),e("div",null,"暂无数据表, 请先去添加数据表",-1)]))):U("",!0)])]),_:1},8,["open"])}}},jr=J(Ar,[["__scopeId","data-v-99f68955"]]),Mr={class:"actions-box"},zr={key:0,class:"library-list"},Dr=["onClick"],Pr={class:"library-name"},Nr={class:"library-intro"},Vr={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(z){const _=w(!1),{robotInfo:k,getRobot:f}=X("robotInfo"),u=z,i=G({work_flow_ids:[]}),a=w(null),y=de(()=>u.robotList.filter(c=>i.work_flow_ids.includes(c.id))),r=c=>{let o=i.work_flow_ids.indexOf(c.id);i.work_flow_ids.splice(o,1),d()},l=c=>{i.work_flow_ids=[...c],d()},x=()=>{a.value.open([...i.work_flow_ids])},d=()=>{let c={...Z(i)};c.work_flow_ids=c.work_flow_ids.join(","),At({id:k.id,...c}).then(o=>{W.success("保存成功"),f(k.id)})};return Ie(()=>{i.work_flow_ids=k.work_flow_ids.split(",")}),(c,o)=>{const h=se,q=oe,L=xe;return n(),P(te,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:_.value,"onUpdate:isEdit":o[0]||(o[0]=p=>_.value=p),bodyStyle:{padding:0}},{tip:s(()=>[t(h,{placement:"top"},{title:s(()=>o[1]||(o[1]=[e("span",null,"支持关联工作流",-1)])),default:s(()=>[t($(ee))]),_:1})]),extra:s(()=>[e("div",Mr,[t(L,{gap:8},{default:s(()=>[t(q,{size:"small",onClick:x},{default:s(()=>o[2]||(o[2]=[S("添加技能")])),_:1,__:[2]})]),_:1})])]),default:s(()=>[y.value.length>0?(n(),v("div",zr,[(n(!0),v(B,null,K(y.value,p=>(n(),v("div",{class:"library-item",key:p.id},[e("span",{class:"close-btn",onClick:C=>r(p)},[t($(be))],8,Dr),e("div",Pr,I(p.robot_name),1),e("div",Nr,I(p.robot_intro),1)]))),128))])):U("",!0),t(jr,{ref_key:"robotSelectAlertRef",ref:a,onChange:l},null,512)]),_:1},8,["isEdit"])}}},Tr=J(Vr,[["__scopeId","data-v-e0ced8ed"]]),Br={key:0,class:"robot-config-page"},Qr={class:"setting-box"},Fr={class:"setting-box"},Jr={class:"setting-box"},Gr={class:"setting-box"},Hr={class:"setting-box"},Kr={class:"setting-box"},Wr={class:"setting-box"},Zr={class:"setting-box"},Yr={class:"setting-box"},Xr={class:"setting-box"},ed={class:"setting-box"},td={class:"setting-box"},od={class:"setting-box"},sd={class:"setting-box"},nd={key:1,class:"robot-config-page"},id={key:2,class:"robot-config-page"},ld={__name:"index",setup(z){const _=Wt(),k=w(null),{robotInfo:f}=kt(_),{getRobot:u}=_,i=()=>{k.value.scrollTop=k.value.scrollHeight},a=w(1),y=w(!1),r=G(f.value),l=o=>{let h=JSON.parse(JSON.stringify(o));o.robot_avatar&&(h.robot_avatar=new File([o.robot_avatar],o.robot_avatar.name)),Object.assign(r,h),c()},x=w([]);(()=>{Xe({application_type:1}).then(o=>{x.value=o.data||[]})})(),gt("robotInfo",{robotInfo:r,updateRobotInfo:l,scrollBoxToBottom:i,getRobot:u});const c=()=>{let o;r.robot_avatar&&(o=new File([r.robot_avatar],r.robot_avatar.name));let h=JSON.parse(JSON.stringify(Z(r)));o&&(h.robot_avatar=o);let q=h.welcomes;q.question=q.question.map(p=>p.content),h.welcomes=JSON.stringify(q),h.prompt_struct=JSON.stringify(h.prompt_struct);let L=h.unknown_question_prompt;L.question=L.question.map(p=>p.content),h.unknown_question_prompt=JSON.stringify(L),delete h.robot_avatar_url,y.value=!0,jt(h).then(p=>{if(p.res!=0)return W.error(p.msg);y.value=!1,W.success("保存成功"),u(r.id)}).catch(()=>{y.value=!1})};return(o,h)=>{const q=st,L=nt;return n(),v(B,null,[t(L,{class:"tab-wrapper",activeKey:a.value,"onUpdate:activeKey":h[0]||(h[0]=p=>a.value=p)},{default:s(()=>[(n(),P(q,{key:1,tab:"基础配置"})),(n(),P(q,{key:3,tab:"权限管理"})),(n(),P(q,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),a.value==1?(n(),v("div",Br,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:k},[e("div",Qr,[t(Ro)]),e("div",Fr,[t(nl)]),e("div",Jr,[t(Jn)]),e("div",Gr,[t(ga)]),e("div",Hr,[t(rn,{robotList:x.value},null,8,["robotList"])]),e("div",Kr,[t(Tr,{robotList:x.value},null,8,["robotList"])]),e("div",Wr,[t(hl)]),e("div",Zr,[t(Il)]),e("div",Yr,[t(Nl)]),e("div",Xr,[t(Xl)]),e("div",ed,[t(Gl)]),e("div",td,[t(Zl)]),e("div",od,[t(Wa)]),e("div",sd,[t(Ya)])],512)])):U("",!0),a.value==2?(n(),v("div",nd,[t(Ka)])):U("",!0),a.value==3?(n(),v("div",id,[t(Cr)])):U("",!0)],64)}}},j_=J(ld,[["__scopeId","data-v-b61909e4"]]);export{j_ as default};
