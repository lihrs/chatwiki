import{b as $e,B as qt,bv as mn,d as We,M as be,dj as vn,W as gn,E as Ie,$ as hn,dn as Ot,dp as Et,k as ve,dv as It,dy as Tt,bW as kn,bN as yn,bO as Rt,dz as bn,bP as Sn,bQ as wn,bS as xn,dA as Cn,e as Mt,dB as $n,a2 as Ln,bs as qn,h as On,dC as En,di as xt,dD as In,dE as Tn,bR as Rn}from"../../index-DDbybdOX.js";import{N as g,O as l,X as n,j as t,U as o,u as ae,d as u,z as qe,q as He,a6 as B,_ as Z,F as pe,a1 as xe,x as Je,a3 as Be,b as ke,D as Pt,ag as ot,Z as T,Y as De,a0 as ye,H as lt,S as U,a5 as Dt,a2 as Ft,a7 as Mn}from"./vue-chunks-BRsu9_To.js";import{_ as Pn}from"./empty-CzGZrENG.js";import{P as zt}from"./PlusOutlined-DxwPJnPR.js";import{S as Ge,a as Nt,c as Ve,C as At,b as Dn,E as Fn}from"./edit-subsection-CT55JiZb.js";import{Z as zn,f as Nn,a as An,P as Hn,H as Bn,C as Un,b as jn}from"./cu-scroll-Bl-IlFJ5.js";import{S as Ue}from"./index-DQhfEGeI.js";import{M as st,_ as it}from"./index-CEgtvWQl.js";import{S as Ht}from"./SettingOutlined-DZIK9oZ8.js";import"./index-mTXfSjnp.js";import{D as rt}from"./dropdown-Bd02-ETx.js";import{S as Bt}from"./SyncOutlined-Bj2Nc-Hc.js";import{M as Ut}from"./MoreOutlined-C4cNqrdW.js";import{_ as Ze}from"./index-QtALLQFU.js";import{_ as Ae}from"./cu-scroll-DYkc5Wqz.js";import{F as Qn,_ as Jn}from"./index-BoKpd4Su.js";import{S as jt,a as Qt}from"./index-D1-T_LNn.js";import{R as Gn}from"./rename-modal-Bgwayl10.js";import{V as Ct}from"./vue3-pdf-embed-BUNF_9cG.js";import{S as Vn,a as Wn,D as Zn,E as Kn}from"./edit-fragment-alert-D13_aExb.js";import{C as Xn}from"./ClockCircleFilled-CWwD5kks.js";import{_ as Yn,a as ea}from"./index-Bqa1pM_h.js";import{B as ta,_ as na}from"./index-BsOaLj8j.js";import{L as aa}from"./LeftOutlined-DsPQxSWK.js";import{S as oa}from"./index-DGhPrh2o.js";import{T as la,_ as sa}from"./index-Lf--c9Q3.js";import{D as $t}from"./DownOutlined-CZgAT6ZI.js";import{_ as ia,a as ra}from"./RadioButton-e3LPvyDr.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./index-UnEC9AyA.js";import"./Input-B_j-VXB9.js";import"./FormItemContext-TDgu36NB.js";import"./index-jhzcGD5Z.js";import"./inputProps-CvodEnI-.js";import"./Search-CeAVobAK.js";import"./SearchOutlined-BC_LJr47.js";import"./isPlainObject-CVF2xtQS.js";import"./TextArea-BjyYZVKw.js";import"./index-BN8NtH5x.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-DwwgneBq.js";import"./index-Cpt4JNwC.js";import"./index-BJAnTmmb.js";import"./index-CE4fNwEl.js";import"./Trigger-D5Y4uzl5.js";import"./DownloadOutlined-BmgxE7Md.js";import"./CheckOutlined-CRMX4qhF.js";import"./collapseMotion-Brd6xpAT.js";import"./index-CbcQ1ico.js";import"./index-Cwb5QxND.js";import"./index-BMSQkwth.js";import"./index-CPUomHrq.js";import"./index-CWtBZ4FM.js";import"./UpOutlined-DP4GhiZr.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./shallowequal-C0xnIuy8.js";import"./slide-B4hiqfwi.js";import"./RightOutlined-D9Xt5P1b.js";import"./move-Cw4o9UBf.js";import"./colors-BxVN-WHk.js";import"./responsiveObserve-Dna7GBXr.js";import"./QuestionCircleOutlined-Cc7dIocD.js";import"./vue-pdf-embed-C6Q-qZ65.js";import"./model-select-BAYKe_g5.js";import"./index-BZF2MlwY.js";import"./index-RCJTj_yO.js";import"./index-qQEEnrOg.js";import"./index-Bs0PpTYg.js";import"./useMaxLevel-Clg9DEyU.js";import"./CaretDownFilled-5KzucDnQ.js";import"./index-CECVv8YK.js";import"./fromPairs-Dx9PT-t0.js";import"./index-BWugqzqL.js";import"./Checkbox-zAmuLCsz.js";import"./index-KnumPlZE.js";import"./CaretDownOutlined-sNQ7bAQ7.js";import"./pick-uOILUdHA.js";const ua={class:"empty-box"},ca={__name:"empty",props:{detailsInfo:{type:Object}},emits:["openEditSubscription"],setup(se,{emit:le}){const C=le,J=()=>{C("openEditSubscription",{})};return(m,_)=>{const c=qt;return l(),g("div",ua,[_[1]||(_[1]=n("img",{src:Pn,alt:""},null,-1)),_[2]||(_[2]=n("div",{class:"title"},"知识库文档为空，请添加分段",-1)),n("div",null,[t(c,{type:"primary",onClick:J},{icon:o(()=>[t(ae(zt))]),default:o(()=>[_[0]||(_[0]=n("span",null,"添加分段",-1))]),_:1,__:[0]})])])}}},at=$e(ca,[["__scopeId","data-v-16e77398"]]),da={class:"chart-wrapper"},_a={class:"zoom-toolbar-wrapper"},pa={__name:"chart-box",emits:["nodeClick"],setup(se,{expose:le,emit:C}){const J=C,m=u(null);let _=null;const c=qe({nodes:[],edges:[]}),M=u(1),P={},D=()=>{_&&_.destroy();const d={layout:"forceDirected",initialZoom:M.value,disableTelemetry:!0,maxZoom:10,minZoom:.1,minimapContainer:document.getElementById("chatMap"),styling:{minimapViewportBoxColor:"#4399FF",selectedBorderColor:"rgba(255, 255, 255, 1)"}},i=document.getElementById("chartBox");_=new Nn(i,c.nodes,c.edges,d,P);const y=new An(_);new Hn(_),y.updateCallback("onZoom",E=>{M.value=Number(E.toFixed(1))}),new Bn(_,{drawShadowOnHover:!0}),new Un(_,{selectOnClick:!0}).updateCallback("onNodeClick",E=>{J("nodeClick",E)})},L=d=>{M.value=d,_&&_.setZoom(d)},k=({nodes:d,edges:i})=>{c.nodes=[c.nodes,...d],c.edges=[c.edges,...i],_&&_.addElementsToGraph(d,i)},Y=({nodes:d,edges:i})=>{c.nodes=[c.nodes,...d],c.edges=[c.edges,...i],_&&_.addAndUpdateElementsInGraph(d,i)},w=({nodes:d,edges:i})=>{c.nodes=d,c.edges=i,_&&_.updateElementsInGraph(d,i)},q=()=>{_&&_.destroy()},ee=({nodes:d,edges:i})=>{c.nodes=d,c.edges=i,D()};return He(()=>{}),le({render:ee,add:k,addAndUpdate:Y,update:w,destroy:q}),(d,i)=>(l(),g("div",da,[n("div",{class:"chart",id:"chartBox",ref_key:"chartBox",ref:m},null,512),i[0]||(i[0]=n("div",{class:"chart-mini-map",id:"chatMap"},null,-1)),n("div",_a,[t(zn,{value:M.value,onChange:L},null,8,["value"])])]))}},fa=$e(pa,[["__scopeId","data-v-04d10c54"]]),ma={key:0,class:"popup-wrapper entity-details-wrapper"},va={class:"popup-header"},ga={key:0,class:"popup-body"},ha={class:"popup-content"},ka={class:"entity-details"},ya={class:"entity-item"},ba={class:"entity-name"},Sa={class:"entity-item",style:{"margin-bottom":"8px"}},wa={class:"file-info"},xa={class:"file-name"},Ca={class:"entity-item"},$a={class:"doc-item"},La={class:"fragment-content"},qa={class:"entity-item"},Oa={key:0,class:""},Ea={class:"fragment-content"},Ia={__name:"entity-details",setup(se,{expose:le}){const C=qe({show:!1,node:null,fromNodes:[]}),J=()=>{C.show=!1};return le({open:(_,c)=>{C.node=_,C.fromNodes=c,C.show?(C.show=!1,Je(()=>{C.show=!0})):C.show=!0},close:J}),(_,c)=>{const M=We;return C.show?(l(),g("div",ma,[n("div",va,[c[0]||(c[0]=n("div",{class:"popup-title"},"实体详情",-1)),t(ae(mn),{class:"close-btn",onClick:J})]),C.node?(l(),g("div",ga,[t(jn,null,{default:o(()=>[n("div",ha,[n("div",ka,[n("div",ya,[c[1]||(c[1]=n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"实体")],-1)),n("div",ba,Z(C.node.name),1)]),n("div",Sa,[c[2]||(c[2]=n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"归属文档")],-1)),n("div",wa,[t(M,{class:"file-icon",name:"doc-file",style:{}}),n("span",xa,Z(C.node.file_name),1)])]),n("div",Ca,[c[3]||(c[3]=n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"分段")],-1)),n("div",null,[n("div",$a,[n("div",La,Z(C.node.content),1)])])]),n("div",qa,[c[4]||(c[4]=n("div",{class:"entity-item-header"},[n("div",{class:"entity-item-label"},"子图")],-1)),n("div",null,[C.fromNodes.length==0?(l(),g("div",Oa,"无")):B("",!0),(l(!0),g(pe,null,xe(C.fromNodes,P=>(l(),g("div",{class:"subgraph-item",key:P.id},[n("div",Ea,Z(P.name),1)]))),128))])])])])]),_:1})])):B("",!0)])):B("",!0)}}},Ta=$e(Ia,[["__scopeId","data-v-a19c97a9"]]),Ra={class:"graph-model-body"},Ma={key:0,class:"loading-wrapper"},Pa={class:"right-box"},Da={__name:"index",setup(se,{expose:le}){const C=u(!1),J=u(null),m=u(null),_=u(null),c=u(!1),M=qe({file_id:"",data_id:""}),P=qe({edges:[],nodes:[]});let D={};const L=()=>{k()},k=()=>{c.value=!0,vn({file_id:M.file_id,data_id:M.data_id,search_term:M.search_term}).then(d=>{c.value=!1;let i=d.data.edges||[],y=d.data.nodes||[];const h=new Map;i=i.filter(b=>{const ge=`${b.from_id}_${b.to_id}`,ie=`${b.to_id}_${b.from_id}`;return h.has(ge)||h.has(ie)?!1:(h.set(ge,!0),!0)}),i.forEach(b=>{b.id=b.id.toString(),b.from=b.from_id.toString(),b.to=b.to_id.toString(),b.caption=b.label});const E=new Set(i.map(b=>b.from)),te=new Set(i.map(b=>b.to));y.forEach(b=>{b.caption=b.name,b.id=b.id.toString(),b.nodeType=E.has(b.id)&&te.has(b.id)?"both":E.has(b.id)?"from":te.has(b.id)?"to":"normal",b.nodeType==="from"?(b.size=35,b.color="#FFB1B2"):b.nodeType==="to"?(b.size=45,b.color="#005AFF"):(b.size=30,b.color="#69E9BE")});let fe={edges:i,nodes:y};P.edges=fe.edges,P.nodes=fe.nodes,setTimeout(()=>{m.value.render(fe)},0),D={},i.forEach(b=>{D[b.to]||(D[b.to]=[]),D[b.to].push(b.from)})}).catch(d=>{c.value=!1})},Y=d=>{let i=D[d.id]||[],y=[];for(let h=0;h<P.nodes.length;h++)i.indexOf(P.nodes[h].id)>-1&&y.push(P.nodes[h]);_.value.open(d,y)},w=()=>{m.value.destroy(),C.value=!1},q=()=>{C.value=!1};return le({open:d=>{M.file_id=d.file_id,M.data_id=d.id,C.value=!0,setTimeout(()=>{L()},350)}}),(d,i)=>{const y=Ue,h=be;return l(),g("div",{ref_key:"mymodal",ref:J},[t(h,{wrapClassName:"graph-model-wrapper",zIndex:99999,centered:"",open:C.value,"onUpdate:open":i[0]||(i[0]=E=>C.value=E),title:"知识图谱",width:"90vw",footer:null,onOk:q,onCancel:w},{default:o(()=>[n("div",Ra,[c.value?(l(),g("div",Ma,[t(y)])):B("",!0),t(fa,{ref_key:"chartBoxRef",ref:m,loading:c.value,onNodeClick:Y},null,8,["loading"]),n("div",Pa,[t(Ta,{ref_key:"entityDetailsRef",ref:_},null,512)])])]),_:1},8,["open"])],512)}}},Fa=$e(Da,[["__scopeId","data-v-2b594227"]]),za={class:"subsection-box-title"},Na=["onClick"],Aa={class:"top-block"},Ha={class:"title"},Ba={class:"title-block"},Ua={class:"status-box"},ja={class:"cfb363f"},Qa={class:"split-err"},Ja={key:0},Ga={class:"cfb363f"},Va={class:"right-opration"},Wa={class:"hover-btn-box"},Za=["onClick"],Ka=["onClick"],Xa=["onClick"],Ya={class:"hover-btn-box"},eo={class:"hover-btn-box"},to=["onClick"],no=["onClick"],ao={key:0,class:"content-box"},oo={key:1,class:"content-box"},lo=["onMouseup","innerHTML"],so={key:2,class:"fragment-img"},io=["src"],ro={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},detailsInfo:{type:Object,default:()=>{}},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList","handleSplit","handleSplitNext","handleSplitUp","handleSplitDelete","handleSegmentation"],setup(se,{expose:le,emit:C}){const J=Be(),m=C,_=se,c=(f,r)=>{let{id:N,title:I,content:K,question:X,answer:Q,images:re,category_id:p}=f,ue=f.similar_questions||[];be.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${r+1}】吗?`,onOk(){return new Promise(F=>{It({id:N,title:I,content:K,question:X,answer:Q,images:re,category_id:p,similar_questions:JSON.stringify(ue)}).then(()=>{m("handleConvert",f),F()}).catch(()=>{F()})})},onCancel(){}})},M=f=>{m("openEditSubscription",f)},P=f=>{be.confirm({title:"提示",icon:t(Ie),content:"确认是否删除该分段?",onOk(){return new Promise(r=>{Tt({id:f}).then(()=>{ve.success("删除成功"),m("handleDelParagraph",f),r()}).catch(()=>{r()})})},onCancel(){}})},D=(f,r,N)=>{window.getSelection().toString().trim()||(m("handleScrollTargetPage",{page_num:f.page_num,index:r}),Ce(N))},L=f=>{m("handleSegmentation",f)},k=u([]),Y=()=>{let f={file_id:J.query.id};Ot(f).then(r=>{k.value=r.data||[],m("getStatrList",r.data||[])})};Y();const w=u(null),q=()=>{w.value.show()},ee=f=>{var N;let r=(N=k.value.filter(I=>I.id==f.category_id)[0])==null?void 0:N.type;return r?Ve[r]:""},d=(f,r={})=>{Et({id:f.id,category_id:r.id||0}).then(()=>{ve.success("设置成功"),f.category_id=r.id,Y()})},i=u(null),y=f=>{i.value.open(f)},h=u(null),E=u(!1),te=u({x:0,y:0}),fe=u(""),b=u(null),ge=u({text:"",parentIndex:-1,originalHtml:""}),ie=ke(()=>{if(!E.value)return{};const f=162;let r=te.value.x,N=te.value.y;const I=h.value.getBoundingClientRect(),K=window.innerWidth;r<10?r=10:r+f>K-50&&(r=K-f-50);const X=r-I.left,Q=N;return{left:`${X}px`,top:`${Q}px`}}),H=(f,r)=>{setTimeout(()=>{const N=window.getSelection(),I=N.toString().trim();if(I){f.stopPropagation(),ge.value={text:I,parentIndex:r,originalHtml:_.paragraphLists[r].content},fe.value=I,b.value=N.getRangeAt(0).cloneRange();const X=N.getRangeAt(0).getBoundingClientRect(),Q=h.value.getBoundingClientRect();te.value={x:X.left+X.width/2,y:X.top-Q.top-50},E.value=!0}else E.value=!1},50)},z=f=>{const{parentIndex:r}=ge.value;switch(f){case"separate":Se(r);break;case"merge-next":x(r);break;case"merge-prev":me(r);break;case"delete":Re(r);break}E.value=!1,window.getSelection().removeAllRanges()},j=(f,r,N)=>{if(r===0&&N===f.textContent.length&&f.textContent.trim().length>0)return["",f.innerHTML,""];const K=document.createTreeWalker(f,NodeFilter.SHOW_TEXT);let X,Q=0,re,p,ue,F;for(;X=K.nextNode();){const Ee=X.nodeValue.length;if(!re&&Q+Ee>=r&&(re=X,ue=r-Q),!p&&Q+Ee>=N){p=X,F=N-Q;break}Q+=Ee}const we=document.createRange();we.setStart(re,ue),we.setEnd(p,F);const Oe=document.createRange();Oe.setStart(f,0),Oe.setEnd(re,ue);const Le=document.createRange();return Le.setStart(p,F),Le.setEnd(f,f.childNodes.length),[G(Oe),G(we),G(Le)]},G=f=>{const r=document.createElement("div");return r.appendChild(f.cloneContents()),r.innerHTML},Se=f=>{const r=_.paragraphLists[f].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:"单独分段",icon:t(Ie),content:"确认将该分段内容单独分段么？分段后，原分段的内容会被删除",onOk(){const X=document.createElement("div");X.innerHTML=r;const[Q,re,p]=j(X,I.startOffset,I.endOffset),ue=Q.replace(/<[^>]+>/g,"").trim()==="",F=p.replace(/<[^>]+>/g,"").trim()==="";ue&&F?m("handleSplit",{index:f,beforeContent:"",selectedContent:re,afterContent:"",isFullSelection:!0}):m("handleSplit",{index:f,beforeContent:Q,selectedContent:re,afterContent:p,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:f}})}})},x=f=>{if(f>=_.paragraphLists.length-1)return ve.error("没有下一个分段");const r=_.paragraphLists[f].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:"合并到下一个分段",icon:t(Ie),content:"确认将该分段内容合并到下一个分段么？分段后，原分段的内容会被删除",onOk(){const X=document.createElement("div");X.innerHTML=r;const[Q,re,p]=j(X,I.startOffset,I.endOffset),ue=Q.replace(/<[^>]+>/g,"").trim()==="",F=p.replace(/<[^>]+>/g,"").trim()==="";ue&&F?m("handleSplitNext",{index:f,beforeContent:"",selectedContent:re,afterContent:"",isFullSelection:!0}):m("handleSplitNext",{index:f,beforeContent:Q,selectedContent:re,afterContent:p,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:f}})}})},me=f=>{if(f<=0)return ve.error("没有上一个分段");const r=_.paragraphLists[f].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:"合并到上一个分段",icon:t(Ie),content:"确认将该分段内容合并到上一个分段么？分段后，原分段的内容会被删除",onOk(){const X=document.createElement("div");X.innerHTML=r;const[Q,re,p]=j(X,I.startOffset,I.endOffset),ue=Q.replace(/<[^>]+>/g,"").trim()==="",F=p.replace(/<[^>]+>/g,"").trim()==="";ue&&F?m("handleSplitUp",{index:f,beforeContent:"",selectedContent:re,afterContent:"",isFullSelection:!0}):m("handleSplitUp",{index:f,beforeContent:Q,selectedContent:re,afterContent:p,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:f}})}})},Re=f=>{const r=_.paragraphLists[f].content,I=window.getSelection().getRangeAt(0);I.toString()&&be.confirm({title:"删除",icon:t(Ie),content:"确认将该分段内容删除么？",onOk(){const X=document.createElement("div");X.innerHTML=r;const[Q,re,p]=j(X,I.startOffset,I.endOffset),ue=Q.replace(/<[^>]+>/g,"").trim()==="",F=p.replace(/<[^>]+>/g,"").trim()==="";ue&&F?m("handleSplitDelete",{index:f,beforeContent:"",selectedContent:"",afterContent:"",isFullSelection:!0}):m("handleSplitDelete",{index:f,beforeContent:Q,selectedContent:"",afterContent:p,originalSelection:{start:I.startOffset,end:I.endOffset,parentIndex:f}})}})},Ce=f=>{E.value&&!f.target.closest(".bubble-card")&&(E.value=!1)};return He(()=>{document.addEventListener("click",Ce)}),Pt(()=>{document.removeEventListener("click",Ce)}),le({handleOpenEditModal:M}),(f,r)=>{const N=Ze,I=it,K=st,X=rt,Q=We,re=ot("viewer");return l(),g("div",{class:"subsection-box content-container",ref_key:"containerRef",ref:h},[n("div",za,[r[4]||(r[4]=T(" 分段预览 ")),n("span",null,"共"+Z(_.total)+"个分段",1)]),(l(!0),g(pe,null,xe(_.paragraphLists,(p,ue)=>(l(),g("div",{class:"list-item",key:p.id,onClick:ye(F=>D(p,ue,F),["stop"]),style:De({"--status-color":ee(p)})},[n("div",Aa,[n("div",Ha,[T(" 分段"+Z(ue+1)+" ",1),n("div",Ba,Z(p.title),1),n("span",null,"共"+Z(p.word_total)+"个字符",1),n("span",Ua,[T(" 嵌入状态："+Z(p.status_text),1),p.status==3?(l(),U(ae(gn),{key:0})):B("",!0),p.status==2&&p.errmsg?(l(),U(N,{key:1,title:p.errmsg},{default:o(()=>[n("strong",ja,[r[5]||(r[5]=T("原因")),t(ae(Ie),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):B("",!0),p.split_status==4&&p.split_err_msg?(l(),U(N,{key:2,title:p.split_err_msg},{default:o(()=>[n("div",Qa,[t(ae(hn),{style:{"margin-left":"0"},class:"cfb363f"}),r[6]||(r[6]=T(" 分段失败 "))])]),_:2},1032,["title"])):B("",!0)]),se.detailsInfo.graph_switch?(l(),g("span",Ja,[T(" 知识图谱状态："+Z(p.graph_status_text)+" ",1),p.graph_status==3&&p.graph_err_msg?(l(),U(N,{key:0,title:p.graph_err_msg},{default:o(()=>[n("strong",Ga,[r[7]||(r[7]=T("原因")),t(ae(Ie),{class:"err-icon cfb363f"})])]),_:2},1032,["title"])):B("",!0)])):B("",!0)]),n("div",Va,[t(X,null,{overlay:o(()=>[t(K,null,{default:o(()=>[(l(!0),g(pe,null,xe(k.value,F=>(l(),U(I,{key:F.id},{default:o(()=>[n("div",{class:"start-item",onClick:ye(we=>d(p,F),["stop"])},[t(ae(Ge),{style:De({color:ae(Ve)[F.type]})},null,8,["style"]),n("div",null,Z(F.name||"-"),1)],8,Za)]),_:2},1024))),128)),t(I,null,{default:o(()=>[n("div",{class:"start-item",onClick:ye(q,["stop"])},[t(ae(Ht)),r[8]||(r[8]=n("div",null,"精选设置",-1))])]),_:1})]),_:2},1024)]),default:o(()=>[n("div",Wa,[p.category_id>0?(l(),U(ae(Ge),{key:0,onClick:ye(F=>d(p,{}),["stop"]),style:De({color:ee(p),"font-size":"16px"})},null,8,["onClick","style"])):(l(),U(ae(Nt),{key:1,onClick:F=>d(p,k.value[0]),style:{"font-size":"16px",color:"#595959"}},null,8,["onClick"]))])]),_:2},1024),t(N,null,{title:o(()=>r[9]||(r[9]=[T("重新分段")])),default:o(()=>[n("div",{class:"hover-btn-box",onClick:ye(F=>L(p),["stop"])},[t(Q,{name:"segmentation-icon",style:{"font-size":"16px"}})],8,Ka)]),_:2},1024),se.detailsInfo.graph_switch?(l(),U(N,{key:0},{title:o(()=>r[10]||(r[10]=[T("知识图谱")])),default:o(()=>[n("div",{class:"hover-btn-box",onClick:F=>y(p)},[t(Q,{name:"graph-icon",style:{"font-size":"16px",color:"#595959"}})],8,Xa)]),_:2},1024)):B("",!0),t(N,null,{title:o(()=>r[11]||(r[11]=[T("重新转换")])),default:o(()=>[n("div",Ya,[t(ae(Bt),{onClick:ye(F=>c(p,ue),["stop"])},null,8,["onClick"])])]),_:2},1024),t(X,{placement:"bottomRight"},{overlay:o(()=>[t(K,null,{default:o(()=>[t(I,null,{default:o(()=>[n("div",{onClick:ye(F=>M(p),["stop"])},"编辑",8,to)]),_:2},1024),t(I,null,{default:o(()=>[n("div",{onClick:ye(F=>P(p.id),["stop"])},"删除",8,no)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",eo,[t(ae(Ut),{style:{"font-size":"16px",color:"#595959"}})])]),_:2},1024)])]),p.question?(l(),g("div",ao,"Q："+Z(p.question),1)):B("",!0),p.answer?(l(),g("div",oo,"A："+Z(p.answer),1)):B("",!0),n("div",{class:"content-box",onMouseup:ye(F=>H(F,ue),["stop"]),innerHTML:p.content},null,40,lo),p.images.length>0?lt((l(),g("div",so,[(l(!0),g(pe,null,xe(p.images,(F,we)=>(l(),g("img",{key:we,src:F,alt:""},null,8,io))),128))])),[[re]]):B("",!0)],12,Na))),128)),t(At,{onOk:Y,ref_key:"classificationMarkModalRef",ref:w},null,512),t(Fa,{ref_key:"graphModelRef",ref:i},null,512),E.value?(l(),g("div",{key:0,class:"bubble-card",style:De(ie.value)},[n("button",{class:"bubble-item",onClick:r[0]||(r[0]=ye(p=>z("separate"),["stop"]))},[t(Q,{name:"segmentation",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),r[12]||(r[12]=T(" 单独成段 "))]),n("button",{class:"bubble-item",onClick:r[1]||(r[1]=ye(p=>z("merge-prev"),["stop"]))},[t(Q,{name:"segmentation-up",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),r[13]||(r[13]=T(" 合并到上一分段 "))]),n("button",{class:"bubble-item",onClick:r[2]||(r[2]=ye(p=>z("merge-next"),["stop"]))},[t(Q,{name:"segmentation-down",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),r[14]||(r[14]=T(" 合并到下一分段 "))]),n("button",{class:"bubble-item",onClick:r[3]||(r[3]=ye(p=>z("delete"),["stop"]))},[t(Q,{name:"delete",style:{"font-size":"16px",color:"#262626","margin-right":"4px"}}),r[15]||(r[15]=T(" 删除 "))])],4)):B("",!0)],512)}}},Lt=$e(ro,[["__scopeId","data-v-4a8db730"]]),uo={class:"mode-box"},co=["innerHTML"],_o={class:"tag-item"},po={__name:"segmentation-mode",props:{detailsInfo:{type:Object}},setup(se){const le=se,C=u(""),J=ke(()=>{const{is_table_file:m,is_qa_doc:_,is_diy_split:c,question_lable:M,answer_lable:P,separators:D,chunk_size:L,chunk_overlap:k,question_column:Y,answer_column:w,qa_index_type:q,doc_type:ee}=le.detailsInfo;if(m!=1&&_!=1&&c!=1)return ee==3?(C.value=`分段模式：手动分段
文档类型：普通文档`,"自定义：普通文档"):(C.value=`分段模式：智能分段
文档类型：普通文档`,"智能分段：普通文档");if(m!=1&&_==1)return ee==3?(C.value=`分段模式：手动分段
文档类型：QA文档`,"自定义：QA文档"):(C.value=`分段模式：智能分段
文档类型：QA文档
问题开始标识符："${M}"
答案开始标识符："${P}"`,"智能分段：QA文档");if(m!=1&&_!=1&&c==1)return C.value=`分段模式：自定义分段
文档标识符：${D}
分段最大长度：${L}字符
文段重叠长度：${k}字符`,"自定义分段";if(m==1&&_!=1)return C.value=`分段模式：智能分段
文档类型：普通表格`,"智能分段：普通表格";if(m==1&&_==1){let d=q==1?"问题与答案一起生成索引":"仅对问题生成索引";return C.value=`分段模式：智能分段
文档类型：QA文档
问题所在列："${Y}"
答案所在列："${w}"
索引方式：${d}`,"智能分段：QA文档"}});return(m,_)=>{const c=Ze;return l(),g("div",uo,[t(c,null,{title:o(()=>[n("div",{class:"tooltip-text-box",innerHTML:C.value},null,8,co)]),default:o(()=>[n("div",_o,Z(J.value),1)]),_:1})])}}},fo=$e(po,[["__scopeId","data-v-6ee0b31f"]]),mo={__name:"update-frequency",emits:["ok"],setup(se,{expose:le,emit:C}){const J=C,m=u(!1),_=u(!1),c=qe({doc_auto_renew_frequency:1,id:""}),M=D=>{let{doc_auto_renew_frequency:L,id:k}=D;c.doc_auto_renew_frequency=+L,c.id=k,m.value=!0},P=()=>{_.value=!0,kn({...c}).then(D=>{J("ok",c.doc_auto_renew_frequency),m.value=!1,ve.success("设置成功")}).finally(()=>{_.value=!1})};return le({open:M}),(D,L)=>{const k=Qt,Y=jt,w=Jn,q=Qn,ee=be;return l(),g("div",null,[t(ee,{open:m.value,"onUpdate:open":L[1]||(L[1]=d=>m.value=d),"confirm-loading":_.value,maskClosable:!1,title:"设置更新频率",onOk:P},{default:o(()=>[t(q,{style:{margin:"32px 0"},layout:"vertical",model:c},{default:o(()=>[t(w,{name:"doc_auto_renew_frequency",label:"更新频率",required:""},{default:o(()=>[t(Y,{value:c.doc_auto_renew_frequency,"onUpdate:value":L[0]||(L[0]=d=>c.doc_auto_renew_frequency=d),style:{width:"100%"}},{default:o(()=>[t(k,{value:1},{default:o(()=>L[2]||(L[2]=[T("不自动更新")])),_:1,__:[2]}),t(k,{value:2},{default:o(()=>L[3]||(L[3]=[T("每天")])),_:1,__:[3]}),t(k,{value:3},{default:o(()=>L[4]||(L[4]=[T("每3天")])),_:1,__:[4]}),t(k,{value:4},{default:o(()=>L[5]||(L[5]=[T("每7天")])),_:1,__:[5]}),t(k,{value:5},{default:o(()=>L[6]||(L[6]=[T("每30天")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}},vo={class:"loading"},go={__name:"pdf-preview",props:{source:{type:[String],required:!0},pageSize:{type:Number,default:10}},emits:["onScrollEnd","select","rendered","scroll","getTotalPage"],setup(se,{expose:le,emit:C}){const J=se,m=C,_=u(null),c=u([]),M=u(0),P=u(!1),D=ke(()=>P.value?null:{"border-bottom":"2px solid #d9d9d9"}),L=u({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40});He(async()=>{const i=await Ct.getDocument(J.source).promise;M.value=i.numPages,m("getTotalPage",M.value),k()});const k=(i=null)=>{const y=c.value.length;if(y>=M.value||P.value)return;P.value=!0;const h=[];for(let E=1;E<=J.pageSize&&y+E<=M.value;E++)h.push(y+E);c.value.push(...h),Je(()=>{typeof i=="function"&&i()})},Y=i=>{k(),m("onScrollEnd",i)},w=i=>{Je(()=>{i===c.value[c.value.length-1]&&(P.value=!1,m("rendered",i,M.value))})},q=i=>{m("select",i)},ee=()=>_.value,d=i=>{m("scroll",i)};return le({loadMore:k,getScrollInstance:ee}),(i,y)=>{const h=Ue;return l(),U(Ae,{scrollbar:L.value,ref_key:"scrollRef",ref:_,onScroll:d,onOnScrollEnd:Y},{default:o(()=>[(l(!0),g(pe,null,xe(c.value,E=>(l(),U(ae(Ct),{onClick:te=>q(E),key:E,source:se.source,page:E,onRendered:()=>w(E),style:De(D.value)},null,8,["onClick","source","page","onRendered","style"]))),128)),n("div",vo,[P.value?(l(),U(h,{key:0})):B("",!0)])]),_:1},8,["scrollbar"])}}},ho=$e(go,[["__scopeId","data-v-8ffdbe19"]]),ko={key:0,class:"loading-wrap"},yo={class:"document-segmentation"},bo={class:"page-container"},So={class:"page-left"},wo={class:"page-right"},xo={class:"document-fragment-preview"},Co={class:"preview-header"},$o={class:"fragment-number"},Lo={key:1,class:"loading-box"},qo="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Oo={__name:"document-segmentation-model",props:{pdfState:{type:Object,default:()=>{}},currentData:{type:Object,default:()=>{}},paragraphType:{type:String,default:""}},emits:["ok","finish","loading"],setup(se,{expose:le,emit:C}){const J=yn(),{setInitDocumentFragmentList:m}=J,_=Be(),c=C,{id:M}=_.query,P=u(!0),D=u(1);let L=!1;const k=se,Y=u(1);let w={id:M,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:qo,ai_chunk_task_id:""};const q=u(null),ee=s=>{typeof s.separators_no=="object"&&(s.separators_no=s.separators_no.join(",")),w={...w,...s},L?be.confirm({title:"提醒",icon:t(Ie),content:"文档片段已被编辑重新获取文档片段会丢失当前修改过的文档片段内容，确定要重新获取吗？",okText:"确定",okType:"danger",cancelText:"取消",onOk(){L=!1,me("create")},onCancel(){}}):(L=!1,me("create"))};let d=60*10,i=0;const y=u({}),h=u(0),E=()=>{P.value||(P.value=!0),Rt({id:M}).then(async s=>{const{status:O}=s.data;if(h.value=s.data.library_type,y.value=s.data,w={...w,separators_no:s.data.separators_no||"11,12",chunk_size:+s.data.chunk_size||512,ai_chunk_size:+s.data.ai_chunk_size||5e3,chunk_overlap:+s.data.chunk_overlap||50,is_qa_doc:h.value==2?1:0,question_lable:s.data.question_lable,answer_lable:s.data.answer_lable,question_column:s.data.question_column,answer_column:s.data.answer_column,enable_extract_image:s.data.enable_extract_image=="true",qa_index_type:+s.data.qa_index_type,chunk_type:+s.data.chunk_type,semantic_chunk_size:+s.data.semantic_chunk_size||512,semantic_chunk_overlap:+s.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+s.data.semantic_chunk_threshold||90,semantic_chunk_use_model:s.data.semantic_chunk_use_model||"",ai_chunk_prumpt:s.data.ai_chunk_prumpt||"",ai_chunk_model:s.data.ai_chunk_model||"",semantic_chunk_model_config_id:s.data.semantic_chunk_model_config_id>0?s.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:s.data.ai_chunk_model_config_id>0?s.data.ai_chunk_model_config_id:"",ai_chunk_task_id:s.data.ai_chunk_task_id||""},s.data.chunk_type==0&&(w={...w,separators_no:s.data.normal_chunk_default_separators_no,chunk_size:s.data.normal_chunk_default_chunk_size,chunk_overlap:s.data.normal_chunk_default_chunk_overlap,chunk_type:+s.data.default_chunk_type,semantic_chunk_size:+s.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+s.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+s.data.semantic_chunk_default_threshold,semantic_chunk_use_model:s.data.default_use_model||"",semantic_chunk_model_config_id:s.data.default_model_config_id>0?s.data.default_model_config_id:""}),O==0){if(i++,i>d){be.error({title:"提醒",content:"文档解析速度慢请稍后再试"});return}setTimeout(()=>{E()},1e3)}else(O==4||O==2)&&(P.value=!1,D.value=parseInt(s.data.is_table_file),s.data.library_id,h.value==2?(w.question_lable||w.question_column)&&me():me());s.data.is_table_file==1&&fe()})};He(async()=>{await E()});const te=u([]),fe=()=>{wn({id:M}).then(s=>{let O=[];for(let ne in s.data)O.push({lable:s.data[ne],value:ne});te.value=O})},b=u([]),ge=u(!1),ie=u(!1),H=u(""),z=u(null);let j=null;const G=u([]),Se=u(0),x=ke(()=>Se.value<=0),me=s=>{var ce;c("loading",!0);let O={...w,semantic_chunk_model_config_id:w.semantic_chunk_model_config_id?+w.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:w.ai_chunk_model_config_id?+w.ai_chunk_model_config_id:0,...k.pdfState};w.chunk_type==3&&(w.ai_chunk_task_id&&!s&&(O.ai_chunk_task_id=w.ai_chunk_task_id),O.ai_chunk_task_id&&s&&s==="create"&&delete O.ai_chunk_task_id);let ne=Sn;return k.paragraphType&&k.paragraphType==="paragraphsSegmented"&&s=="create"&&(ne=Cn,delete O.id),k.paragraphType&&k.paragraphType==="paragraphsSegmented"&&!s?(G.value=k.currentData.list||[],Se.value=k.currentData.list.length,w.chunk_type==3&&(H.value=((ce=k.currentData.split_params)==null?void 0:ce.ai_chunk_task_id)||"",ie.value=!0,q.value.reLoading=!0,z.value=null,!w.ai_chunk_task_id&&D.value!=1||s&&s==="create"?(G.value=[],Se.value=0,r()):(ie.value=!1,q.value.reLoading=!1)),w.chunk_type!=3&&(q.value.reLoading=!1,q.value.saveLoading=!1),c("loading",!1),!1):ne(O).then(_e=>{var Te;b.value=_e.data.list||[],m(b.value),G.value=_e.data.list||[],Se.value=_e.data.list.length||0,w.chunk_type==3&&(H.value=((Te=_e.data.split_params)==null?void 0:Te.ai_chunk_task_id)||"",ie.value=!0,q.value.reLoading=!0,q.value.saveLoading=!0,z.value=null,!w.ai_chunk_task_id&&D.value!=1||s&&s==="create"?(G.value=[],Se.value=0,r()):(ie.value=!1,q.value.reLoading=!1,q.value.saveLoading=!1))}).finally(()=>{w.chunk_type!=3&&(q.value.reLoading=!1,q.value.saveLoading=!1),c("loading",!1)})},Re=s=>{Y.value=s},Ce=async()=>{var s;try{const O=await N();return O.data.err_msg?(z.value=O.data.err_msg,!0):((s=O.data.list)==null?void 0:s.length)>0?(b.value=O.data.list||[],m(b.value),G.value=O.data.list||[],Se.value=O.data.list.length||0,!0):!1}catch{return z.value="请求异常，停止轮询",!0}};function f(s){return s.split("message:")[1]}const r=()=>{const s=async()=>{if(!await Ce())j=setTimeout(s,3e3);else if(ie.value=!1,q.value.reLoading=!1,q.value.saveLoading=!1,j!==null&&(clearTimeout(j),j=null),ge.value&&Le(),z.value){let ne=f(z.value);be.error({title:"分段失败提示",content:ne?`模型调用失败，失败原因：${ne}`:"模型调用失败"})}};s()},N=()=>xn({id:w.id,task_id:H.value}),I=u(null);let K=null;const X=({title:s,content:O,question:ne,answer:ce,images:_e},Te)=>{K=Te,I.value.open({title:s,content:O,question:ne,answer:ce,images:_e})},Q=({title:s,content:O,question:ne,answer:ce,images:_e})=>{(G.value[K].title!=s||G.value[K].content!=O||G.value[K].question!=ne||G.value[K].answer!=ce)&&(L=!0),G.value[K].title=s,G.value[K].content=O,G.value[K].question=ne,G.value[K].answer=ce,G.value[K].images=_e,G.value[K].word_total=ce.length+ne.length+O.length},re=s=>{be.confirm({title:"提醒",icon:t(Ie),content:"确定要删除这个片段吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){L=!0,G.value.splice(s,1)},onCancel(){}})},p=u(""),ue=s=>{p.value=s},F=u(!1),we=()=>{let s=q.value.formState;s=JSON.parse(JSON.stringify(s)),typeof s.separators_no=="object"&&(s.separators_no=s.separators_no.join(",")),w={...w,...s}},Oe=s=>{let O=0;return s.forEach(ne=>{O+=parseInt(ne.word_total)}),O},Le=async()=>{if((Se.value<=0||w.chunk_type!=Y.value)&&(we(),await me()),we(),p.value)return ve.error(p.value);if(w.chunk_type==3&&!G.value.length)return ge.value=!0,!1;H.value&&(w.ai_chunk_task_id=H.value);let s={...w,semantic_chunk_model_config_id:w.semantic_chunk_model_config_id?+w.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:w.ai_chunk_model_config_id?+w.ai_chunk_model_config_id:0,is_table_file:D.value,...k.pdfState};delete s.id;let O={file_id:M,word_total:Oe(G.value),split_params:JSON.stringify(s),list:JSON.stringify(G.value),...k.pdfState};s.is_qa_doc==1&&(O.qa_index_type=s.qa_index_type),F.value=!0,k.paragraphType&&k.paragraphType==="paragraphsSegmented"&&(O.data_id=O.data_ids,delete O.data_ids),bn(O).then(()=>{c("ok"),c("finish")}).finally(()=>{F.value=!1}).catch(ne=>{ne.data&&ne.data.index&&Ke(ne.data.index),c("finish")})},Ee=u(null),Ke=s=>{s=s-1;let O=Ee.value.querySelectorAll(".fragment-item");O.length>=s&&O[s].scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})};return Pt(()=>{j&&(clearTimeout(j),j=null)}),le({handleSaveLibFileSplit:Le}),(s,O)=>{const ne=Ue;return l(),g(pe,null,[P.value?(l(),g("div",ko,[t(ne)])):B("",!0),n("div",yo,[n("div",bo,[n("div",So,[t(Vn,{excellQaLists:te.value,libFileInfo:y.value,library_type:h.value,mode:D.value,hideSave:!0,status:"paragraphsSegmented",ref_key:"segmentationSettingRef",ref:q,onChange:ee,onChangeChunkType:Re,onSave:Le,onValidate:ue},null,8,["excellQaLists","libFileInfo","library_type","mode"])]),n("div",wo,[n("div",xo,[n("div",Co,[O[0]||(O[0]=n("span",{class:"label-text"},"分段预览",-1)),n("span",$o,"共"+Z(Se.value)+"个分段",1)]),x.value&&!ie.value?(l(),U(Wn,{key:0})):B("",!0),ie.value?(l(),g("div",Lo,[t(ne),O[1]||(O[1]=T("数据处理中..."))])):B("",!0),n("div",{class:"preview-box",ref_key:"previewBoxRef",ref:Ee},[(l(!0),g(pe,null,xe(G.value,(ce,_e)=>(l(),g("div",{class:"fragment-item",key:ce.number},[t(Zn,{status:"paragraphsSegmented",currentData:se.currentData,number:ce.number,title:ce.title,content:ce.content,total:ce.word_total,question:ce.question,answer:ce.answer,images:ce.images,onDelete:Te=>re(_e),onEdit:Te=>X(ce,_e)},null,8,["currentData","number","title","content","total","question","answer","images","onDelete","onEdit"])]))),128))],512)])])]),t(Kn,{ref_key:"editFragmentAlertRef",ref:I,onOk:Q},null,512)])],64)}}},Jt=$e(Oo,[["__scopeId","data-v-f651f9a3"]]),Eo={class:"select-box"},Io=["onClick"],To={class:"title"},Ro={class:"desc"},Mo={key:0,class:"card-switch"},Po={class:"main-content-box"},Do={__name:"re-segmentation-page",props:{detailsInfo:{type:Object,default:()=>{}}},emits:["ok","enable"],setup(se,{expose:le,emit:C}){const J=Mt(),m=ke(()=>{var z;return((z=J.companyInfo)==null?void 0:z.ali_ocr_switch)=="1"}),_=Be().query,c=Ft(),M=se,P=u(!1),D=u(!1),L=u(""),k=C;let Y={};const w=u([{title:"图文OCR解析",desc:"通过OCR文字识别提取pdf文件内容，可以兼容扫描件，但是解析速度较慢。",icon:"pdf-ocr",pdf_parse_type:2},{title:"纯文本解析",desc:"只提取Pdf中的文字内容，如果文档为扫描件可能提取不到内容。",icon:"pdf-text",pdf_parse_type:1},{title:"图文解析",desc:"提取PDF文档中的图片和文字",icon:"pdf-img",pdf_parse_type:3}]),q=qe({pdf_parse_type:2,pdf_page_num:0}),ee=()=>{w.value=w.value.filter(z=>z.pdf_parse_type!=4),k("enable")},d=u(!1),i=z=>{d.value=z},y=z=>{Y={...z},q.pdf_parse_type=2,q.pdf_page_num=z.pdf_page_num,z.type==1&&(L.value=`当页(${z.pdf_page_num})重新分段`),z.type==2&&(L.value="将文档重新分段"),z.type==3&&(L.value="重新学习文档",w.value.push({title:"阿里云OCR解析",desc:"通过阿里云文档智能接口解析提取图片和文字",icon:"ali-ocr",pdf_parse_type:4})),P.value=!0},h=()=>{window.open("#/user/aliocr")},E=z=>{if(z.pdf_parse_type==4&&!m.value)return!1;q.pdf_parse_type=z.pdf_parse_type},te=u(!1),fe=()=>{if(Y.type==3){if(q.pdf_parse_type==1){c.push("/library/document-segmentation?document_id="+_.id+"&source=preview");return}te.value=!0,$n({id:_.id,pdf_parse_type:q.pdf_parse_type}).then(z=>{ve.success("重新学习成功"),(q.pdf_parse_type==2||q.pdf_parse_type==3||q.pdf_parse_type==4)&&c.push({path:"/library/details/knowledge-document",query:{id:M.detailsInfo.library_id}}),q.pdf_parse_type==1&&c.push("/library/document-segmentation?document_id="+_.id+"&source=preview"),P.value=!1}).finally(()=>{te.value=!1});return}P.value=!1,D.value=!0},b=u(null),ge=()=>{te.value=!0,b.value.handleSaveLibFileSplit()},ie=()=>{ve.success("保存成功"),D.value=!1,k("ok",Y.type)},H=()=>{te.value=!1};return le({show:y}),(z,j)=>{const G=We,Se=be;return l(),g("div",null,[t(Se,{open:P.value,"onUpdate:open":j[0]||(j[0]=x=>P.value=x),title:L.value,onOk:fe,onCancel:ee,width:720,confirmLoading:te.value},{default:o(()=>[n("div",Eo,[(l(!0),g(pe,null,xe(w.value,x=>(l(),g("div",{class:Dt(["select-list-item",{active:x.pdf_parse_type==q.pdf_parse_type},{disabled:x.pdf_parse_type==4&&!m.value}]),onClick:me=>E(x),key:x.pdf_parse_type},[n("div",To,[t(G,{name:x.icon,style:{"font-size":"16px"}},null,8,["name"]),T(" "+Z(x.title),1)]),n("div",Ro,Z(x.desc),1),x.pdf_parse_type==4&&!m.value?(l(),g("div",Mo,[j[2]||(j[2]=T(" 未开启阿里云OCR ")),n("div",{class:"card-switch-btn",onClick:ye(h,["stop"])},"去开启")])):B("",!0)],10,Io))),128))])]),_:1},8,["open","title","confirmLoading"]),t(Se,{open:D.value,"onUpdate:open":j[1]||(j[1]=x=>D.value=x),onCancel:ee,title:L.value,maskClosable:!1,"ok-text":d.value?"文档解析中,请稍候...":"确定",confirmLoading:te.value||d.value,onOk:ge,width:1e3},{default:o(()=>[n("div",Po,[D.value?(l(),U(Jt,{key:0,onOk:ie,onFinish:H,onLoading:i,pdfState:q,ref_key:"documentSegmentationModalRef",ref:b},null,8,["pdfState"])):B("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},Fo=$e(Do,[["__scopeId","data-v-fdcaa00c"]]),zo={class:"subsection-box"},No={class:"qa-list-box"},Ao={class:"list-item"},Ho={class:"list-content"},Bo={key:0,class:"list-item"},Uo={class:"list-content"},jo={class:"list-item"},Qo={class:"list-content"},Jo={class:"fragment-img"},Go=["src"],Vo={key:0,class:"status-tag"},Wo={key:1,class:"status-tag complete"},Zo={class:"status-tag status-error"},Ko={key:3,class:"status-tag running"},Xo={class:"right-opration"},Yo={class:"hover-btn-box"},el=["onClick"],tl=["onClick"],nl={class:"hover-btn-box"},al=["onClick"],ol=["onClick"],ll={__name:"qa-subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup(se,{expose:le,emit:C}){const m=Be().query,_=C,c=se,M=(d,i)=>{let{id:y,title:h,content:E,question:te,answer:fe,images:b,category_id:ge}=d,ie=d.similar_questions||[];be.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${i+1}】吗?`,onOk(){return new Promise((H,z)=>{It({id:y,title:h,content:E,question:te,answer:fe,images:b,category_id:ge,similar_questions:JSON.stringify(ie)}).then(j=>{_("handleConvert",d),H()}).catch(()=>{H()})})},onCancel(){}})},P=d=>{_("openEditSubscription",d)},D=d=>{be.confirm({title:"提示",icon:t(Ie),content:"确认是否删除该分段?",onOk(){return new Promise((i,y)=>{Tt({id:d}).then(h=>{ve.success("删除成功"),_("handleDelParagraph",d),i()}).catch(()=>{i()})})},onCancel(){}})},L=u([]),k=()=>{let d={};m.id&&(d.file_id=m.id),Ot(d).then(i=>{L.value=i.data||[],_("getStatrList",i.data||[])})};k();const Y=u(null),w=()=>{Y.value.show()},q=d=>{var y;let i=(y=L.value.filter(h=>h.id==d.category_id)[0])==null?void 0:y.type;return i?Ve[i]:"#F4EA2A"},ee=(d,i={})=>{Et({id:d.id,category_id:i.id||0}).then(y=>{ve.success("设置成功"),d.category_id=i.id,k()})};return le({handleOpenEditModal:P}),(d,i)=>{const y=Yn,h=Ze,E=Ue,te=it,fe=st,b=rt,ge=ea,ie=ot("viewer");return l(),g("div",zo,[t(ge,{"data-source":se.paragraphLists,pagination:!1},{default:o(()=>[t(y,{key:"id","data-index":"id",width:1148},{title:o(()=>[T("问答（共"+Z(c.total)+"个）",1)]),default:o(({record:H})=>[n("div",No,[n("div",Ao,[i[0]||(i[0]=n("div",{class:"list-label"},"问题",-1)),n("div",Ho,Z(H.question),1)]),H.similar_questions&&H.similar_questions.length?(l(),g("div",Bo,[i[1]||(i[1]=n("div",{class:"list-label"},"相似问法",-1)),n("div",Uo,Z(H.similar_questions.join("/")),1)])):B("",!0),n("div",jo,[i[2]||(i[2]=n("div",{class:"list-label"},"答案",-1)),n("div",Qo,Z(H.answer),1)]),lt((l(),g("div",Jo,[(l(!0),g(pe,null,xe(H.images,(z,j)=>(l(),g("img",{key:j,src:z,alt:""},null,8,Go))),128))])),[[ie]])])]),_:1}),t(y,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:o(({record:H})=>[H.status==0?(l(),g("span",Vo,[t(ae(Xn)),i[3]||(i[3]=T(" 未转换"))])):B("",!0),H.status==1?(l(),g("span",Wo,[t(ae(Ln)),i[4]||(i[4]=T(" 已转换"))])):B("",!0),H.status==2?(l(),U(h,{key:2,placement:"top"},{title:o(()=>[n("span",null,Z(H.errmsg),1)]),default:o(()=>[n("span",null,[n("span",Zo,[t(ae(qn)),i[5]||(i[5]=T(" 转换异常"))])])]),_:2},1024)):B("",!0),H.status==3?(l(),g("span",Ko,[t(E,{size:"small"}),i[6]||(i[6]=T(" 转换中"))])):B("",!0)]),_:1}),t(y,{title:"操作",key:"action","data-index":"action",width:120},{default:o(({record:H,index:z})=>[n("div",Xo,[t(b,null,{overlay:o(()=>[t(fe,null,{default:o(()=>[(l(!0),g(pe,null,xe(L.value,j=>(l(),U(te,{key:j.id},{default:o(()=>[n("div",{class:"start-item",onClick:G=>ee(H,j)},[t(ae(Ge),{style:De({color:ae(Ve)[j.type]})},null,8,["style"]),n("div",null,Z(j.name||"-"),1)],8,el)]),_:2},1024))),128)),t(te,null,{default:o(()=>[n("div",{class:"start-item",onClick:w},[t(ae(Ht)),i[7]||(i[7]=n("div",null,"标记设置",-1))])]),_:1})]),_:2},1024)]),default:o(()=>[n("div",Yo,[H.category_id>0?(l(),U(ae(Ge),{key:0,onClick:j=>ee(H,{}),style:De({color:q(H),"font-size":"16px"})},null,8,["onClick","style"])):(l(),U(ae(Nt),{key:1,onClick:j=>ee(H,L.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),t(h,null,{title:o(()=>i[8]||(i[8]=[T("重新转换")])),default:o(()=>[n("div",{class:"hover-btn-box",onClick:j=>M(H,z)},[t(ae(Bt))],8,tl)]),_:2},1024),t(b,{placement:"bottomRight"},{overlay:o(()=>[t(fe,null,{default:o(()=>[t(te,null,{default:o(()=>[n("div",{onClick:ye(j=>P(H),["stop"])},"编辑",8,al)]),_:2},1024),t(te,null,{default:o(()=>[n("div",{onClick:ye(j=>D(H.id),["stop"])},"删除",8,ol)]),_:2},1024)]),_:2},1024)]),default:o(()=>[n("div",nl,[t(ae(Ut))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),t(At,{onOk:k,ref_key:"classificationMarkModalRef",ref:Y},null,512)])}}},sl=$e(ll,[["__scopeId","data-v-e2a6d168"]]),il={class:"main-content-box"},rl={__name:"segmentation-setting-modal",emits:["ok","enable"],setup(se,{expose:le,emit:C}){const J=u(!1),m=u("重新分段"),_=C;let c={};const M=qe({data_ids:0,file_id:0}),P={0:"未转换",1:"已转换",2:"转换异常",3:"转换中",4:"分段失败",10:"分段中"},D=qe({status:"",errmsg:"",status_text:""}),L=()=>{_("enable")},k=u(!1),Y=h=>{k.value=h},w=h=>{J.value=!0,M.data_ids=h.id,M.file_id=h.file_id,D.list=[{content:h.content,number:h.number,title:h.title,word_total:h.word_total,question:h.question,answer:h.answer,images:h.images}],D.status=h.status,D.errmsg=h.errmsg,D.status_text=P[h.status]},q=u(!1),ee=u(null),d=()=>{q.value=!0,ee.value.handleSaveLibFileSplit()},i=()=>{ve.success("保存成功"),J.value=!1,_("ok",c.type)},y=()=>{q.value=!1};return le({show:w}),(h,E)=>{const te=be;return l(),g("div",null,[t(te,{open:J.value,"onUpdate:open":E[0]||(E[0]=fe=>J.value=fe),onCancel:L,title:m.value,maskClosable:!1,"ok-text":k.value?"文档解析中,请稍候...":"确定",confirmLoading:q.value||k.value,onOk:d,width:1084},{default:o(()=>[n("div",il,[J.value?(l(),U(Jt,{key:0,onOk:i,onFinish:y,onLoading:Y,paragraphType:"paragraphsSegmented",pdfState:M,currentData:D,ref_key:"documentSegmentationModalRef",ref:ee},null,8,["pdfState","currentData"])):B("",!0)])]),_:1},8,["open","title","ok-text","confirmLoading"])])}}},ul=$e(rl,[["__scopeId","data-v-e8467ea0"]]),cl={class:"library-preview-page"},dl={class:"breadcrumb-block"},_l={class:"library-line1"},pl={class:"selct-star-box"},fl={class:"document-title-block",style:{height:"22px"}},ml={class:"title"},vl={class:"search-content-block"},gl={class:"preview-box"},hl={key:0,class:"page-loading-box"},kl={class:"content-block"},yl={class:"content-block"},bl={key:1,class:"pdf-view-box"},Sl={key:0,class:"pdf-mode-switch"},wl={key:0},xl={key:1,class:"segmentation-btn"},Cl={class:"view-content-box",style:{"padding-top":"60px"}},$l=["onClick"],Ll={key:0,class:"content-box"},ql={key:1,class:"content-box"},Ol=["innerHTML"],El={class:"fragment-img"},Il=["src"],Tl={class:"right-contnt-box"},Rl={key:0,class:"right-tabs-box"},Ml={class:"content-block"},Pl="你是一位文章分段助手，根据文章内容的语义进行合理分段，确保每个分段表述一个完整的语义，每个分段字数控制在500字左右，最大不超过1000字。请严格按照文章内容进行分段，不要对文章内容进行加工，分段完成后输出分段后的内容。",Dl={__name:"library-preview",setup(se){const le=Mt(),C=ke(()=>{var e;return((e=le.companyInfo)==null?void 0:e.neo4j_status)=="true"}),J=u(!1),m=u(null),_=u(0),c=u(0),M={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},P=u([]),D=e=>{P.value=e},L=u({fade:!1,scrollbarTrackClickable:!0,interactive:!0,minSize:40}),k=Be(),Y=Ft(),w=On(),q=ke(()=>y.value.is_table_file=="1"),ee=ke(()=>y.value.doc_type),d=ke(()=>{let e=y.value.status;return!(e=="1"||e=="2")||x.value.length==0}),i=ke(()=>y.value.is_qa_doc=="1"),y=u({}),h=qe({status:-1,graph_status:-1,category_id:-1}),E=u(1),te=ke(()=>"/manage/getLibRawFile?id="+k.query.id+"&token="+w.getToken),fe=()=>{Y.back()},b=u(null),ge=u(null);let ie=-1;const H=(e,a=1)=>{let v,$;a==1?(v=".subsection-box .list-item",$=ge.value):(v=".view-content-box .list-item",$=b.value);const A=document.querySelectorAll(v)[e];A.classList.add("flash-border"),ie>=0&&document.querySelectorAll(v)[ie].classList.remove("flash-border"),setTimeout(()=>{ie=-1,A.classList.remove("flash-border")},2500),ie=e,$.scrollToElement({el:A,time:1e3})},z=u(!0),j=u(0),G=u({page:1,size:1e3}),Se=u({}),x=u([]),me=u(0),Re={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},Ce=qe({split_status_exception:0,total:0,vector_status_converted:0,vector_status_converting:0,vector_status_exception:0,vector_status_initial:0}),f=qe([{value:-1,label:"全部",num:ke(()=>Ce.total)},{value:4,label:"分段失败",num:ke(()=>Ce.split_status_exception)},{value:0,label:"未转换",num:ke(()=>Ce.vector_status_initial)},{value:3,label:"转换中",num:ke(()=>Ce.vector_status_converting)},{value:2,label:"转换异常",num:ke(()=>Ce.vector_status_exception)},{value:1,label:"已转换",num:ke(()=>Ce.vector_status_converted)}]),r=u(1);let N={id:k.query.id,separators_no:"",chunk_size:512,chunk_overlap:50,is_qa_doc:0,question_lable:"",similar_label:"",answer_lable:"",enable_extract_image:!0,ai_chunk_size:5e3,ai_chunk_model:"",ai_chunk_model_config_id:"",ai_chunk_prumpt:Pl,ai_chunk_task_id:""};const I=u(!1);let K=!0;(async()=>{Rt({id:k.query.id}).then(e=>{j.value=e.data.library_type,y.value={...e.data,graph_switch:e.data.graph_switch=="1"&&C.value};let a=e.data.status;a==1||a==2?we():z.value=!1,N={...N,separators_no:e.data.separators_no||"11,12",chunk_size:+e.data.chunk_size||512,ai_chunk_size:+e.data.ai_chunk_size||5e3,chunk_overlap:+e.data.chunk_overlap||50,is_qa_doc:j.value==2?1:0,question_lable:e.data.question_lable,similar_label:e.data.similar_label,answer_lable:e.data.answer_lable,question_column:e.data.question_column,similar_column:e.data.similar_column,answer_column:e.data.answer_column,enable_extract_image:e.data.enable_extract_image=="true",qa_index_type:+e.data.qa_index_type,chunk_type:+e.data.chunk_type,semantic_chunk_size:+e.data.semantic_chunk_size||512,semantic_chunk_overlap:+e.data.semantic_chunk_overlap||50,semantic_chunk_threshold:+e.data.semantic_chunk_threshold||90,semantic_chunk_use_model:e.data.semantic_chunk_use_model||"",ai_chunk_prumpt:e.data.ai_chunk_prumpt||"",ai_chunk_model:e.data.ai_chunk_model||"",semantic_chunk_model_config_id:e.data.semantic_chunk_model_config_id>0?e.data.semantic_chunk_model_config_id:"",ai_chunk_model_config_id:e.data.ai_chunk_model_config_id>0?e.data.ai_chunk_model_config_id:"",ai_chunk_task_id:e.data.ai_chunk_task_id||""},e.data.chunk_type==0&&(N={...N,separators_no:e.data.normal_chunk_default_separators_no,chunk_size:+e.data.normal_chunk_default_chunk_size,chunk_overlap:+e.data.normal_chunk_default_chunk_overlap,chunk_type:+e.data.default_chunk_type,semantic_chunk_size:+e.data.semantic_chunk_default_chunk_size,semantic_chunk_overlap:+e.data.semantic_chunk_default_chunk_overlap,semantic_chunk_threshold:+e.data.semantic_chunk_default_threshold,semantic_chunk_use_model:e.data.default_use_model||"",semantic_chunk_model_config_id:e.data.default_model_config_id>0?e.data.default_model_config_id:""}),(a==4||a==2)&&(r.value=parseInt(e.data.is_table_file))})})();const Q=()=>{En({file_id:k.query.id}).then(e=>{Object.assign(Ce,e.data)})},re=()=>{window.location.reload()},p=()=>{G.value.page=1,me.value=0,x.value=[],we()},ue=e=>{h.category_id=e,p()},F=(e=null)=>{G.value.page++,we(e)},we=(e=null)=>{K=!0,xt({file_id:k.query.id,...G.value,...h}).then(a=>{var S,R;z.value=!1,K=!1;let v=a.data,$=v.list||[],A=((S=v.info)==null?void 0:S.is_qa_doc)=="1"&&((R=v.info)==null?void 0:R.is_table_file)=="1";$.forEach(he=>{he.status_text=Re[he.status],he.graph_status_text=M[he.graph_status],he.isExcelQa=A,he.similar_questions&&(he.similar_questions=JSON.parse(he.similar_questions))}),Se.value=v.info,G.value.page==1&&(x.value=[]),x.value=[...x.value,...$],me.value=v.total,typeof e=="function"&&e()})},Oe=()=>{K||x.value.length>=me.value||(F(),m.value&&m.value.loadMore())},Le=()=>{s()};let Ee=null;function Ke(){clearInterval(Ee),x.value.filter(a=>a.status==3).length?Ee=setInterval(()=>{s()},5e3):clearInterval(Ee)}const s=()=>{xt({file_id:k.query.id,page:1,size:x.value.length,...h}).then(e=>{var A,S;let a=e.data,v=a.list||[],$=((A=a.info)==null?void 0:A.is_qa_doc)=="1"&&((S=a.info)==null?void 0:S.is_table_file)=="1";v.forEach(R=>{R.status_text=Re[R.status],R.graph_status_text=M[R.graph_status],R.isExcelQa=$,R.similar_questions&&(R.similar_questions=JSON.parse(R.similar_questions))}),x.value=v,Ke()})},O=e=>{if(!e.id){G.value.page=1,we();return}let a=x.value,v=a.findIndex($=>$.id==e.id);if(v>-1){let $=a[v];$.title=e.title,$.content=e.content,$.question=e.question,$.answer=e.answer,$.images=e.images,$.category_id=e.category_id,$.word_total=e.question.length+e.answer.length+e.content.length,$.similar_questions=e.similar_questions.length?JSON.parse(e.similar_questions):[],a.splice(v,1,$),x.value=a}},ne=e=>{let a=x.value,v=a.findIndex($=>$.id==e);v>-1&&(a.splice(v,1),x.value=a,me.value=me.value--)},ce=u(null),_e=e=>{ce.value.showModal(JSON.parse(JSON.stringify(e)))},Te=u(null),Gt=()=>{In({id:k.query.id}).then(()=>ve.success("操作完成"))},Vt=()=>{Tn({id:k.query.id}).then(()=>ve.success("操作完成"))},ut=u(null),Wt=()=>{ut.value.show(y.value)},ct=()=>{Y.push("/library/document-segmentation?document_id="+k.query.id+"&source=preview")},Zt=()=>{Te.value.open({id:k.query.id,doc_auto_renew_frequency:y.value.doc_auto_renew_frequency})},Kt=e=>{y.value.doc_auto_renew_frequency=e},Xt=e=>{y.value.file_name=e},Yt=e=>{const a=()=>{for(let v in x.value)if(x.value[v].page_num==e){H(v);return}};if(e>x.value[x.value.length-1].page_num){ve.warning("分段数据正在加载，请稍后...");const v=()=>{e<=x.value[x.value.length-1].page_num?(ve.success("加载完成"),Je(()=>{a()})):F(v)};F(v)}else a()},en=(e,a)=>{c.value=a,_.value=e,x.value[x.value.length-1].page_num<e&&F()},dt=e=>{var a;if(((a=y.value)==null?void 0:a.file_ext)=="pdf"&&E.value==1){const v=e.page_num-1,$=()=>document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[v],A=()=>{const R=$();R.classList.add("flash-border"),setTimeout(()=>R.classList.remove("flash-border"),2500),m.value.getScrollInstance().scrollToElement({el:R,time:1e3})};if($())A();else{ve.warning("PDF正在加载，请稍后...");const R=()=>{$()?(ve.success("加载完成"),A()):m.value&&m.value.loadMore()};m.value&&m.value.loadMore(R)}}else H(e.index,2)},Xe=u(1);let Ye=null;const je=u(0),tn=e=>{je.value=e},nn=({y:e})=>{if(!Ye){const v=document.querySelectorAll(".pdf-render-box > .scroll-content .vue-pdf-embed")[0];Ye=v&&v.clientHeight}let a=Math.floor(Math.abs(e)/Ye)+1;Xe.value=Math.max(a,1)},et=u(null),tt=u(null),an=e=>{let{key:a}=e;m.value&&m.value.getScrollInstance().disable(),a==1&&et.value.show({type:a,pdf_page_num:Xe.value}),a==2&&ct(),a==3&&et.value.show({type:a,pdf_page_num:0})},_t=e=>{tt.value&&tt.value.show(e)},pt=()=>{m.value&&m.value.getScrollInstance().enable()},on=()=>{pt(),p()},ft=()=>{J.value=!J.value},nt=(e,a)=>{let v=JSON.parse(JSON.stringify(e));return v.content=a,v.word_total=a.length,v},Me=u(!1),Pe=u(1),mt=({index:e,beforeContent:a,selectedContent:v,afterContent:$,isFullSelection:A})=>{const S=[...x.value];Me.value=A,Pe.value=1,A?(S.splice(e+1,0,nt(S[e],v)),S.splice(e,1)):(S[e].content=a||"",S[e].word_total=a.length||0,$.trim()&&S.splice(e+1,0,nt(S[e],$)),S.splice(e+1,0,nt(S[e],v)),S[e+1].images=[],S.splice(e,1)),x.value=S,Fe(S,e)},vt=({index:e,beforeContent:a,selectedContent:v,afterContent:$,isFullSelection:A})=>{const S=[...x.value];Me.value=A,Pe.value=2;let R=S[e+1].word_total;A?(S[e+1].content=+v,S[e+1].word_total=parseInt(R)+v.length,S.splice(e,1),x.value=S,Fe(S,e)):(S[e].content=a||"",S[e].word_total=a.length||0,S[e+1].content+=v,S[e+1].word_total=parseInt(R)+v.length,$.trim()&&(S[e].content+=$||"",S[e].word_total+=$.length||0),x.value=S,Fe(S,e+1))},gt=({index:e,beforeContent:a,selectedContent:v,afterContent:$,isFullSelection:A})=>{const S=[...x.value];Me.value=A,Pe.value=3;let R=S[e-1].word_total;A?(S[e-1].content+=v,S[e-1].word_total=parseInt(R)+v.length,S.splice(e,1),x.value=S,Fe(S,e)):(S[e].content=a||"",S[e].word_total=a.length||0,S[e-1].content+=v,S[e-1].word_total=parseInt(R)+v.length,$.trim()&&(S[e].content+=$||"",S[e].word_total+=$.length||0),x.value=S,Fe(S,e-1))},ht=({index:e,beforeContent:a,afterContent:v,isFullSelection:$})=>{const A=[...x.value];Me.value=$,Pe.value=4,$?A.splice(e,1):(A[e].content=a||"",A[e].word_total=a.length||0,v.trim()&&(A[e].content+=v||"",A[e].word_total+=v.length||0)),x.value=A,Fe(A,e)};function ln(e,a,v={},$){let A=$+1;if(!Array.isArray(e)||!Array.isArray(a))return JSON.stringify([]);const S=e.map((R,he)=>{const V={};for(const W of a){const Ne=v[W]||W,de=R[Ne];if(Object.prototype.hasOwnProperty.call(R,Ne))if(W==="number")V[W]=he+1;else if(W==="page_num"||W==="word_total")V[W]=+de;else if(W==="content"){if(!de)return null;V[W]=de}else W==="images"?Pe.value==1?Me.value?(A==V.number,V[W]=de):A+1==V.number?V[W]=[]:V[W]=de:Pe.value==2?(Me.value,A==V.number,V[W]=de):Pe.value==3?Me.value?(A-1==V.number,V[W]=de):(A==V.number,V[W]=de):Pe.value==4&&(Me.value,V[W]=de):V[W]=de}return V}).filter(R=>R!==null&&R.content!==void 0&&R.content!=="");return JSON.stringify(S)}const sn={similar_question_list:"similar_questions"},Fe=async(e,a)=>{let v={...N,semantic_chunk_model_config_id:N.semantic_chunk_model_config_id?+N.semantic_chunk_model_config_id:0,ai_chunk_model_config_id:N.ai_chunk_model_config_id?+N.ai_chunk_model_config_id:0,is_table_file:r.value};delete v.id;let $={id:k.query.id,word_total:me.value,split_params:JSON.stringify(v),list:ln(e,["number","page_num","title","content","question","similar_question_list","answer","word_total","images"],sn,a)};v.is_qa_doc==1&&($.qa_index_type=v.qa_index_type),I.value=!0,Rn($).then(A=>{ve.success("操作成功");const S=A.data;for(let R=0;R<S.length;R++){const he=S[R],V=x.value[R];if(R<x.value.length)V.id=he.toString(),V.status="0",V.status_text=Re[V.status];else break}}).finally(()=>{I.value=!1})};return He(()=>{Q(),k.query.graph_status&&(h.graph_status=k.query.graph_status,p())}),(e,a)=>{var yt,bt,St;const v=Mn("router-link"),$=na,A=ta,S=We,R=qt,he=Qt,V=jt,W=it,Ne=st,de=rt,rn=oa,un=Ue,Qe=Ze,kt=ra,cn=ia,dn=sa,_n=la,pn=ot("viewer");return l(),g("div",cl,[n("div",dl,[t(A,null,{default:o(()=>[t($,null,{default:o(()=>[t(v,{to:"/library/list"},{default:o(()=>a[7]||(a[7]=[T(" 知识库管理 ")])),_:1,__:[7]})]),_:1}),t($,null,{default:o(()=>[t(v,{to:{path:"/library/details/knowledge-document",query:{id:y.value.library_id}}},{default:o(()=>[n("div",_l,Z(y.value.library_name)+"知识库",1)]),_:1},8,["to"])]),_:1}),t($,null,{default:o(()=>a[8]||(a[8]=[T("知识库详情")])),_:1,__:[8]})]),_:1}),n("div",pl,[t(Dn,{startLists:P.value,onChange:ue},null,8,["startLists"])])]),n("div",fl,[t(ae(aa),{onClick:fe}),n("span",ml,Z(y.value.file_name),1),t(fo,{detailsInfo:y.value},null,8,["detailsInfo"])]),n("div",vl,[n("div",gl,[J.value?(l(),U(R,{key:1,onClick:a[1]||(a[1]=oe=>ft())},{default:o(()=>[t(S,{class:"preview-box-icon",name:"expand"}),a[10]||(a[10]=T(" 展开预览"))]),_:1,__:[10]})):(l(),U(R,{key:0,onClick:a[0]||(a[0]=oe=>ft())},{default:o(()=>[t(S,{class:"preview-box-icon",name:"put-away"}),a[9]||(a[9]=T(" 收起预览"))]),_:1,__:[9]}))]),t(rn,null,{default:o(()=>[i.value?(l(),U(V,{key:0,value:h.status,"onUpdate:value":a[2]||(a[2]=oe=>h.status=oe),placeholder:"请选择",style:{width:"160px"},onChange:p},{default:o(()=>[t(he,{value:-1},{default:o(()=>a[11]||(a[11]=[T("全部嵌入状态")])),_:1,__:[11]}),(l(),g(pe,null,xe(Re,(oe,ze)=>t(he,{key:oe,value:ze},{default:o(()=>[T(Z(oe),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])):B("",!0),y.value.graph_switch?(l(),U(V,{key:1,value:h.graph_status,"onUpdate:value":a[3]||(a[3]=oe=>h.graph_status=oe),placeholder:"请选择",onChange:p,style:{width:"160px"}},{default:o(()=>[t(he,{value:-1},{default:o(()=>a[12]||(a[12]=[T("全部知识图谱状态")])),_:1,__:[12]}),(l(),g(pe,null,xe(M,(oe,ze)=>t(he,{key:oe,value:ze},{default:o(()=>[T(Z(oe),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])):B("",!0),t(de,null,{overlay:o(()=>[t(Ne,null,{default:o(()=>[t(W,{onClick:Gt},{default:o(()=>a[13]||(a[13]=[T("重新嵌入向量")])),_:1,__:[13]}),y.value.graph_switch?(l(),U(W,{key:0,onClick:Vt},{default:o(()=>a[14]||(a[14]=[T("重新抽取知识图谱")])),_:1,__:[14]})):B("",!0),t(W,{onClick:Wt},{default:o(()=>a[15]||(a[15]=[T("重命名")])),_:1,__:[15]}),ee.value==2?(l(),U(W,{key:1,onClick:Zt},{default:o(()=>a[16]||(a[16]=[T("设置更新频率")])),_:1,__:[16]})):B("",!0)]),_:1})]),default:o(()=>[t(R,null,{default:o(()=>[a[17]||(a[17]=T("其他操作 ")),t(ae($t))]),_:1,__:[17]})]),_:1}),ee.value!=3?(l(),U(R,{key:2,onClick:ct},{default:o(()=>a[18]||(a[18]=[T("重新分段")])),_:1,__:[18]})):B("",!0),t(R,{onClick:a[4]||(a[4]=oe=>_e({})),type:"primary"},{icon:o(()=>[t(ae(zt))]),default:o(()=>[a[19]||(a[19]=n("span",null,"添加分段",-1))]),_:1,__:[19]})]),_:1})]),z.value?(l(),g("div",hl,[t(un)])):(l(),g(pe,{key:1},[i.value?(l(),g(pe,{key:0},[d.value?(l(),U(at,{key:0,onOpenEditSubscription:_e})):(l(),U(Ae,{key:1,scrollbar:{minSize:0},onOnScrollEnd:Oe},{default:o(()=>[n("div",kl,[t(sl,{ref:"subsectionBoxRef",total:me.value,paragraphLists:x.value,detailsInfo:y.value,onOpenEditSubscription:_e,onHandleDelParagraph:ne,onHandleConvert:Le,onGetStatrList:D},null,8,["total","paragraphLists","detailsInfo"])])]),_:1}))],64)):(l(),g(pe,{key:1},[q.value||ee.value==3?(l(),g(pe,{key:0},[d.value?(l(),U(at,{key:0,onOpenEditSubscription:_e})):(l(),U(Ae,{key:1,scrollbar:{minSize:0},onOnScrollEnd:Oe,disableMouse:!0},{default:o(()=>[n("div",yl,[t(Lt,{ref:"subsectionBoxRef",total:me.value,detailsInfo:y.value,paragraphLists:x.value,onOpenEditSubscription:_e,onHandleDelParagraph:ne,onHandleConvert:Le,onHandleScrollTargetPage:dt,onGetStatrList:D,onHandleSplit:mt,onHandleSplitNext:vt,onHandleSplitUp:gt,onHandleSplitDelete:ht,onHandleSegmentation:_t},null,8,["total","detailsInfo","paragraphLists"])])]),_:1}))],64)):(l(),g("div",bl,[n("div",{class:Dt(["view-content-wrap",{collapsed:J.value}])},[((yt=y.value)==null?void 0:yt.file_ext)=="pdf"?(l(),g("div",Sl,[t(cn,{value:E.value,"onUpdate:value":a[5]||(a[5]=oe=>E.value=oe)},{default:o(()=>[t(kt,{value:1},{default:o(()=>[t(Qe,{placement:"right",title:"原文预览模式下，会展示pdf原始文件内容，手动编辑分段的不会展示。您可以通过原文预览模式，校验分段准确性，然后手动编辑分段。"},{default:o(()=>[a[20]||(a[20]=T(" 原文预览 ")),E.value==1&&je.value>0?(l(),g("span",wl,"("+Z(Xe.value)+" / "+Z(je.value)+")",1)):B("",!0)]),_:1,__:[20]})]),_:1}),t(kt,{value:2},{default:o(()=>a[21]||(a[21]=[T("纯文本预览")])),_:1,__:[21]})]),_:1},8,["value"])])):B("",!0),((bt=y.value)==null?void 0:bt.file_ext)=="pdf"?(l(),g("div",xl,[t(de,null,{overlay:o(()=>[t(Ne,{onClick:an},{default:o(()=>[E.value==1&&je.value>0?(l(),U(W,{key:1},{default:o(()=>[t(Qe,{placement:"right",title:"将当前页重新解析并分段"},{default:o(()=>a[22]||(a[22]=[n("div",null,"将当页重新分段",-1)])),_:1,__:[22]})]),_:1})):B("",!0),(l(),U(W,{key:2},{default:o(()=>[t(Qe,{placement:"right",title:"将整个文档重新分段，注意，重新分段并不会重新提取文档的内容，只是将内容重新分段。"},{default:o(()=>a[23]||(a[23]=[n("div",null,"将文档重新分段",-1)])),_:1,__:[23]})]),_:1})),(l(),U(W,{key:3},{default:o(()=>[t(Qe,{placement:"right",title:"将整个文档重新学习，包含重新解析并提取文档内容，重新分段。"},{default:o(()=>a[24]||(a[24]=[n("div",null,"重新学习文档",-1)])),_:1,__:[24]})]),_:1}))]),_:1})]),default:o(()=>[t(R,null,{default:o(()=>[a[25]||(a[25]=T(" 重新分段 ")),t(ae($t))]),_:1,__:[25]})]),_:1})])):B("",!0),((St=y.value)==null?void 0:St.file_ext)=="pdf"&&E.value==1?(l(),U(ho,{key:2,ref_key:"pdfRef",ref:m,class:"scroll-box pdf-render-box",source:te.value,onSelect:Yt,onScroll:nn,onRendered:en,onGetTotalPage:tn},null,8,["source"])):(l(),U(Ae,{key:3,scrollbar:L.value,ref_key:"leftScrollRef",ref:b,class:"scroll-box",onOnScrollEnd:Oe},{default:o(()=>[n("div",Cl,[(l(!0),g(pe,null,xe(x.value,(oe,ze)=>(l(),g("div",{class:"list-item",onClick:wt=>H(ze),key:ze},[oe.question?(l(),g("div",Ll,Z(oe.question),1)):B("",!0),oe.answer?(l(),g("div",ql,Z(oe.answer),1)):B("",!0),n("div",{class:"content-box",innerHTML:oe.content},null,8,Ol),lt((l(),g("div",El,[(l(!0),g(pe,null,xe(oe.images,(wt,fn)=>(l(),g("img",{key:fn,src:wt,alt:""},null,8,Il))),128))])),[[pn]])],8,$l))),128))])]),_:1},8,["scrollbar"]))],2),n("div",Tl,[i.value?B("",!0):(l(),g("div",Rl,[t(_n,{activeKey:h.status,"onUpdate:activeKey":a[6]||(a[6]=oe=>h.status=oe),style:{"background-color":"#f2f4f7",padding:"0px 16px","border-radius":"6px"},onChange:p},{default:o(()=>[(l(!0),g(pe,null,xe(f,oe=>(l(),U(dn,{key:oe.value,tab:`${oe.label} (${oe.num})`},null,8,["tab"]))),128))]),_:1},8,["activeKey"])])),d.value?(l(),U(at,{key:1,onOpenEditSubscription:_e})):(l(),U(Ae,{key:2,scrollbar:L.value,disableMouse:!0,ref_key:"rightScrollRef",ref:ge,onOnScrollEnd:Oe},{default:o(()=>[n("div",Ml,[t(Lt,{ref:"subsectionBoxRef",total:me.value,detailsInfo:y.value,paragraphLists:x.value,onOpenEditSubscription:_e,onHandleDelParagraph:ne,onHandleConvert:Le,onHandleScrollTargetPage:dt,onGetStatrList:D,onHandleSplit:mt,onHandleSplitNext:vt,onHandleSplitUp:gt,onHandleSplitDelete:ht,onHandleSegmentation:_t},null,8,["total","detailsInfo","paragraphLists"])])]),_:1},8,["scrollbar"]))])]))],64))],64)),t(Fn,{detailsInfo:y.value,onHandleEdit:O,ref_key:"editSubscriptionRef",ref:ce},null,8,["detailsInfo"]),t(mo,{onOk:Kt,ref_key:"updateFrequencyRef",ref:Te},null,512),t(Gn,{onOk:Xt,ref_key:"renameModalRef",ref:ut},null,512),t(Fo,{onOk:on,onEnable:pt,detailsInfo:y.value,ref_key:"reSegmentationPageRef",ref:et},null,8,["detailsInfo"]),t(ul,{ref_key:"segmentationSettingModalRef",ref:tt,onOk:re},null,512)])}}},ci=$e(Dl,[["__scopeId","data-v-d4b91d10"]]);export{ci as default};
