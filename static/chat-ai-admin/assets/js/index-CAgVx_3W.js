import{j as t,N as v,O as s,X as e,a6 as E,Z as I,_ as R,V as ce,S as D,U as i,Y as mt,a5 as Ce,d as x,a as Y,z as Q,H as ae,I as re,u as $,G as W,a3 as Je,F as T,a1 as G,w as ue,k as Ge,q as fe,o as vt,h as Le,ae as ye,af as ke,D as ft,b as ve,a0 as bt,x as He,aa as ht,W as yt,a8 as kt,p as gt}from"./vue-chunks-BRsu9_To.js";import{I as $t,b as B,d as de,B as te,az as xt,ap as Be,M as Z,k as K,an as wt,as as qt,ar as pe,aA as St,aB as Ct,a0 as Ke,e as Lt,aC as It,aD as Se,E as Ae,ay as Rt}from"../../index-CvfGQnmW.js";import{_ as ge}from"./index-BjEoDhm5.js";import{C as Ut}from"./cu-upload-BmyOj2g7.js";import"./index-DUS5CIPm.js";import{I as _e}from"./Input-DT-w6V-X.js";import{_ as $e}from"./TextArea-B40Dha8W.js";import{_ as Me}from"./cu-scroll-B_WJBedC.js";import{e as Et,g as We,f as Ot,h as At}from"./index-8-RdvZT5.js";import{T as jt}from"./index-Be8_2it1.js";import{S as Ie}from"./index-MLftqXg-.js";import{I as Mt}from"./index-Dmc7P8k4.js";import{F as je,_ as Ze}from"./index-CeLDnZbi.js";import{S as Ye,a as Xe,i as zt}from"./index-Bic_ld4j.js";import{_ as et,T as tt}from"./index-CT9_rIV-.js";import{D as Dt}from"./DownloadOutlined-D6_CmJ5K.js";import{P as Re}from"./PlusOutlined-BsYDRa8m.js";import{D as ot}from"./DownOutlined-DKJ0lkJp.js";import{U as Pt}from"./UpOutlined-BZVglKCC.js";import{_ as oe}from"./index-B-ykUzgY.js";import{_ as se}from"./index-ChS1NVDw.js";import{c as st}from"./index-CiT4vUhP.js";import{C as Nt}from"./index-D4B36xuZ.js";import{Q as ee}from"./QuestionCircleOutlined-DsT-V90y.js";import{_ as nt}from"./index-WowefPIW.js";import{_ as Ue}from"./index-D2a_iSIQ.js";import{_ as Tt,a as Vt}from"./index-BADD93sS.js";import{S as Bt}from"./SearchOutlined-B9P7O4A9.js";import{S as Qt}from"./SyncOutlined-YMAvMLpO.js";import{_ as ze,C as De}from"./index-C_DWe9ZR.js";import{_ as it}from"./index-BjQk2Mcr.js";import{_ as Ft}from"./recommendation-AQ4_FPQ9.js";import{R as Jt}from"./RightOutlined-DQOW11d0.js";import{g as lt}from"./index-ZXKXzZnJ.js";import{_ as at}from"./empty-CzGZrENG.js";import{d as Pe}from"./vuedraggable.umd-CIIT_a56.js";import{M as Gt}from"./model-select-DyyTdKgZ.js";import"./index-ESeBgLel.js";import{_ as rt,R as dt}from"./RadioButton-Bh1r7hrP.js";import{E as _t}from"./EditOutlined-CGnEZrbQ.js";import{_ as Ht}from"./index-RzuxWmAm.js";import{u as Kt}from"./robot-CVYMQ0Uf.js";import{i as Wt,e as Zt,f as Yt}from"./index-C_N0YJ9k.js";import{A as Xt}from"./add-collaborator-BFwdMW1F.js";import{A as eo}from"./index-CE26VU2J.js";import{U as Qe}from"./UserOutlined-CvUaVWRq.js";import{C as Oe}from"./CheckOutlined-N7bppPAu.js";import{E as to}from"./Password-Bl0n4Nu8.js";import{_ as oo}from"./index-Cj1xldbi.js";import{a as so}from"./index-SYniNczA.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-CFzzmp00.js";import"./index-B0doyz59.js";import"./Search-BVbdzfe3.js";import"./isPlainObject-C_BoBcyP.js";import"./inputProps-DJXIqADS.js";import"./index-DaOSj_2K.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./colors-Cy2bPHOW.js";import"./Trigger-C5a0DMKm.js";import"./responsiveObserve-4wudV-W8.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-vrDadJH3.js";import"./move-CunrTozH.js";import"./index-Cn6_tPQQ.js";import"./shallowequal-C0xnIuy8.js";import"./dropdown-JwPNtE5e.js";import"./pick-BfwQ-ZV5.js";import"./Checkbox-CD3yZxoG.js";import"./index-BNsyVryY.js";import"./index-CteniEgA.js";import"./useMaxLevel-CGODDmyb.js";import"./CaretDownFilled-D2jjQ2Qs.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-CaA0Q_W1.js";import"./index-XnBLv09r.js";import"./CaretDownOutlined-CGSacOH8.js";var no={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885 780H165c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM400 325.7h73.9V664c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V325.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 171a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13z"}}]},name:"to-top",theme:"outlined"};function Fe(j){for(var c=1;c<arguments.length;c++){var b=arguments[c]!=null?Object(arguments[c]):{},f=Object.keys(b);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(b).filter(function(p){return Object.getOwnPropertyDescriptor(b,p).enumerable}))),f.forEach(function(p){io(j,p,b[p])})}return j}function io(j,c,b){return c in j?Object.defineProperty(j,c,{value:b,enumerable:!0,configurable:!0,writable:!0}):j[c]=b,j}var Ne=function(c,b){var f=Fe({},c,b.attrs);return t($t,Fe({},f,{icon:no}),null)};Ne.displayName="ToTopOutlined";Ne.inheritAttrs=!1;const lo={class:"edit-box-header"},ao={class:"left-box"},ro={class:"edit-box-title"},_o={key:0},co={key:0,class:"title-tip"},uo={class:"right-box"},po={class:"extra-box"},mo={class:"actions-box"},vo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(j,{emit:c}){const b=c,f=j,p=r=>{b("edit"),b("update:isEdit",r)},n=()=>{b("save")};return(r,h)=>{const _=de,u=te,g=ge;return s(),v("div",{class:Ce(["edit-box",{"is-edit":j.isEdit}])},[e("div",lo,[e("div",ao,[t(_,{class:"edit-box-icon",name:f.iconName},null,8,["name"]),e("span",ro,[I(R(f.title)+" ",1),r.$slots.icon?(s(),v("span",_o,[ce(r.$slots,"icon",{},void 0,!0)])):E("",!0)]),r.$slots.tip?(s(),v("span",co,[ce(r.$slots,"tip",{},void 0,!0)])):E("",!0)]),e("div",uo,[e("div",po,[ce(r.$slots,"extra",{},()=>[e("div",mo,[f.isEdit?(s(),D(g,{key:0,gap:8},{default:i(()=>[t(u,{onClick:n,size:"small",type:"primary"},{default:i(()=>h[2]||(h[2]=[I("保存")])),_:1,__:[2]}),t(u,{onClick:h[0]||(h[0]=a=>p(!1)),size:"small"},{default:i(()=>h[3]||(h[3]=[I("取消")])),_:1,__:[3]})]),_:1})):(s(),D(u,{key:1,onClick:h[1]||(h[1]=a=>p(!0)),size:"small"},{default:i(()=>h[4]||(h[4]=[I("修改")])),_:1,__:[4]}))])],!0)])])]),e("div",{class:"edit-box-body",style:mt({...j.bodyStyle})},[ce(r.$slots,"default",{},void 0,!0)],4)],2)}}},X=B(vo,[["__scopeId","data-v-1b63f826"]]),fo={class:"robot-form-box"},bo={class:"form-item"},ho={class:"form-item-body robot-name-item"},yo={class:"robot-avetar-upload"},ko=["src"],go={class:"robot-name-box"},$o={class:"form-item"},xo={class:"form-item-body"},wo={class:"robot-info-box"},qo={class:"robot-name-box"},So=["src"],Co={class:"robot-name"},Lo={class:"robot-intro"},Io={__name:"basic-config",setup(j){const c=x(!1),{robotInfo:b,updateRobotInfo:f}=Y("robotInfo"),p=Q({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=()=>{f({...W(p)}),c.value=!1},r=_=>{let u=_[0];return p.robot_avatar=u,xt(u).then(g=>{p.robot_avatar_url=g}),!1},h=()=>{p.robot_name=b.robot_name,p.robot_intro=b.robot_intro,p.robot_avatar=b.robot_avatar,p.robot_avatar_url=b.robot_avatar_url};return(_,u)=>{const g=_e,a=$e;return s(),D(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:c.value,"onUpdate:isEdit":u[2]||(u[2]=l=>c.value=l),onSave:n,onEdit:h},{default:i(()=>[ae(e("div",fo,[e("div",bo,[u[3]||(u[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",ho,[t(Ut,{accept:"image/*",onChange:r},{default:i(()=>[e("div",yo,[p.robot_avatar_url?(s(),v("img",{key:0,class:"robot-avetar",src:p.robot_avatar_url},null,8,ko)):E("",!0)])]),_:1}),e("div",go,[t(g,{value:p.robot_name,"onUpdate:value":u[0]||(u[0]=l=>p.robot_name=l),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",$o,[u[4]||(u[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",xo,[t(a,{rows:3,value:p.robot_intro,"onUpdate:value":u[1]||(u[1]=l=>p.robot_intro=l),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[re,c.value]]),ae(e("div",wo,[e("div",qo,[e("img",{class:"robot-avatar",src:$(b).robot_avatar_url,alt:""},null,8,So),e("span",Co,R($(b).robot_name),1)]),e("div",Lo,R($(b).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[re,!c.value]])]),_:1},8,["isEdit"])}}},Ro=B(Io,[["__scopeId","data-v-c384f413"]]),Uo={class:"ai-create-box"},Eo={class:"input-box"},Oo={class:"quick-tags-box"},Ao={class:"ai-list-box"},jo={key:0,class:"loading-box"},Mo={key:0,class:"prompt-list-box"},zo={class:"prompt-list"},Do={class:"prompt-header"},Po={class:"prompt-title"},No={class:"prompt-content"},To={class:"prompt-list"},Vo={class:"prompt-header"},Bo={class:"prompt-title"},Qo={class:"prompt-content"},Fo={class:"prompt-list"},Jo={class:"prompt-header"},Go={class:"prompt-title"},Ho={class:"prompt-content"},Ko={class:"prompt-list"},Wo={class:"prompt-header"},Zo={class:"prompt-title"},Yo={class:"prompt-content"},Xo={class:"prompt-list"},es={class:"prompt-header"},ts={class:"prompt-title"},os={class:"prompt-content"},ss={class:"prompt-header"},ns={class:"prompt-title"},is={class:"prompt-content"},ls={key:1,class:"empty-box"},as={__name:"ai-create-prompt",emits:["handleAiSave"],setup(j,{expose:c,emit:b}){const f=Be.PRESENTED_IMAGE_SIMPLE,p=x(!1),n=x(!1),r=Je().query,h=b,_=x(""),u=x(!1),g=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],a=x("在上方输入框输入要求，点击生成提示词"),l=()=>{o.value=!1,q.promptStruct=k,_.value="",a.value="在上方输入框输入要求，点击生成提示词",p.value=!0},o=x(!1),k={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},q=Q({promptStruct:k}),U=L=>{_.value=L},m=()=>{if(!_.value)return K.error("请输入AI 生成提示词");if(u.value)return K.error("正在生成中...");u.value=!0,Et({id:r.id,demand:_.value}).then(L=>{q.promptStruct=JSON.parse(L.data.promptStruct),o.value=!0}).finally(()=>{u.value=!1}).catch(L=>{o.value=!1,a.value=L.msg})},S=()=>{if(!o.value)return K.error("请先生成提示词");h("handleAiSave",q.promptStruct),p.value=!1};return c({show:l}),(L,d)=>{const w=te,F=_e,M=de,C=jt,O=Ie,J=Be,P=Me,H=Z;return s(),v("div",null,[t(H,{open:p.value,"onUpdate:open":d[1]||(d[1]=N=>p.value=N),title:"AI 生成提示词",width:746},{footer:i(()=>[t(w,{type:"primary",loading:n.value,onClick:S},{default:i(()=>d[2]||(d[2]=[I("使用该提示")])),_:1,__:[2]},8,["loading"])]),default:i(()=>[e("div",Uo,[e("div",Eo,[t(F,{style:{width:"100%"},value:_.value,"onUpdate:value":d[0]||(d[0]=N=>_.value=N),size:"large",onPressEnter:m,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:m},[t(M,{name:"ai-mark"}),d[3]||(d[3]=e("span",null,"生成",-1))])]),e("div",Oo,[d[4]||(d[4]=e("div",{class:"quick-label"},"快捷生成：",-1)),(s(),v(T,null,G(g,N=>t(C,{key:N.title,onClick:z=>U(N.title),color:"blue"},{default:i(()=>[I(R(N.title),1)]),_:2},1032,["onClick"])),64))]),e("div",Ao,[t(P,{style:{height:"100%"}},{default:i(()=>[u.value?(s(),v("div",jo,[t(O,{tip:"正在生成中..."})])):(s(),v(T,{key:1},[o.value?(s(),v("div",Mo,[e("div",zo,[e("div",Do,[e("div",Po,R(q.promptStruct.role.subject),1)]),e("div",No,R(q.promptStruct.role.describe),1)]),e("div",To,[e("div",Vo,[e("div",Bo,R(q.promptStruct.task.subject),1)]),e("div",Qo,R(q.promptStruct.task.describe),1)]),e("div",Fo,[e("div",Jo,[e("div",Go,R(q.promptStruct.constraints.subject),1)]),e("div",Ho,R(q.promptStruct.constraints.describe),1)]),e("div",Ko,[e("div",Wo,[e("div",Zo,R(q.promptStruct.output.subject),1)]),e("div",Yo,R(q.promptStruct.output.describe),1)]),e("div",Xo,[e("div",es,[e("div",ts,R(q.promptStruct.tone.subject),1)]),e("div",os,R(q.promptStruct.tone.describe),1)]),(s(!0),v(T,null,G(q.promptStruct.custom,(N,z)=>(s(),v("div",{class:"prompt-list",key:z+N.key?N.key:""},[e("div",ss,[e("div",ns,R(N.subject),1)]),e("div",is,R(N.describe),1)]))),128))])):(s(),v("div",ls,[t(J,{image:$(f),description:a.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},rs=B(as,[["__scopeId","data-v-87ba79c2"]]),ds={__name:"upload-prompt",setup(j,{expose:c}){const b=x(!1),f=Q({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),p=x(null),n=g=>{if(g.prompt_type==0&&!g.prompt)return K.error("自定义提示为空,无法上传");p.value&&p.value.resetFields();let a={...g};f.title="",f.group_id=0,f.prompt="",f.prompt_struct={},f.prompt_type=a.prompt_type,a.prompt_type==0?f.prompt=a.prompt:f.prompt_struct=JSON.stringify(a.prompt_struct),b.value=!0},r=x([]);(()=>{wt().then(g=>{r.value=[{id:0,group_name:"默认分组"},...g.data]})})();const _=x(!1),u=()=>{p.value.validate().then(()=>{let g={...f};_.value=!0,qt({...g}).then(()=>{K.success("保存成功"),b.value=!1}).finally(()=>{_.value=!1})})};return c({show:n}),(g,a)=>{const l=_e,o=Ze,k=Xe,q=Ye,U=je,m=Z;return s(),v("div",null,[t(m,{open:b.value,"onUpdate:open":a[2]||(a[2]=S=>b.value=S),title:"保存到提示词库",width:580,onOk:u,confirmLoading:_.value},{default:i(()=>[t(U,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:p,model:f},{default:i(()=>[t(o,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:i(()=>[t(l,{value:f.title,"onUpdate:value":a[0]||(a[0]=S=>f.title=S),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(o,{name:"group_id",label:"分组"},{default:i(()=>[t(q,{value:f.group_id,"onUpdate:value":a[1]||(a[1]=S=>f.group_id=S),style:{width:"100%"}},{default:i(()=>[(s(!0),v(T,null,G(r.value,S=>(s(),D(k,{value:S.id},{default:i(()=>[I(R(S.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},_s={class:"prompt-box"},cs={class:"tab-header"},us={key:0,class:"opt-block"},ps={key:1,class:"opt-block"},ms={class:"tip-text"},vs={key:0,class:"prompt-list-box"},fs={class:"prompt-list"},bs={class:"prompt-header"},hs={class:"prompt-title"},ys={key:0,class:"btn-wrapper-box"},ks={class:"prompt-content"},gs={class:"prompt-list"},$s={class:"prompt-header"},xs={class:"prompt-title"},ws={key:0,class:"btn-wrapper-box"},qs={class:"prompt-content"},Ss={class:"prompt-list"},Cs={class:"prompt-header"},Ls={class:"prompt-title"},Is={key:0,class:"btn-wrapper-box"},Rs={class:"prompt-content"},Us={class:"prompt-list"},Es={class:"prompt-header"},Os={class:"prompt-title"},As={key:0,class:"btn-wrapper-box"},js={class:"prompt-content"},Ms={class:"prompt-list"},zs={class:"prompt-header"},Ds={class:"prompt-title"},Ps={key:0,class:"btn-wrapper-box"},Ns={class:"swich-item"},Ts={class:"swich-item"},Vs={class:"prompt-content"},Bs={class:"prompt-list"},Qs={class:"prompt-header"},Fs={class:"prompt-title"},Js={key:0,class:"btn-wrapper-box"},Gs={class:"prompt-content"},Hs={class:"prompt-header"},Ks={class:"prompt-title",style:{flex:"1"}},Ws={key:0,class:"btn-wrapper-box"},Zs=["onClick"],Ys={class:"prompt-content"},Xs={key:0,class:"add-theme-block"},en={class:"show-more-block"},tn={key:1,class:"diy-prompt-box"},on={key:0,class:"diy-switch-box"},sn={class:"swich-item"},nn={class:"swich-item"},ie="- 请使用markdown格式回答问题。",le="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",ln={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(j){const c=x(!1),{robotInfo:b,updateRobotInfo:f}=Y("robotInfo"),p=j;let n={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const r=x({}),h=x(!1),_=x(!1),u=x(!1),g=x(!1),a=Q({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),l=x(localStorage.getItem("system_prompt_words_ishide")=="1"),o=()=>{l.value=!l.value,localStorage.setItem("system_prompt_words_ishide",l.value?1:0)},k=(V,y)=>V.includes(y),q=x(b.prompt_type);ue(()=>b,()=>{a.prompt=b.prompt,a.prompt_struct=b.prompt_struct,r.value=b.prompt_struct_default},{immediate:!0,deep:!0}),ue(()=>a.prompt_struct.output.describe,V=>{h.value=k(V,ie),_.value=k(V,le)},{immediate:!0,deep:!0}),ue(()=>a.prompt,V=>{u.value=k(V,ie),g.value=k(V,le)},{immediate:!0,deep:!0});const U=(V,y)=>{V?(y=="outSwitch"&&(a.prompt_struct.output.describe?a.prompt_struct.output.describe+=`
`+ie:a.prompt_struct.output.describe+=ie),y=="imgSwitch"&&(a.prompt_struct.output.describe?a.prompt_struct.output.describe+=`
`+le:a.prompt_struct.output.describe+=le)):(y=="outSwitch"&&(a.prompt_struct.output.describe=a.prompt_struct.output.describe.replace(new RegExp(ie,"g"),"")),y=="imgSwitch"&&(a.prompt_struct.output.describe=a.prompt_struct.output.describe.replace(new RegExp(le,"g"),"")),a.prompt_struct.output.describe=a.prompt_struct.output.describe.trim())},m=(V,y)=>{V?(y=="outDiySwitch"&&(a.prompt?a.prompt+=`
`+ie:a.prompt+=ie),y=="imgDiySwitch"&&(a.prompt?a.prompt+=`
`+le:a.prompt+=le)):(y=="outDiySwitch"&&(a.prompt=a.prompt.replace(new RegExp(ie,"g"),"")),y=="imgDiySwitch"&&(a.prompt=a.prompt.replace(new RegExp(le,"g"),"")),a.prompt=a.prompt.trim())},S=V=>{a.prompt_struct[V].describe=r.value[V].describe},L=()=>{let V=b.work_flow_ids.split(","),y=p.robotList.filter(me=>V.includes(me.id)),he=[];he=y.map(me=>`- ${me.robot_name} ${me.robot_intro}`).join(`
`),a.prompt_struct.skill.describe=he},d=()=>{a.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),q.value=1},w=V=>{a.prompt_struct.custom.splice(V,1)},F=()=>{f({...W(a),prompt_type:q.value}),c.value=!1},M=V=>{q.value=1,f({prompt_type:q.value,prompt:a.prompt,prompt_struct:V}),c.value=!1},C=()=>{c.value=!0},O=()=>{c.value=!1},J=x(null),P=()=>{J.value.show()},H=x(null),N=()=>{H.value.show()},z=x(null),be=()=>{z.value.show({...a,prompt_type:q.value})},Ee=V=>{V.prompt_type==1?(q.value=1,a.prompt_struct=V.prompt_struct):(q.value=0,a.prompt=V.prompt),F()};return(V,y)=>{const he=et,me=tt,Te=oe,ct=de,xe=te,ut=ge,ne=$e,we=se,pt=_e;return s(),v("div",_s,[e("div",cs,[t(me,{activeKey:q.value,"onUpdate:activeKey":y[0]||(y[0]=A=>q.value=A)},{default:i(()=>[(s(),D(he,{key:1,tab:"结构化提示词"})),(s(),D(he,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),c.value?(s(),v("div",us,[t(Te,null,{title:i(()=>y[22]||(y[22]=[I("将当前编辑的提示词保存到提示词库中")])),default:i(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:be},[t($(Ne)),y[23]||(y[23]=I("上传 "))])]),_:1}),t(Te,null,{title:i(()=>y[24]||(y[24]=[I("从提示词库导入提示词")])),default:i(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:N},[t($(Dt)),y[25]||(y[25]=I("导入 "))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:P},[t(ct,{name:"ai-mark"}),y[26]||(y[26]=I(" AI自动生成 "))]),t(ut,{gap:8},{default:i(()=>[t(xe,{size:"small",type:"primary",onClick:F},{default:i(()=>y[27]||(y[27]=[I("保存")])),_:1,__:[27]}),t(xe,{size:"small",onClick:O},{default:i(()=>y[28]||(y[28]=[I("取消")])),_:1,__:[28]})]),_:1})])):(s(),v("div",ps,[e("span",ms,"当前类型："+R(q.value==1?"结构化提示词":"自定义提示词"),1),t(xe,{size:"small",onClick:C},{default:i(()=>y[29]||(y[29]=[I("修改")])),_:1,__:[29]})]))]),q.value==1?(s(),v("div",vs,[e("div",fs,[e("div",bs,[e("div",hs,R(a.prompt_struct.role.subject),1),c.value?(s(),v("div",ys,[e("a",{onClick:y[1]||(y[1]=A=>S("role"))},"恢复默认")])):E("",!0)]),e("div",ks,[t(ne,{bordered:!1,disabled:!c.value,value:a.prompt_struct.role.describe,"onUpdate:value":y[2]||(y[2]=A=>a.prompt_struct.role.describe=A),placeholder:$(n).role},null,8,["disabled","value","placeholder"])])]),e("div",gs,[e("div",$s,[e("div",xs,R(a.prompt_struct.task.subject),1),c.value?(s(),v("div",ws,[e("a",{onClick:y[3]||(y[3]=A=>S("task"))},"恢复默认")])):E("",!0)]),e("div",qs,[t(ne,{bordered:!1,disabled:!c.value,value:a.prompt_struct.task.describe,"onUpdate:value":y[4]||(y[4]=A=>a.prompt_struct.task.describe=A),placeholder:$(n).task},null,8,["disabled","value","placeholder"])])]),l.value?(s(),v(T,{key:0},[e("div",Ss,[e("div",Cs,[e("div",Ls,R(a.prompt_struct.constraints.subject),1),c.value?(s(),v("div",Is,[e("a",{onClick:y[5]||(y[5]=A=>S("constraints"))},"恢复默认")])):E("",!0)]),e("div",Rs,[t(ne,{bordered:!1,disabled:!c.value,value:a.prompt_struct.constraints.describe,"onUpdate:value":y[6]||(y[6]=A=>a.prompt_struct.constraints.describe=A),placeholder:$(n).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",Us,[e("div",Es,[e("div",Os,R(a.prompt_struct.skill.subject),1),c.value?(s(),v("div",As,[e("a",{onClick:y[7]||(y[7]=A=>L())},"自动导入技能")])):E("",!0)]),e("div",js,[t(ne,{bordered:!1,disabled:!c.value,value:a.prompt_struct.skill.describe,"onUpdate:value":y[8]||(y[8]=A=>a.prompt_struct.skill.describe=A),placeholder:$(n).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",Ms,[e("div",zs,[e("div",Ds,R(a.prompt_struct.output.subject),1),c.value?(s(),v("div",Ps,[e("div",Ns,[y[30]||(y[30]=I(" 输出markdown： ")),t(we,{onChange:y[9]||(y[9]=A=>U(A,"outSwitch")),checked:h.value,"onUpdate:checked":y[10]||(y[10]=A=>h.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Ts,[y[31]||(y[31]=I(" 回复图片： ")),t(we,{onChange:y[11]||(y[11]=A=>U(A,"imgSwitch")),checked:_.value,"onUpdate:checked":y[12]||(y[12]=A=>_.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:y[13]||(y[13]=A=>S("output"))},"恢复默认")])):E("",!0)]),e("div",Vs,[t(ne,{bordered:!1,disabled:!c.value,value:a.prompt_struct.output.describe,"onUpdate:value":y[14]||(y[14]=A=>a.prompt_struct.output.describe=A),placeholder:$(n).output},null,8,["disabled","value","placeholder"])])]),e("div",Bs,[e("div",Qs,[e("div",Fs,R(a.prompt_struct.tone.subject),1),c.value?(s(),v("div",Js,[e("a",{onClick:y[15]||(y[15]=A=>S("tone"))},"恢复默认")])):E("",!0)]),e("div",Gs,[t(ne,{bordered:!1,disabled:!c.value,value:a.prompt_struct.tone.describe,"onUpdate:value":y[16]||(y[16]=A=>a.prompt_struct.tone.describe=A),placeholder:$(n).tone},null,8,["disabled","value","placeholder"])])]),(s(!0),v(T,null,G(a.prompt_struct.custom,(A,Ve)=>(s(),v("div",{class:"prompt-list",key:Ve+A.key?A.key:""},[e("div",Hs,[e("div",Ks,[t(pt,{bordered:!1,disabled:!c.value,style:{width:"100%"},value:A.subject,"onUpdate:value":qe=>A.subject=qe,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),c.value?(s(),v("div",Ws,[e("div",{class:"hover-btn-box",onClick:qe=>w(Ve)},[t($(pe))],8,Zs)])):E("",!0)]),e("div",Ys,[t(ne,{bordered:!1,disabled:!c.value,value:A.describe,"onUpdate:value":qe=>A.describe=qe,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),c.value?(s(),v("div",Xs,[t(xe,{onClick:d,block:"",icon:Ge($(Re))},{default:i(()=>y[32]||(y[32]=[I("添加主题")])),_:1,__:[32]},8,["icon"])])):E("",!0)],64)):E("",!0),e("div",en,[e("div",{class:"btn-item",onClick:o},[l.value?(s(),v(T,{key:1},[y[34]||(y[34]=I("收起")),t($(Pt))],64)):(s(),v(T,{key:0},[y[33]||(y[33]=I("展开")),t($(ot))],64))])])])):(s(),v("div",tn,[c.value?(s(),v("div",on,[e("div",sn,[y[35]||(y[35]=I(" 输出markdown： ")),t(we,{size:"small",onChange:y[17]||(y[17]=A=>m(A,"outDiySwitch")),checked:u.value,"onUpdate:checked":y[18]||(y[18]=A=>u.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",nn,[y[36]||(y[36]=I(" 回复图片： ")),t(we,{size:"small",onChange:y[19]||(y[19]=A=>m(A,"imgDiySwitch")),checked:g.value,"onUpdate:checked":y[20]||(y[20]=A=>g.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):E("",!0),t(ne,{bordered:c.value,value:a.prompt,"onUpdate:value":y[21]||(y[21]=A=>a.prompt=A),disabled:!c.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(rs,{onHandleAiSave:M,ref_key:"aiCreatePromptRef",ref:J},null,512),t(Mt,{onOk:Ee,ref_key:"importPromptRef",ref:H},null,512),t(ds,{ref_key:"uploadPromptRef",ref:z},null,512)])}}},an=B(ln,[["__scopeId","data-v-f95249d5"]]),rn={class:"actions-box"},dn={class:"setting-info-block"},_n={class:"set-item w-100"},cn={key:0,class:"set-item-content"},un=["src"],pn={key:1},mn={class:"set-item"},vn={class:"set-item"},fn={class:"set-item"},bn={class:"set-item"},hn={class:"form-box"},yn={class:"form-item"},kn={class:"form-item-body"},gn={class:"form-item"},$n={class:"form-item-label"},xn={class:"form-item-body"},wn={class:"number-box"},qn={class:"number-slider-box"},Sn={class:"number-input-box"},Cn={class:"form-item"},Ln={class:"form-item-label"},In={class:"form-item-body"},Rn={class:"number-box"},Un={class:"number-slider-box"},En={class:"number-input-box"},On={class:"form-item"},An={class:"form-item-label"},jn={class:"form-item-body"},Mn={class:"number-box"},zn={class:"number-slider-box"},Dn={class:"number-input-box"},Pn={class:"form-item justify-between"},Nn={class:"form-item-label"},Tn={__name:"model-settings",setup(j){const c=["azure","ollama","xinference","openaiAgent","doubao"],b=["doubao"],f=["azure"],p=Q({sm:24,md:24,lg:12,xl:24,xxl:24}),n=x([]),r=x(!1),{robotInfo:h,updateRobotInfo:_}=Y("robotInfo"),u=Q({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),g=x(""),a=x(""),l=x(""),o=d=>{u.use_model=c.includes(d.rawData.model_define)&&d.rawData.deployment_name?d.rawData.show_model_name||d.rawData.deployment_name:d.rawData.name,u.use_model_icon=d.icon,u.use_model_name=d.use_model_name,u.model_config_id=d.rawData.id,g.value=d.rawData.model_define},k=x(!1),q=d=>{d.target.closest(".custom-select")||(k.value=!1)};fe(()=>{c.indexOf(g.value)>-1?u.use_model=l.value:u.use_model=h.use_model,document.addEventListener("click",q)}),vt(()=>{document.removeEventListener("click",q)});const U=()=>{l.value=u.use_model;let d={...W(u)};f.indexOf(g.value)>-1&&(d.use_model="默认"),_(d),r.value=!1},m=d=>{c.indexOf(g.value)>-1?u.use_model=l.value:u.use_model=h.use_model,u.model_config_id=h.model_config_id,u.temperature=h.temperature,u.max_token=h.max_token,u.context_pair=h.context_pair,u.think_switch=Number(h.think_switch),r.value=d};Le(()=>{u.model_config_id=h.model_config_id,u.temperature=h.temperature,u.max_token=h.max_token,u.context_pair=h.context_pair,u.think_switch=Number(h.think_switch)});function S(d,w,F){const M=new Set(d.map(C=>C.model_define));return w.filter(C=>{let O=C[F];M.has(O)&&d.filter(J=>{if(J.model_define==O)return J.children=Ct(J.children,C.children),!1})}),d}return(()=>{st({model_type:"LLM"}).then(d=>{l.value=h.use_model;let w=d.data||[],F=[];n.value=w.map(M=>{F=[];for(let C=0;C<M.model_info.llm_model_list.length;C++){const O=M.model_info.llm_model_list[C];c.indexOf(M.model_info.model_define)>-1&&h.model_config_id==M.model_config.id&&(l.value=M.model_config.show_model_name||M.model_config.deployment_name,g.value=M.model_info.model_define,a.value=M.model_info.model_define),F.push({name:O,deployment_name:M.model_config.deployment_name,show_model_name:b.includes(M.model_info.model_define)?M.model_config.show_model_name:"",id:M.model_config.id,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,use_model_name:M.model_info.model_name})}return{id:M.model_config.id,name:M.model_info.model_name,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,children:F,deployment_name:M.model_config.deployment_name}}),n.value=S(St(n.value,"model_define"),n.value,"model_define"),h.use_model&&h.model_config_id&&n.value.some(M=>M.children.some(C=>{const O=c.includes(C.model_define)&&C.deployment_name?C.deployment_name:C.name;if(c.includes(C.model_define)&&C.deployment_name&&C.id===h.model_config_id)return u.use_model_icon=C.icon,u.use_model_name=C.use_model_name,u.use_model=C.show_model_name||C.deployment_name,!0;if(O===h.use_model&&C.id===h.model_config_id)return u.use_model_icon=C.icon,u.use_model_name=C.use_model_name,!0}))})})(),(d,w)=>{const F=te,M=Vt,C=oe,O=nt,J=Ue,P=se,H=Tt,N=Z;return s(),D(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:r.value,"onUpdate:isEdit":w[10]||(w[10]=z=>r.value=z)},{extra:i(()=>[e("div",rn,[t(F,{onClick:w[0]||(w[0]=z=>m(!0)),size:"small"},{default:i(()=>w[11]||(w[11]=[I("修改")])),_:1,__:[11]})])]),default:i(()=>[e("div",dn,[e("div",_n,[w[12]||(w[12]=I(" LLM模型： ")),u.use_model_icon&&u.use_model_name?(s(),v("span",cn,[e("img",{src:u.use_model_icon,class:"model-icon"},null,8,un),I(R(u.use_model_name)+" "+R(u.use_model),1)])):(s(),v("span",pn,R(u.use_model),1))]),e("div",mn,[w[13]||(w[13]=I(" 温度： ")),e("span",null,R(u.temperature),1)]),e("div",vn,[w[14]||(w[14]=I(" 最大token： ")),e("span",null,R(u.max_token),1)]),e("div",fn,[w[15]||(w[15]=I(" 上下文数量： ")),e("span",null,R(u.context_pair),1)]),e("div",bn,[w[16]||(w[16]=I(" 显示推理过程： ")),e("span",null,R(u.think_switch==1?"开":"关"),1)])]),t(N,{open:r.value,"onUpdate:open":w[9]||(w[9]=z=>r.value=z),width:672,title:"模型设置",onOk:U},{default:i(()=>[e("div",hn,[t(H,{gutter:[32,24]},{default:i(()=>[t(M,ye(ke(p)),{default:i(()=>[e("div",yn,[w[17]||(w[17]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",kn,[t(Nt,{modelValue:u.use_model,"onUpdate:modelValue":w[1]||(w[1]=z=>u.use_model=z),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":u.model_config_id,onChange:o},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",gn,[e("div",$n,[w[19]||(w[19]=e("span",null,"温度 ",-1)),t(C,null,{title:i(()=>w[18]||(w[18]=[I("温度越低，回答越严谨。温度越高，回答越发散。")])),default:i(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",xn,[e("div",wn,[e("div",qn,[t(O,{class:"custom-slider",value:u.temperature,"onUpdate:value":w[2]||(w[2]=z=>u.temperature=z),min:0,max:2,step:.1},null,8,["value"])]),e("div",Sn,[t(J,{value:u.temperature,"onUpdate:value":w[3]||(w[3]=z=>u.temperature=z),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",Cn,[e("div",Ln,[w[21]||(w[21]=e("span",null,"最大token ",-1)),t(C,null,{title:i(()=>w[20]||(w[20]=[I("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:i(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",In,[e("div",Rn,[e("div",Un,[t(O,{class:"custom-slider",value:u.max_token,"onUpdate:value":w[4]||(w[4]=z=>u.max_token=z),min:0,max:100*1024},null,8,["value"])]),e("div",En,[t(J,{value:u.max_token,"onUpdate:value":w[5]||(w[5]=z=>u.max_token=z),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",On,[e("div",An,[w[23]||(w[23]=e("span",null,"上下文数量 ",-1)),t(C,null,{title:i(()=>w[22]||(w[22]=[I("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置10轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:i(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",jn,[e("div",Mn,[e("div",zn,[t(O,{class:"custom-slider",value:u.context_pair,"onUpdate:value":w[6]||(w[6]=z=>u.context_pair=z),min:0,max:10},null,8,["value"])]),e("div",Dn,[t(J,{value:u.context_pair,"onUpdate:value":w[7]||(w[7]=z=>u.context_pair=z),min:0,max:10},null,8,["value"])])])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",Pn,[e("div",Nn,[w[25]||(w[25]=e("span",null,"显示推理过程 ",-1)),t(C,null,{title:i(()=>w[24]||(w[24]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])),default:i(()=>[t($(ee),{class:"question-icon"})]),_:1})]),t(P,{checked:u.think_switch,"onUpdate:checked":w[8]||(w[8]=z=>u.think_switch=z),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Vn=B(Tn,[["__scopeId","data-v-a21e358b"]]),Bn={class:"library-checkbox-box"},Qn={class:"list-tools"},Fn={class:"list-box",ref:"scrollContainer"},Jn={class:"library-name"},Gn={class:"library-desc"},Hn={__name:"library-select-alert",emits:["change"],setup(j,{expose:c,emit:b}){const f=b,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),n=x(!1),r=U=>{l(),p.checkedList=U,n.value=!0},h=()=>{n.value=!1,a()},_=x(""),u=()=>{l()},g=x([]),a=()=>{f("change",[...p.checkedList])},l=async()=>{const U=await Ke({library_name:_.value,type:"",show_open_docs:1});if(U){let m=U.data||[];g.value=m}},o=x(!1),k=async()=>{o.value=!0,await l(),o.value=!1,K.success("刷新完成")},q=()=>{window.open("/#/library/list")};return c({open:r}),(U,m)=>{const S=it,L=_e,d=te,w=De,F=ze,M=Ie,C=Z;return s(),D(C,{width:"746px",open:n.value,"onUpdate:open":m[2]||(m[2]=O=>n.value=O),title:"关联知识库",onOk:h},{default:i(()=>[e("div",Bn,[t(S,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",Qn,[e("div",null,[t(L,{style:{width:"282px"},value:_.value,"onUpdate:value":m[0]||(m[0]=O=>_.value=O),placeholder:"请输入知识库名称搜索",onChange:u},{suffix:i(()=>[t($(Bt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(d,{style:{"margin-right":"8px"},onClick:k},{default:i(()=>[t($(Qt)),m[3]||(m[3]=I(" 刷新 "))]),_:1,__:[3]}),t(d,{type:"primary",ghost:"",onClick:q},{default:i(()=>m[4]||(m[4]=[I("新建知识库")])),_:1,__:[4]})])]),t(M,{spinning:o.value,delay:100},{default:i(()=>[t(F,{value:p.checkedList,"onUpdate:value":m[1]||(m[1]=O=>p.checkedList=O),style:{width:"100%"}},{default:i(()=>[e("div",Fn,[(s(!0),v(T,null,G(g.value,O=>(s(),v("div",{class:"list-item-wraapper",key:O.id},[t(w,{class:"list-item",value:O.id},{default:i(()=>[e("div",Jn,R(O.library_name),1),e("div",Gn,R(O.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},Kn=B(Hn,[["__scopeId","data-v-81c2223e"]]),Wn={class:"recall-settings-box"},Zn={class:"form-box"},Yn={class:"form-item is-required"},Xn={class:"form-item-body"},ei={class:"retrieval-mode-items"},ti=["onClick"],oi={class:"retrieval-mode-title"},si={class:"title-text"},ni={key:0,style:{width:"32px"},src:Ft,alt:""},ii={class:"retrieval-mode-desc"},li={class:"form-item"},ai={class:"form-item-label"},ri={class:"form-item-body"},di={class:"number-box"},_i={class:"number-slider-box"},ci={class:"number-input-box"},ui={key:0,class:"form-item"},pi={class:"form-item-label"},mi={class:"form-item-body"},vi={class:"number-box"},fi={class:"number-slider-box"},bi={class:"number-input-box"},hi={class:"form-item"},yi={class:"form-item-label"},ki={key:0,class:"form-item-body"},gi=["src"],$i={__name:"recall-settings-alert",emits:["change"],setup(j,{expose:c,emit:b}){const f=b,p=x([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),n=Q({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),r=x(!1),h=U=>{q(),n.rerank_status=U.rerank_status||0,n.rerank_use_model=U.rerank_use_model||void 0,n.rerank_model_config_id=U.rerank_model_config_id>0?U.rerank_model_config_id:"",n.top_k=U.top_k,n.similarity=U.similarity,n.search_type=U.search_type,r.value=!0},_=(U,m)=>{if(!U||!m){n.rerank_model_config_id="";return}n.rerank_model_config_id=m.rerank_model_config_id},u=U=>{U==0&&(n.rerank_model_config_id="",n.rerank_use_model="")},g=U=>{n.search_type=U},a=()=>n.rerank_status==1&&!n.rerank_model_config_id,l=()=>{if(a())return K.error("请选择Rerank模型");r.value=!1,o()},o=()=>{f("change",W(n))},k=x([]),q=()=>{st({model_type:"RERANK"}).then(U=>{let m=U.data||[];k.value=m.map(S=>({id:S.model_config.id,name:S.model_info.model_name,icon:S.model_info.model_icon_url,children:S.model_info.rerank_model_list}))})};return c({open:h}),(U,m)=>{const S=de,L=oe,d=nt,w=Ue,F=se,M=Xe,C=zt,O=Ye,J=Z;return s(),D(J,{width:"746px",open:r.value,"onUpdate:open":m[6]||(m[6]=P=>r.value=P),title:"召回设置",onOk:l},{default:i(()=>[e("div",Wn,[e("div",Zn,[e("div",Yn,[m[7]||(m[7]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",Xn,[e("div",ei,[(s(!0),v(T,null,G(p.value,P=>(s(),v("div",{class:Ce(["retrieval-mode-item",{active:n.search_type==P.value}]),key:P.value,onClick:H=>g(P.value)},[n.search_type==P.value?(s(),D(S,{key:0,class:"check-arrow",name:"check-arrow-filled"})):E("",!0),e("div",oi,[t(S,{name:P.iconName,class:"title-icon"},null,8,["name"]),e("span",si,R(P.title),1),P.isRecommendation?(s(),v("img",ni)):E("",!0)]),e("div",ii,R(P.desc),1)],10,ti))),128))])])]),e("div",li,[e("div",ai,[m[9]||(m[9]=e("span",null,"Top K ",-1)),t(L,null,{title:i(()=>m[8]||(m[8]=[I("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:i(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",ri,[e("div",di,[e("div",_i,[t(d,{class:"custom-slider",value:n.top_k,"onUpdate:value":m[0]||(m[0]=P=>n.top_k=P),min:1,max:10},null,8,["value"])]),e("div",ci,[t(w,{value:n.top_k,"onUpdate:value":m[1]||(m[1]=P=>n.top_k=P),min:1,max:10},null,8,["value"])])])])]),n.search_type<=2?(s(),v("div",ui,[e("div",pi,[m[11]||(m[11]=e("span",null,"相似度阈值 ",-1)),t(L,null,{title:i(()=>m[10]||(m[10]=[I("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:i(()=>[t($(ee),{class:"question-icon"})]),_:1})]),e("div",mi,[e("div",vi,[e("div",fi,[t(d,{class:"custom-slider",value:n.similarity,"onUpdate:value":m[2]||(m[2]=P=>n.similarity=P),min:0,max:1,step:.01},null,8,["value"])]),e("div",bi,[t(w,{value:n.similarity,"onUpdate:value":m[3]||(m[3]=P=>n.similarity=P),min:0,max:1,step:.01},null,8,["value"])])])])])):E("",!0),e("div",hi,[e("div",yi,[m[12]||(m[12]=e("span",null,"Rerank模型",-1)),m[13]||(m[13]=I("   ")),t(F,{checkedValue:1,unCheckedValue:0,checked:n.rerank_status,"onUpdate:checked":m[4]||(m[4]=P=>n.rerank_status=P),onChange:u},null,8,["checked"])]),n.rerank_status==1?(s(),v("div",ki,[t(O,{allowClear:"",value:n.rerank_use_model,"onUpdate:value":m[5]||(m[5]=P=>n.rerank_use_model=P),placeholder:"请选择Rerank模型",onChange:_,style:{width:"60%"}},{default:i(()=>[(s(!0),v(T,null,G(k.value,P=>(s(),D(C,{key:P.id},{label:i(()=>[e("span",null,[e("img",{class:"model-icon",src:P.icon,alt:""},null,8,gi)])]),default:i(()=>[(s(!0),v(T,null,G(P.children,H=>(s(),D(M,{value:H,rerank_model_config_id:P.id,key:H},{default:i(()=>[e("span",null,R(H),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):E("",!0)])])])]),_:1},8,["open"])}}},xi=B($i,[["__scopeId","data-v-4bfd6507"]]),wi={class:"list-box"},qi=["onClick"],Si={class:"avater-box"},Ci=["src"],Li={class:"content-box"},Ii={class:"title-block"},Ri={class:"title-text"},Ui={class:"desc-box"},Ei={class:"right-icon"},Oi={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(j,{expose:c,emit:b}){const f=b,p=j,n=x(!1);ue(()=>p.list,()=>{p.list.length==0&&(n.value=!1)},{});const r=()=>{n.value=!0},h=()=>{document.visibilityState==="visible"&&f("refreshList")};fe(()=>{document.addEventListener("visibilitychange",h)}),ft(()=>{document.removeEventListener("visibilitychange",h)});const _=u=>{window.open(`/#/library/details/knowledge-config?id=${u.id}`)};return c({show:r}),(u,g)=>{const a=it,l=Me,o=Z;return s(),v("div",null,[t(o,{open:n.value,"onUpdate:open":g[0]||(g[0]=k=>n.value=k),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:i(()=>[t(a,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(l,{scrollbar:!1,style:{height:"400px"}},{default:i(()=>[e("div",wi,[(s(!0),v(T,null,G(p.list,k=>(s(),v("div",{class:"list-item",onClick:q=>_(k),key:k.id},[e("div",Si,[e("img",{src:k.avatar,alt:""},null,8,Ci)]),e("div",Li,[e("div",Ii,[g[1]||(g[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",Ri,R(k.library_name),1)]),e("div",Ui,R(k.library_intro),1)]),e("div",Ei,[t($(Jt))])],8,qi))),128))])]),_:1})]),_:1},8,["open"])])}}},Ai=B(Oi,[["__scopeId","data-v-0ebe0aeb"]]),ji={class:"actions-box"},Mi={key:0,class:"library-list"},zi=["onClick"],Di=["onClick"],Pi={class:"library-name"},Ni={class:"library-name-text"},Ti={class:"library-intro"},Vi={class:"setting-info-block"},Bi={class:"set-item"},Qi={key:0},Fi={key:1},Ji={key:2},Gi={key:3},Hi={class:"set-item"},Ki={key:0,class:"set-item"},Wi={class:"set-item"},Zi={key:0},Yi={key:1},Xi={__name:"index",setup(j){const{getStorage:c,removeStorage:b}=It("localStorage"),f=Lt(),p=ve(()=>{var C;return((C=f.companyInfo)==null?void 0:C.neo4j_status)=="true"}),n=x(!1),{robotInfo:r,updateRobotInfo:h}=Y("robotInfo"),_=Q({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),u=x([]),g=x(null),a=ve(()=>u.value.filter(C=>_.library_ids.includes(C.id))),l=ve(()=>a.value.filter(C=>C.graph_switch==0)),o=C=>{let O=_.library_ids.indexOf(C.id);_.library_ids.splice(O,1),d()},k=C=>{_.library_ids=[...C],d()},q=()=>{g.value.open([..._.library_ids])},U=x(null),m=()=>{U.value.open(W(_))},S=x(null),L=C=>{_.rerank_status=C.rerank_status,_.rerank_use_model=C.rerank_use_model,_.rerank_model_config_id=C.rerank_model_config_id,_.top_k=C.top_k,_.similarity=C.similarity,_.search_type=C.search_type,(C.search_type==1||C.search_type==4)&&l.value.length>0&&S.value.show(),d()},d=()=>{let C={...W(_)};C.library_ids=C.library_ids.join(","),h({...C})},w=async()=>{const C=await Ke({type:"",show_open_docs:1});C&&(u.value=C.data||[])},F=()=>{Z.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){q()}})};_.rerank_use_model=r.rerank_use_model||void 0,Le(()=>{_.library_ids=r.library_ids.split(","),_.rerank_status=r.rerank_status||0,_.rerank_use_model=r.rerank_use_model||void 0,_.rerank_model_config_id=r.rerank_model_config_id||"",_.top_k=r.top_k,_.similarity=r.similarity,_.search_type=r.search_type});const M=C=>{window.open(`#/library/details/knowledge-document?id=${C.id}`)};return fe(()=>{w(),c("showNoLibraryTip")&&(F(),b("showNoLibraryTip"))}),(C,O)=>{const J=te,P=ge,H=oe;return s(),D(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:n.value,"onUpdate:isEdit":O[0]||(O[0]=N=>n.value=N),bodyStyle:{padding:0}},{extra:i(()=>[e("div",ji,[t(P,{gap:8},{default:i(()=>[t(J,{size:"small",onClick:m},{default:i(()=>O[1]||(O[1]=[I("召回设置")])),_:1,__:[1]}),t(J,{size:"small",onClick:q},{default:i(()=>O[2]||(O[2]=[I("关联知识库")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[a.value.length>0?(s(),v("div",Mi,[(s(!0),v(T,null,G(a.value,N=>(s(),v("div",{class:"library-item",key:N.id,onClick:z=>M(N)},[e("span",{class:"close-btn",onClick:bt(z=>o(N),["stop"])},[t($(pe))],8,Di),e("div",Pi,[p.value?(s(),D(H,{key:0},{title:i(()=>[I(R(N.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:i(()=>[e("div",{class:Ce(["graph-tag",{active:N.graph_switch==1}])},"Graph",2)]),_:2},1024)):E("",!0),e("div",Ni,R(N.library_name),1)]),e("div",Ti,R(N.library_intro),1)],8,zi))),128))])):E("",!0),e("div",Vi,[e("div",Bi,[O[3]||(O[3]=I(" 检索模式： ")),_.search_type==1?(s(),v("span",Qi,"混合检索")):E("",!0),_.search_type==2?(s(),v("span",Fi,"向量检索")):E("",!0),_.search_type==3?(s(),v("span",Ji,"全文检索")):E("",!0),_.search_type==4?(s(),v("span",Gi,"知识图谱检索")):E("",!0)]),e("div",Hi,[O[4]||(O[4]=I(" Top K： ")),e("span",null,R(_.top_k),1)]),_.search_type<=2?(s(),v("div",Ki,[O[5]||(O[5]=I(" 相似度阈值： ")),e("span",null,R(_.similarity),1)])):E("",!0),e("div",Wi,[O[6]||(O[6]=I(" Rerank模型： ")),_.rerank_status==0?(s(),v("span",Zi,"关")):(s(),v("span",Yi,R(_.rerank_use_model),1))])]),t(Kn,{ref_key:"librarySelectAlertRef",ref:g,onChange:k},null,512),t(xi,{ref_key:"recallSettingsAlertRef",ref:U,onChange:L},null,512),t(Ai,{list:l.value,onRefreshList:w,ref_key:"noOpenGraphModalRef",ref:S},null,8,["list"])]),_:1},8,["isEdit"])}}},el=B(Xi,[["__scopeId","data-v-7e4fe84e"]]),tl={class:"library-checkbox-box"},ol={class:"list-box",ref:"scrollContainer"},sl={class:"library-name"},nl={class:"library-desc"},il={key:0,class:"empty-box"},ll={__name:"library-select-alert",emits:["change"],setup(j,{expose:c,emit:b}){const f=b,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),n=x(!1),r=o=>{g(),p.checkedList=o,n.value=!0},h=()=>{n.value=!1,u()};x("");const _=x([]),u=()=>{f("change",[...p.checkedList])},g=async()=>{const o=await lt();if(o){let k=o.data||[];_.value=k}},a=x(!1),l=()=>{window.open("/#/database/list")};return c({open:r}),(o,k)=>{const q=De,U=ze,m=Ie,S=Z;return s(),D(S,{width:"746px",open:n.value,"onUpdate:open":k[1]||(k[1]=L=>n.value=L),title:"关联数据表",onOk:h},{default:i(()=>[e("div",tl,[t(m,{spinning:a.value,delay:100},{default:i(()=>[t(U,{value:p.checkedList,"onUpdate:value":k[0]||(k[0]=L=>p.checkedList=L),style:{width:"100%"}},{default:i(()=>[e("div",ol,[(s(!0),v(T,null,G(_.value,L=>(s(),v("div",{class:"list-item-wraapper",key:L.id},[t(q,{class:"list-item",value:L.id},{default:i(()=>[e("div",sl,R(L.name),1),e("div",nl,R(L.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!a.value&&!_.value.length?(s(),v("div",il,[k[3]||(k[3]=e("img",{src:at,alt:""},null,-1)),e("div",null,[k[2]||(k[2]=I(" 暂无数据表, 请先去添加数据表 ")),e("a",{onClick:l}," 去添加")])])):E("",!0)])]),_:1},8,["open"])}}},al=B(ll,[["__scopeId","data-v-890ab853"]]),rl={class:"actions-box"},dl={key:0,class:"library-list"},_l=["onClick"],cl={class:"library-name"},ul={class:"library-intro"},pl={__name:"index",setup(j){const c=x(!1),{robotInfo:b,updateRobotInfo:f}=Y("robotInfo"),p=Q({form_ids:[]}),n=x([]),r=x(null),h=ve(()=>n.value.filter(o=>p.form_ids.includes(o.id))),_=o=>{let k=p.form_ids.indexOf(o.id);p.form_ids.splice(k,1),a()},u=o=>{p.form_ids=[...o],a()},g=()=>{r.value.open([...p.form_ids])},a=()=>{let o={...W(p)};o.form_ids=o.form_ids.join(","),f({...o})};return(async()=>{const o=await lt();o&&(n.value=o.data||[])})(),Le(()=>{p.form_ids=b.form_ids.split(",")}),(o,k)=>{const q=oe,U=te,m=ge;return s(),D(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:c.value,"onUpdate:isEdit":k[0]||(k[0]=S=>c.value=S),bodyStyle:{padding:0}},{tip:i(()=>[t(q,{placement:"top"},{title:i(()=>k[1]||(k[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])),default:i(()=>[t($(ee))]),_:1})]),extra:i(()=>[e("div",rl,[t(m,{gap:8},{default:i(()=>[t(U,{size:"small",onClick:g},{default:i(()=>k[2]||(k[2]=[I("关联数据表")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[h.value.length>0?(s(),v("div",dl,[(s(!0),v(T,null,G(h.value,S=>(s(),v("div",{class:"library-item",key:S.id},[e("span",{class:"close-btn",onClick:L=>_(S)},[t($(pe))],8,_l),e("div",cl,R(S.name),1),e("div",ul,R(S.description),1)]))),128))])):E("",!0),t(al,{ref_key:"librarySelectAlertRef",ref:r,onChange:u},null,512)]),_:1},8,["isEdit"])}}},ml=B(pl,[["__scopeId","data-v-077d8df6"]]),vl={class:"form-box"},fl={class:"question-title"},bl={class:"question-options"},hl={class:"question-option"},yl={class:"drag-btn"},kl={class:"action-box"},gl={class:"robot-info-box"},$l={class:"robot-welcome-content"},xl={class:"robot-welcome-question"},wl={__name:"welcome-words",setup(j){const c=x(!1),b=x(!1),{robotInfo:f,updateRobotInfo:p,scrollBoxToBottom:n}=Y("robotInfo"),r=Q({welcomes:{content:"",question:[]}}),h=()=>{let l=!1;if(r.welcomes.question.length>0){for(let o=0;o<r.welcomes.question.length;o++)if(!r.welcomes.question[o].content){l=o+1;break}}return l},_=()=>{r.welcomes.question.push({content:"",id:Se(8)})},u=l=>{r.welcomes.question.splice(l,1)},g=()=>{if(!r.welcomes.content)return K.error("请输入欢迎语");if(h())return K.error("引导问题内容不能为空");p({...W(r)}),c.value=!1},a=()=>{let l={...f.welcomes},o=[];l.question.forEach(({content:k,id:q})=>{let U={id:q,content:k};U.id||(U.id=Se(6)),o.push(U)}),r.welcomes.content=l.content,r.welcomes.question=o};return(l,o)=>{const k=$e,q=de,U=_e;return s(),D(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:c.value,"onUpdate:isEdit":o[4]||(o[4]=m=>c.value=m),onSave:g,onEdit:a},{default:i(()=>[ae(e("div",vl,[e("div",fl,[t(k,{value:r.welcomes.content,"onUpdate:value":o[0]||(o[0]=m=>r.welcomes.content=m),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",bl,[t($(Pe),{modelValue:r.welcomes.question,"onUpdate:modelValue":o[1]||(o[1]=m=>r.welcomes.question=m),"item-key":"id",handle:".drag-btn",onStart:o[2]||(o[2]=m=>b.value=!0),onEnd:o[3]||(o[3]=m=>b.value=!1)},{item:i(({element:m,index:S})=>[e("div",hl,[e("span",yl,[t(q,{name:"drag"})]),t(U,{class:"question-option-content",value:m.content,"onUpdate:value":L=>m.content=L,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",kl,[t($(pe),{class:"del-btn",onClick:L=>u(S)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:_},[t($(Re),{class:"add-btn-icon"}),o[5]||(o[5]=I("添加引导问题 "))])])],512),[[re,c.value]]),ae(e("div",gl,[e("div",$l,R($(f).welcomes.content),1),e("div",xl,[(s(!0),v(T,null,G($(f).welcomes.question,(m,S)=>(s(),v("div",{class:"question-item",key:S},R(m.content),1))),128))])],512),[[re,!c.value]])]),_:1},8,["isEdit"])}}},ql=B(wl,[["__scopeId","data-v-9b840ded"]]),Sl={class:"form-box"},Cl={class:"question-title"},Ll={class:"question-options"},Il={class:"question-option"},Rl={class:"drag-btn"},Ul={class:"action-box"},El={class:"robot-info-box"},Ol={class:"robot-unknown-content"},Al={class:"robot-unknown-question"},jl={__name:"unknown-problem-prompt",setup(j){const c=x(!1),b=x(!1),{robotInfo:f,updateRobotInfo:p,scrollBoxToBottom:n}=Y("robotInfo"),r=Q({unknown_question_prompt:{content:"",question:[]}}),h=()=>{r.unknown_question_prompt.question.push({content:"",id:Se(8)}),He(()=>{n()})},_=a=>{r.unknown_question_prompt.question.splice(a,1)},u=()=>{p({...W(r)}),c.value=!1},g=()=>{let a={...f.unknown_question_prompt},l=[];a.question&&a.question.forEach(({content:o,id:k})=>{let q={id:k,content:o};q.id||(q.id=Se(6)),l.push(q)}),a.content&&(r.unknown_question_prompt.content=a.content),l&&(r.unknown_question_prompt.question=l)};return fe(()=>{}),(a,l)=>{const o=oe,k=$e,q=de,U=_e;return s(),D(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:c.value,"onUpdate:isEdit":l[4]||(l[4]=m=>c.value=m),onSave:u,onEdit:g},{tip:i(()=>[t(o,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>l[5]||(l[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])),default:i(()=>[t($(ee))]),_:1})]),default:i(()=>[ae(e("div",Sl,[e("div",Cl,[t(k,{value:r.unknown_question_prompt.content,"onUpdate:value":l[0]||(l[0]=m=>r.unknown_question_prompt.content=m),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Ll,[t($(Pe),{modelValue:r.unknown_question_prompt.question,"onUpdate:modelValue":l[1]||(l[1]=m=>r.unknown_question_prompt.question=m),"item-key":"id",handle:".drag-btn",onStart:l[2]||(l[2]=m=>b.value=!0),onEnd:l[3]||(l[3]=m=>b.value=!1)},{item:i(({element:m,index:S})=>[e("div",Il,[e("span",Rl,[t(q,{name:"drag"})]),t(U,{class:"question-option-content",value:m.content,"onUpdate:value":L=>m.content=L,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",Ul,[t($(pe),{class:"del-btn",onClick:L=>_(S)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:h},[t($(Re),{class:"add-btn-icon"}),l[6]||(l[6]=I("添加引导问题 "))])])],512),[[re,c.value]]),ae(e("div",El,[e("div",Ol,R($(f).unknown_question_prompt.content),1),e("div",Al,[(s(!0),v(T,null,G($(f).unknown_question_prompt.question,(m,S)=>(s(),v("div",{class:"question-item",key:S},R(m.content),1))),128))])],512),[[re,!c.value]])]),_:1},8,["isEdit"])}}},Ml=B(jl,[["__scopeId","data-v-aca01d0e"]]),zl={class:"robot-info-box"},Dl={class:"modal-box",ref:"modalBoxRef"},Pl={class:"modal-item-box"},Nl={class:"modal-item"},Tl={class:"modal-item"},Vl={__name:"problem-optimization",setup(j){const c=x(!1);x(!1);const{robotInfo:b,updateRobotInfo:f}=Y("robotInfo"),p=x("0"),n=Q({optimize_question_use_model:"",optimize_question_model_config_id:""});fe(()=>{p.value=b.optimize_question_model_config_id!=0?"1":"0",n.optimize_question_use_model=b.optimize_question_use_model,n.optimize_question_model_config_id=b.optimize_question_model_config_id});const r=x([]),h=l=>{r.value=l,He(()=>{(!n.optimize_question_use_model||!Number(n.optimize_question_model_config_id))&&_()})},_=()=>{if(r.value.length>0){let l=null,o=null;for(let k of r.value)if(k.model_define==="tongyi"){l=k;for(let q of l.children)if(q.name==="qwen-max"){o=q;break}break}l||(l=r.value[0],o=l.children[0]),l&&o&&(n.optimize_question_use_model=o.name,n.optimize_question_model_config_id=o.model_config_id)}},u=()=>{c.value=!1,f({...W(n)})},g=l=>{l!=1&&(n.optimize_question_use_model="",n.optimize_question_model_config_id=0)},a=l=>{f({})};return(l,o)=>{const k=oe,q=se,U=dt,m=rt,S=$e,L=Z;return s(),D(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:i(()=>o[7]||(o[7]=[e("span",null,null,-1)])),default:i(()=>[e("div",zl,[o[9]||(o[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),t(k,null,{title:i(()=>o[8]||(o[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])),default:i(()=>[e("div",{class:"dialog-bg-set",onClick:o[0]||(o[0]=d=>c.value=!0)}," 对话背景设置 ")]),_:1})]),t(q,{onChange:a,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(b).enable_question_optimize,"onUpdate:checked":o[1]||(o[1]=d=>$(b).enable_question_optimize=d),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",Dl,[t(L,{getContainer:()=>l.$refs.modalBoxRef,open:c.value,"onUpdate:open":o[6]||(o[6]=d=>c.value=d),width:472,title:"用户问题建议设置",onOk:u},{default:i(()=>[e("div",Pl,[e("div",Nl,[o[12]||(o[12]=e("div",{class:"label"},"模型",-1)),t(m,{value:p.value,"onUpdate:value":o[2]||(o[2]=d=>p.value=d),onChange:g},{default:i(()=>[t(U,{value:"0"},{default:i(()=>o[10]||(o[10]=[I("跟随机器人")])),_:1,__:[10]}),t(U,{value:"1"},{default:i(()=>o[11]||(o[11]=[I("指定模型")])),_:1,__:[11]})]),_:1},8,["value"]),p.value=="1"?(s(),D(Gt,{key:0,modelType:"LLM",modeName:n.optimize_question_use_model,"onUpdate:modeName":o[3]||(o[3]=d=>n.optimize_question_use_model=d),modeId:n.optimize_question_model_config_id,"onUpdate:modeId":o[4]||(o[4]=d=>n.optimize_question_model_config_id=d),style:{width:"100%","margin-top":"8px"},onLoaded:h},null,8,["modeName","modeId"])):E("",!0)]),e("div",Tl,[o[13]||(o[13]=e("div",{class:"label"},"对话背景",-1)),t(S,{style:{height:"120px"},value:$(b).optimize_question_dialogue_background,"onUpdate:value":o[5]||(o[5]=d=>$(b).optimize_question_dialogue_background=d),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Bl=B(Vl,[["__scopeId","data-v-13ab9369"]]),Ql={class:"robot-info-box"},Fl={class:"robot-prompt"},Jl={__name:"suggested-issues",setup(j){x(!1);const{robotInfo:c,updateRobotInfo:b}=Y("robotInfo"),f=p=>{b({})};return(p,n)=>{const r=Ue,h=se;return s(),D(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:i(()=>n[2]||(n[2]=[e("span",null,null,-1)])),default:i(()=>[e("div",Ql,[e("div",Fl,[n[3]||(n[3]=I(" 开启后，机器人回答问题后，自动根据对话内容提供 ")),t(r,{value:$(c).question_guide_num,"onUpdate:value":n[0]||(n[0]=_=>$(c).question_guide_num=_),style:{width:"80px"},precision:0,min:1,max:10,onBlur:f},null,8,["value"]),n[4]||(n[4]=I(" 条用户提问建议，最大不超过10条。 "))])]),t(h,{onChange:f,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(c).enable_question_guide,"onUpdate:checked":n[1]||(n[1]=_=>$(c).enable_question_guide=_),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Gl=B(Jl,[["__scopeId","data-v-bec632a5"]]),Hl={__name:"sensitive-words",setup(j){x(!1);const{robotInfo:c,updateRobotInfo:b}=Y("robotInfo");Q({prompt:""});const f=()=>{window.open("/#/user/sensitive-words")},p=n=>{b({})};return(n,r)=>{const h=se;return s(),D(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:i(()=>r[1]||(r[1]=[e("span",null,null,-1)])),default:i(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[r[2]||(r[2]=I(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，")),e("span",{onClick:f,style:{cursor:"pointer"}},"设置敏词 >")])]),t(h,{onChange:p,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:$(c).sensitive_words_switch,"onUpdate:checked":r[0]||(r[0]=_=>$(c).sensitive_words_switch=_),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Kl=B(Hl,[["__scopeId","data-v-f1e5ad50"]]),Wl={class:"direct-title"},Zl={class:"direct-desc"},Yl={class:"qa"},Xl={class:"prompt-form-item-label"},ea={class:"direct-switch"},ta={class:"similarity"},oa={class:"number-input-box"},sa={__name:"chat-edit-alert",emits:["save"],setup(j,{expose:c,emit:b}){const f=b,p=x(1),n=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],r=Q(n()),h=x(!1),_=Q({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),u=()=>{_.chat_type=p.value.toString(),r.forEach(l=>{l.chat_type==p.value&&(_.chat_type=="3"?(_.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch==1?"true":"false",_.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score.toString()):_.chat_type=="1"&&(_.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch==1?"true":"false",_.library_qa_direct_reply_score=l.library_qa_direct_reply_score.toString()))}),g(),Object.assign(r,n()),h.value=!1},g=()=>{f("save",W(_))};fe(()=>{});const a=l=>{p.value=parseInt(l.chat_type),_.chat_type=l.chat_type,_.library_qa_direct_reply_score=l.library_qa_direct_reply_score,_.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch,_.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score,_.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch,r.forEach(o=>{o.chat_type=="3"?(o.mixture_qa_direct_reply_score=l.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=l.mixture_qa_direct_reply_switch=="true"?1:0):o.chat_type=="1"&&(o.library_qa_direct_reply_score=l.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=l.library_qa_direct_reply_switch=="true"?1:0)}),h.value=!0};return ue(()=>h.value,l=>{l===!1&&Object.assign(r,n())},{immediate:!0}),c({open:a}),(l,o)=>{const k=oe,q=se,U=Ue,m=dt,S=rt,L=Z;return s(),D(L,{width:"746px",open:h.value,"onUpdate:open":o[1]||(o[1]=d=>h.value=d),title:"聊天模式设置",onOk:u},{default:i(()=>[t(S,{class:"direct-box",value:p.value,"onUpdate:value":o[0]||(o[0]=d=>p.value=d)},{default:i(()=>[(s(!0),v(T,null,G(r,d=>(s(),D(m,{class:Ce(["direct-item",{active:p.value==d.direct_id}]),value:d.direct_id,key:d.direct_id},{default:i(()=>[e("div",Wl,R(d.direct_title),1),e("div",Zl,R(d.direct_desc),1),ae(e("div",Yl,[e("div",Xl,[o[4]||(o[4]=e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),t(k,null,ht({default:i(()=>[t($(ee),{class:"question-icon"})]),_:2},[d.chat_type=="1"?{name:"title",fn:i(()=>[o[2]||(o[2]=I("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"0"}:d.chat_type=="3"?{name:"title",fn:i(()=>[o[3]||(o[3]=I("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"1"}:void 0]),1024),e("div",ea,[d.chat_type=="1"?(s(),D(q,{key:0,checkedValue:1,unCheckedValue:0,checked:d.library_qa_direct_reply_switch,"onUpdate:checked":w=>d.library_qa_direct_reply_switch=w},null,8,["checked","onUpdate:checked"])):d.chat_type=="3"?(s(),D(q,{key:1,checkedValue:1,unCheckedValue:0,checked:d.mixture_qa_direct_reply_switch,"onUpdate:checked":w=>d.mixture_qa_direct_reply_switch=w},null,8,["checked","onUpdate:checked"])):E("",!0)])])],512),[[re,d.isQaDirectReply&&p.value==d.direct_id]]),ae(e("div",ta,[o[5]||(o[5]=e("span",null,"相似度超过",-1)),e("div",oa,[d.chat_type=="1"?(s(),D(U,{key:0,value:d.library_qa_direct_reply_score,"onUpdate:value":w=>d.library_qa_direct_reply_score=w,disabled:!d.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):d.chat_type=="3"?(s(),D(U,{key:1,value:d.mixture_qa_direct_reply_score,"onUpdate:value":w=>d.mixture_qa_direct_reply_score=w,disabled:!d.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):E("",!0)]),o[6]||(o[6]=e("span",null,"时直接回复答案",-1))],512),[[re,d.isQaDirectReply&&p.value==d.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},na=B(sa,[["__scopeId","data-v-fc008010"]]),ia={class:"actions-box"},la={class:"setting-info-block"},aa={class:"set-item"},ra={key:0},da={key:1},_a={key:2},ca={class:"set-item"},ua={key:0,class:"set-item"},pa={class:"set-item"},ma={key:0,class:"set-item"},va={class:"form-box"},fa={__name:"index",setup(j){const c=x(!1),b=x(null),{robotInfo:f,updateRobotInfo:p}=Y("robotInfo"),n=Q({chat_type:f.chat_type,library_qa_direct_reply_score:f.library_qa_direct_reply_score,library_qa_direct_reply_switch:f.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:f.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:f.mixture_qa_direct_reply_switch}),r=u=>{n.chat_type=u.chat_type,n.library_qa_direct_reply_score=u.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch,h()},h=()=>{p({...W(n)}),c.value=!1},_=()=>{b.value.open(W(n)),c.value=!0};return(u,g)=>{const a=oe,l=te;return s(),D(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:c.value,"onUpdate:isEdit":g[1]||(g[1]=o=>c.value=o),bodyStyle:{padding:0}},{tip:i(()=>[t(a,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>g[2]||(g[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])),default:i(()=>[t($(ee))]),_:1})]),extra:i(()=>[e("div",ia,[t(l,{size:"small",onClick:g[0]||(g[0]=o=>_(!0))},{default:i(()=>g[3]||(g[3]=[I("修改")])),_:1,__:[3]})])]),default:i(()=>[e("div",la,[e("div",aa,[g[4]||(g[4]=I(" 聊天模式： ")),$(f).chat_type=="1"?(s(),v("span",ra,"仅知识库")):E("",!0),$(f).chat_type=="2"?(s(),v("span",da,"直连模式")):E("",!0),$(f).chat_type=="3"?(s(),v("span",_a,"混合模式")):E("",!0)]),$(f).chat_type=="1"?(s(),v(T,{key:0},[e("div",ca,[g[5]||(g[5]=I(" QA文档直接回复答案： ")),e("span",null,R($(f).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),$(f).library_qa_direct_reply_switch=="true"?(s(),v("div",ua,[g[6]||(g[6]=I(" 相似度值： ")),e("span",null,R($(f).library_qa_direct_reply_score),1)])):E("",!0)],64)):E("",!0),$(f).chat_type=="3"?(s(),v(T,{key:1},[e("div",pa,[g[7]||(g[7]=I(" QA文档直接回复答案： ")),e("span",null,R($(f).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),$(f).mixture_qa_direct_reply_switch=="true"?(s(),v("div",ma,[g[8]||(g[8]=I(" 相似度值： ")),e("span",null,R($(f).mixture_qa_direct_reply_score),1)])):E("",!0)],64)):E("",!0)]),e("div",va,[t(na,{ref_key:"ChatEditAlertRef",ref:b,onSave:r},null,512)])]),_:1},8,["isEdit"])}}},ba=B(fa,[["__scopeId","data-v-be544020"]]),ha={class:"switch-box"},ya={class:"switch-box-body"},ka={class:"switch-box-header"},ga={class:"left-box"},$a={class:"switch-box-title"},xa={key:0,class:"title-tip"},wa={class:"right-box"},qa={class:"extra-box"},Sa={class:"switch-desc"},Ca={class:"switch-box-right"},La={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(j,{emit:c}){const b=c,f=j,p=x(f.value),n=r=>{b("update:value",r),b("change",r)};return(r,h)=>{const _=de,u=se;return s(),v("div",ha,[e("div",ya,[e("div",ka,[e("div",ga,[t(_,{class:"switch-box-icon",name:f.iconName},null,8,["name"]),e("span",$a,R(f.title),1),r.$slots.tip?(s(),v("span",xa,[ce(r.$slots,"tip",{},void 0,!0)])):E("",!0)]),e("div",wa,[e("div",qa,[ce(r.$slots,"extra",{},()=>[h[1]||(h[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",Sa,[ce(r.$slots,"default",{},void 0,!0)])]),e("div",Ca,[t(u,{checked:p.value,"onUpdate:checked":h[0]||(h[0]=g=>p.value=g),onChange:n,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Ia=B(La,[["__scopeId","data-v-0548f52d"]]),Ra="/assets/img/empty-Bx9z1cwf.png",Ua="/assets/img/phone-head-CDwwPhYa.png",Ea="/assets/img/phone-body-CbEf8GZP.png",Oa="/assets/img/phone-footer-ClQtNpln.png",Aa={class:"common-problem-box"},ja={class:"left-content-box"},Ma={key:0,class:"empty-box"},za={key:1,class:"lists-box"},Da={class:"drag-btn"},Pa={class:"title"},Na={class:"opration-box"},Ta={class:"preview-box"},Va={class:"phone-body"},Ba={key:0,class:"question-box"},Qa={__name:"common-problem",setup(j){x(!1);const{robotInfo:c,updateRobotInfo:b}=Y("robotInfo"),f=ve(()=>c.common_question_list?JSON.parse(c.common_question_list):[]),p=x([]);p.value=f.value,ue(f,()=>{p.value=f.value});const n=je.useForm,r=x(!1),h=x("添加问题"),_=Q({question:"",index:-1}),u=Q({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:g,validate:a,validateInfos:l}=n(_,u),o=()=>{if(f.value.length>=10)return K.error("最多设置10条常用问题");r.value=!0,g(),_.question="",_.index=-1},k=(L,d)=>{r.value=!0,g(),_.question=L,_.index=d},q=L=>{let d=[];d=f.value.filter((w,F)=>L!=F),Z.confirm({title:"提醒",icon:t(Ae),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){b({common_question_list:JSON.stringify(d)})},onCancel(){}})},U=()=>{a().then(()=>{let L=[];_.index>=0?L=f.value.map((d,w)=>w===_.index?_.question:d):L=[_.question,...f.value],b({common_question_list:JSON.stringify(L)}),r.value=!1})},m=L=>{b({})},S=L=>{b({common_question_list:JSON.stringify(p.value)})};return(L,d)=>{const w=oe,F=se,M=Ht,C=te,O=de,J=_e,P=Ze,H=je,N=Z;return s(),v("div",Aa,[e("div",ja,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:i(()=>[t(w,null,{title:i(()=>d[4]||(d[4]=[I("最多10条。开启后，常见问题会显示在每条问答后面")])),default:i(()=>[t($(ee),{class:"quess-icon"})]),_:1})]),extra:i(()=>[t(F,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:$(c).enable_common_question,"onUpdate:checked":d[0]||(d[0]=z=>$(c).enable_common_question=z),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(M,{type:"vertical"}),t(C,{type:"primary",size:"small",onClick:o},{default:i(()=>d[5]||(d[5]=[I("添加")])),_:1,__:[5]})]),default:i(()=>[f.value.length==0?(s(),v("div",Ma,[d[7]||(d[7]=e("img",{src:Ra,alt:""},null,-1)),d[8]||(d[8]=e("div",{class:"title"},"暂无数据",-1)),d[9]||(d[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),t(C,{onClick:o,type:"primary"},{default:i(()=>d[6]||(d[6]=[I("立即添加")])),_:1,__:[6]})])):(s(),v("div",za,[t($(Pe),{modelValue:p.value,"onUpdate:modelValue":d[1]||(d[1]=z=>p.value=z),handle:".drag-btn","item-key":"index",onEnd:S},{item:i(({element:z,index:be})=>[(s(),v("div",{class:"list-item",key:be},[e("span",Da,[t(O,{name:"drag"})]),e("div",Pa,R(z),1),e("div",Na,[t($(_t),{onClick:Ee=>k(z,be)},null,8,["onClick"]),t($(pe),{onClick:Ee=>q(be)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Ta,[d[12]||(d[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ua,alt:""})],-1)),e("div",Va,[d[11]||(d[11]=e("div",null,[e("img",{class:"body-img",src:Ea,alt:""})],-1)),f.value.length&&$(c).enable_common_question=="true"?(s(),v("div",Ba,[d[10]||(d[10]=e("div",{class:"name"},"常见问题",-1)),(s(!0),v(T,null,G(f.value,z=>(s(),v("div",{class:"list-item",key:z},R(z),1))),128))])):E("",!0)]),d[13]||(d[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Oa,alt:""})],-1))]),t(N,{open:r.value,"onUpdate:open":d[3]||(d[3]=z=>r.value=z),title:h.value,onOk:U,width:"476px"},{default:i(()=>[t(H,{class:"form-box",layout:"vertical"},{default:i(()=>[t(P,yt({label:"问题名称"},$(l).question),{default:i(()=>[t(J,{maxLength:100,value:_.question,"onUpdate:value":d[2]||(d[2]=z=>_.question=z),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Fa=B(Qa,[["__scopeId","data-v-dce83f0d"]]),Ja={__name:"display-aitations",setup(j){const{robotInfo:c,updateRobotInfo:b}=Y("robotInfo"),f=x(!1);ue(()=>c.answer_source_switch,n=>{f.value=n=="true"},{immediate:!0});const p=()=>{b({answer_source_switch:f.value?"true":"false"})};return(n,r)=>(s(),D(Ia,{title:"显示引文","icon-name":"jibenpeizhi",value:f.value,"onUpdate:value":r[0]||(r[0]=h=>f.value=h),onChange:p},{extra:i(()=>r[1]||(r[1]=[e("span",null,null,-1)])),default:i(()=>[r[2]||(r[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1,__:[2]},8,["value"]))}},Ga={__name:"show-like",setup(j){const{robotInfo:c,updateRobotInfo:b}=Y("robotInfo"),f=p=>{b({})};return(p,n)=>{const r=se;return s(),D(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:i(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:i(()=>[n[2]||(n[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),t(r,{onChange:f,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:$(c).feedback_switch,"onUpdate:checked":n[0]||(n[0]=h=>$(c).feedback_switch=h),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[2]})}}},Ha=B(Ga,[["__scopeId","data-v-73894b10"]]),Ka={class:"content-box"},Wa={key:0,class:"add-btn-block"},Za={class:"list-content"},Ya={key:0,class:"user-block"},Xa={class:"name-box"},er={class:"name"},tr={class:"remark-text"},or={key:0,class:"hover-btn-box"},sr={key:0},nr={key:1},ir={key:2},lr={key:1,class:"hover-btn-box"},ar={class:"role-menu-box"},rr=["onClick"],dr={class:"menu-header"},_r={key:0,class:"check-box"},cr=["onClick"],ur={class:"menu-header"},pr={key:0,class:"check-box"},mr=["onClick"],vr={class:"menu-header"},fr={key:0,class:"check-box"},br={class:"hover-btn-box"},hr={key:0},yr={key:1},kr={key:2},gr=["onClick"],$r={__name:"role-permission",setup(j){const c=Je().query,b=x(Rt(c.id)),f=x([]),p=Q({object_id:c.id,object_type:1}),n=()=>{Wt({...p}).then(a=>{let l=a.data||[];f.value=l})};n();const r=x(null),h=()=>{r.value.show(f.value,[{object_id:+c.id,object_type:1,operate_rights:4}])},_=(a,l)=>{let o=l==4?"管理":l==2?"编辑":"查看";Z.confirm({title:"提示?",icon:t(Ae),content:"确认修改该协作者权限为【"+o+"】",okText:"确认",cancelText:"取消",onOk:()=>{let k=[{object_id:+a.object_id,object_type:+a.object_type,operate_rights:+l}];Zt({identity_ids:a.identity_id,identity_type:a.identity_type,object_array:JSON.stringify(k)}).then(q=>{K.success("修改成功"),n()})},onCancel(){}})},u=a=>{Z.confirm({title:"提示?",icon:t(Ae),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{Yt({identity_id:a.identity_id,identity_type:a.identity_type,object_id:a.object_id,object_type:a.object_type}).then(l=>{K.success("删除成功"),n()})},onCancel(){}})},g=x([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(a,l)=>{const o=te,k=eo,q=oo,U=so,m=Me;return s(),D(m,null,{default:i(()=>[e("div",Ka,[b.value==4?(s(),v("div",Wa,[t(o,{type:"primary",onClick:h,icon:Ge($(Re))},{default:i(()=>l[0]||(l[0]=[I("添加协助者")])),_:1,__:[0]},8,["icon"])])):E("",!0),e("div",Za,[t(U,{columns:g.value,"data-source":f.value,pagination:!1},{bodyCell:i(({column:S,record:L})=>[S.key==="name"?(s(),v("div",Ya,[t(k,{shape:"square",src:L.avatar,size:40},{icon:i(()=>[L.avatar?E("",!0):(s(),D($(Qe),{key:0}))]),_:2},1032,["src"]),e("div",Xa,[e("div",er,R(L.user_name),1),e("div",tr,R(L.name),1)])])):E("",!0),S.key==="operate_rights"?(s(),v(T,{key:1},[b.value==2?(s(),v("div",or,[L.operate_rights==4?(s(),v("span",sr,"管理")):E("",!0),L.operate_rights==2?(s(),v("span",nr,"编辑")):E("",!0),L.operate_rights==1?(s(),v("span",ir,"查看")):E("",!0)])):L.role_type==1||L.is_creator==1?(s(),v("div",lr,"管理")):(s(),D(q,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:i(()=>[e("div",ar,[e("div",{class:"role-menu",onClick:d=>_(L,4)},[e("div",dr,[t($(Qe)),l[1]||(l[1]=e("span",{class:"title"},"管理",-1))]),l[2]||(l[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),L.operate_rights==4?(s(),v("div",_r,[t($(Oe))])):E("",!0)],8,rr),e("div",{class:"role-menu",onClick:d=>_(L,2)},[e("div",ur,[t($(_t)),l[3]||(l[3]=e("span",{class:"title"},"编辑",-1))]),l[4]||(l[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),L.operate_rights==2?(s(),v("div",pr,[t($(Oe))])):E("",!0)],8,cr),e("div",{class:"role-menu",onClick:d=>_(L,1)},[e("div",vr,[t($(to)),l[5]||(l[5]=e("span",{class:"title"},"查看",-1))]),l[6]||(l[6]=e("div",{class:"desc"},"仅查看",-1)),L.operate_rights==1?(s(),v("div",fr,[t($(Oe))])):E("",!0)],8,mr)])]),default:i(()=>[e("div",br,[L.operate_rights==4?(s(),v("span",hr,"管理")):E("",!0),L.operate_rights==2?(s(),v("span",yr,"编辑")):E("",!0),L.operate_rights==1?(s(),v("span",kr,"查看")):E("",!0),t($(ot))])]),_:2},1024))],64)):E("",!0),S.key==="action"?(s(),v(T,{key:2},[b.value==4?(s(),v(T,{key:0},[L.role_type!=1&&L.is_creator!=1?(s(),v("a",{key:0,onClick:d=>u(L)},"移除",8,gr)):E("",!0)],64)):E("",!0)],64)):E("",!0)]),_:1},8,["columns","data-source"])])]),t(Xt,{onOk:n,ref_key:"addCollaboratorRef",ref:r},null,512)]),_:1})}}},xr=B($r,[["__scopeId","data-v-2b384f47"]]),wr={class:"library-checkbox-box"},qr={class:"list-box",ref:"scrollContainer"},Sr={class:"library-name"},Cr={key:0,class:"library-desc"},Lr={class:"library-desc"},Ir={key:0,class:"empty-box"},Rr={__name:"robot-select-alert",emits:["change"],setup(j,{expose:c,emit:b}){const f=b,p=Q({indeterminate:!1,checkAll:!1,checkedList:[]}),n=x(!1),r=l=>{g(),p.checkedList=l,n.value=!0},h=()=>{n.value=!1,u()};x("");const _=x([]),u=()=>{f("change",[...p.checkedList])},g=async()=>{const l=await We({application_type:1});if(l){let o=l.data||[];_.value=o}},a=x(!1);return c({open:r}),(l,o)=>{const k=De,q=ze,U=Ie,m=Z;return s(),D(m,{width:"746px",open:n.value,"onUpdate:open":o[1]||(o[1]=S=>n.value=S),title:"添加技能",onOk:h},{default:i(()=>[e("div",wr,[t(U,{spinning:a.value,delay:100},{default:i(()=>[t(q,{value:p.checkedList,"onUpdate:value":o[0]||(o[0]=S=>p.checkedList=S),style:{width:"100%"}},{default:i(()=>[e("div",qr,[(s(!0),v(T,null,G(_.value,S=>(s(),v("div",{class:"list-item-wraapper",key:S.id},[t(k,{class:"list-item",disabled:S.start_node_key==="",value:S.id},{default:i(()=>[e("div",Sr,[I(R(S.robot_name)+" ",1),S.start_node_key===""?(s(),v("span",Cr," (未发布)")):E("",!0)]),e("div",Lr,R(S.robot_intro),1)]),_:2},1032,["disabled","value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!a.value&&!_.value.length?(s(),v("div",Ir,o[2]||(o[2]=[e("img",{src:at,alt:""},null,-1),e("div",null,"暂无数据表, 请先去添加数据表",-1)]))):E("",!0)])]),_:1},8,["open"])}}},Ur=B(Rr,[["__scopeId","data-v-99f68955"]]),Er={class:"actions-box"},Or={key:0,class:"library-list"},Ar=["onClick"],jr={class:"library-name"},Mr={class:"library-intro"},zr={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(j){const c=x(!1),{robotInfo:b,getRobot:f}=Y("robotInfo"),p=j,n=Q({work_flow_ids:[]}),r=x(null),h=ve(()=>p.robotList.filter(l=>n.work_flow_ids.includes(l.id))),_=l=>{let o=n.work_flow_ids.indexOf(l.id);n.work_flow_ids.splice(o,1),a()},u=l=>{n.work_flow_ids=[...l],a()},g=()=>{r.value.open([...n.work_flow_ids])},a=()=>{let l={...W(n)};l.work_flow_ids=l.work_flow_ids.join(","),Ot({id:b.id,...l}).then(o=>{K.success("保存成功"),f(b.id)})};return Le(()=>{n.work_flow_ids=b.work_flow_ids.split(",")}),(l,o)=>{const k=oe,q=te,U=ge;return s(),D(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:c.value,"onUpdate:isEdit":o[0]||(o[0]=m=>c.value=m),bodyStyle:{padding:0}},{tip:i(()=>[t(k,{placement:"top"},{title:i(()=>o[1]||(o[1]=[e("span",null,"支持关联工作流",-1)])),default:i(()=>[t($(ee))]),_:1})]),extra:i(()=>[e("div",Er,[t(U,{gap:8},{default:i(()=>[t(q,{size:"small",onClick:g},{default:i(()=>o[2]||(o[2]=[I("添加技能")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[h.value.length>0?(s(),v("div",Or,[(s(!0),v(T,null,G(h.value,m=>(s(),v("div",{class:"library-item",key:m.id},[e("span",{class:"close-btn",onClick:S=>_(m)},[t($(pe))],8,Ar),e("div",jr,R(m.robot_name),1),e("div",Mr,R(m.robot_intro),1)]))),128))])):E("",!0),t(Ur,{ref_key:"robotSelectAlertRef",ref:r,onChange:u},null,512)]),_:1},8,["isEdit"])}}},Dr=B(zr,[["__scopeId","data-v-e0ced8ed"]]),Pr={key:0,class:"robot-config-page"},Nr={class:"setting-box"},Tr={class:"setting-box"},Vr={class:"setting-box"},Br={class:"setting-box"},Qr={class:"setting-box"},Fr={class:"setting-box"},Jr={class:"setting-box"},Gr={class:"setting-box"},Hr={class:"setting-box"},Kr={class:"setting-box"},Wr={class:"setting-box"},Zr={class:"setting-box"},Yr={class:"setting-box"},Xr={class:"setting-box"},ed={key:1,class:"robot-config-page"},td={key:2,class:"robot-config-page"},od={__name:"index",setup(j){const c=Kt(),b=x(null),{robotInfo:f}=kt(c),{getRobot:p}=c,n=()=>{b.value.scrollTop=b.value.scrollHeight},r=x(1),h=x(!1),_=Q(f.value),u=o=>{let k=JSON.parse(JSON.stringify(o));o.robot_avatar&&(k.robot_avatar=new File([o.robot_avatar],o.robot_avatar.name)),Object.assign(_,k),l()},g=x([]);(()=>{We({application_type:1}).then(o=>{g.value=o.data||[]})})(),gt("robotInfo",{robotInfo:_,updateRobotInfo:u,scrollBoxToBottom:n,getRobot:p});const l=()=>{let o;_.robot_avatar&&(o=new File([_.robot_avatar],_.robot_avatar.name));let k=JSON.parse(JSON.stringify(W(_)));o&&(k.robot_avatar=o);let q=k.welcomes;q.question=q.question.map(m=>m.content),k.welcomes=JSON.stringify(q),k.prompt_struct=JSON.stringify(k.prompt_struct);let U=k.unknown_question_prompt;U.question=U.question.map(m=>m.content),k.unknown_question_prompt=JSON.stringify(U),delete k.robot_avatar_url,h.value=!0,At(k).then(m=>{if(m.res!=0)return K.error(m.msg);h.value=!1,K.success("保存成功"),p(_.id)}).catch(()=>{h.value=!1})};return(o,k)=>{const q=et,U=tt;return s(),v(T,null,[t(U,{class:"tab-wrapper",activeKey:r.value,"onUpdate:activeKey":k[0]||(k[0]=m=>r.value=m)},{default:i(()=>[(s(),D(q,{key:1,tab:"基础配置"})),(s(),D(q,{key:3,tab:"权限管理"})),(s(),D(q,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),r.value==1?(s(),v("div",Pr,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:b},[e("div",Nr,[t(Ro)]),e("div",Tr,[t(el)]),e("div",Vr,[t(Vn)]),e("div",Br,[t(ba)]),e("div",Qr,[t(an,{robotList:g.value},null,8,["robotList"])]),e("div",Fr,[t(Dr,{robotList:g.value},null,8,["robotList"])]),e("div",Jr,[t(ml)]),e("div",Gr,[t(ql)]),e("div",Hr,[t(Ml)]),e("div",Kr,[t(Kl)]),e("div",Wr,[t(Bl)]),e("div",Zr,[t(Gl)]),e("div",Yr,[t(Ja)]),e("div",Xr,[t(Ha)])],512)])):E("",!0),r.value==2?(s(),v("div",ed,[t(Fa)])):E("",!0),r.value==3?(s(),v("div",td,[t(xr)])):E("",!0)],64)}}},U_=B(od,[["__scopeId","data-v-b61909e4"]]);export{U_ as default};
