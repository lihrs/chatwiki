import{b as E,af as he,k as O,d as Q,B as ee,M as be,a2 as ye,dO as te,f as ge,dP as ke,dQ as xe,bW as we,dh as Se}from"../../index-CfxQ5aRu.js";import{B as T,b as H,e as x,w as $e,x as Y,M as i,N as v,W as t,k as e,S as o,Y as k,Q as P,F as q,$ as ae,Z as I,a7 as z,a1 as oe,a2 as se,d as le,a8 as Ce,a6 as Le,G as De,H as Ie,u as W,z as Ue,a0 as K,a5 as Re,p as X,aa as Me}from"./vue-chunks-BjMuQ6KD.js";import{C as Oe}from"./config-page-menu-DyN5fJ4W.js";import{u as Pe}from"./index-BOicLpMv.js";import"./index-DPiF7UEG.js";import{R as re,_ as ne}from"./RadioButton-_iRIgmgW.js";import{_ as ze}from"./index-DcUUFn-g.js";import{I as Be}from"./Input-C5WaaE9Z.js";import{_ as ie,F as ce}from"./index-xqeVJHPz.js";import{S as Fe,_ as je}from"./index-BuS_bfCI.js";import{B as V,P as Ae,S as Te,M as Ne}from"./pull-up.esm-JZ91zQ8P.js";import{d as _e}from"./role_avatar-DL0r08JY.js";import{A as ue}from"./index-DjukszQZ.js";import{_ as Ve,M as We}from"./index-Bx_z5H0C.js";import"./index-CBvtIVuM.js";import{D as qe}from"./dropdown-DsYo-imx.js";import{P as Ee}from"./PlusOutlined-xiVHYVI8.js";import{D as He}from"./DownOutlined-Gk0UBxct.js";import{_ as Qe}from"./index-DAEefp5e.js";import{_ as Ye}from"./index-CjFLR2DA.js";import{a as Ge}from"./index-P3IiyBCy.js";import"./axios-Cm0UX6qg.js";import"./qs-DjdPq-RR.js";import"./crypto-js-BemCeW_6.js";import"./dayjs-DK4rpucX.js";import"./FormItemContext-DQ1b1ToO.js";import"./Checkbox-DQe8ZxR1.js";import"./index-D6-G2N0k.js";import"./Search-DozVr2pE.js";import"./SearchOutlined-B7dGgS_P.js";import"./isPlainObject-xAKL-sfk.js";import"./inputProps-D7qr__m5.js";import"./TextArea-CN_AI7y7.js";import"./index-CXSrVsd0.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./Password-BCnVcrNJ.js";import"./Trigger-Dy6Dc2CN.js";import"./responsiveObserve-X1b6Czsg.js";import"./collapseMotion-BH6Vz7El.js";import"./index-D1MiuDW_.js";import"./colors-C9XVGyX_.js";import"./QuestionCircleOutlined-Deh272L3.js";import"./slide-BYYxYcj9.js";import"./CheckOutlined-BLsT0eZM.js";import"./move-BjmscfYf.js";import"./index-C38XHIGB.js";import"./useMaxLevel-C9fYQrQA.js";import"./CaretDownFilled-CgS0_Akm.js";import"./index-BSl1-tWC.js";import"./index-C-uK-k7U.js";import"./shallowequal-B6gQS78g.js";import"./RightOutlined-BHf0iqSq.js";import"./css-DbBMd65r.js";import"./fromPairs-Dx9PT-t0.js";import"./index-BLP-Fxny.js";import"./LeftOutlined-qzkQKHcF.js";import"./index-CxLzlFzW.js";import"./CaretDownOutlined-Qu8nVykI.js";const G=h=>(oe("data-v-f2139ed1"),h=h(),se(),h),Ze={class:"form-box"},Je={class:"form-box-header"},Ke={class:"form-box-label"},Xe=G(()=>t("span",{class:"form-box-label-text"},"访问权限",-1)),et=G(()=>t("div",null,null,-1)),tt={class:"share-url-box"},at=G(()=>t("div",null,[t("a",{href:"/#/user/domain"},"添加自定义域名")],-1)),ot={__name:"permissions-form",props:{value:{type:Object,default:()=>({})},saveLoading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(h,{emit:U}){const{toClipboard:L}=Pe(),m=U,$=h,s=T({access_rights:"0",share_url:void 0,library_key:""}),p=H(()=>s.share_url+"/open/home/"+s.library_key),b=()=>{m("submit",s)},a=x([]),_=()=>{he().then(c=>{a.value=c.data||[],s.share_url||(a.value.length>0?s.share_url=a.value[0].url:s.share_url=window.location.origin)})},R=c=>{s.access_rights=c.access_rights,s.share_url=c.share_url,s.library_key=c.library_key,(a.value.length==0||!s.share_url)&&_()},B=async()=>{s.share_url||O.error("请选择自定义域名");let c=p.value;try{await L(c),O.success("复制成功")}catch{O.error("复制失败")}};return $e($.value,c=>{R({...c})}),Y(()=>{_()}),(c,D)=>{const y=Q,C=re,r=ne,l=ie,g=Fe,u=je,F=Be,M=ze,j=ee,A=ce;return i(),v("div",Ze,[t("div",Je,[t("div",Ke,[e(y,{name:"auth",style:{"font-size":"14px",color:"#333"}}),Xe]),et]),e(A,{"label-col":{span:4},style:{width:"750px"}},{default:o(()=>[e(l,{label:"访问权限"},{default:o(()=>[e(r,{value:s.access_rights,"onUpdate:value":D[0]||(D[0]=w=>s.access_rights=w),onChange:b},{default:o(()=>[e(C,{value:"0"},{default:o(()=>[k("私有，仅能与应用关联，作为应用知识库")]),_:1}),e(C,{value:"1"},{default:o(()=>[k("公开，发布到互联网，所有人可访问")]),_:1})]),_:1},8,["value"])]),_:1}),s.access_rights==1?(i(),P(l,{key:0,label:"分享链接"},{default:o(()=>[t("div",tt,[e(M,{compact:"",style:{width:"460px"}},{default:o(()=>[e(u,{style:{width:"45%"},value:s.share_url,"onUpdate:value":D[1]||(D[1]=w=>s.share_url=w),placeholder:"请选择自定义域名",onChange:b},{default:o(()=>[(i(!0),v(q,null,ae(a.value,w=>(i(),P(g,{value:w.url,key:w.id},{default:o(()=>[k(I(w.url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),e(F,{disabled:!0,value:"/open/home/"+s.library_key,style:{width:"55%"}},null,8,["value"])]),_:1}),e(j,{class:"copy-btn",onClick:B},{default:o(()=>[k("复制")]),_:1})]),at]),_:1})):z("",!0)]),_:1})])}}},st=E(ot,[["__scopeId","data-v-f2139ed1"]]),lt={class:"form-box"},rt={class:"collaborator-list-tip"},nt={class:"list-content"},it={class:"collaborator-grid"},ct=["onClick"],_t={class:"user-info"},ut={class:"user-details"},dt={class:"user-name"},pt={class:"user-nickname"},mt={key:0,class:"loading-more"},ft={key:1,class:"no-more"},vt={__name:"add-collaborator",props:{excludedIds:{type:Array,default:()=>[]}},emits:["ok"],setup(h,{expose:U,emit:L}){V.use(Ae),V.use(Te),V.use(Ne);const m=L,$=h,s=le("libraryState",{}),p=x(!1),b=x(null),a=x(!1),_=T({permission:"2",collaborators:[]}),R={permission:[{required:!0,message:"请选择协作权限"}],collaborators:[{required:!0,message:"请选择协作者",type:"array",min:1}]},B=n=>{let d=_.collaborators.indexOf(n.id);d>-1?_.collaborators.splice(d,1):_.collaborators.push(n.id)},c=x([]),D=H(()=>c.value.filter(n=>!$.excludedIds.includes(n.id))),y=T({page:1,size:20,total:0,search:""}),C=x(null),r=x(!1),l=x(!1);let g=x(null);const u=()=>{if(g.value){g.value.refresh();return}g.value=new V(C.value,{probeType:2,click:!0,scrollY:!0,bounce:!1,pullUpLoad:!0,scrollbar:{fade:!1,interactive:!0},mouseWheel:{speed:20,invert:!1,easeTime:300}}),g.value.on("pullingUp",F)},F=async()=>{r.value||l.value||(y.page=y.page+1,r.value=!0,await M(),g.value.finishPullUp(),r.value=!1)},M=async()=>{let n={page:y.page,size:y.size,search:y.search};return ye(n).then(d=>{let f=d.data.list||[];return y.page==1?c.value=c.value=f:c.value=c.value.concat(f),y.total=+d.data.total,c.value.length>=y.total&&(l.value=!0),Ue(()=>{g.value&&g.value.refresh()}),d})},j=()=>{let n={operate_rights:_.permission,user_ids:_.collaborators.join(","),type:1,library_key:s.library_key};a.value=!0,te(n).then(()=>{p.value=!1,a.value=!1,m("ok",n),O.success("添加成功")}).catch(()=>{a.value=!1})},A=async()=>{var n;try{await((n=b.value)==null?void 0:n.validate()),j()}catch(d){console.error("表单验证失败:",d)}},w=()=>{var n;(n=b.value)==null||n.resetFields(),p.value=!1};return U({open:()=>{var n;p.value=!0,(n=b.value)==null||n.resetFields(),y.page=1,M(),setTimeout(()=>{u()},200)}}),(n,d)=>{const f=re,N=ne,J=ie,de=Ce("RouterLink"),pe=Q,me=ue,fe=ce,ve=be;return i(),P(ve,{open:p.value,"onUpdate:open":d[1]||(d[1]=S=>p.value=S),title:"添加协作者",width:"760px",confirmLoading:a.value,onOk:A,onCancel:w},{default:o(()=>[t("div",lt,[e(fe,{layout:"vertical",model:_,rules:R,ref_key:"formRef",ref:b},{default:o(()=>[e(J,{name:"permission",label:"协作权限"},{default:o(()=>[e(N,{value:_.permission,"onUpdate:value":d[0]||(d[0]=S=>_.permission=S)},{default:o(()=>[e(f,{value:"4"},{default:o(()=>[k("可管理")]),_:1}),e(f,{value:"2"},{default:o(()=>[k("可编辑")]),_:1})]),_:1},8,["value"])]),_:1}),e(J,{name:"collaborators",label:"协作者"},{default:o(()=>[t("div",rt,[k(" 如果协作者没有账号，请先到团队管理中添加账号 "),e(de,{to:"/user/manage",target:"_blank"},{default:o(()=>[k("去添加")]),_:1})]),t("div",{class:"collaborator-list",ref_key:"listRef",ref:C},[t("div",nt,[t("div",it,[(i(!0),v(q,null,ae(D.value,S=>(i(),v("div",{class:Le(["collaborator-item",{active:_.collaborators.includes(S.id)}]),key:S.id,onClick:Tt=>B(S)},[De(e(pe,{name:"check-arrow-filled",class:"check-icon"},null,512),[[Ie,_.collaborators.includes(S.id)]]),t("div",_t,[e(me,{class:"user-avatar",src:S.avatar||W(_e)},null,8,["src"]),t("div",ut,[t("div",dt,I(S.user_name),1),t("div",pt,I(S.nick_name),1)])])],10,ct))),128))]),r.value?(i(),v("div",mt,"加载中...")):z("",!0),l.value?(i(),v("div",ft,"没有更多了")):z("",!0)])],512)]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"])}}},ht=E(vt,[["__scopeId","data-v-63eab63e"]]),bt=h=>(oe("data-v-36368ac1"),h=h(),se(),h),yt={class:"collaborator-list-box"},gt={class:"list-tools-box"},kt={class:"list-label"},xt={class:"label-text"},wt={class:"tools-box-right"},St={class:"list-box"},$t={key:0,class:"name-cell"},Ct={class:"user-info"},Lt={class:"username"},Dt={class:"nickname"},It={key:0,class:"role-cell"},Ut={key:1,class:"role-cell"},Rt=bt(()=>t("a",{href:"#"},"移除",-1)),Mt={key:1},Ot={__name:"collaborator-list",setup(h){const U=ge(),L=le("libraryState",{}),m=x(null),$=[{title:"姓名",key:"name",width:"40%"},{title:"角色",dataIndex:"role",key:"role",width:"40%"},{title:"操作",key:"action",width:"20%"}],s={4:{label:"可管理",value:"4"},2:{label:"可编辑",value:"2"}},p=T({current:1,pageSize:999,total:0}),b=x([]),a=H(()=>b.value.map(r=>r.user_id)),_=(r,l)=>{l.operate_rights=r.key*1,l.operate_rights_label=s[l.operate_rights].label||"",R(l)},R=r=>{let l={operate_rights:r.operate_rights,user_ids:r.user_id,type:2,library_key:L.library_key};te(l).then(()=>{O.success("修改成功")}).catch(()=>{})},B=()=>{m.value.open()},c=r=>{let l={id:r.id,library_key:L.library_key};ke(l).then(()=>{O.success("移除成功"),C()}).catch(()=>{})},D=()=>{C()},y=r=>{Object.assign(p,r),C()},C=()=>{xe({library_key:L.library_key,page:p.current,size:p.pageSize}).then(r=>{let l=r.data.list||[],{user_id:g}=U.userInfo;p.total=r.data.total,l.forEach(u=>{u.showDelete=!0,g==u.user_id&&(u.showDelete=!1),u.role_type==1&&(u.showDelete=!1),u.operate_rights=u.operate_rights*1,u.operate_rights_label="无权限",s[u.operate_rights]&&(u.operate_rights_label=s[u.operate_rights].label)}),b.value=l})};return Y(()=>{C()}),(r,l)=>{const g=Q,u=ee,F=ue,M=Ve,j=We,A=qe,w=Qe,Z=Ye,n=Ge;return i(),v("div",yt,[t("div",gt,[t("div",kt,[e(g,{name:"collaborator"}),t("span",xt,"协助权限 ("+I(p.total)+")",1)]),t("div",wt,[e(u,{type:"primary",size:"small",onClick:B},{default:o(()=>[e(W(Ee)),k(" 添加协助者")]),_:1})])]),t("div",St,[e(n,{columns:$,"data-source":b.value,pagination:p,onChange:y},{bodyCell:o(({column:d,record:f})=>[d.key==="name"?(i(),v("div",$t,[e(F,{class:"avatar",src:f.avatar||W(_e)},null,8,["src"]),t("div",Ct,[t("div",Lt,I(f.user_name),1),t("div",Dt,I(f.nick_name),1)])])):z("",!0),d.key==="role"?(i(),v(q,{key:1},[f.showDelete?(i(),v("div",It,[e(A,null,{overlay:o(()=>[e(j,{onClick:N=>_(N,f)},{default:o(()=>[(i(),P(M,{key:4},{default:o(()=>[k("可管理")]),_:1})),(i(),P(M,{key:2},{default:o(()=>[k("可编辑")]),_:1}))]),_:2},1032,["onClick"])]),default:o(()=>[t("a",{class:"dropdown-label",onClick:l[0]||(l[0]=K(()=>{},["prevent"]))},[k(I(f.operate_rights_label)+" ",1),e(W(He),{style:{"font-size":"12px"}})])]),_:2},1024)])):(i(),v("div",Ut,[t("a",{class:"dropdown-label disabled",onClick:l[1]||(l[1]=K(()=>{},["prevent"]))},I(f.operate_rights_label),1)]))],64)):z("",!0),d.key==="action"?(i(),v(q,{key:2},[f.showDelete?(i(),P(Z,{key:0},{default:o(()=>[e(w,{title:"确定要移除此协作者吗?","ok-text":"确定","cancel-text":"取消",onConfirm:N=>c(f)},{default:o(()=>[Rt]),_:2},1032,["onConfirm"])]),_:2},1024)):(i(),v("span",Mt,[e(u,{style:{padding:"0"},type:"link",disabled:""},{default:o(()=>[k("移除")]),_:1})]))],64)):z("",!0)]),_:1},8,["data-source","pagination"])]),e(ht,{excludedIds:a.value,ref_key:"addCollaboratorRef",ref:m,onOk:D},null,8,["excludedIds"])])}}},Pt=E(Ot,[["__scopeId","data-v-36368ac1"]]),zt={class:"permissions-page"},Bt={class:"page-container"},Ft={class:"form-box-wrapper"},jt={class:"collaborator-list-wrapper"},At={__name:"index",setup(h){const U=Re(),L=H(()=>U.query.library_id),m=T({type:1,library_intro:"",library_name:"",model_config_id:"",model_define:"",use_model:"",is_offline:!1,access_rights:"0",share_url:"",library_key:"",avatar:"",avatar_file:""});X("libraryState",m),X("updateState",a=>{Object.assign(m,a)});const $=x(!1),s=a=>{Object.assign(m,a),$.value=!0,p().then(()=>{$.value=!1}).catch(()=>{$.value=!1})},p=async()=>{let a={...Me(m)};delete a.library_key,a.avatar_file?(a.avatar=a.avatar_file,delete a.avatar_file):(delete a.avatar,delete a.avatar_file),await we(a),O.success("修改成功")},b=()=>{Se({id:L.value}).then(a=>{Object.assign(m,a.data)})};return Y(()=>{b()}),(a,_)=>(i(),v("div",zt,[e(Oe),t("div",Bt,[t("div",Ft,[e(st,{value:m,"onUpdate:value":_[0]||(_[0]=R=>m=R),saveLoading:$.value,onSubmit:s},null,8,["value","saveLoading"])]),t("div",jt,[m.library_key?(i(),P(Pt,{key:0})):z("",!0)])])]))}},Ea=E(At,[["__scopeId","data-v-bdfb2890"]]);export{Ea as default};
