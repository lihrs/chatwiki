import{_ as at}from"./cu-scroll-BJMOpWv6.js";import{a3 as W,d as y,ag as nt,N as c,O as l,j as o,U as n,_ as p,X as i,a6 as P,H as A,F as E,a1 as H,Z as v,S as R,u as f,Y as U,a0 as G,z as lt}from"./vue-chunks-BRsu9_To.js";import{S as X,a as rt,c as Y,C as ut,b as ct,E as _t}from"./edit-subsection-DSsrkOVC.js";import{b as tt,a2 as pt,bs as dt,dn as mt,dp as ft,k as st,M as Z,dq as vt,E as gt,dr as K,B as ht,ds as yt}from"../../index-D5kWFI_D.js";import{C as bt}from"./ClockCircleFilled-Ce7B8JCh.js";import{S as kt}from"./index-BL3WAXpV.js";import"./index-qh96aJip.js";import{D as St}from"./dropdown-LAVathmR.js";import{M as Ct,_ as xt}from"./index-CHJt20_R.js";import{S as Lt}from"./SettingOutlined-DE2XR8Y4.js";import{S as qt}from"./SyncOutlined-DH2i9o5A.js";import{M as wt}from"./MoreOutlined-CvRpSdls.js";import{_ as Mt,a as Ot}from"./index-DzIdf_3n.js";import{_ as Et}from"./index-BPoB9Ww2.js";import{_ as $t}from"./index-BHzFNPiC.js";import{S as It}from"./index-Bv2DMWK1.js";import{S as Dt,a as Nt}from"./index-DKL6lsbQ.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./index-C564__T8.js";import"./index-Dl5gOyIo.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./DownloadOutlined-B7eFnoKE.js";import"./pick-BHbdUBTQ.js";import"./index-BtvIFvZE.js";import"./Trigger-DKtb4Equ.js";import"./isPlainObject-DEufRGOn.js";import"./responsiveObserve-CkCS37Fy.js";import"./collapseMotion-Brd6xpAT.js";import"./QuestionCircleOutlined-BwNSer6q.js";import"./FormItemContext-FSdunmL7.js";import"./CheckOutlined-BjkEYCxV.js";import"./PlusOutlined-DpByR1sK.js";import"./slide-DT-jtFtX.js";import"./index-Ca1EG28E.js";import"./Input-BnGlJfeo.js";import"./index-DhRq8W09.js";import"./inputProps-BEjYvl-5.js";import"./Search-BlRwzxLf.js";import"./SearchOutlined-BtoJ0H4_.js";import"./TextArea-BjyvIBLl.js";import"./Password-7xAmuTgW.js";import"./index-BxtV5ueZ.js";import"./index-DAunq2V5.js";import"./index-BfVvK1-5.js";import"./index-Db0Pk3Ky.js";import"./index-BwRZ1OHf.js";import"./index-BMSQkwth.js";import"./LeftOutlined-DQvF1y9x.js";import"./index-DFT5721i.js";import"./index-zi4hwqKG.js";import"./UpOutlined-KJgll7IS.js";import"./DownOutlined-C4cabUXt.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./RightOutlined-79RkPZqS.js";import"./move-BtjpvD48.js";import"./colors-CvmZis4z.js";import"./shallowequal-C0xnIuy8.js";import"./index-B2XOXYwR.js";import"./useMaxLevel-BWnZSZWL.js";import"./CaretDownFilled-D71A1QnS.js";import"./index-Yb0PVvN4.js";import"./fromPairs-Dx9PT-t0.js";import"./index-wN8GK70L.js";import"./Checkbox-Bw8VtrER.js";import"./index-CfBC_gul.js";import"./RadioButton-Dk1I9vb9.js";import"./CaretDownOutlined-lBOxADbH.js";import"./index-Dz2p5XjH.js";const Pt={class:"subsection-box"},Bt=["onClick"],Ft={key:1,class:"file-name-text",style:{color:"#F40"}},zt={key:2,class:"qa-list-box"},Rt={class:"list-item"},Ht={class:"list-content"},Jt={key:0,class:"list-item"},Vt={class:"list-content"},Qt={class:"list-item"},Tt={class:"list-content"},jt={class:"fragment-img"},At=["src"],Ut={key:3,class:"common-list-box"},Gt={class:"top-block"},Xt={class:"title"},Yt={class:"title"},Zt=["innerHTML"],Kt={class:"fragment-img"},Wt=["src"],ts={key:0,class:"status-tag"},ss={key:1,class:"status-tag complete"},es={class:"status-tag status-error"},os={key:3,class:"status-tag running"},is={class:"right-opration"},as={class:"hover-btn-box"},ns=["onClick"],ls=["onClick"],rs={class:"hover-btn-box"},us=["onClick"],cs=["onClick"],_s={__name:"subsection-box",props:{paragraphLists:{type:Array,default:()=>[]},total:{type:[Number,String],default:0},isQaLibray:{default:!1}},emits:["handleDelParagraph","handleScrollTargetPage","openEditSubscription","handleConvert","getStatrList"],setup($,{expose:j,emit:B}){const L=B,_=$,F=W().query,I=(r,a)=>{let{id:d,title:k,content:N,question:M,answer:h,images:S,category_id:C,library_id:x}=r,e=r.similar_questions||[];Z.confirm({title:"重新转换确认",icon:null,content:`确定要重新转换【分段${a+1}】吗?`,onOk(){return new Promise((t,u)=>{vt({id:d,library_id:x,title:k,content:N,question:M,answer:h,images:S,category_id:C,similar_questions:JSON.stringify(e)}).then(s=>{L("handleConvert",r),t()}).catch(()=>{t()})})},onCancel(){}})},q=r=>{L("openEditSubscription",r)},z=r=>{Z.confirm({title:"提示",icon:o(gt),content:"是否取消该标记?",onOk(){w(r,{})},onCancel(){}})},m=y([]),g=()=>{mt({library_id:F.id}).then(r=>{m.value=r.data||[],L("getStatrList",r.data||[])})};g();const D=y(null),J=()=>{D.value.show()},V=r=>{var d;let a=(d=m.value.filter(k=>k.id==r.category_id)[0])==null?void 0:d.type;return a?Y[a]:"#F4EA2A"},w=(r,a={})=>{ft({id:r.id,category_id:a.id||0}).then(d=>{st.success("修改成功"),a.id?r.category_id=a.id:L("handleDelParagraph",r.id),g()})},Q=r=>{window.open(`/#/library/preview?id=${r.file_id}`)};return j({handleOpenEditModal:q}),(r,a)=>{const d=Mt,k=Et,N=kt,M=$t,h=xt,S=Ct,C=St,x=Ot,e=nt("viewer");return l(),c("div",Pt,[o(x,{"data-source":$.paragraphLists,pagination:!1},{default:n(()=>[o(d,{key:"id","data-index":"id",width:1148},{title:n(()=>[$.isQaLibray?(l(),c(E,{key:0},[v(" 问答（共"+p(_.total)+"个） ",1)],64)):(l(),c(E,{key:1},[v("分段 （共"+p(_.total)+"个分段）",1)],64))]),default:n(({record:t,index:u})=>[t.file_name?(l(),c("a",{key:0,class:"file-name-text",onClick:s=>Q(t)},p(t.file_name),9,Bt)):(l(),c("div",Ft,"原文档已删除")),$.isQaLibray?(l(),c("div",zt,[i("div",Rt,[a[0]||(a[0]=i("div",{class:"list-label"},"问题",-1)),i("div",Ht,p(t.question),1)]),t.similar_questions&&t.similar_questions.length?(l(),c("div",Jt,[a[1]||(a[1]=i("div",{class:"list-label"},"相似问法",-1)),i("div",Vt,p(t.similar_questions.join("/")),1)])):P("",!0),i("div",Qt,[a[2]||(a[2]=i("div",{class:"list-label"},"答案",-1)),i("div",Tt,p(t.answer),1)]),A((l(),c("div",jt,[(l(!0),c(E,null,H(t.images,(s,O)=>(l(),c("img",{key:O,src:s,alt:""},null,8,At))),128))])),[[e]])])):(l(),c("div",Ut,[i("div",Gt,[i("div",Xt,"分段"+p(u+1),1),i("div",Yt,p(t.title),1),i("span",null,"共"+p(t.word_total)+"个字符",1)]),i("div",{class:"content-box",innerHTML:t.content},null,8,Zt),A((l(),c("div",Kt,[(l(!0),c(E,null,H(t.images,(s,O)=>(l(),c("img",{key:O,src:s,alt:""},null,8,Wt))),128))])),[[e]])]))]),_:1}),o(d,{title:"嵌入状态",key:"status_text","data-index":"status_text",width:128},{default:n(({record:t})=>[t.status==0?(l(),c("span",ts,[o(f(bt)),a[3]||(a[3]=v(" 未转换"))])):P("",!0),t.status==1?(l(),c("span",ss,[o(f(pt)),a[4]||(a[4]=v(" 已转换"))])):P("",!0),t.status==2?(l(),R(k,{key:2,placement:"top"},{title:n(()=>[i("span",null,p(t.errmsg),1)]),default:n(()=>[i("span",null,[i("span",es,[o(f(dt)),a[5]||(a[5]=v(" 转换异常"))])])]),_:2},1024)):P("",!0),t.status==3?(l(),c("span",os,[o(N,{size:"small"}),a[6]||(a[6]=v(" 转换中"))])):P("",!0)]),_:1}),o(d,{title:"操作",key:"action","data-index":"action",width:120},{default:n(({record:t,index:u})=>[i("div",is,[o(C,null,{overlay:n(()=>[o(S,null,{default:n(()=>[(l(!0),c(E,null,H(m.value,s=>(l(),R(h,{key:s.id},{default:n(()=>[i("div",{class:"start-item",onClick:O=>w(t,s)},[o(f(X),{style:U({color:f(Y)[s.type]})},null,8,["style"]),i("div",null,p(s.name||"-"),1)],8,ns)]),_:2},1024))),128)),o(h,null,{default:n(()=>[i("div",{class:"start-item",onClick:J},[o(f(Lt)),a[7]||(a[7]=i("div",null,"标记设置",-1))])]),_:1})]),_:2},1024)]),default:n(()=>[i("div",as,[t.category_id>0?(l(),R(M,{key:0,title:"是否取消该标记？","ok-text":"确定","cancel-text":"取消",onConfirm:s=>w(t,{})},{default:n(()=>[o(f(X),{style:U({color:V(t),"font-size":"16px"})},null,8,["style"])]),_:2},1032,["onConfirm"])):(l(),R(f(rt),{key:1,onClick:s=>w(t,m.value[0]),style:{"font-size":"16px"}},null,8,["onClick"]))])]),_:2},1024),o(k,null,{title:n(()=>a[8]||(a[8]=[v("重新转换")])),default:n(()=>[i("div",{class:"hover-btn-box",onClick:s=>I(t,u)},[o(f(qt))],8,ls)]),_:2},1024),o(C,{placement:"bottomRight"},{overlay:n(()=>[o(S,null,{default:n(()=>[o(h,null,{default:n(()=>[i("div",{onClick:G(s=>q(t),["stop"])},"编辑",8,us)]),_:2},1024),o(h,null,{default:n(()=>[i("div",{onClick:G(s=>z(t),["stop"])},"删除",8,cs)]),_:2},1024)]),_:2},1024)]),default:n(()=>[i("div",rs,[o(f(wt))])]),_:2},1024)])]),_:1})]),_:1},8,["data-source"]),o(ut,{onOk:g,ref_key:"classificationMarkModalRef",ref:D},null,512)])}}},ps=tt(_s,[["__scopeId","data-v-8a1777f0"]]),ds={class:"robot-page"},ms={class:"search-content-block"},fs={class:"selct-star-box"},vs={class:"scroll-box"},gs={class:"content-block"},hs={__name:"index",setup($){const B=W().query,L=y([]),_=y([]),b=y(0),F={0:"待生成",4:"生成中",2:"生成成功",3:"生成失败"},I={0:"未转换",1:"已转换",2:"转换异常",3:"转换中..."},q=y({}),z=e=>{L.value=e},m=y({page:1,size:10}),g=lt({status:-1,category_id:-1,library_id:B.id}),D=()=>{m.value.page=1,b.value=0,_.value=[],x()},J=e=>{g.category_id=e,D()},V=()=>{yt({id:B.id}).then(()=>st.success("操作完成"))},w=y(null),Q=e=>{w.value.showModal(JSON.parse(JSON.stringify(e)))},r=e=>{if(!e.id){m.value.page=1,x();return}let t=_.value,u=t.findIndex(s=>s.id==e.id);if(u>-1){let s=t[u];s.title=e.title,s.content=e.content,s.question=e.question,s.answer=e.answer,s.answer=e.answer,s.images=e.images,s.category_id=e.category_id,s.word_total=e.question.length+e.answer.length+e.content.length,s.similar_questions=JSON.parse(e.similar_questions),t.splice(u,1,s),_.value=t}},a=e=>{let t=_.value,u=t.findIndex(s=>s.id==e);u>-1&&(t.splice(u,1),_.value=t,b.value=--b.value,b.value)},d=()=>{C.value||_.value.length>=b.value||k()},k=()=>{m.value.page++,x()},N=()=>{h()};function M(){clearInterval(S),_.value.filter(t=>t.status==3).length?S=setInterval(()=>{h()},5e3):clearInterval(S)}const h=()=>{K({page:1,size:_.value.length,...g}).then(e=>{let u=e.data.list||[];u.forEach(s=>{s.status_text=I[s.status],s.graph_status_text=F[s.graph_status],s.similar_questions&&(s.similar_questions=JSON.parse(s.similar_questions))}),_.value=u,M()})};let S=null;const C=y(!1),x=()=>{C.value=!0,K({...m.value,...g}).then(e=>{C.value=!1;let t=e.data,u=t.list||[];t.info&&(q.value={...t.info,is_qa_doc:t.info.type==2?1:0}),q.value={...t.info,is_qa_doc:t.info.type==2?1:0},u.forEach(s=>{s.status_text=I[s.status],s.graph_status_text=F[s.graph_status],s.similar_questions&&(s.similar_questions=JSON.parse(s.similar_questions))}),m.value.page==1&&(_.value=[]),_.value=[..._.value,...u],b.value=t.total,M()})};return x(),(e,t)=>{const u=Nt,s=Dt,O=ht,et=It,ot=at;return l(),c("div",ds,[i("div",ms,[i("div",fs,[o(ct,{hideId:[0],startLists:L.value,onChange:J},null,8,["startLists"])]),o(et,null,{default:n(()=>[o(s,{value:g.status,"onUpdate:value":t[0]||(t[0]=T=>g.status=T),placeholder:"请选择",style:{width:"160px"},onChange:D},{default:n(()=>[o(u,{value:-1},{default:n(()=>t[1]||(t[1]=[v("全部嵌入状态")])),_:1,__:[1]}),(l(),c(E,null,H(I,(T,it)=>o(u,{value:it},{default:n(()=>[v(p(T),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),o(O,{onClick:V},{default:n(()=>t[2]||(t[2]=[v("重新嵌入向量")])),_:1,__:[2]})]),_:1})]),i("div",vs,[o(ot,{scrollbar:{minSize:0},onOnScrollEnd:d},{default:n(()=>[i("div",gs,[o(ps,{ref:"subsectionBoxRef",isQaLibray:q.value.is_qa_doc,total:b.value,paragraphLists:_.value,onOpenEditSubscription:Q,onHandleDelParagraph:a,onHandleConvert:N,onGetStatrList:z},null,8,["isQaLibray","total","paragraphLists"])])]),_:1})]),o(_t,{detailsInfo:q.value,onHandleEdit:r,onHandleStatrList:z,ref_key:"editSubscriptionRef",ref:w},null,8,["detailsInfo"])])}}},Fe=tt(hs,[["__scopeId","data-v-b57b693f"]]);export{Fe as default};
