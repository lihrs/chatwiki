import{b as J,f as j,B as ae,M as ee,k as Y,E as ie}from"../../index-5YmK49PT.js";import{e as re,a as me,g as ce,d as _e}from"./index-BN9XyO-I.js";import{d as E,N as c,O as e,F as K,a1 as q,a5 as se,_ as h,u as A,X as s,j as I,aa as ue,U as u,Z as B,a6 as M,H as pe,S as T,I as fe,G as R,z as de,W as ye,ab as ve,b as oe}from"./vue-chunks-BRsu9_To.js";import{_ as ge}from"./index-BlLboPxR.js";import{F as te,_ as he}from"./index-CgExRH-D.js";import{_ as ke,R as we}from"./RadioButton-BOA7hXbN.js";import"./index-D5xnDPHV.js";import{S as be,a as xe}from"./index-CY6Uw_HG.js";import"./index-CaUPg-sM.js";import{I as Ie}from"./Input-BUp4aYTr.js";import{_ as Ce,a as Ae}from"./index-5A-oefQw.js";import{_ as Me}from"./index-DzeS_XLH.js";import{_ as Te}from"./index-B9uthI5P.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./Trigger-B4vLzRfT.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./colors-DWh3mM8d.js";import"./isPlainObject-vCHOGwck.js";import"./responsiveObserve-BCCnUN0N.js";import"./collapseMotion-Brd6xpAT.js";import"./QuestionCircleOutlined-B1NoWbnW.js";import"./FormItemContext-CEomr4ey.js";import"./Checkbox-DdXoTH-0.js";import"./index-DKf75RQ4.js";import"./slide-D1R8ir8y.js";import"./index-D-Ceyk84.js";import"./CheckOutlined-DCEeaX0q.js";import"./DownOutlined-BGr9Ccqp.js";import"./SearchOutlined-Cw4SeIMs.js";import"./move-tLDxFMn0.js";import"./Search-CIbInPkK.js";import"./inputProps-DdSvkSVM.js";import"./TextArea-srALwtoG.js";import"./Password-DgCvYgs_.js";import"./index-Cxugkp18.js";import"./useMaxLevel-CDGNXJj0.js";import"./CaretDownFilled-D36rP4ZN.js";import"./index-B6Ux9iTH.js";import"./fromPairs-Dx9PT-t0.js";import"./index-c_Ya0Lit.js";import"./LeftOutlined-DGPwWNGt.js";import"./RightOutlined-BuGpdF_a.js";import"./index-6z-4GDNJ.js";import"./index-Ddj7EPU4.js";import"./dropdown-CZtNlLdq.js";import"./index-8HS083vp.js";import"./shallowequal-C0xnIuy8.js";import"./CaretDownOutlined-By9NhBsg.js";const Ke={class:"page-tabs"},$e=["onClick"],Ee={__name:"page-tabs",props:{value:{type:[Number,String]}},emits:["update:value","change"],setup(_,{emit:p}){const{t:n}=j(),i=p,C=_,f=E([{value:1,title:n("views.user.model.modelsHaveBeenAdded"),langKey:"views.user.model.modelsHaveBeenAdded"},{value:0,title:n("views.user.model.canAddAModel"),langKey:"views.user.model.canAddAModel"}]),$=m=>{i("update:value",m),i("change",m)};return(m,b)=>(e(),c("div",Ke,[(e(!0),c(K,null,q(f.value,x=>(e(),c("div",{class:se(["tab-item",{active:C.value==x.value}]),onClick:y=>$(x.value),key:x.value},h(A(n)(x.langKey)),11,$e))),128))]))}},Se=J(Ee,[["__scopeId","data-v-5999ba44"]]),Be={class:"model-list"},De={class:"model-item-left"},Le={class:"model-item-left-top"},Oe=["src"],Ne={class:"model-name"},Re={class:"model-tags"},Pe={key:0,class:"tag"},Ue={class:"model-item-left-bottom"},qe={class:"model-desc"},ze={class:"model-item-right"},Fe={__name:"model-list",props:{type:{type:Number,default:()=>1},list:{type:Array,default:()=>[]}},emits:["edit","new","see","remove","add"],setup(_,{emit:p}){const{t:n}=j(),i=p,C=["azure","ollama","xinference","openaiAgent"],f=_,$=g=>{i("see",R(g))},m=g=>{let d=R(g);i("edit",d,d.config_list[0])},b=g=>{i("new",R(g))},x=g=>{i("add",R(g))},y=g=>{let d=R(g);i("remove",d.config_list[0])};return(g,d)=>{const P=ge,v=ae;return e(),c("div",Be,[(e(!0),c(K,null,q(f.list,a=>(e(),c("div",{class:"model-item",key:a.model_define},[s("div",De,[s("div",Le,[s("img",{class:"model-logo",src:a.model_icon_url,alt:""},null,8,Oe),s("div",Ne,h(a.model_name),1),d[3]||(d[3]=s("div",{class:"line"},null,-1)),s("div",Re,[(e(!0),c(K,null,q(a.support_list,(t,k)=>(e(),c("div",{key:k},[I(P,null,ue({default:u(()=>[t!="SPEECH2TEXT"&&t!="TTS"?(e(),c("span",Pe,h(t),1)):M("",!0)]),_:2},[t=="LLM"?{name:"title",fn:u(()=>[d[0]||(d[0]=B("大语言模型，添加机器人时需要选择一个大语言模型。用户的提问将交由大语言模型，结合知识库给出答案。"))]),key:"0"}:t=="TEXT EMBEDDING"?{name:"title",fn:u(()=>[d[1]||(d[1]=B("嵌入模型，添加知识库时需要选择嵌入模型，用于将知识库分段向量化。用户提问时也会将问题生成向量，通过比对向量相似度的方式四配跟提问语义相近的知识库分段。向量检索具备很好的语义分析能力。"))]),key:"1"}:t=="RERANK"?{name:"title",fn:u(()=>[d[2]||(d[2]=B("重排序模型,通过重排序模型,将从知识库中检索出来的分段进行重新排序。再将重排序的结果前top-K传递个大语言模型生成答案。重排序有助于优化检索结果，提高大语言模型回答的准确性。"))]),key:"2"}:void 0]),1024)]))),128))])]),s("div",Ue,[s("div",qe,h(a.introduce),1)])]),s("div",ze,[pe(I(v,{class:se({"btn-red":a.listType==1&&f.type==1}),onClick:t=>y(a)},{default:u(()=>[B(h(a.listType==1&&f.type==1?"移除配置":"删除"),1)]),_:2},1032,["class","onClick"]),[[fe,f.type==1]]),f.type==2&&a.model_define!="azure"?(e(),T(v,{key:0,class:"add-btn",onClick:t=>$(a)},{default:u(()=>d[4]||(d[4]=[B("查看模型")])),_:2,__:[4]},1032,["onClick"])):M("",!0),f.type==2?(e(),T(v,{key:1,disabled:a.listType==1,class:"add-btn",onClick:t=>x(a)},{default:u(()=>d[5]||(d[5]=[B("添加配置")])),_:2,__:[5]},1032,["disabled","onClick"])):M("",!0),a.listType==1&&f.type==1?(e(),c(K,{key:2},[C.indexOf(a.model_define)>-1?(e(),c(K,{key:0},[I(v,{class:"add-btn",onClick:t=>$(a)},{default:u(()=>[B(h(A(n)("views.user.model.modelConfigButton"))+"（"+h(a.config_list.length)+"）",1)]),_:2},1032,["onClick"]),I(v,{class:"add-btn",onClick:t=>b(a)},{default:u(()=>[B(h(A(n)("views.user.model.addModelButton")),1)]),_:2},1032,["onClick"])],64)):(e(),c(K,{key:1},[I(v,{class:"add-btn",onClick:t=>m(a)},{default:u(()=>[B(h(A(n)("views.user.model.editModelButton")),1)]),_:2},1032,["onClick"]),I(v,{class:"add-btn",onClick:t=>$(a)},{default:u(()=>[B(h(A(n)("views.user.model.viewModelButton")),1)]),_:2},1032,["onClick"])],64))],64)):M("",!0)])]))),128))])}}},le=J(Fe,[["__scopeId","data-v-72110a96"]]),D={componentType:"input",placeholder:"",defaultValue:""},Ve={componentType:"radio",defaultValue:void 0},Xe={componentType:"select",defaultValue:void 0},ne={id:{hidden:!0},model_types:{...Ve,key:"model_types",label:"模型类型",optionsKey:"supported_type",options:[],disabled:!1,rules:[{required:!0,message:"请选择模型类型",trigger:"change"}]},deployment_name:{...D,label:"部署名称",placeholder:"请与Azure 部署名称保持一致",rules:[{required:!0,message:"请输入部署名称",trigger:"change"}]},model_name:{...D,label:"模型名称",placeholder:"模型名称请保持一致",rules:[{required:!0,message:"请输入模型名称",trigger:"change"}]},api_endpoint:{...D,label:"API 域名",placeholder:"请输入您的API 域名",rules:[{required:!0,message:"请输入API 域名",trigger:"change"}]},model_context_length:{...D,label:"模型上下文长度",placeholder:"请输入您的模型上下文长度",rules:[{required:!0,message:"请输入模型上下文长度",trigger:"change"}]},model_uid:{...D,label:"模型UID",placeholder:"请输入您的模型UID",rules:[{required:!0,message:"请输入模型UID",trigger:"change"}]},api_key:{...D,label:"API Key",placeholder:"请输入您的API Key",rules:[{required:!0,message:"请输入API Key",trigger:"change"}]},secret_key:{...D,label:"Secret Key",placeholder:"请输入您的Secret Key",rules:[{required:!0,message:"请输入Secret Key",trigger:"change"}]},api_version:{...Xe,label:"API 版本",placeholder:"请输入您的API 版本",optionsKey:"api_versions",options:[],rules:[{required:!0,message:"请选择API 版本",trigger:"change"}]},app_id:{...D,label:"appid",placeholder:"请输入appid",rules:[{required:!0,message:"请输入appid",trigger:"change"}]},region:{...D,label:"region",placeholder:"请输入地区",rules:[{required:!0,message:"请输入地区",trigger:"change"}]}};function Ge(_,p){if((p=="yiyan"||p=="doubao")&&_=="secret_key")return{...D,label:"Secret Key",placeholder:"请输入您的Secret Key"};if(ne[_])return ne[_];let n={...D};return n.placeholder="请输入您的"+_,n}const He={columns:[{title:"模型名称",dataIndex:"model_name",key:"model_name",langKey:"views.user.model.model_name"},{title:"模型类型",dataIndex:"model_type",key:"model_type",langKey:"views.user.model.model_type"}],rows:[],showAddBtn:!1},Je={azure:{columns:[{title:"部署名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"API版本",dataIndex:"api_version",key:"api_version",langKey:"views.user.model.api_version"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},ollama:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"BaseURL",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},openaiAgent:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"BaseURL",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"API Key",dataIndex:"api_key",key:"api_key",langKey:"views.user.model.api_key"},{title:"API版本",dataIndex:"api_version",key:"api_version",langKey:"views.user.model.api_version"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0},xinference:{columns:[{title:"模型名称",dataIndex:"deployment_name",key:"deployment_name",langKey:"views.user.model.deployment_name"},{title:"模型类型",dataIndex:"model_types",key:"model_types",langKey:"views.user.model.model_types"},{title:"服务器地址",dataIndex:"api_endpoint",key:"api_endpoint",langKey:"views.user.model.api_endpoint"},{title:"操作",dataIndex:"action",key:"action",width:150,langKey:"common.action"}],rows:[],showAddBtn:!0}},je=["azure","ollama","xinference","openaiAgent"];function We(_){if(je.indexOf(_.model_define)>-1)return _.config_list;{let p=[];return _.llm_model_list||(_.llm_model_list=[]),_.llm_model_list.forEach(n=>{p.push({model_name:n,model_type:"LLM"})}),_.vector_model_list||(_.vector_model_list=[]),_.vector_model_list.forEach(n=>{p.push({model_name:n,model_type:"TEXT EMBEDDING"})}),p}}function Ze(_){let p=["model_define","model_icon_url"],n=Je[_.model_define];return n||(n=He),p.forEach(i=>{n[i]=_[i]}),n.rows=We(_),n}const Qe={class:"form-wrapper"},Ye={class:"model-logo-box"},eo=["src"],oo={key:0,href:"https://www.yuque.com/zhimaxiaoshiwangluo/pggco1/hmwl4gveq4xwa4uw?singleDoc# ",target:"_blank"},to={class:"form-box"},lo={class:"form-item-label"},no={key:0},ao={key:1},so=["href"],io={__name:"set-model-alert",emits:["ok"],setup(_,{expose:p,emit:n}){const{t:i}=j(),C=n,f=te.useForm,$=E(""),m=de({model_icon_url:"",model_define:"",model_name:""}),b=E(!1),x=E({}),y=E({}),g=E([]),d=["ollama","xinference","openaiAgent"],P=(w,l)=>{x.value={},y.value={},g.value=[];const{model_icon_url:Q,model_define:Z,model_name:X,history_config_params:G}=w;let z=w.config_params;$.value=l?i("common.edit")+" "+X:i("common.add")+" "+X,m.model_icon_url=Q,m.model_define=Z,m.model_name=X;let O={},F={},H=[];z.unshift("id"),l&&G&&G.length>0&&(z=[...z,...G]),z.forEach(o=>{o=="model_type"&&(o="model_types"),d.indexOf(w.model_define)>-1&&o=="deployment_name"&&(o="model_name");let r=Ge(o,Z);r.key=o,r.help_links=w.help_links,r.disabled=!1,r.key=="model_types"&&l&&(r.disabled=!0);let V=r.options;l?(d.indexOf(l.model_define)>-1&&l.deployment_name&&(l.model_name=l.deployment_name),F[o]=l[o]||void 0):F[o]=r.defaultValue,r.optionsKey&&w[r.optionsKey]&&(V=w[r.optionsKey]),r.hidden||H.push({...r,options:V,key:o}),r.rules&&(O[o]=r.rules)}),w.model_define=="doubao"?(l||(F.region="cn-beijing"),H.forEach(o=>{o.key=="deployment_name"&&(o.placeholder="请输入接入点ID")}),O.deployment_name&&O.deployment_name.length&&(O.deployment_name[0].message="请输入接入点ID")):O.deployment_name&&O.deployment_name.length&&(O.deployment_name[0].message="请输入部署名称"),x.value=O,y.value=F,g.value=H,b.value=!0,setTimeout(()=>{a()},100)},{resetFields:v,clearValidate:a,validate:t,validateInfos:k}=f(y,x),S=()=>{t().then(()=>{y.value.id?W():L()}).catch(w=>{})},U=()=>{v(),a()},N=E(!1),L=()=>{let w=R(y.value),l=JSON.parse(JSON.stringify(w));l.model_type=l.model_types,l.model_define=m.model_define,d.indexOf(l.model_define)>-1&&l.model_name&&(l.deployment_name=l.model_name,delete l.model_name),N.value=!0,me(l).then(()=>{N.value=!1,b.value=!1,Y.success(i("common.saveSuccess")),C("ok")}).catch(()=>{N.value=!1})},W=()=>{let w=R(y.value),l=JSON.parse(JSON.stringify(w));l.model_type=l.model_types,l.model_define=m.model_define,d.indexOf(l.model_define)>-1&&l.model_name&&(l.deployment_name=l.model_name,delete l.model_name),N.value=!0,re(l).then(()=>{N.value=!1,b.value=!1,Y.success(i("common.saveSuccess")),C("ok")}).catch(()=>{N.value=!1})};return p({open:P}),(w,l)=>{const Q=we,Z=ke,X=xe,G=be,z=Ie,O=he,F=te,H=ee;return e(),T(H,{class:"add-model-alert",width:"650px",open:b.value,"onUpdate:open":l[0]||(l[0]=o=>b.value=o),title:$.value,confirmLoading:N.value,onOk:S,onCancel:U,maskClosable:!1},{default:u(()=>[s("div",Qe,[s("div",Ye,[s("img",{class:"model-logo",src:m.model_icon_url,alt:""},null,8,eo),m.model_define=="doubao"?(e(),c("a",oo,"查看使用说明>")):M("",!0)]),s("div",to,[I(F,{layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18}},{default:u(()=>[(e(!0),c(K,null,q(g.value,o=>(e(),c(K,{key:o.key},[o.hidden?M("",!0):(e(),T(O,ye({key:0,ref_for:!0},A(k)[o.key]),{label:u(()=>[s("div",lo,[m.model_define=="doubao"&&o.key=="deployment_name"?(e(),c("span",no,"接入点ID")):(e(),c("span",ao,h(A(i)("views.user.model."+o.key)),1))])]),default:u(()=>[o.componentType=="radio"?(e(),T(Z,{key:0,value:y.value[o.key],"onUpdate:value":r=>y.value[o.key]=r,disabled:o.disabled},{default:u(()=>[(e(!0),c(K,null,q(o.options,(r,V)=>(e(),T(Q,{value:r,key:V},{default:u(()=>[s("span",null,h(r),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled"])):M("",!0),o.componentType=="select"?(e(),T(G,{key:1,value:y.value[o.key],"onUpdate:value":r=>y.value[o.key]=r,placeholder:o.placeholder},{default:u(()=>[(e(!0),c(K,null,q(o.options,(r,V)=>(e(),T(X,{value:r,key:V},{default:u(()=>[s("span",null,h(r),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):M("",!0),o.componentType=="input"?(e(),c(K,{key:2},[I(z,{value:y.value[o.key],"onUpdate:value":r=>y.value[o.key]=r,placeholder:o.placeholder},null,8,["value","onUpdate:value","placeholder"]),o.key=="api_key"?(e(),c("a",{key:0,href:o.help_links,target:"_blank"},h(A(i)("views.user.model.getApikeyText")),9,so)):M("",!0)],64)):M("",!0)]),_:2},1040))],64))),128))]),_:1})])])]),_:1},8,["open","title","confirmLoading"])}}},ro=J(io,[["__scopeId","data-v-f60bd420"]]),mo={class:"form-wrapper"},co={class:"tools-wrapper"},_o=["src"],uo={class:"tools-box"},po={class:"list-box"},fo=["onClick"],yo=["onClick"],vo={__name:"see-model-alert",emits:["new","edit","remove"],setup(_,{expose:p,emit:n}){const{t:i}=j(),C=n,f=E(!1),$=["ollama","xinference","openaiAgent"],m=de({model_icon_url:"",model_define:"",columns:[],rows:[],showAddBtn:!1});let b=ve({});const x=v=>{b=v;let a=Ze(v);for(let t in a)m[t]=a[t];f.value=!0},y=()=>{f.value=!1,C("new",{...b})},g=v=>{f.value=!1,C("edit",{...b},R(v))},d=v=>{f.value=!1,C("remove",R(v))},P=()=>{};return p({open:x}),(v,a)=>{const t=ae,k=Me,S=Ce,U=Ae,N=ee;return e(),T(N,{class:"add-model-alert",width:"800px",open:f.value,"onUpdate:open":a[0]||(a[0]=L=>f.value=L),title:A(i)("views.user.model.modelConfigButton"),footer:null,onOk:P},{default:u(()=>[s("div",mo,[s("div",co,[s("img",{class:"model-logo",src:m.model_icon_url,alt:""},null,8,_o),s("div",uo,[m.showAddBtn?(e(),T(t,{key:0,type:"primary",onClick:y},{default:u(()=>[B(h(A(i)("views.user.model.addModel")),1)]),_:1})):M("",!0)])]),s("div",po,[I(U,{"data-source":m.rows,scroll:{y:400},pagination:!1},{default:u(()=>[(e(!0),c(K,null,q(m.columns,L=>(e(),c(K,{key:L.key},[L.key=="action"?(e(),T(S,{key:0,title:A(i)("common.action"),"data-index":L.key,width:"140px"},{default:u(({record:W})=>[s("span",null,[s("a",{onClick:w=>g(W)},h(A(i)("common.edit")),9,fo),I(k,{type:"vertical"}),s("a",{onClick:w=>d(W)},h(A(i)("common.remove")),9,yo)])]),_:2},1032,["title","data-index"])):(e(),T(S,{key:1,title:A(i)("views.user.model."+($.indexOf(m.model_define)>-1&&L.key=="deployment_name"?"model_name":L.key)),"data-index":L.key},null,8,["title","data-index"]))],64))),128))]),_:1},8,["data-source"])])])]),_:1},8,["open","title"])}}},go=J(vo,[["__scopeId","data-v-905dacec"]]),ho={class:"user-model-page"},ko={class:"list-wrapper"},wo={key:0,class:"alert-content-box"},bo={__name:"index",setup(_){const{t:p}=j(),n=E(1),i=()=>{},C=E([]),f=oe(()=>C.value.filter(t=>t.listType==1)),$=oe(()=>C.value),m=()=>{ce().then(t=>{let k=t.data||[];k.forEach(S=>{S.listType=S.config_list.length>0?1:0}),k.sort((S,U)=>S.listType-U.listType),C.value=k})};m();const b=E(null),x=t=>{b.value.open(t)},y=t=>{d.value.open(t)},g=t=>{d.value.open(t)},d=E(null),P=(t,k)=>{d.value.open(t,k)},v=()=>{m()},a=t=>{ee.confirm({title:p("views.user.model.deleteModel"),icon:I(ie),content:p("views.user.model.deleteModelContent"),onOk(){_e({id:t.id}).then(()=>{Y.success(p("common.deleteSuccessful")),m()})}})};return(t,k)=>{const S=Te;return e(),c(K,null,[s("div",ho,[I(Se,{value:n.value,"onUpdate:value":k[0]||(k[0]=U=>n.value=U),onChange:i},null,8,["value"]),s("div",ko,[n.value==0?(e(),c("div",wo,[I(S,{"show-icon":""},{message:u(()=>k[1]||(k[1]=[s("div",{class:"title"},"使用说明",-1),s("div",null,"1、模型主要分为嵌入模型（TEXT EMBEDDING）和大模型（LLM），嵌入模型用于将上传知识库的文本内容进行向量化便于后续检索，大模型用于将检索到的相关知识进行理解后返回答案。",-1),s("div",null,"2、配置模型时尽量选择同时支持LLM和TEXT EMBEDDING的模型，否则要配置多个模型。",-1),s("div",null,"3、国内模型厂商一般都需要认证后才可使用，所以在配置模型前，确保在模型服务厂商那里已认证，否则配置模型时会提示配置参数错误。",-1)])),_:1})])):M("",!0),n.value==1?(e(),T(le,{list:f.value,type:1,key:"addedModelList",onEdit:P,onNew:y,onSee:x,onRemove:a},null,8,["list"])):M("",!0),n.value==0?(e(),T(le,{list:$.value,type:2,key:"canAddModelList",onAdd:g,onSee:x},null,8,["list"])):M("",!0)])]),I(go,{ref_key:"seeModelAlertRef",ref:b,onNew:y,onEdit:P,onRemove:a},null,512),I(ro,{ref_key:"setModelAlertRef",ref:d,onOk:v},null,512)],64)}}},kt=J(bo,[["__scopeId","data-v-1f3aa710"]]);export{kt as default};
