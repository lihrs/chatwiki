import{b as ce,dM as ge,d as ve,dk as Le,bM as De,dN as xe,dO as pe,dL as le,k as N,M as we,E as He,dP as Re,dQ as Ve}from"../../index-DDbybdOX.js";import{c as ee,N as H,O as w,F as fe,a1 as Me,a6 as P,u as Q,a5 as re,j as p,X as _,_ as de,d as F,U as C,Z as te,S as Fe,a0 as A,b as ie,a3 as $e,z as Ee,w as _e,q as Se,a7 as Be,a2 as Ae,x as se}from"./vue-chunks-BRsu9_To.js";import{P as ye}from"./PlusOutlined-DxwPJnPR.js";import{M as je,_ as Ke}from"./index-CEgtvWQl.js";import"./index-mTXfSjnp.js";import{D as Oe}from"./dropdown-Bd02-ETx.js";import{M as Ie}from"./MoreOutlined-C4cNqrdW.js";import{C as Te}from"./CaretDownOutlined-sNQ7bAQ7.js";import{_ as Ze}from"./index-QtALLQFU.js";import{_ as Ue}from"./index-Bs0PpTYg.js";import{S as qe}from"./share-modal-FbsTSDfK.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./shallowequal-C0xnIuy8.js";import"./Trigger-D5Y4uzl5.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-B4hiqfwi.js";import"./index-BN8NtH5x.js";import"./RightOutlined-D9Xt5P1b.js";import"./move-Cw4o9UBf.js";import"./colors-BxVN-WHk.js";import"./useMaxLevel-Clg9DEyU.js";import"./index-D1-T_LNn.js";import"./index-jhzcGD5Z.js";import"./CheckOutlined-CRMX4qhF.js";import"./DownOutlined-CZgAT6ZI.js";import"./SearchOutlined-BC_LJr47.js";import"./FormItemContext-TDgu36NB.js";import"./CaretDownFilled-5KzucDnQ.js";import"./index-CECVv8YK.js";import"./responsiveObserve-Dna7GBXr.js";import"./share-form-B7Le82IN.js";import"./index-C0kilmAu.js";import"./index-KnumPlZE.js";import"./RadioButton-e3LPvyDr.js";import"./Checkbox-zAmuLCsz.js";import"./index-UnEC9AyA.js";import"./Input-B_j-VXB9.js";import"./inputProps-CvodEnI-.js";import"./Search-CeAVobAK.js";import"./isPlainObject-CVF2xtQS.js";import"./TextArea-BjyYZVKw.js";import"./Password-DwwgneBq.js";import"./index-BoKpd4Su.js";import"./QuestionCircleOutlined-Cc7dIocD.js";const Pe="data:image/svg+xml,%3csvg%20width='72'%20height='22'%20viewBox='0%200%2072%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='72'%20height='22'%20rx='6'%20fill='%23BFBFBF'/%3e%3cpath%20d='M14.0007%2017.6637C15.8416%2017.6637%2017.5083%2016.9175%2018.7147%2015.711C19.9211%2014.5046%2020.6673%2012.8379%2020.6673%2010.997C20.6673%209.15606%2019.9211%207.48939%2018.7147%206.28294C17.5083%205.07652%2015.8416%204.33032%2014.0007%204.33032C12.1597%204.33032%2010.4931%205.07652%209.2866%206.28294C8.08018%207.48939%207.33398%209.15606%207.33398%2010.997C7.33398%2012.8379%208.08018%2014.5046%209.2866%2015.711C10.4931%2016.9175%2012.1597%2017.6637%2014.0007%2017.6637Z'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M13.9993%2015.3363C14.4596%2015.3363%2014.8327%2014.9632%2014.8327%2014.503C14.8327%2014.0428%2014.4596%2013.6697%2013.9993%2013.6697C13.5391%2013.6697%2013.166%2014.0428%2013.166%2014.503C13.166%2014.9632%2013.5391%2015.3363%2013.9993%2015.3363Z'%20fill='%23BFBFBF'%20stroke='%23BFBFBF'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%207V12.3333Z'%20fill='%23BFBFBF'/%3e%3cpath%20d='M14%207V12.3333'%20stroke='%23BFBFBF'%20stroke-width='1.3'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M30.328%204.576H31.672V6.382H36.362V7.67H31.672V9.84H37.104V11.128H32.778C33.702%2012.766%2035.256%2014.236%2037.426%2015.538L36.488%2016.742C34.234%2015.062%2032.652%2013.2%2031.728%2011.128H31.672V17.4H30.328V11.128H30.272C29.278%2013.396%2027.64%2015.272%2025.372%2016.756L24.602%2015.51C26.702%2014.362%2028.242%2012.892%2029.222%2011.128H24.896V9.84H30.328V7.67H25.736V6.382H30.328V4.576ZM39.442%209.014L40.548%204.926L41.878%205.15L41.15%207.74H43.222C43.488%206.704%2043.698%205.612%2043.866%204.464L45.224%204.632C45.056%205.738%2044.846%206.774%2044.608%207.74H51.02V9.014H44.272C44.132%209.476%2043.978%209.91%2043.838%2010.33H49.438V11.45C49.074%2012.598%2048.388%2013.634%2047.352%2014.558C48.416%2015.146%2049.704%2015.692%2051.202%2016.196L50.516%2017.456C48.822%2016.84%2047.394%2016.154%2046.246%2015.426C45.14%2016.196%2043.782%2016.896%2042.172%2017.526L41.472%2016.266C42.872%2015.762%2044.076%2015.202%2045.07%2014.6C44.16%2013.872%2043.474%2013.088%2043.026%2012.262C42.018%2014.334%2040.744%2015.986%2039.218%2017.218L38.532%2015.986C40.464%2014.278%2041.906%2011.954%2042.858%209.014H39.442ZM43.992%2011.534C44.454%2012.36%2045.182%2013.13%2046.176%2013.83C47.058%2013.116%2047.702%2012.346%2048.094%2011.534H43.992ZM47.576%204.478C48.542%205.206%2049.354%205.948%2050.012%206.69L49.06%207.642C48.5%206.914%2047.716%206.158%2046.68%205.36L47.576%204.478ZM59.266%208.244H60.554V9.854H64.418V14.614C64.418%2015.58%2063.928%2016.07%2062.948%2016.07H61.674L61.352%2014.838L62.528%2014.88C62.934%2014.88%2063.144%2014.684%2063.144%2014.32V11.086H60.554V17.442H59.266V11.086H56.648V16.182H55.374V10.974C54.744%2011.618%2054.058%2012.22%2053.316%2012.78L52.462%2011.66C54.114%2010.442%2055.444%209.056%2056.424%207.516H52.938V6.214H57.152C57.432%205.626%2057.67%205.038%2057.866%204.45L59.21%204.618C59.028%205.178%2058.832%205.71%2058.608%206.214H65.202V7.516H57.978C57.502%208.342%2056.97%209.126%2056.382%209.854H59.266V8.244Z'%20fill='white'/%3e%3c/svg%3e",ze="data:image/svg+xml,%3csvg%20width='72'%20height='22'%20viewBox='0%200%2072%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='72'%20height='22'%20rx='6'%20fill='%23CCDFFF'/%3e%3cpath%20d='M14.0007%2017.6637C15.8416%2017.6637%2017.5083%2016.9175%2018.7147%2015.711C19.9211%2014.5046%2020.6673%2012.8379%2020.6673%2010.997C20.6673%209.15606%2019.9211%207.48939%2018.7147%206.28294C17.5083%205.07652%2015.8416%204.33032%2014.0007%204.33032C12.1597%204.33032%2010.4931%205.07652%209.2866%206.28294C8.08018%207.48939%207.33398%209.15606%207.33398%2010.997C7.33398%2012.8379%208.08018%2014.5046%209.2866%2015.711C10.4931%2016.9175%2012.1597%2017.6637%2014.0007%2017.6637Z'%20fill='%232475FC'/%3e%3cpath%20d='M11.334%2011L13.334%2013L17.334%209'%20stroke='white'%20stroke-width='1.33'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M35.816%2011.058H27.136V14.908C27.136%2015.44%2027.402%2015.706%2027.934%2015.706H34.92C35.172%2015.706%2035.41%2015.622%2035.606%2015.454C35.83%2015.244%2035.97%2014.404%2036.054%2012.934L37.356%2013.354C37.188%2015.118%2036.95%2016.168%2036.656%2016.49C36.32%2016.798%2035.872%2016.966%2035.298%2016.994H27.57C26.38%2016.994%2025.792%2016.378%2025.792%2015.146V7.866H27.136V9.784H34.458V6.452H25.218V5.178H35.816V11.058ZM39.442%209.014L40.548%204.926L41.878%205.15L41.15%207.74H43.222C43.488%206.704%2043.698%205.612%2043.866%204.464L45.224%204.632C45.056%205.738%2044.846%206.774%2044.608%207.74H51.02V9.014H44.272C44.132%209.476%2043.978%209.91%2043.838%2010.33H49.438V11.45C49.074%2012.598%2048.388%2013.634%2047.352%2014.558C48.416%2015.146%2049.704%2015.692%2051.202%2016.196L50.516%2017.456C48.822%2016.84%2047.394%2016.154%2046.246%2015.426C45.14%2016.196%2043.782%2016.896%2042.172%2017.526L41.472%2016.266C42.872%2015.762%2044.076%2015.202%2045.07%2014.6C44.16%2013.872%2043.474%2013.088%2043.026%2012.262C42.018%2014.334%2040.744%2015.986%2039.218%2017.218L38.532%2015.986C40.464%2014.278%2041.906%2011.954%2042.858%209.014H39.442ZM43.992%2011.534C44.454%2012.36%2045.182%2013.13%2046.176%2013.83C47.058%2013.116%2047.702%2012.346%2048.094%2011.534H43.992ZM47.576%204.478C48.542%205.206%2049.354%205.948%2050.012%206.69L49.06%207.642C48.5%206.914%2047.716%206.158%2046.68%205.36L47.576%204.478ZM59.266%208.244H60.554V9.854H64.418V14.614C64.418%2015.58%2063.928%2016.07%2062.948%2016.07H61.674L61.352%2014.838L62.528%2014.88C62.934%2014.88%2063.144%2014.684%2063.144%2014.32V11.086H60.554V17.442H59.266V11.086H56.648V16.182H55.374V10.974C54.744%2011.618%2054.058%2012.22%2053.316%2012.78L52.462%2011.66C54.114%2010.442%2055.444%209.056%2056.424%207.516H52.938V6.214H57.152C57.432%205.626%2057.67%205.038%2057.866%204.45L59.21%204.618C59.028%205.178%2058.832%205.71%2058.608%206.214H65.202V7.516H57.978C57.502%208.342%2056.97%209.126%2056.382%209.854H59.266V8.244Z'%20fill='%232475FC'/%3e%3c/svg%3e";var ne={exports:{}},We=ne.exports,me;function Ge(){return me||(me=1,function(V,$){(function(g,h){h()})(We,function(){function g(n,i){return typeof i>"u"?i={autoBom:!1}:typeof i!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),i={autoBom:!i}),i.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function h(n,i,r){var c=new XMLHttpRequest;c.open("GET",n),c.responseType="blob",c.onload=function(){d(c.response,i,r)},c.onerror=function(){console.error("could not download file")},c.send()}function D(n){var i=new XMLHttpRequest;i.open("HEAD",n,!1);try{i.send()}catch{}return 200<=i.status&&299>=i.status}function m(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(i)}}var f=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ee=="object"&&ee.global===ee?ee:void 0,L=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=f.saveAs||(typeof window!="object"||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!L?function(n,i,r){var c=f.URL||f.webkitURL,y=document.createElement("a");i=i||n.name||"download",y.download=i,y.rel="noopener",typeof n=="string"?(y.href=n,y.origin===location.origin?m(y):D(y.href)?h(n,i,r):m(y,y.target="_blank")):(y.href=c.createObjectURL(n),setTimeout(function(){c.revokeObjectURL(y.href)},4e4),setTimeout(function(){m(y)},0))}:"msSaveOrOpenBlob"in navigator?function(n,i,r){if(i=i||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(g(n,r),i);else if(D(n))h(n,i,r);else{var c=document.createElement("a");c.href=n,c.target="_blank",setTimeout(function(){m(c)})}}:function(n,i,r,c){if(c=c||open("","_blank"),c&&(c.document.title=c.document.body.innerText="downloading..."),typeof n=="string")return h(n,i,r);var y=n.type==="application/octet-stream",j=/constructor/i.test(f.HTMLElement)||f.safari,Z=/CriOS\/[\d]+/.test(navigator.userAgent);if((Z||y&&j||L)&&typeof FileReader<"u"){var K=new FileReader;K.onloadend=function(){var M=K.result;M=Z?M:M.replace(/^data:[^;]*;/,"data:attachment/file;"),c?c.location.href=M:location=M,c=null},K.readAsDataURL(n)}else{var E=f.URL||f.webkitURL,O=E.createObjectURL(n);c?c.location=O:location.href=O,c=null,setTimeout(function(){E.revokeObjectURL(O)},4e4)}});f.saveAs=d.saveAs=d,V.exports=d})}(ne)),ne.exports}var Xe=Ge();const Qe={class:"side-meuns"},Ye=["onClick"],Je={class:"menu-name"},Ne={__name:"side-menus",props:{menus:{type:Array,default:()=>[]},active:{type:String,default:""}},emits:["menuClick"],setup(V,{emit:$}){const g=$,h=V,{checkPermission:D}=ge(),m=f=>{g("menuClick",f)};return(f,L)=>{const d=ve;return w(),H("div",Qe,[(w(!0),H(fe,null,Me(h.menus,n=>(w(),H(fe,{key:n.key},[Q(D)(n.permissions)?(w(),H("div",{key:0,class:re(["side-meun-item",{active:n.key===h.active}]),onClick:i=>m(n)},[p(d,{class:"menu-icon",name:n.icon},null,8,["name"]),_("span",Je,de(n.name),1)],10,Ye)):P("",!0)],64))),128))])}}},et=ce(Ne,[["__scopeId","data-v-00b2c2a7"]]),tt={__name:"upload-doc",emits:["file-loaded"],setup(V,{expose:$,emit:g}){const h=g,D=F(null);let m={};const f=d=>{m=d||{},D.value.click()},L=d=>{const n=d.target.files[0];if(!n)return;if(!n.name.endsWith(".md")){alert("请选择.md文件");return}const i=new FileReader;i.onload=r=>{h("file-loaded",{content:r.target.result,title:n.name,file:n,...m})},i.readAsText(n),d.target.value=null};return $({triggerUpload:f}),(d,n)=>(w(),H("input",{type:"file",style:{opacity:"0",position:"fixed",bottom:"-9999px",left:"-9999px"},ref_key:"fileInput",ref:D,onChange:L,accept:".md"},null,544))}},nt={class:"side-directory"},ot={class:"directory-header"},at={class:"action-box"},lt={class:"action-btn"},it={class:"directory-body"},st={class:"directory-content"},rt={style:{"margin-right":"4px"}},ct={class:"action-btn toggle-btn"},dt=["data-level"],ut={class:"doc-title"},pt={class:"doc-action-box"},ft={__name:"side-directory",props:{list:{type:Array,default:()=>[]},loadData:{type:Function,default:()=>{}},selectedKeys:{type:Array,default:()=>[]}},emits:["addDoc","importDoc","copyLink","copyDoc","deleteDoc","exportDoc","dragenter","drop","select"],setup(V,{expose:$,emit:g}){const h=g,D=V,m=F([]),f=F([]),L=u=>{f.value.includes(u)||f.value.push(u)},d=(u,s)=>{const R=m.value.indexOf(u);typeof s=="boolean"?R>-1&&s===!1?m.value.splice(R,1):m.value.push(u):R>-1?m.value.splice(R,1):m.value.push(u)},n=u=>{m.value=[]},i=F(null),r=u=>{h("addDoc",u)};let c=null;const y=u=>{c=u,i.value.triggerUpload()},j=u=>{h("importDoc",c,u)},Z=u=>{h("copyLink",u)},K=u=>{h("copyDoc",u)},E=u=>{h("exportDoc",u)},O=u=>{h("deleteDoc",u)},M=u=>{h("dragenter",u)},Y=u=>{h("drop",u)},oe=(u,s)=>{h("select",s.node.dataRef)};return $({toggleExpand:d,addLoadedKey:L}),(u,s)=>{const R=ve,x=Ke,z=je,W=Oe,ae=Ze,I=Ue;return w(),H("div",nt,[_("div",ot,[p(R,{name:"doc-directory",style:{"font-size":"16px",color:"#595959"}}),s[9]||(s[9]=_("div",{class:"label-text"},"文档目录",-1)),_("div",at,[p(W,null,{overlay:C(()=>[p(z,null,{default:C(()=>[p(x,{key:"addDoc",onClick:s[0]||(s[0]=k=>r())},{default:C(()=>s[6]||(s[6]=[te(" 添加文档 ")])),_:1,__:[6]}),p(x,{key:"importDoc",onClick:s[1]||(s[1]=k=>y())},{default:C(()=>s[7]||(s[7]=[te(" 导入文档 ")])),_:1,__:[7]})]),_:1})]),default:C(()=>[_("span",lt,[p(Q(ye),{style:{color:"#595959"}})])]),_:1}),p(ae,null,{title:C(()=>s[8]||(s[8]=[te("收起全部文档")])),default:C(()=>[_("span",{class:"action-btn",onClick:s[2]||(s[2]=k=>n(!1))},[p(R,{name:"menu-expand",style:{"font-size":"16px",color:"#595959"}})])]),_:1})])]),_("div",it,[_("div",st,[p(I,{class:"directory-tree",expandedKeys:m.value,"onUpdate:expandedKeys":s[5]||(s[5]=k=>m.value=k),"selected-keys":V.selectedKeys,loadedKeys:f.value,"block-node":"","tree-data":D.list,"load-data":V.loadData,"field-names":{key:"id",title:"title",children:"children"},draggable:"",onDragenter:M,onDrop:Y,onSelect:oe},{switcherIcon:C(({switcherCls:k})=>[_("div",rt,[_("span",ct,[p(Q(Te),{style:{"font-size":"12px"},class:re(k)},null,8,["class"])])])]),title:C(k=>[_("div",{class:re(["doc-item",{"is-leaf":k.dataRef.isLeaf}]),"data-level":k.level},[p(R,{class:"doc-icon",name:"doc-file"}),_("div",ut,de(k.dataRef.title),1),_("div",pt,[k.level<2?(w(),Fe(W,{key:0},{overlay:C(()=>[p(z,null,{default:C(()=>[p(x,{key:"addDoc",onClick:A(T=>r(k),["stop","prevent"])},{default:C(()=>s[10]||(s[10]=[_("span",{class:"menu-name"},"添加文档",-1)])),_:2,__:[10]},1032,["onClick"]),p(x,{key:"importDoc",onClick:A(T=>y(k),["stop","prevent"])},{default:C(()=>s[11]||(s[11]=[_("span",{class:"menu-name"},"导入文档",-1)])),_:2,__:[11]},1032,["onClick"])]),_:2},1024)]),default:C(()=>[_("span",{class:"action-btn",onClick:s[3]||(s[3]=A(()=>{},["stop"]))},[p(Q(ye))])]),_:2},1024)):P("",!0),p(W,null,{overlay:C(()=>[p(z,null,{default:C(()=>[p(x,{key:"copyLink",onClick:A(T=>Z(k),["stop","prevent"])},{default:C(()=>s[12]||(s[12]=[te(" 复制链接"),_("span",{class:"menu-name"},null,-1)])),_:2,__:[12]},1032,["onClick"]),p(x,{key:"copyDoc",onClick:A(T=>K(k),["stop","prevent"])},{default:C(()=>s[13]||(s[13]=[_("span",{class:"menu-name"},"复制文档",-1)])),_:2,__:[13]},1032,["onClick"]),p(x,{key:"exportDoc",onClick:A(T=>E(k),["stop","prevent"])},{default:C(()=>s[14]||(s[14]=[_("span",{class:"menu-name"},"导出文档",-1)])),_:2,__:[14]},1032,["onClick"]),p(x,{key:"deleteDoc",onClick:A(T=>O(k),["stop","prevent"])},{default:C(()=>s[15]||(s[15]=[_("span",{class:"menu-name"},"删除文档",-1)])),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),default:C(()=>[_("span",{class:"action-btn",onClick:s[4]||(s[4]=A(()=>{},["stop"]))},[p(Q(Ie))])]),_:2},1024)])],10,dt)]),_:1},8,["expandedKeys","selected-keys","loadedKeys","tree-data","load-data"])])]),p(tt,{ref_key:"uploadDocRef",ref:i,onFileLoaded:j},null,512)])}}},_t=ce(ft,[["__scopeId","data-v-9de614d1"]]),yt={class:"public-library-layout"},mt={class:"layout-left"},vt={class:"library-title"},ht=["src"],Ct={class:"library-name"},kt={key:1,class:"publish-status"},bt={key:0,class:"icon",src:Pe,alt:""},gt={key:1,class:"icon",src:ze,alt:""},Lt={class:"side-directory-wrapper"},Dt={class:"layout-body"},xt={__name:"index",setup(V){const $=(e,t)=>{const a=new Blob([e],{type:"text/markdown;charset=utf-8"});Xe.saveAs(a,t)},g=(e,t)=>{{for(let a=0;a<e.length;a++){const o=e[a];if(o.id==t)return o;if(o.children){const l=g(o.children,t);if(l)return l}}return null}},h=(e,t,a=null)=>{for(let o=0;o<e.length;o++){const l=e[o];if(l.id==t)return a;if(l.children){const b=h(l.children,t,l);if(b)return b}}return null};function D(e="无标题文档",t=[]){const a=new Set(t.map(b=>b.title));let o=1,l=`${e}(${o})`;for(;a.has(l);)o++,l=`${e}(${o})`;return l}const m=Ae(),f=$e(),L=ie(()=>f.query.library_id),d=Ee({type:1,library_intro:"",library_name:"",library_key:"",avatar:""}),n=ie(()=>f.query.doc_id),i=F(null),r=F([]),c=F([]),y=F(null),j=ie(()=>f.meta.activeMenu||""),Z=[{name:"知识库配置",key:"config",icon:"jichupeizhi",path:"/public-library/config",permissions:["4"]},{name:"首页",key:"home",icon:"ai",path:"/public-library/home",permissions:["*"]}],K=e=>{m.push({path:e.path,query:{library_id:f.query.library_id,library_key:d.library_key}})};_e(()=>f.path,e=>{e!=="/public-library/editor"&&(M(),y.value=null)}),n.value&&(c.value=[Number(n.value)]),_e(n,e=>{e&&(c.value=[Number(n.value)])});const E=e=>{let t={library_key:d.library_key,pid:e?e.id:0};return xe(t).then(a=>{let o=a.data||[];o.forEach(l=>{l.id=l.id*1,l.pid=l.pid*1,l.key=l.id,l.level=e?e.level+1:0,l.sort=l.sort*1,l.children_num=l.children_num*1,l.children=[],l.hasLoaded=!1,l.isLeaf=l.children_num==0}),e?(e.hasLoaded=!0,e.children=o,r.value=[...r.value]):r.value=o})},O=e=>new Promise(t=>{if(e.dataRef.hasLoaded){t();return}E(e.dataRef).then(()=>{t()})}),M=()=>{c.value=[]},Y=F(null),oe=e=>{Y.value.show({doc_key:e.doc_key})},u=(e,t)=>{let a=t.title;a.endsWith(".md")&&(a=a.replace(/\.md$/i,""));let o={library_key:d.library_key,doc_id:"",doc_type:"4",pid:e?e.dataRef.id:"0",title:a,content:t.content,sort:0};le(o).then(l=>{N.success("导入成功"),o.id=l.data.doc_id,o.sort=l.data.sort;let b=e?e.dataRef:null;x(b,o)})},s=e=>{let t="无标题文档";e?t=D("无标题文档",e.dataRef.children):t=D("无标题文档",r.value);let a={library_key:d.library_key,doc_id:"",doc_type:"4",pid:e?e.dataRef.id:0,title:t,content:"# 无标题文档",sort:0};le(a).then(o=>{N.success("添加成功"),a.id=o.data.doc_id,a.sort=o.data.sort;let l=e?e.dataRef:null;x(l,a)})},R=e=>{pe({library_key:d.library_key,doc_id:e.dataRef.id}).then(t=>{let a={library_key:d.library_key,doc_id:"",doc_type:"4",pid:t.data.pid*1,title:t.data.title+"(副本)",content:t.data.content,sort:0};le(a).then(o=>{N.success("复制成功"),a.id=o.data.doc_id,a.sort=o.data.sort;let l=g(r.value,a.pid);x(l,a)})})},x=(e,t)=>{t.children_num=0,t.children=[],t.hasLoaded=!1,t.key=t.id,t.isLeaf=!0,t.level=0,e?(t.level=e.level+1,e.children_num++,e.isLeaf=!1,e.hasLoaded?(e.children.unshift(t),se(()=>{i.value.toggleExpand(e.id,!0)})):(e.hasLoaded=!1,se(()=>{i.value.toggleExpand(e.id,!0)}))):(t.level=0,r.value.unshift(t)),I(t)},z=e=>{we.confirm({title:"删除文档",icon:p(He),content:`确定删除文档 ${e.dataRef.title} 吗？`,onOk(){W(e)},onCancel(){}})},W=e=>{Ve({library_key:d.library_key,doc_id:e.dataRef.id}).then(()=>{N.success("删除成功");let t=g(r.value,e.dataRef.pid);if(t){let a=t.children.findIndex(o=>o.id==e.dataRef.id);if(t.children_num--,t.isLeaf=t.children_num==0,t.children.splice(a,1),j.value!="doc")return;t.children.length>0?I(t.children[0]):r.value.length>0?I(r.value[0]):(y.value=null,m.replace({path:"/public-library/home",query:{library_id:L.value,library_key:d.library_key}}))}else{let a=r.value.findIndex(o=>o.id==e.dataRef.id);if(r.value.splice(a,1),j.value!="doc")return;r.value.length>0?I(r.value[0]):(y.value=null,m.replace({path:"/public-library/home",query:{library_id:L.value,library_key:d.library_key}}))}})},ae=e=>{pe({library_key:d.library_key,doc_id:e.dataRef.id}).then(t=>{let{content:a,title:o}=t.data;o.endsWith(".md")||(o+=".md"),$(a,o)})},I=e=>{y.value=e,c.value=[e.id],f.path=="/public-library/editor"?m.replace({path:"/public-library/editor",query:{library_id:L.value,library_key:d.library_key,doc_id:e.id}}):m.push({path:"/public-library/editor",query:{library_id:L.value,library_key:d.library_key,doc_id:e.id}})},k=()=>{},T=e=>{const t=[...r.value],a=e.node,o=e.dragNode,l=a.key,b=o.key,U=a.pos.split("-"),ue=e.dropPosition-Number(U[U.length-1]),G=(v,S,J=0,q)=>{for(let B=0;B<v.length;B++){if(v[B].key===S){q(v[B],B,J,v);break}v[B].children&&G(v[B].children,S,J+1,q)}};let X;if(G(t,b,0,(v,S,J,q)=>{X={...v},q.splice(S,1)}),o.parent&&o.parent.node.children_num>0&&(o.parent.node.children_num--,o.parent.node.isLeaf=o.parent.node.children_num==0),!e.dropToGap)G(t,l,0,v=>{v.children=v.children||[],v.children_num++,v.isLeaf=!1,v.children.unshift(X)});else if((e.node.children||[]).length>0&&e.node.expanded&&ue===1)G(t,l,0,v=>{v.children=v.children||[],v.children_num++,v.isLeaf=!1,v.children.unshift(X)});else{let v=[],S=0;G(t,l,0,(J,q,B,be)=>{v=be,S=q}),ue===-1?v.splice(S,0,X):v.splice(S+1,0,X)}r.value=t,he(o,a)},he=(e,t)=>{let a=h(r.value,e.dataRef.id);e.dataRef.pid=a?a.id:0;let o={library_key:d.library_key,doc_id:e.dataRef.id,pid:e.dataRef.pid,level:a?a.level+1:0,sort:0},l=a?a.children:r.value,b=-1;l.length>1&&(b=l.findIndex(U=>U.id==e.dataRef.id),b===0?(o.top=1,o.sort=l[b+1].sort):o.sort=l[b-1].sort),Re(o).then(U=>{e.dataRef.sort=U.data.sort,t.pid!=o.pid&&(t.dataRef.children.length>=t.dataRef.children_num?(t.dataRef.hasLoaded=!0,i.value.addLoadedKey(t.id),i.value.toggleExpand(t.id,!0)):E(t.dataRef).then(()=>{l[b]=e.dataRef,se(()=>{t.dataRef.hasLoaded=!0,i.value.toggleExpand(t.id,!0)})}))})},Ce=e=>{let t=g(r.value,e.id);t.title=e.title,t.is_draft=e.is_draft,y.value=t},ke=async()=>{try{const e=await Le({id:L.value});e.data.avatar||(e.data.avatar=De),Object.assign(d,e.data)}catch(e){}};return Se(()=>{ke().then(()=>{E()})}),(e,t)=>{const a=Be("router-view");return w(),H("div",yt,[_("div",mt,[_("div",vt,[d.avatar?(w(),H("img",{key:0,class:"library-logo",src:d.avatar,alt:""},null,8,ht)):P("",!0),_("span",Ct,de(d.library_name),1),y.value?(w(),H("span",kt,[y.value.is_draft==1?(w(),H("img",bt)):P("",!0),y.value.is_draft==0?(w(),H("img",gt)):P("",!0)])):P("",!0)]),p(et,{menus:Z,active:j.value,onMenuClick:K},null,8,["active"]),_("div",Lt,[p(_t,{ref_key:"docTreeRef",ref:i,list:r.value,"load-data":O,selectedKeys:c.value,onImportDoc:u,onAddDoc:s,onDeleteDoc:z,onCopyDoc:R,onCopyLink:oe,onExportDoc:ae,onDragenter:k,onDrop:T,onSelect:I},null,8,["list","selectedKeys"])])]),_("div",Dt,[p(a,{onChangeDoc:Ce})]),p(qe,{ref_key:"shareModalRef",ref:Y},null,512)])}}},k2=ce(xt,[["__scopeId","data-v-58998fe3"]]);export{k2 as default};
