import{j as t,N as v,O as s,X as e,a6 as R,Z as I,_ as U,V as ce,S as D,U as i,Y as mt,a5 as Ce,d as w,a as Y,z as F,H as ae,I as re,u as x,G as W,a3 as Je,F as T,a1 as G,w as ue,k as Ge,q as fe,o as vt,h as Le,ae as ye,af as ke,D as ft,b as pe,a0 as bt,x as He,aa as ht,W as yt,a8 as kt,p as gt}from"./vue-chunks-BRsu9_To.js";import{I as $t,b as Q,d as de,B as te,az as xt,ap as Be,M as Z,k as K,an as wt,as as qt,ar as me,aA as St,aB as Ct,a0 as Ke,e as Lt,aC as It,aD as Se,E as Ae,h as Ut,ay as Rt}from"../../index-DGlN_gTP.js";import{_ as ge}from"./index-DasxHN4l.js";import{C as Et}from"./cu-upload-D8q3isWj.js";import"./index-JAP4Oum8.js";import{I as _e}from"./Input-BpI49rDY.js";import{_ as $e}from"./TextArea-BNOG6RQ7.js";import{_ as Me}from"./cu-scroll-CGL6fhO0.js";import{e as Ot,g as We,f as At,h as jt}from"./index-D9NnHyqS.js";import{T as Mt}from"./index-BiKG4PZA.js";import{S as Ie}from"./index-DBSnNVJY.js";import{I as zt}from"./index-Dh7x3hVt.js";import{F as je,_ as Ze}from"./index-vDDFetvc.js";import{S as Ye,a as Xe,i as Dt}from"./index-BlDgRIYn.js";import{_ as et,T as tt}from"./index-C0UMgAJu.js";import{D as Pt}from"./DownloadOutlined-3aTO680L.js";import{P as Ue}from"./PlusOutlined-D8SGrPLQ.js";import{D as ot}from"./DownOutlined-BUKGfKlO.js";import{U as Nt}from"./UpOutlined-CR2jjLrd.js";import{_ as oe}from"./index-BQDPftJ3.js";import{_ as se}from"./index-C1MdRggi.js";import{c as st}from"./index-D9KRCCIf.js";import{C as Tt}from"./index-BA8w32s8.js";import{Q as ee}from"./QuestionCircleOutlined-Bvo9_S3-.js";import{_ as nt}from"./index-B8XmcRDl.js";import{_ as Re}from"./index-DSI4uitL.js";import{_ as Vt,a as Bt}from"./index-6Kxt1ZPe.js";import{S as Qt}from"./SearchOutlined-DSY7YbKD.js";import{S as Ft}from"./SyncOutlined-DW7e_W_D.js";import{_ as ze,C as De}from"./index-CVsoyaFF.js";import{_ as it}from"./index-CNkxcL4v.js";import{_ as Jt}from"./recommendation-AQ4_FPQ9.js";import{R as Gt}from"./RightOutlined-TchQhXHc.js";import{g as lt}from"./index-CinEFcJi.js";import{_ as at}from"./empty-CzGZrENG.js";import{d as Pe}from"./vuedraggable.umd-CIIT_a56.js";import{M as Ht}from"./model-select-7nrl0gxH.js";import"./index-SBg8gFw7.js";import{_ as rt,R as dt}from"./RadioButton-Bnx6tN7r.js";import{E as _t}from"./EditOutlined-BD_pNgHD.js";import{_ as Kt}from"./index-B3c5vJBe.js";import{u as Wt}from"./robot-Bza63Zse.js";import{i as Zt,e as Yt,f as Xt}from"./index-Bimk7Frz.js";import{A as eo}from"./add-collaborator-Zjc0N9q5.js";import{A as to}from"./index-BPqZqeM9.js";import{U as Qe}from"./UserOutlined-s-McxcUX.js";import{C as Oe}from"./CheckOutlined-B_Hs0-OP.js";import{E as oo}from"./Password-B9FCv-aw.js";import{_ as so}from"./index-DpIV4w7P.js";import{a as no}from"./index-DIzQ-2kQ.js";import"./axios-Dq7h7Pqt.js";import"./qs-BrxkIg-9.js";import"./crypto-js-ClNpte_9.js";import"./dayjs-B6IotFah.js";import"./FormItemContext-DAoPsdM7.js";import"./index-C0cXlrXm.js";import"./Search-CH76L-gx.js";import"./isPlainObject-51jSOJKV.js";import"./inputProps-Bu_dzA3C.js";import"./index-k9nX7Zez.js";import"./ResizeObserver.es-B1PUzC5B.js";import"./pull-up.esm-D94Swpvl.js";import"./observe-dom.esm-CyCedSm-.js";import"./colors-DKWwHq2l.js";import"./Trigger-oBKhEx1B.js";import"./responsiveObserve-BLoLQTqt.js";import"./collapseMotion-Brd6xpAT.js";import"./slide-Ccxw2gRU.js";import"./move-BSoEcIoa.js";import"./index-D35sYO_B.js";import"./shallowequal-C0xnIuy8.js";import"./dropdown-0QsfqJqV.js";import"./pick-DJeTcTfK.js";import"./Checkbox-B8J-JVwM.js";import"./index-Cf43OwEB.js";import"./index-Bar3uf0o.js";import"./useMaxLevel-CkEcKQq6.js";import"./CaretDownFilled-7wQJySwA.js";import"./fromPairs-Dx9PT-t0.js";import"./LeftOutlined-D6kSS-Pc.js";import"./index-Jd-vOpFR.js";import"./CaretDownOutlined-Cx15LuFR.js";var io={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M885 780H165c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM400 325.7h73.9V664c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V325.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 171a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13z"}}]},name:"to-top",theme:"outlined"};function Fe(j){for(var c=1;c<arguments.length;c++){var y=arguments[c]!=null?Object(arguments[c]):{},f=Object.keys(y);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(y).filter(function(p){return Object.getOwnPropertyDescriptor(y,p).enumerable}))),f.forEach(function(p){lo(j,p,y[p])})}return j}function lo(j,c,y){return c in j?Object.defineProperty(j,c,{value:y,enumerable:!0,configurable:!0,writable:!0}):j[c]=y,j}var Ne=function(c,y){var f=Fe({},c,y.attrs);return t($t,Fe({},f,{icon:io}),null)};Ne.displayName="ToTopOutlined";Ne.inheritAttrs=!1;const ao={class:"edit-box-header"},ro={class:"left-box"},_o={class:"edit-box-title"},co={key:0},uo={key:0,class:"title-tip"},po={class:"right-box"},mo={class:"extra-box"},vo={class:"actions-box"},fo={__name:"edit-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},isEdit:{type:Boolean,default:!1},bodyStyle:{type:Object,default:()=>({})}},emits:["update:isEdit","save","edit"],setup(j,{emit:c}){const y=c,f=j,p=l=>{y("edit"),y("update:isEdit",l)},n=()=>{y("save")};return(l,k)=>{const r=de,d=te,$=ge;return s(),v("div",{class:Ce(["edit-box",{"is-edit":j.isEdit}])},[e("div",ao,[e("div",ro,[t(r,{class:"edit-box-icon",name:f.iconName},null,8,["name"]),e("span",_o,[I(U(f.title)+" ",1),l.$slots.icon?(s(),v("span",co,[ce(l.$slots,"icon",{},void 0,!0)])):R("",!0)]),l.$slots.tip?(s(),v("span",uo,[ce(l.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",po,[e("div",mo,[ce(l.$slots,"extra",{},()=>[e("div",vo,[f.isEdit?(s(),D($,{key:0,gap:8},{default:i(()=>[t(d,{onClick:n,size:"small",type:"primary"},{default:i(()=>k[2]||(k[2]=[I("保存")])),_:1,__:[2]}),t(d,{onClick:k[0]||(k[0]=_=>p(!1)),size:"small"},{default:i(()=>k[3]||(k[3]=[I("取消")])),_:1,__:[3]})]),_:1})):(s(),D(d,{key:1,onClick:k[1]||(k[1]=_=>p(!0)),size:"small"},{default:i(()=>k[4]||(k[4]=[I("修改")])),_:1,__:[4]}))])],!0)])])]),e("div",{class:"edit-box-body",style:mt({...j.bodyStyle})},[ce(l.$slots,"default",{},void 0,!0)],4)],2)}}},X=Q(fo,[["__scopeId","data-v-1b63f826"]]),bo={class:"robot-form-box"},ho={class:"form-item"},yo={class:"form-item-body robot-name-item"},ko={class:"robot-avetar-upload"},go=["src"],$o={class:"robot-name-box"},xo={class:"form-item"},wo={class:"form-item-body"},qo={class:"robot-info-box"},So={class:"robot-name-box"},Co=["src"],Lo={class:"robot-name"},Io={class:"robot-intro"},Uo={__name:"basic-config",setup(j){const c=w(!1),{robotInfo:y,updateRobotInfo:f}=Y("robotInfo"),p=F({robot_name:"",robot_avatar:"",robot_avatar_url:"",robot_intro:""}),n=()=>{f({...W(p)}),c.value=!1},l=r=>{let d=r[0];return p.robot_avatar=d,xt(d).then($=>{p.robot_avatar_url=$}),!1},k=()=>{p.robot_name=y.robot_name,p.robot_intro=y.robot_intro,p.robot_avatar=y.robot_avatar,p.robot_avatar_url=y.robot_avatar_url};return(r,d)=>{const $=_e,_=$e;return s(),D(X,{class:"basic-config",title:"基本配置","icon-name":"jibenpeizhi",isEdit:c.value,"onUpdate:isEdit":d[2]||(d[2]=u=>c.value=u),onSave:n,onEdit:k},{default:i(()=>[ae(e("div",bo,[e("div",ho,[d[3]||(d[3]=e("div",{class:"form-item-label"},"机器人名称/头像",-1)),e("div",yo,[t(Et,{accept:"image/*",onChange:l},{default:i(()=>[e("div",ko,[p.robot_avatar_url?(s(),v("img",{key:0,class:"robot-avetar",src:p.robot_avatar_url},null,8,go)):R("",!0)])]),_:1}),e("div",$o,[t($,{value:p.robot_name,"onUpdate:value":d[0]||(d[0]=u=>p.robot_name=u),placeholder:"请输入机器人名称"},null,8,["value"])])])]),e("div",xo,[d[4]||(d[4]=e("div",{class:"form-item-label"},"简介",-1)),e("div",wo,[t(_,{rows:3,value:p.robot_intro,"onUpdate:value":d[1]||(d[1]=u=>p.robot_intro=u),placeholder:"请输入机器人简介，比如 ZHIMA CHATAI 基于大语言模型提供ZHIMA CHATAI 产品帮助。","allow-clear":""},null,8,["value"])])])],512),[[re,c.value]]),ae(e("div",qo,[e("div",So,[e("img",{class:"robot-avatar",src:x(y).robot_avatar_url,alt:""},null,8,Co),e("span",Lo,U(x(y).robot_name),1)]),e("div",Io,U(x(y).robot_intro||"还没有设置机器人介绍，快来写一段简介吧"),1)],512),[[re,!c.value]])]),_:1},8,["isEdit"])}}},Ro=Q(Uo,[["__scopeId","data-v-c384f413"]]),Eo={class:"ai-create-box"},Oo={class:"input-box"},Ao={class:"quick-tags-box"},jo={class:"ai-list-box"},Mo={key:0,class:"loading-box"},zo={key:0,class:"prompt-list-box"},Do={class:"prompt-list"},Po={class:"prompt-header"},No={class:"prompt-title"},To={class:"prompt-content"},Vo={class:"prompt-list"},Bo={class:"prompt-header"},Qo={class:"prompt-title"},Fo={class:"prompt-content"},Jo={class:"prompt-list"},Go={class:"prompt-header"},Ho={class:"prompt-title"},Ko={class:"prompt-content"},Wo={class:"prompt-list"},Zo={class:"prompt-header"},Yo={class:"prompt-title"},Xo={class:"prompt-content"},es={class:"prompt-list"},ts={class:"prompt-header"},os={class:"prompt-title"},ss={class:"prompt-content"},ns={class:"prompt-header"},is={class:"prompt-title"},ls={class:"prompt-content"},as={key:1,class:"empty-box"},rs={__name:"ai-create-prompt",emits:["handleAiSave"],setup(j,{expose:c,emit:y}){const f=Be.PRESENTED_IMAGE_SIMPLE,p=w(!1),n=w(!1),l=Je().query,k=y,r=w(""),d=w(!1),$=[{title:"创建一个电商行业售后客服"},{title:"创建一个英语教育机构官网售前机器人"}],_=w("在上方输入框输入要求，点击生成提示词"),u=()=>{o.value=!1,q.promptStruct=b,r.value="",_.value="在上方输入框输入要求，点击生成提示词",p.value=!0},o=w(!1),b={role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]},q=F({promptStruct:b}),C=E=>{r.value=E},m=()=>{if(!r.value)return K.error("请输入AI 生成提示词");if(d.value)return K.error("正在生成中...");d.value=!0,Ot({id:l.id,demand:r.value}).then(E=>{q.promptStruct=JSON.parse(E.data.promptStruct),o.value=!0}).finally(()=>{d.value=!1}).catch(E=>{o.value=!1,_.value=E.msg})},L=()=>{if(!o.value)return K.error("请先生成提示词");k("handleAiSave",q.promptStruct),p.value=!1};return c({show:u}),(E,a)=>{const h=te,V=_e,M=de,S=Mt,O=Ie,J=Be,P=Me,H=Z;return s(),v("div",null,[t(H,{open:p.value,"onUpdate:open":a[1]||(a[1]=N=>p.value=N),title:"AI 生成提示词",width:746},{footer:i(()=>[t(h,{type:"primary",loading:n.value,onClick:L},{default:i(()=>a[2]||(a[2]=[I("使用该提示")])),_:1,__:[2]},8,["loading"])]),default:i(()=>[e("div",Eo,[e("div",Oo,[t(V,{style:{width:"100%"},value:r.value,"onUpdate:value":a[0]||(a[0]=N=>r.value=N),size:"large",onPressEnter:m,placeholder:"请输入AI 生成提示词例如：创建一个电商行业售后客服"},null,8,["value"]),e("div",{class:"btn-box",onClick:m},[t(M,{name:"ai-mark"}),a[3]||(a[3]=e("span",null,"生成",-1))])]),e("div",Ao,[a[4]||(a[4]=e("div",{class:"quick-label"},"快捷生成：",-1)),(s(),v(T,null,G($,N=>t(S,{key:N.title,onClick:z=>C(N.title),color:"blue"},{default:i(()=>[I(U(N.title),1)]),_:2},1032,["onClick"])),64))]),e("div",jo,[t(P,{style:{height:"100%"}},{default:i(()=>[d.value?(s(),v("div",Mo,[t(O,{tip:"正在生成中..."})])):(s(),v(T,{key:1},[o.value?(s(),v("div",zo,[e("div",Do,[e("div",Po,[e("div",No,U(q.promptStruct.role.subject),1)]),e("div",To,U(q.promptStruct.role.describe),1)]),e("div",Vo,[e("div",Bo,[e("div",Qo,U(q.promptStruct.task.subject),1)]),e("div",Fo,U(q.promptStruct.task.describe),1)]),e("div",Jo,[e("div",Go,[e("div",Ho,U(q.promptStruct.constraints.subject),1)]),e("div",Ko,U(q.promptStruct.constraints.describe),1)]),e("div",Wo,[e("div",Zo,[e("div",Yo,U(q.promptStruct.output.subject),1)]),e("div",Xo,U(q.promptStruct.output.describe),1)]),e("div",es,[e("div",ts,[e("div",os,U(q.promptStruct.tone.subject),1)]),e("div",ss,U(q.promptStruct.tone.describe),1)]),(s(!0),v(T,null,G(q.promptStruct.custom,(N,z)=>(s(),v("div",{class:"prompt-list",key:z+N.key?N.key:""},[e("div",ns,[e("div",is,U(N.subject),1)]),e("div",ls,U(N.describe),1)]))),128))])):(s(),v("div",as,[t(J,{image:x(f),description:_.value},null,8,["image","description"])]))],64))]),_:1})])])]),_:1},8,["open"])])}}},ds=Q(rs,[["__scopeId","data-v-87ba79c2"]]),_s={__name:"upload-prompt",setup(j,{expose:c}){const y=w(!1),f=F({title:"",group_id:0,prompt_type:0,prompt:"",prompt_struct:{}}),p=w(null),n=$=>{if($.prompt_type==0&&!$.prompt)return K.error("自定义提示为空,无法上传");p.value&&p.value.resetFields();let _={...$};f.title="",f.group_id=0,f.prompt="",f.prompt_struct={},f.prompt_type=_.prompt_type,_.prompt_type==0?f.prompt=_.prompt:f.prompt_struct=JSON.stringify(_.prompt_struct),y.value=!0},l=w([]);(()=>{wt().then($=>{l.value=[{id:0,group_name:"默认分组"},...$.data]})})();const r=w(!1),d=()=>{p.value.validate().then(()=>{let $={...f};r.value=!0,qt({...$}).then(()=>{K.success("保存成功"),y.value=!1}).finally(()=>{r.value=!1})})};return c({show:n}),($,_)=>{const u=_e,o=Ze,b=Xe,q=Ye,C=je,m=Z;return s(),v("div",null,[t(m,{open:y.value,"onUpdate:open":_[2]||(_[2]=L=>y.value=L),title:"保存到提示词库",width:580,onOk:d,confirmLoading:r.value},{default:i(()=>[t(C,{style:{"margin-top":"24px"},"label-col":{span:4},"wrapper-col":{span:18},ref_key:"formRef",ref:p,model:f},{default:i(()=>[t(o,{name:"title",label:"提示词标题",rules:[{required:!0,message:"请输入提示词标题"}]},{default:i(()=>[t(u,{value:f.title,"onUpdate:value":_[0]||(_[0]=L=>f.title=L),placeholder:"请输入提示词标题",maxLength:10},null,8,["value"])]),_:1}),t(o,{name:"group_id",label:"分组"},{default:i(()=>[t(q,{value:f.group_id,"onUpdate:value":_[1]||(_[1]=L=>f.group_id=L),style:{width:"100%"}},{default:i(()=>[(s(!0),v(T,null,G(l.value,L=>(s(),D(b,{value:L.id},{default:i(()=>[I(U(L.group_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirmLoading"])])}}},cs={class:"prompt-box"},us={class:"tab-header"},ps={key:0,class:"opt-block"},ms={key:1,class:"opt-block"},vs={class:"tip-text"},fs={key:0,class:"prompt-list-box"},bs={class:"prompt-list"},hs={class:"prompt-header"},ys={class:"prompt-title"},ks={key:0,class:"btn-wrapper-box"},gs={class:"prompt-content"},$s={class:"prompt-list"},xs={class:"prompt-header"},ws={class:"prompt-title"},qs={key:0,class:"btn-wrapper-box"},Ss={class:"prompt-content"},Cs={class:"prompt-list"},Ls={class:"prompt-header"},Is={class:"prompt-title"},Us={key:0,class:"btn-wrapper-box"},Rs={class:"prompt-content"},Es={class:"prompt-list"},Os={class:"prompt-header"},As={class:"prompt-title"},js={key:0,class:"btn-wrapper-box"},Ms={class:"prompt-content"},zs={class:"prompt-list"},Ds={class:"prompt-header"},Ps={class:"prompt-title"},Ns={key:0,class:"btn-wrapper-box"},Ts={class:"swich-item"},Vs={class:"swich-item"},Bs={class:"prompt-content"},Qs={class:"prompt-list"},Fs={class:"prompt-header"},Js={class:"prompt-title"},Gs={key:0,class:"btn-wrapper-box"},Hs={class:"prompt-content"},Ks={class:"prompt-header"},Ws={class:"prompt-title",style:{flex:"1"}},Zs={key:0,class:"btn-wrapper-box"},Ys=["onClick"],Xs={class:"prompt-content"},en={key:0,class:"add-theme-block"},tn={class:"show-more-block"},on={key:1,class:"diy-prompt-box"},sn={key:0,class:"diy-switch-box"},nn={class:"swich-item"},ln={class:"swich-item"},ie="- 请使用markdown格式回答问题。",le="- 当你选择的知识点中包含图片、链接数据时，你需要在你的答案对应位置输出这些数据，不要改写或忽略这些数据。",an={__name:"system-prompt-words",props:{robotList:{type:Array,default:()=>[]}},setup(j){const c=w(!1),{robotInfo:y,updateRobotInfo:f}=Y("robotInfo"),p=j;let n={role:"请输入，告知大模型要扮演的身份、职责、沟通风格等，比如“你扮演一名经验丰富的电商行业售后客服AI助手，具备良好的沟通能力和解决问题的能力。”",task:"请输入，比如“根据提供的知识库资料，找到对应的售后知识（每个知识点之间使用⧼-split_line-⧽进行分割），快速准确回答用户的问题。”",constraints:"请输入对大模型在回复时的要求，比如“你的回答应该使用自然的对话方式，简单直接地回答，不要解释你的答案；当用户问题没有找到相关知识点时，直接告诉用户问题暂时无法回答，不能胡编乱造，否则你将受到惩罚。”",output:"请输入对大模型输出格式的要求，比如“请使用markdown格式输出”",tone:"请告知语言风格要求，比如“专业而不失亲切，适当使用emoji增强可读性”",skill:"请输入"};const l=w({}),k=w(!1),r=w(!1),d=w(!1),$=w(!1),_=F({prompt:"",prompt_struct:{role:{subject:"",describe:""},task:{subject:"",describe:""},constraints:{subject:"",describe:""},skill:{subject:"",describe:""},output:{subject:"",describe:""},tone:{subject:"",describe:""},custom:[]}}),u=w(localStorage.getItem("system_prompt_words_ishide")=="1"),o=()=>{u.value=!u.value,localStorage.setItem("system_prompt_words_ishide",u.value?1:0)},b=(B,g)=>B.includes(g),q=w(y.prompt_type);ue(()=>y,()=>{_.prompt=y.prompt,_.prompt_struct=y.prompt_struct,l.value=y.prompt_struct_default},{immediate:!0,deep:!0}),ue(()=>_.prompt_struct.output.describe,B=>{k.value=b(B,ie),r.value=b(B,le)},{immediate:!0,deep:!0}),ue(()=>_.prompt,B=>{d.value=b(B,ie),$.value=b(B,le)},{immediate:!0,deep:!0});const C=(B,g)=>{B?(g=="outSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+ie:_.prompt_struct.output.describe+=ie),g=="imgSwitch"&&(_.prompt_struct.output.describe?_.prompt_struct.output.describe+=`
`+le:_.prompt_struct.output.describe+=le)):(g=="outSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(ie,"g"),"")),g=="imgSwitch"&&(_.prompt_struct.output.describe=_.prompt_struct.output.describe.replace(new RegExp(le,"g"),"")),_.prompt_struct.output.describe=_.prompt_struct.output.describe.trim())},m=(B,g)=>{B?(g=="outDiySwitch"&&(_.prompt?_.prompt+=`
`+ie:_.prompt+=ie),g=="imgDiySwitch"&&(_.prompt?_.prompt+=`
`+le:_.prompt+=le)):(g=="outDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(ie,"g"),"")),g=="imgDiySwitch"&&(_.prompt=_.prompt.replace(new RegExp(le,"g"),"")),_.prompt=_.prompt.trim())},L=B=>{_.prompt_struct[B].describe=l.value[B].describe},E=()=>{let B=y.work_flow_ids.split(","),g=p.robotList.filter(ve=>B.includes(ve.id)),he=[];he=g.map(ve=>`- ${ve.robot_name} ${ve.robot_intro}`).join(`
`),_.prompt_struct.skill.describe=he},a=()=>{_.prompt_struct.custom.push({subject:"",describe:"",key:Math.random()*1e4}),q.value=1},h=B=>{_.prompt_struct.custom.splice(B,1)},V=()=>{f({...W(_),prompt_type:q.value}),c.value=!1},M=B=>{q.value=1,f({prompt_type:q.value,prompt:_.prompt,prompt_struct:B}),c.value=!1},S=()=>{c.value=!0},O=()=>{c.value=!1},J=w(null),P=()=>{J.value.show()},H=w(null),N=()=>{H.value.show()},z=w(null),be=()=>{z.value.show({..._,prompt_type:q.value})},Ee=B=>{B.prompt_type==1?(q.value=1,_.prompt_struct=B.prompt_struct):(q.value=0,_.prompt=B.prompt),V()};return(B,g)=>{const he=et,ve=tt,Te=oe,ct=de,xe=te,ut=ge,ne=$e,we=se,pt=_e;return s(),v("div",cs,[e("div",us,[t(ve,{activeKey:q.value,"onUpdate:activeKey":g[0]||(g[0]=A=>q.value=A)},{default:i(()=>[(s(),D(he,{key:1,tab:"结构化提示词"})),(s(),D(he,{key:0,tab:"自定义提示词"}))]),_:1},8,["activeKey"]),c.value?(s(),v("div",ps,[t(Te,null,{title:i(()=>g[22]||(g[22]=[I("将当前编辑的提示词保存到提示词库中")])),default:i(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:be},[t(x(Ne)),g[23]||(g[23]=I("上传 "))])]),_:1}),t(Te,null,{title:i(()=>g[24]||(g[24]=[I("从提示词库导入提示词")])),default:i(()=>[e("div",{class:"hover-btn-box",style:{color:"#6524fc"},onClick:N},[t(x(Pt)),g[25]||(g[25]=I("导入 "))])]),_:1}),e("div",{class:"ai-mark-box hover-btn-box",onClick:P},[t(ct,{name:"ai-mark"}),g[26]||(g[26]=I(" AI自动生成 "))]),t(ut,{gap:8},{default:i(()=>[t(xe,{size:"small",type:"primary",onClick:V},{default:i(()=>g[27]||(g[27]=[I("保存")])),_:1,__:[27]}),t(xe,{size:"small",onClick:O},{default:i(()=>g[28]||(g[28]=[I("取消")])),_:1,__:[28]})]),_:1})])):(s(),v("div",ms,[e("span",vs,"当前类型："+U(q.value==1?"结构化提示词":"自定义提示词"),1),t(xe,{size:"small",onClick:S},{default:i(()=>g[29]||(g[29]=[I("修改")])),_:1,__:[29]})]))]),q.value==1?(s(),v("div",fs,[e("div",bs,[e("div",hs,[e("div",ys,U(_.prompt_struct.role.subject),1),c.value?(s(),v("div",ks,[e("a",{onClick:g[1]||(g[1]=A=>L("role"))},"恢复默认")])):R("",!0)]),e("div",gs,[t(ne,{bordered:!1,disabled:!c.value,value:_.prompt_struct.role.describe,"onUpdate:value":g[2]||(g[2]=A=>_.prompt_struct.role.describe=A),placeholder:x(n).role},null,8,["disabled","value","placeholder"])])]),e("div",$s,[e("div",xs,[e("div",ws,U(_.prompt_struct.task.subject),1),c.value?(s(),v("div",qs,[e("a",{onClick:g[3]||(g[3]=A=>L("task"))},"恢复默认")])):R("",!0)]),e("div",Ss,[t(ne,{bordered:!1,disabled:!c.value,value:_.prompt_struct.task.describe,"onUpdate:value":g[4]||(g[4]=A=>_.prompt_struct.task.describe=A),placeholder:x(n).task},null,8,["disabled","value","placeholder"])])]),u.value?(s(),v(T,{key:0},[e("div",Cs,[e("div",Ls,[e("div",Is,U(_.prompt_struct.constraints.subject),1),c.value?(s(),v("div",Us,[e("a",{onClick:g[5]||(g[5]=A=>L("constraints"))},"恢复默认")])):R("",!0)]),e("div",Rs,[t(ne,{bordered:!1,disabled:!c.value,value:_.prompt_struct.constraints.describe,"onUpdate:value":g[6]||(g[6]=A=>_.prompt_struct.constraints.describe=A),placeholder:x(n).constraints,style:{"min-height":"130px"}},null,8,["disabled","value","placeholder"])])]),e("div",Es,[e("div",Os,[e("div",As,U(_.prompt_struct.skill.subject),1),c.value?(s(),v("div",js,[e("a",{onClick:g[7]||(g[7]=A=>E())},"自动导入技能")])):R("",!0)]),e("div",Ms,[t(ne,{bordered:!1,disabled:!c.value,value:_.prompt_struct.skill.describe,"onUpdate:value":g[8]||(g[8]=A=>_.prompt_struct.skill.describe=A),placeholder:x(n).skill,style:{"min-height":"80px"}},null,8,["disabled","value","placeholder"])])]),e("div",zs,[e("div",Ds,[e("div",Ps,U(_.prompt_struct.output.subject),1),c.value?(s(),v("div",Ns,[e("div",Ts,[g[30]||(g[30]=I(" 输出markdown： ")),t(we,{onChange:g[9]||(g[9]=A=>C(A,"outSwitch")),checked:k.value,"onUpdate:checked":g[10]||(g[10]=A=>k.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",Vs,[g[31]||(g[31]=I(" 回复图片： ")),t(we,{onChange:g[11]||(g[11]=A=>C(A,"imgSwitch")),checked:r.value,"onUpdate:checked":g[12]||(g[12]=A=>r.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("a",{onClick:g[13]||(g[13]=A=>L("output"))},"恢复默认")])):R("",!0)]),e("div",Bs,[t(ne,{bordered:!1,disabled:!c.value,value:_.prompt_struct.output.describe,"onUpdate:value":g[14]||(g[14]=A=>_.prompt_struct.output.describe=A),placeholder:x(n).output},null,8,["disabled","value","placeholder"])])]),e("div",Qs,[e("div",Fs,[e("div",Js,U(_.prompt_struct.tone.subject),1),c.value?(s(),v("div",Gs,[e("a",{onClick:g[15]||(g[15]=A=>L("tone"))},"恢复默认")])):R("",!0)]),e("div",Hs,[t(ne,{bordered:!1,disabled:!c.value,value:_.prompt_struct.tone.describe,"onUpdate:value":g[16]||(g[16]=A=>_.prompt_struct.tone.describe=A),placeholder:x(n).tone},null,8,["disabled","value","placeholder"])])]),(s(!0),v(T,null,G(_.prompt_struct.custom,(A,Ve)=>(s(),v("div",{class:"prompt-list",key:Ve+A.key?A.key:""},[e("div",Ks,[e("div",Ws,[t(pt,{bordered:!1,disabled:!c.value,style:{width:"100%"},value:A.subject,"onUpdate:value":qe=>A.subject=qe,placeholder:"请输入主题"},null,8,["disabled","value","onUpdate:value"])]),c.value?(s(),v("div",Zs,[e("div",{class:"hover-btn-box",onClick:qe=>h(Ve)},[t(x(me))],8,Ys)])):R("",!0)]),e("div",Xs,[t(ne,{bordered:!1,disabled:!c.value,value:A.describe,"onUpdate:value":qe=>A.describe=qe,placeholder:"请输入"},null,8,["disabled","value","onUpdate:value"])])]))),128)),c.value?(s(),v("div",en,[t(xe,{onClick:a,block:"",icon:Ge(x(Ue))},{default:i(()=>g[32]||(g[32]=[I("添加主题")])),_:1,__:[32]},8,["icon"])])):R("",!0)],64)):R("",!0),e("div",tn,[e("div",{class:"btn-item",onClick:o},[u.value?(s(),v(T,{key:1},[g[34]||(g[34]=I("收起")),t(x(Nt))],64)):(s(),v(T,{key:0},[g[33]||(g[33]=I("展开")),t(x(ot))],64))])])])):(s(),v("div",on,[c.value?(s(),v("div",sn,[e("div",nn,[g[35]||(g[35]=I(" 输出markdown： ")),t(we,{size:"small",onChange:g[17]||(g[17]=A=>m(A,"outDiySwitch")),checked:d.value,"onUpdate:checked":g[18]||(g[18]=A=>d.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),e("div",ln,[g[36]||(g[36]=I(" 回复图片： ")),t(we,{size:"small",onChange:g[19]||(g[19]=A=>m(A,"imgDiySwitch")),checked:$.value,"onUpdate:checked":g[20]||(g[20]=A=>$.value=A),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])):R("",!0),t(ne,{bordered:c.value,value:_.prompt,"onUpdate:value":g[21]||(g[21]=A=>_.prompt=A),disabled:!c.value,placeholder:"请输入"},null,8,["bordered","value","disabled"])])),t(ds,{onHandleAiSave:M,ref_key:"aiCreatePromptRef",ref:J},null,512),t(zt,{onOk:Ee,ref_key:"importPromptRef",ref:H},null,512),t(_s,{ref_key:"uploadPromptRef",ref:z},null,512)])}}},rn=Q(an,[["__scopeId","data-v-f95249d5"]]),dn={class:"actions-box"},_n={class:"setting-info-block"},cn={class:"set-item w-100"},un={key:0,class:"set-item-content"},pn=["src"],mn={key:1},vn={class:"set-item"},fn={class:"set-item"},bn={class:"set-item"},hn={class:"set-item"},yn={class:"form-box"},kn={class:"form-item"},gn={class:"form-item-body"},$n={class:"form-item"},xn={class:"form-item-label"},wn={class:"form-item-body"},qn={class:"number-box"},Sn={class:"number-slider-box"},Cn={class:"number-input-box"},Ln={class:"form-item"},In={class:"form-item-label"},Un={class:"form-item-body"},Rn={class:"number-box"},En={class:"number-slider-box"},On={class:"number-input-box"},An={class:"form-item"},jn={class:"form-item-label"},Mn={class:"form-item-body"},zn={class:"number-box"},Dn={class:"number-slider-box"},Pn={class:"number-input-box"},Nn={class:"form-item justify-between"},Tn={class:"form-item-label"},Vn={__name:"model-settings",setup(j){const c=["azure","ollama","xinference","openaiAgent","doubao"],y=["doubao"],f=["azure"],p=F({sm:24,md:24,lg:12,xl:24,xxl:24}),n=w([]),l=w(!1),{robotInfo:k,updateRobotInfo:r}=Y("robotInfo"),d=F({use_model:void 0,use_model_icon:"",use_model_name:"",model_config_id:"",temperature:0,max_token:0,context_pair:0,think_switch:1}),$=w(""),_=w(""),u=w(""),o=a=>{d.use_model=c.includes(a.rawData.model_define)&&a.rawData.deployment_name?a.rawData.show_model_name||a.rawData.deployment_name:a.rawData.name,d.use_model_icon=a.icon,d.use_model_name=a.use_model_name,d.model_config_id=a.rawData.id,$.value=a.rawData.model_define},b=w(!1),q=a=>{a.target.closest(".custom-select")||(b.value=!1)};fe(()=>{c.indexOf($.value)>-1?d.use_model=u.value:d.use_model=k.use_model,document.addEventListener("click",q)}),vt(()=>{document.removeEventListener("click",q)});const C=()=>{u.value=d.use_model;let a={...W(d)};f.indexOf($.value)>-1&&(a.use_model="默认"),r(a),l.value=!1},m=a=>{c.indexOf($.value)>-1?d.use_model=u.value:d.use_model=k.use_model,d.model_config_id=k.model_config_id,d.temperature=k.temperature,d.max_token=k.max_token,d.context_pair=k.context_pair,d.think_switch=Number(k.think_switch),l.value=a};Le(()=>{d.model_config_id=k.model_config_id,d.temperature=k.temperature,d.max_token=k.max_token,d.context_pair=k.context_pair,d.think_switch=Number(k.think_switch)});function L(a,h,V){const M=new Set(a.map(S=>S.model_define));return h.filter(S=>{let O=S[V];M.has(O)&&a.filter(J=>{if(J.model_define==O)return J.children=Ct(J.children,S.children),!1})}),a}return(()=>{st({model_type:"LLM"}).then(a=>{u.value=k.use_model;let h=a.data||[],V=[];n.value=h.map(M=>{V=[];for(let S=0;S<M.model_info.llm_model_list.length;S++){const O=M.model_info.llm_model_list[S];c.indexOf(M.model_info.model_define)>-1&&k.model_config_id==M.model_config.id&&(u.value=M.model_config.show_model_name||M.model_config.deployment_name,$.value=M.model_info.model_define,_.value=M.model_info.model_define),V.push({name:O,deployment_name:M.model_config.deployment_name,show_model_name:y.includes(M.model_info.model_define)?M.model_config.show_model_name:"",id:M.model_config.id,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,use_model_name:M.model_info.model_name})}return{id:M.model_config.id,name:M.model_info.model_name,model_define:M.model_info.model_define,icon:M.model_info.model_icon_url,children:V,deployment_name:M.model_config.deployment_name}}),n.value=L(St(n.value,"model_define"),n.value,"model_define"),k.use_model&&k.model_config_id&&n.value.some(M=>M.children.some(S=>{const O=c.includes(S.model_define)&&S.deployment_name?S.deployment_name:S.name;if(c.includes(S.model_define)&&S.deployment_name&&S.id===k.model_config_id)return d.use_model_icon=S.icon,d.use_model_name=S.use_model_name,d.use_model=S.show_model_name||S.deployment_name,!0;if(O===k.use_model&&S.id===k.model_config_id)return d.use_model_icon=S.icon,d.use_model_name=S.use_model_name,!0}))})})(),(a,h)=>{const V=te,M=Bt,S=oe,O=nt,J=Re,P=se,H=Vt,N=Z;return s(),D(X,{class:"setting-box",title:"模型设置","icon-name":"moxingshezhi",isEdit:l.value,"onUpdate:isEdit":h[10]||(h[10]=z=>l.value=z)},{extra:i(()=>[e("div",dn,[t(V,{onClick:h[0]||(h[0]=z=>m(!0)),size:"small"},{default:i(()=>h[11]||(h[11]=[I("修改")])),_:1,__:[11]})])]),default:i(()=>[e("div",_n,[e("div",cn,[h[12]||(h[12]=I(" LLM模型： ")),d.use_model_icon&&d.use_model_name?(s(),v("span",un,[e("img",{src:d.use_model_icon,class:"model-icon"},null,8,pn),I(U(d.use_model_name)+" "+U(d.use_model),1)])):(s(),v("span",mn,U(d.use_model),1))]),e("div",vn,[h[13]||(h[13]=I(" 温度： ")),e("span",null,U(d.temperature),1)]),e("div",fn,[h[14]||(h[14]=I(" 最大token： ")),e("span",null,U(d.max_token),1)]),e("div",bn,[h[15]||(h[15]=I(" 上下文数量： ")),e("span",null,U(d.context_pair),1)]),e("div",hn,[h[16]||(h[16]=I(" 显示推理过程： ")),e("span",null,U(d.think_switch==1?"开":"关"),1)])]),t(N,{open:l.value,"onUpdate:open":h[9]||(h[9]=z=>l.value=z),width:672,title:"模型设置",onOk:C},{default:i(()=>[e("div",yn,[t(H,{gutter:[32,24]},{default:i(()=>[t(M,ye(ke(p)),{default:i(()=>[e("div",kn,[h[17]||(h[17]=e("div",{class:"form-item-label mb12"},[e("span",null,"LLM模型 ")],-1)),e("div",gn,[t(Tt,{modelValue:d.use_model,"onUpdate:modelValue":h[1]||(h[1]=z=>d.use_model=z),placeholder:"请选择LLM模型","label-key":"use_model_name","value-key":"value",modelType:"LLM","model-config-id":d.model_config_id,onChange:o},null,8,["modelValue","model-config-id"])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",$n,[e("div",xn,[h[19]||(h[19]=e("span",null,"温度 ",-1)),t(S,null,{title:i(()=>h[18]||(h[18]=[I("温度越低，回答越严谨。温度越高，回答越发散。")])),default:i(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",wn,[e("div",qn,[e("div",Sn,[t(O,{class:"custom-slider",value:d.temperature,"onUpdate:value":h[2]||(h[2]=z=>d.temperature=z),min:0,max:2,step:.1},null,8,["value"])]),e("div",Cn,[t(J,{value:d.temperature,"onUpdate:value":h[3]||(h[3]=z=>d.temperature=z),min:0,max:2,step:.1},null,8,["value"])])])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",Ln,[e("div",In,[h[21]||(h[21]=e("span",null,"最大token ",-1)),t(S,null,{title:i(()=>h[20]||(h[20]=[I("问题+答案的最大token数，如果出现回答被截断，可调高此值")])),default:i(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",Un,[e("div",Rn,[e("div",En,[t(O,{class:"custom-slider",value:d.max_token,"onUpdate:value":h[4]||(h[4]=z=>d.max_token=z),min:0,max:100*1024},null,8,["value"])]),e("div",On,[t(J,{value:d.max_token,"onUpdate:value":h[5]||(h[5]=z=>d.max_token=z),min:0,max:100*1024},null,8,["value"])])])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",An,[e("div",jn,[h[23]||(h[23]=e("span",null,"上下文数量 ",-1)),t(S,null,{title:i(()=>h[22]||(h[22]=[I("提示词中携带的历史聊天记录轮次。设置为0则不携带聊天记录。最多设置50轮。注意，携带的历史聊天记录越多，消耗的token相应也就越多。")])),default:i(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",Mn,[e("div",zn,[e("div",Dn,[t(O,{class:"custom-slider",value:d.context_pair,"onUpdate:value":h[6]||(h[6]=z=>d.context_pair=z),min:0,max:50},null,8,["value"])]),e("div",Pn,[t(J,{value:d.context_pair,"onUpdate:value":h[7]||(h[7]=z=>d.context_pair=z),min:0,max:50},null,8,["value"])])])])])]),_:1},16),t(M,ye(ke(p)),{default:i(()=>[e("div",Nn,[e("div",Tn,[h[25]||(h[25]=e("span",null,"显示推理过程 ",-1)),t(S,null,{title:i(()=>h[24]||(h[24]=[e("span",null,"开启后，API接口、聊天测试页、 webAPP页会显示或返回推理模型的推理过程",-1)])),default:i(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),t(P,{checked:d.think_switch,"onUpdate:checked":h[8]||(h[8]=z=>d.think_switch=z),checkedValue:1,unCheckedValue:0},null,8,["checked"])])]),_:1},16)]),_:1})])]),_:1},8,["open"])]),_:1},8,["isEdit"])}}},Bn=Q(Vn,[["__scopeId","data-v-826b95fe"]]),Qn={class:"library-checkbox-box"},Fn={class:"list-tools"},Jn={class:"list-box",ref:"scrollContainer"},Gn={class:"library-name"},Hn={class:"library-desc"},Kn={__name:"library-select-alert",emits:["change"],setup(j,{expose:c,emit:y}){const f=y,p=F({indeterminate:!1,checkAll:!1,checkedList:[]}),n=w(!1),l=C=>{u(),p.checkedList=C,n.value=!0},k=()=>{n.value=!1,_()},r=w(""),d=()=>{u()},$=w([]),_=()=>{f("change",[...p.checkedList])},u=async()=>{const C=await Ke({library_name:r.value,type:"",show_open_docs:1});if(C){let m=C.data||[];$.value=m}},o=w(!1),b=async()=>{o.value=!0,await u(),o.value=!1,K.success("刷新完成")},q=()=>{window.open("/#/library/list")};return c({open:l}),(C,m)=>{const L=it,E=_e,a=te,h=De,V=ze,M=Ie,S=Z;return s(),D(S,{width:"746px",open:n.value,"onUpdate:open":m[2]||(m[2]=O=>n.value=O),title:"关联知识库",onOk:k},{default:i(()=>[e("div",Qn,[t(L,{message:"请选择关联知识库，机器人会根据知识库内上传的文档回复用户的提问。每个机器人最多关联5个知识库",type:"info"}),e("div",Fn,[e("div",null,[t(E,{style:{width:"282px"},value:r.value,"onUpdate:value":m[0]||(m[0]=O=>r.value=O),placeholder:"请输入知识库名称搜索",onChange:d},{suffix:i(()=>[t(x(Qt),{style:{color:"rgba(0, 0, 0, 0.25)"}})]),_:1},8,["value"])]),e("div",null,[t(a,{style:{"margin-right":"8px"},onClick:b},{default:i(()=>[t(x(Ft)),m[3]||(m[3]=I(" 刷新 "))]),_:1,__:[3]}),t(a,{type:"primary",ghost:"",onClick:q},{default:i(()=>m[4]||(m[4]=[I("新建知识库")])),_:1,__:[4]})])]),t(M,{spinning:o.value,delay:100},{default:i(()=>[t(V,{value:p.checkedList,"onUpdate:value":m[1]||(m[1]=O=>p.checkedList=O),style:{width:"100%"}},{default:i(()=>[e("div",Jn,[(s(!0),v(T,null,G($.value,O=>(s(),v("div",{class:"list-item-wraapper",key:O.id},[t(h,{class:"list-item",value:O.id},{default:i(()=>[e("div",Gn,U(O.library_name),1),e("div",Hn,U(O.library_intro),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"])])]),_:1},8,["open"])}}},Wn=Q(Kn,[["__scopeId","data-v-81c2223e"]]),Zn={class:"recall-settings-box"},Yn={class:"form-box"},Xn={class:"form-item is-required"},ei={class:"form-item-body"},ti={class:"retrieval-mode-items"},oi=["onClick"],si={class:"retrieval-mode-title"},ni={class:"title-text"},ii={key:0,style:{width:"32px"},src:Jt,alt:""},li={class:"retrieval-mode-desc"},ai={class:"form-item"},ri={class:"form-item-label"},di={class:"form-item-body"},_i={class:"number-box"},ci={class:"number-slider-box"},ui={class:"number-input-box"},pi={key:0,class:"form-item"},mi={class:"form-item-label"},vi={class:"form-item-body"},fi={class:"number-box"},bi={class:"number-slider-box"},hi={class:"number-input-box"},yi={class:"form-item"},ki={class:"form-item-label"},gi={key:0,class:"form-item-body"},$i=["src"],xi={__name:"recall-settings-alert",emits:["change"],setup(j,{expose:c,emit:y}){const f=y,p=w([{iconName:"mix-icon",title:"混合检索",value:1,isRecommendation:!0,desc:"同时执行三种检索模式，使用RRF算法进行排序，从三种查询结果中选择更匹配用户问题的结果。混合检索兼顾语义相似性与逻辑关联性，通过互补优势提升检索的准确性和生成结果的可信度"},{iconName:"vector-icon",title:"向量检索",value:2,desc:"将用户提问转成向量之后与知识库分段匹配相似度，返回相似度高的结果。向量检索擅长语义相似性匹配和大规模非结构化数据处理，但缺乏可解释性和精准关系验证"},{iconName:"graph-icon",title:"知识图谱检索",value:4,desc:"通过关系推理，检索出与用户问题相关联的知识。知识图谱检索擅长精准的实体关系推理和逻辑验证，但对非结构化文本和语义模糊查询支持较弱"},{iconName:"search-check-icon",title:"全文检索",value:3,desc:"通过分词匹配文档中的词汇，返回包含这些词汇的文本片段"}]),n=F({rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:void 0,search_type:1}),l=w(!1),k=C=>{q(),n.rerank_status=C.rerank_status||0,n.rerank_use_model=C.rerank_use_model||void 0,n.rerank_model_config_id=C.rerank_model_config_id>0?C.rerank_model_config_id:"",n.top_k=C.top_k,n.similarity=C.similarity,n.search_type=C.search_type,l.value=!0},r=(C,m)=>{if(!C||!m){n.rerank_model_config_id="";return}n.rerank_model_config_id=m.rerank_model_config_id},d=C=>{C==0&&(n.rerank_model_config_id="",n.rerank_use_model="")},$=C=>{n.search_type=C},_=()=>n.rerank_status==1&&!n.rerank_model_config_id,u=()=>{if(_())return K.error("请选择Rerank模型");l.value=!1,o()},o=()=>{f("change",W(n))},b=w([]),q=()=>{st({model_type:"RERANK"}).then(C=>{let m=C.data||[];b.value=m.map(L=>({id:L.model_config.id,name:L.model_info.model_name,icon:L.model_info.model_icon_url,children:L.model_info.rerank_model_list}))})};return c({open:k}),(C,m)=>{const L=de,E=oe,a=nt,h=Re,V=se,M=Xe,S=Dt,O=Ye,J=Z;return s(),D(J,{width:"746px",open:l.value,"onUpdate:open":m[6]||(m[6]=P=>l.value=P),title:"召回设置",onOk:u},{default:i(()=>[e("div",Zn,[e("div",Yn,[e("div",Xn,[m[7]||(m[7]=e("div",{class:"form-item-label"},[e("span",null,"检索模式")],-1)),e("div",ei,[e("div",ti,[(s(!0),v(T,null,G(p.value,P=>(s(),v("div",{class:Ce(["retrieval-mode-item",{active:n.search_type==P.value}]),key:P.value,onClick:H=>$(P.value)},[n.search_type==P.value?(s(),D(L,{key:0,class:"check-arrow",name:"check-arrow-filled"})):R("",!0),e("div",si,[t(L,{name:P.iconName,class:"title-icon"},null,8,["name"]),e("span",ni,U(P.title),1),P.isRecommendation?(s(),v("img",ii)):R("",!0)]),e("div",li,U(P.desc),1)],10,oi))),128))])])]),e("div",ai,[e("div",ri,[m[9]||(m[9]=e("span",null,"Top K ",-1)),t(E,null,{title:i(()=>m[8]||(m[8]=[I("最多从知识库中召回分段数，最低为1，最高为10。召回分段数越多，消耗的token也会越多。")])),default:i(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",di,[e("div",_i,[e("div",ci,[t(a,{class:"custom-slider",value:n.top_k,"onUpdate:value":m[0]||(m[0]=P=>n.top_k=P),min:1,max:10},null,8,["value"])]),e("div",ui,[t(h,{value:n.top_k,"onUpdate:value":m[1]||(m[1]=P=>n.top_k=P),min:1,max:10},null,8,["value"])])])])]),n.search_type<=2?(s(),v("div",pi,[e("div",mi,[m[11]||(m[11]=e("span",null,"相似度阈值 ",-1)),t(E,null,{title:i(()=>m[10]||(m[10]=[I("召回时，只会召回相似度大于阈值的文本分段。取值范围：0~1，阈值越大回答的越准确，建议不超过0.9")])),default:i(()=>[t(x(ee),{class:"question-icon"})]),_:1})]),e("div",vi,[e("div",fi,[e("div",bi,[t(a,{class:"custom-slider",value:n.similarity,"onUpdate:value":m[2]||(m[2]=P=>n.similarity=P),min:0,max:1,step:.01},null,8,["value"])]),e("div",hi,[t(h,{value:n.similarity,"onUpdate:value":m[3]||(m[3]=P=>n.similarity=P),min:0,max:1,step:.01},null,8,["value"])])])])])):R("",!0),e("div",yi,[e("div",ki,[m[12]||(m[12]=e("span",null,"Rerank模型",-1)),m[13]||(m[13]=I("   ")),t(V,{checkedValue:1,unCheckedValue:0,checked:n.rerank_status,"onUpdate:checked":m[4]||(m[4]=P=>n.rerank_status=P),onChange:d},null,8,["checked"])]),n.rerank_status==1?(s(),v("div",gi,[t(O,{allowClear:"",value:n.rerank_use_model,"onUpdate:value":m[5]||(m[5]=P=>n.rerank_use_model=P),placeholder:"请选择Rerank模型",onChange:r,style:{width:"60%"}},{default:i(()=>[(s(!0),v(T,null,G(b.value,P=>(s(),D(S,{key:P.id},{label:i(()=>[e("span",null,[e("img",{class:"model-icon",src:P.icon,alt:""},null,8,$i)])]),default:i(()=>[(s(!0),v(T,null,G(P.children,H=>(s(),D(M,{value:H,rerank_model_config_id:P.id,key:H},{default:i(()=>[e("span",null,U(H),1)]),_:2},1032,["value","rerank_model_config_id"]))),128))]),_:2},1024))),128))]),_:1},8,["value"])])):R("",!0)])])])]),_:1},8,["open"])}}},wi=Q(xi,[["__scopeId","data-v-4bfd6507"]]),qi={class:"list-box"},Si=["onClick"],Ci={class:"avater-box"},Li=["src"],Ii={class:"content-box"},Ui={class:"title-block"},Ri={class:"title-text"},Ei={class:"desc-box"},Oi={class:"right-icon"},Ai={__name:"no-open-graph-modal",props:{list:{type:Array,default:[]}},emits:["refreshList"],setup(j,{expose:c,emit:y}){const f=y,p=j,n=w(!1);ue(()=>p.list,()=>{p.list.length==0&&(n.value=!1)},{});const l=()=>{n.value=!0},k=()=>{document.visibilityState==="visible"&&f("refreshList")};fe(()=>{document.addEventListener("visibilitychange",k)}),ft(()=>{document.removeEventListener("visibilitychange",k)});const r=d=>{window.open(`/#/library/details/knowledge-config?id=${d.id}`)};return c({show:l}),(d,$)=>{const _=it,u=Me,o=Z;return s(),v("div",null,[t(o,{open:n.value,"onUpdate:open":$[0]||($[0]=b=>n.value=b),title:"部分知识库未开启生成知识图谱",footer:null,width:746},{default:i(()=>[t(_,{style:{"margin-top":"16px"},message:"当前机器人关联的部分知识库未开启知识图谱,无法通过知识图谱检索,可能会影响检索结果。请您按需开启对应知识的生成知识图谱功能"}),t(u,{scrollbar:!1,style:{height:"400px"}},{default:i(()=>[e("div",qi,[(s(!0),v(T,null,G(p.list,b=>(s(),v("div",{class:"list-item",onClick:q=>r(b),key:b.id},[e("div",Ci,[e("img",{src:b.avatar,alt:""},null,8,Li)]),e("div",Ii,[e("div",Ui,[$[1]||($[1]=e("div",{class:"tag-icon"},"Graph",-1)),e("div",Ri,U(b.library_name),1)]),e("div",Ei,U(b.library_intro),1)]),e("div",Oi,[t(x(Gt))])],8,Si))),128))])]),_:1})]),_:1},8,["open"])])}}},ji=Q(Ai,[["__scopeId","data-v-0ebe0aeb"]]),Mi={class:"actions-box"},zi={key:0,class:"library-list"},Di=["onClick"],Pi=["onClick"],Ni={class:"library-name"},Ti={class:"library-name-text"},Vi={class:"library-intro"},Bi={class:"setting-info-block"},Qi={class:"set-item"},Fi={key:0},Ji={key:1},Gi={key:2},Hi={key:3},Ki={class:"set-item"},Wi={key:0,class:"set-item"},Zi={class:"set-item"},Yi={key:0},Xi={key:1},el={__name:"index",setup(j){const{getStorage:c,removeStorage:y}=It("localStorage"),f=Lt(),p=pe(()=>{var S;return((S=f.companyInfo)==null?void 0:S.neo4j_status)=="true"}),n=w(!1),{robotInfo:l,updateRobotInfo:k}=Y("robotInfo"),r=F({library_ids:[],rerank_status:0,rerank_use_model:void 0,rerank_model_config_id:"",top_k:0,similarity:0,search_type:1}),d=w([]),$=w(null),_=pe(()=>d.value.filter(S=>r.library_ids.includes(S.id))),u=pe(()=>_.value.filter(S=>S.graph_switch==0)),o=S=>{let O=r.library_ids.indexOf(S.id);r.library_ids.splice(O,1),a()},b=S=>{r.library_ids=[...S],a()},q=()=>{$.value.open([...r.library_ids])},C=w(null),m=()=>{C.value.open(W(r))},L=w(null),E=S=>{r.rerank_status=S.rerank_status,r.rerank_use_model=S.rerank_use_model,r.rerank_model_config_id=S.rerank_model_config_id,r.top_k=S.top_k,r.similarity=S.similarity,r.search_type=S.search_type,(S.search_type==1||S.search_type==4)&&u.value.length>0&&L.value.show(),a()},a=()=>{let S={...W(r)};S.library_ids=S.library_ids.join(","),k({...S})},h=async()=>{const S=await Ke({type:"",show_open_docs:1});S&&(d.value=S.data||[])},V=()=>{Z.confirm({title:"还未关联知识库",content:"关联知识库后，机器人会根据知识库作答。",okText:"立即关联",cancelText:"暂不关联",onOk(){q()}})};r.rerank_use_model=l.rerank_use_model||void 0,Le(()=>{r.library_ids=l.library_ids.split(","),r.rerank_status=l.rerank_status||0,r.rerank_use_model=l.rerank_use_model||void 0,r.rerank_model_config_id=l.rerank_model_config_id||"",r.top_k=l.top_k,r.similarity=l.similarity,r.search_type=l.search_type});const M=S=>{window.open(`#/library/details/knowledge-document?id=${S.id}`)};return fe(()=>{h(),c("showNoLibraryTip")&&(V(),y("showNoLibraryTip"))}),(S,O)=>{const J=te,P=ge,H=oe;return s(),D(X,{class:"setting-box",title:"关联知识库","icon-name":"guanlianzhishiku",isEdit:n.value,"onUpdate:isEdit":O[0]||(O[0]=N=>n.value=N),bodyStyle:{padding:0}},{extra:i(()=>[e("div",Mi,[t(P,{gap:8},{default:i(()=>[t(J,{size:"small",onClick:m},{default:i(()=>O[1]||(O[1]=[I("召回设置")])),_:1,__:[1]}),t(J,{size:"small",onClick:q},{default:i(()=>O[2]||(O[2]=[I("关联知识库")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[_.value.length>0?(s(),v("div",zi,[(s(!0),v(T,null,G(_.value,N=>(s(),v("div",{class:"library-item",key:N.id,onClick:z=>M(N)},[e("span",{class:"close-btn",onClick:bt(z=>o(N),["stop"])},[t(x(me))],8,Pi),e("div",Ni,[p.value?(s(),D(H,{key:0},{title:i(()=>[I(U(N.graph_switch==0?"未":"已")+"开启知识图谱生成",1)]),default:i(()=>[e("div",{class:Ce(["graph-tag",{active:N.graph_switch==1}])},"Graph",2)]),_:2},1024)):R("",!0),e("div",Ti,U(N.library_name),1)]),e("div",Vi,U(N.library_intro),1)],8,Di))),128))])):R("",!0),e("div",Bi,[e("div",Qi,[O[3]||(O[3]=I(" 检索模式： ")),r.search_type==1?(s(),v("span",Fi,"混合检索")):R("",!0),r.search_type==2?(s(),v("span",Ji,"向量检索")):R("",!0),r.search_type==3?(s(),v("span",Gi,"全文检索")):R("",!0),r.search_type==4?(s(),v("span",Hi,"知识图谱检索")):R("",!0)]),e("div",Ki,[O[4]||(O[4]=I(" Top K： ")),e("span",null,U(r.top_k),1)]),r.search_type<=2?(s(),v("div",Wi,[O[5]||(O[5]=I(" 相似度阈值： ")),e("span",null,U(r.similarity),1)])):R("",!0),e("div",Zi,[O[6]||(O[6]=I(" Rerank模型： ")),r.rerank_status==0?(s(),v("span",Yi,"关")):(s(),v("span",Xi,U(r.rerank_use_model),1))])]),t(Wn,{ref_key:"librarySelectAlertRef",ref:$,onChange:b},null,512),t(wi,{ref_key:"recallSettingsAlertRef",ref:C,onChange:E},null,512),t(ji,{list:u.value,onRefreshList:h,ref_key:"noOpenGraphModalRef",ref:L},null,8,["list"])]),_:1},8,["isEdit"])}}},tl=Q(el,[["__scopeId","data-v-7e4fe84e"]]),ol={class:"library-checkbox-box"},sl={class:"list-box",ref:"scrollContainer"},nl={class:"library-name"},il={class:"library-desc"},ll={key:0,class:"empty-box"},al={__name:"library-select-alert",emits:["change"],setup(j,{expose:c,emit:y}){const f=y,p=F({indeterminate:!1,checkAll:!1,checkedList:[]}),n=w(!1),l=o=>{$(),p.checkedList=o,n.value=!0},k=()=>{n.value=!1,d()};w("");const r=w([]),d=()=>{f("change",[...p.checkedList])},$=async()=>{const o=await lt();if(o){let b=o.data||[];r.value=b}},_=w(!1),u=()=>{window.open("/#/database/list")};return c({open:l}),(o,b)=>{const q=De,C=ze,m=Ie,L=Z;return s(),D(L,{width:"746px",open:n.value,"onUpdate:open":b[1]||(b[1]=E=>n.value=E),title:"关联数据表",onOk:k},{default:i(()=>[e("div",ol,[t(m,{spinning:_.value,delay:100},{default:i(()=>[t(C,{value:p.checkedList,"onUpdate:value":b[0]||(b[0]=E=>p.checkedList=E),style:{width:"100%"}},{default:i(()=>[e("div",sl,[(s(!0),v(T,null,G(r.value,E=>(s(),v("div",{class:"list-item-wraapper",key:E.id},[t(q,{class:"list-item",value:E.id},{default:i(()=>[e("div",nl,U(E.name),1),e("div",il,U(E.description),1)]),_:2},1032,["value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!_.value&&!r.value.length?(s(),v("div",ll,[b[3]||(b[3]=e("img",{src:at,alt:""},null,-1)),e("div",null,[b[2]||(b[2]=I(" 暂无数据表, 请先去添加数据表 ")),e("a",{onClick:u}," 去添加")])])):R("",!0)])]),_:1},8,["open"])}}},rl=Q(al,[["__scopeId","data-v-890ab853"]]),dl={class:"actions-box"},_l={key:0,class:"library-list"},cl=["onClick"],ul={class:"library-name"},pl={class:"library-intro"},ml={__name:"index",setup(j){const c=w(!1),{robotInfo:y,updateRobotInfo:f}=Y("robotInfo"),p=F({form_ids:[]}),n=w([]),l=w(null),k=pe(()=>n.value.filter(o=>p.form_ids.includes(o.id))),r=o=>{let b=p.form_ids.indexOf(o.id);p.form_ids.splice(b,1),_()},d=o=>{p.form_ids=[...o],_()},$=()=>{l.value.open([...p.form_ids])},_=()=>{let o={...W(p)};o.form_ids=o.form_ids.join(","),f({...o})};return(async()=>{const o=await lt();o&&(n.value=o.data||[])})(),Le(()=>{p.form_ids=y.form_ids.split(",")}),(o,b)=>{const q=oe,C=te,m=ge;return s(),D(X,{class:"setting-box",title:"数据库","icon-name":"guanlianzhishiku",isEdit:c.value,"onUpdate:isEdit":b[0]||(b[0]=L=>c.value=L),bodyStyle:{padding:0}},{tip:i(()=>[t(q,{placement:"top"},{title:i(()=>b[1]||(b[1]=[e("span",null,"关联数据库表，可以在机器人对话时，搜集用户数据进行存储，或者调用存储的数据回答用户提问。",-1)])),default:i(()=>[t(x(ee))]),_:1})]),extra:i(()=>[e("div",dl,[t(m,{gap:8},{default:i(()=>[t(C,{size:"small",onClick:$},{default:i(()=>b[2]||(b[2]=[I("关联数据表")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[k.value.length>0?(s(),v("div",_l,[(s(!0),v(T,null,G(k.value,L=>(s(),v("div",{class:"library-item",key:L.id},[e("span",{class:"close-btn",onClick:E=>r(L)},[t(x(me))],8,cl),e("div",ul,U(L.name),1),e("div",pl,U(L.description),1)]))),128))])):R("",!0),t(rl,{ref_key:"librarySelectAlertRef",ref:l,onChange:d},null,512)]),_:1},8,["isEdit"])}}},vl=Q(ml,[["__scopeId","data-v-077d8df6"]]),fl={class:"form-box"},bl={class:"question-title"},hl={class:"question-options"},yl={class:"question-option"},kl={class:"drag-btn"},gl={class:"action-box"},$l={class:"robot-info-box"},xl={class:"robot-welcome-content"},wl={class:"robot-welcome-question"},ql={__name:"welcome-words",setup(j){const c=w(!1),y=w(!1),{robotInfo:f,updateRobotInfo:p,scrollBoxToBottom:n}=Y("robotInfo"),l=F({welcomes:{content:"",question:[]}}),k=()=>{let u=!1;if(l.welcomes.question.length>0){for(let o=0;o<l.welcomes.question.length;o++)if(!l.welcomes.question[o].content){u=o+1;break}}return u},r=()=>{l.welcomes.question.push({content:"",id:Se(8)})},d=u=>{l.welcomes.question.splice(u,1)},$=()=>{if(!l.welcomes.content)return K.error("请输入欢迎语");if(k())return K.error("引导问题内容不能为空");p({...W(l)}),c.value=!1},_=()=>{let u={...f.welcomes},o=[];u.question.forEach(({content:b,id:q})=>{let C={id:q,content:b};C.id||(C.id=Se(6)),o.push(C)}),l.welcomes.content=u.content,l.welcomes.question=o};return(u,o)=>{const b=$e,q=de,C=_e;return s(),D(X,{class:"setting-box",title:"欢迎语","icon-name":"huanyingyu",isEdit:c.value,"onUpdate:isEdit":o[4]||(o[4]=m=>c.value=m),onSave:$,onEdit:_},{default:i(()=>[ae(e("div",fl,[e("div",bl,[t(b,{value:l.welcomes.content,"onUpdate:value":o[0]||(o[0]=m=>l.welcomes.content=m),placeholder:"请输入欢迎语"},null,8,["value"])]),e("div",hl,[t(x(Pe),{modelValue:l.welcomes.question,"onUpdate:modelValue":o[1]||(o[1]=m=>l.welcomes.question=m),"item-key":"id",handle:".drag-btn",onStart:o[2]||(o[2]=m=>y.value=!0),onEnd:o[3]||(o[3]=m=>y.value=!1)},{item:i(({element:m,index:L})=>[e("div",yl,[e("span",kl,[t(q,{name:"drag"})]),t(C,{class:"question-option-content",value:m.content,"onUpdate:value":E=>m.content=E,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",gl,[t(x(me),{class:"del-btn",onClick:E=>d(L)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:r},[t(x(Ue),{class:"add-btn-icon"}),o[5]||(o[5]=I("添加引导问题 "))])])],512),[[re,c.value]]),ae(e("div",$l,[e("div",xl,U(x(f).welcomes.content),1),e("div",wl,[(s(!0),v(T,null,G(x(f).welcomes.question,(m,L)=>(s(),v("div",{class:"question-item",key:L},U(m.content),1))),128))])],512),[[re,!c.value]])]),_:1},8,["isEdit"])}}},Sl=Q(ql,[["__scopeId","data-v-9b840ded"]]),Cl={class:"form-box"},Ll={class:"question-title"},Il={class:"question-options"},Ul={class:"question-option"},Rl={class:"drag-btn"},El={class:"action-box"},Ol={class:"robot-info-box"},Al={class:"robot-unknown-content"},jl={class:"robot-unknown-question"},Ml={__name:"unknown-problem-prompt",setup(j){const c=w(!1),y=w(!1),{robotInfo:f,updateRobotInfo:p,scrollBoxToBottom:n}=Y("robotInfo"),l=F({unknown_question_prompt:{content:"",question:[]}}),k=()=>{l.unknown_question_prompt.question.push({content:"",id:Se(8)}),He(()=>{n()})},r=_=>{l.unknown_question_prompt.question.splice(_,1)},d=()=>{p({...W(l)}),c.value=!1},$=()=>{let _={...f.unknown_question_prompt},u=[];_.question&&_.question.forEach(({content:o,id:b})=>{let q={id:b,content:o};q.id||(q.id=Se(6)),u.push(q)}),_.content&&(l.unknown_question_prompt.content=_.content),u&&(l.unknown_question_prompt.question=u)};return fe(()=>{}),(_,u)=>{const o=oe,b=$e,q=de,C=_e;return s(),D(X,{class:"setting-box",title:"未知问题提示语","icon-name":"unknown-prompt",isEdit:c.value,"onUpdate:isEdit":u[4]||(u[4]=m=>c.value=m),onSave:d,onEdit:$},{tip:i(()=>[t(o,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>u[5]||(u[5]=[e("span",null,"仅知识库模式下，用户提问没有在知识库中大于score阈值的分段时，会直接回复未知问题提示语。",-1)])),default:i(()=>[t(x(ee))]),_:1})]),default:i(()=>[ae(e("div",Cl,[e("div",Ll,[t(b,{value:l.unknown_question_prompt.content,"onUpdate:value":u[0]||(u[0]=m=>l.unknown_question_prompt.content=m),placeholder:"请输入未知问题提示语"},null,8,["value"])]),e("div",Il,[t(x(Pe),{modelValue:l.unknown_question_prompt.question,"onUpdate:modelValue":u[1]||(u[1]=m=>l.unknown_question_prompt.question=m),"item-key":"id",handle:".drag-btn",onStart:u[2]||(u[2]=m=>y.value=!0),onEnd:u[3]||(u[3]=m=>y.value=!1)},{item:i(({element:m,index:L})=>[e("div",Ul,[e("span",Rl,[t(q,{name:"drag"})]),t(C,{class:"question-option-content",value:m.content,"onUpdate:value":E=>m.content=E,placeholder:"请输入问题"},null,8,["value","onUpdate:value"]),e("div",El,[t(x(me),{class:"del-btn",onClick:E=>r(L)},null,8,["onClick"])])])]),_:1},8,["modelValue"]),e("div",{class:"add-btn",onClick:k},[t(x(Ue),{class:"add-btn-icon"}),u[6]||(u[6]=I("添加引导问题 "))])])],512),[[re,c.value]]),ae(e("div",Ol,[e("div",Al,U(x(f).unknown_question_prompt.content),1),e("div",jl,[(s(!0),v(T,null,G(x(f).unknown_question_prompt.question,(m,L)=>(s(),v("div",{class:"question-item",key:L},U(m.content),1))),128))])],512),[[re,!c.value]])]),_:1},8,["isEdit"])}}},zl=Q(Ml,[["__scopeId","data-v-aca01d0e"]]),Dl={class:"robot-info-box"},Pl={class:"modal-box",ref:"modalBoxRef"},Nl={class:"modal-item-box"},Tl={class:"modal-item"},Vl={class:"modal-item"},Bl={__name:"problem-optimization",setup(j){const c=w(!1);w(!1);const{robotInfo:y,updateRobotInfo:f}=Y("robotInfo"),p=w("0"),n=F({optimize_question_use_model:"",optimize_question_model_config_id:""});fe(()=>{p.value=y.optimize_question_model_config_id!=0?"1":"0",n.optimize_question_use_model=y.optimize_question_use_model,n.optimize_question_model_config_id=y.optimize_question_model_config_id});const l=w([]),k=u=>{l.value=u,He(()=>{(!n.optimize_question_use_model||!Number(n.optimize_question_model_config_id))&&r()})},r=()=>{if(l.value.length>0){let u=null,o=null;for(let b of l.value)if(b.model_define==="tongyi"){u=b;for(let q of u.children)if(q.name==="qwen-max"){o=q;break}break}u||(u=l.value[0],o=u.children[0]),u&&o&&(n.optimize_question_use_model=o.name,n.optimize_question_model_config_id=o.model_config_id)}},d=()=>{c.value=!1,f({...W(n)})},$=u=>{u!=1&&(n.optimize_question_use_model="",n.optimize_question_model_config_id=0)},_=u=>{f({})};return(u,o)=>{const b=oe,q=se,C=dt,m=rt,L=$e,E=Z;return s(),D(X,{class:"setting-box",title:"问题优化","icon-name":"problem-optimization"},{extra:i(()=>o[7]||(o[7]=[e("span",null,null,-1)])),default:i(()=>[e("div",Dl,[o[9]||(o[9]=e("div",{class:"robot-prompt"}," 开启后，进行知识库搜索时，会根据对话记录，利用AI补全问题缺失的信息 ",-1)),t(b,null,{title:i(()=>o[8]||(o[8]=[e("span",null,"填写对话背景，可以帮助大模型在上下文不全时也能更好的补全用户问题",-1)])),default:i(()=>[e("div",{class:"dialog-bg-set",onClick:o[0]||(o[0]=a=>c.value=!0)}," 对话背景设置 ")]),_:1})]),t(q,{onChange:_,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(y).enable_question_optimize,"onUpdate:checked":o[1]||(o[1]=a=>x(y).enable_question_optimize=a),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),e("div",Pl,[t(E,{getContainer:()=>u.$refs.modalBoxRef,open:c.value,"onUpdate:open":o[6]||(o[6]=a=>c.value=a),width:472,title:"用户问题建议设置",onOk:d},{default:i(()=>[e("div",Nl,[e("div",Tl,[o[12]||(o[12]=e("div",{class:"label"},"模型",-1)),t(m,{value:p.value,"onUpdate:value":o[2]||(o[2]=a=>p.value=a),onChange:$},{default:i(()=>[t(C,{value:"0"},{default:i(()=>o[10]||(o[10]=[I("跟随机器人")])),_:1,__:[10]}),t(C,{value:"1"},{default:i(()=>o[11]||(o[11]=[I("指定模型")])),_:1,__:[11]})]),_:1},8,["value"]),p.value=="1"?(s(),D(Ht,{key:0,modelType:"LLM",modeName:n.optimize_question_use_model,"onUpdate:modeName":o[3]||(o[3]=a=>n.optimize_question_use_model=a),modeId:n.optimize_question_model_config_id,"onUpdate:modeId":o[4]||(o[4]=a=>n.optimize_question_model_config_id=a),style:{width:"100%","margin-top":"8px"},onLoaded:k},null,8,["modeName","modeId"])):R("",!0)]),e("div",Vl,[o[13]||(o[13]=e("div",{class:"label"},"对话背景",-1)),t(L,{style:{height:"120px"},value:x(y).optimize_question_dialogue_background,"onUpdate:value":o[5]||(o[5]=a=>x(y).optimize_question_dialogue_background=a),placeholder:"描述当前对话的背景，便于大模型补全用户问题，比如：当前对话是关于chatwiki的使用问题和功能介绍"},null,8,["value"])])])]),_:1},8,["getContainer","open"])],512)]),_:1})}}},Ql=Q(Bl,[["__scopeId","data-v-13ab9369"]]),Fl={class:"robot-info-box"},Jl={class:"robot-prompt"},Gl={__name:"suggested-issues",setup(j){w(!1);const{robotInfo:c,updateRobotInfo:y}=Y("robotInfo"),f=p=>{y({})};return(p,n)=>{const l=Re,k=se;return s(),D(X,{class:"setting-box",title:"用户问题建议","icon-name":"suggested-issues"},{extra:i(()=>n[2]||(n[2]=[e("span",null,null,-1)])),default:i(()=>[e("div",Fl,[e("div",Jl,[n[3]||(n[3]=I(" 开启后，机器人回答问题后，自动根据对话内容提供 ")),t(l,{value:x(c).question_guide_num,"onUpdate:value":n[0]||(n[0]=r=>x(c).question_guide_num=r),style:{width:"80px"},precision:0,min:1,max:10,onBlur:f},null,8,["value"]),n[4]||(n[4]=I(" 条用户提问建议，最大不超过10条。 "))])]),t(k,{onChange:f,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(c).enable_question_guide,"onUpdate:checked":n[1]||(n[1]=r=>x(c).enable_question_guide=r),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Hl=Q(Gl,[["__scopeId","data-v-bec632a5"]]),Kl={__name:"sensitive-words",setup(j){w(!1);const{robotInfo:c,updateRobotInfo:y}=Y("robotInfo");F({prompt:""});const f=()=>{window.open("/#/user/sensitive-words")},p=n=>{y({})};return(n,l)=>{const k=se;return s(),D(X,{class:"setting-box",title:"敏感词","icon-name":"sensitive-icon"},{extra:i(()=>l[1]||(l[1]=[e("span",null,null,-1)])),default:i(()=>[e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},[l[2]||(l[2]=I(" 开启后，访客提交的问题中如果包含敏感词，将不支持提交，")),e("span",{onClick:f,style:{cursor:"pointer"}},"设置敏词 >")])]),t(k,{onChange:p,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:x(c).sensitive_words_switch,"onUpdate:checked":l[0]||(l[0]=r=>x(c).sensitive_words_switch=r),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1})}}},Wl=Q(Kl,[["__scopeId","data-v-f1e5ad50"]]),Zl={class:"direct-title"},Yl={class:"direct-desc"},Xl={class:"qa"},ea={class:"prompt-form-item-label"},ta={class:"direct-switch"},oa={class:"similarity"},sa={class:"number-input-box"},na={__name:"chat-edit-alert",emits:["save"],setup(j,{expose:c,emit:y}){const f=y,p=w(1),n=()=>[{direct_id:1,direct_title:"仅知识库模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",chat_type:"1",library_qa_direct_reply_score:"0.900",library_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:3,direct_title:"混合模式",direct_desc:"用户提问时,从知识库检索文档,大语言模型(LLM)根据检索出来的文档分段进行回复。如索果没有符合的分段,则由大语言模型自行组织回复。",chat_type:"3",mixture_qa_direct_reply_score:"0.900",mixture_qa_direct_reply_switch:0,isQaDirectReply:!0},{direct_id:2,direct_title:"直连模式",direct_desc:"用户提问时，直接由LLM生成答案，不从关联知识库中检索。",chat_type:"2",isQaDirectReply:!1}],l=F(n()),k=w(!1),r=F({chat_type:"",library_qa_direct_reply_score:"",library_qa_direct_reply_switch:"false",mixture_qa_direct_reply_score:"",mixture_qa_direct_reply_switch:"false"}),d=()=>{r.chat_type=p.value.toString(),l.forEach(u=>{u.chat_type==p.value&&(r.chat_type=="3"?(r.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch==1?"true":"false",r.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score.toString()):r.chat_type=="1"&&(r.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch==1?"true":"false",r.library_qa_direct_reply_score=u.library_qa_direct_reply_score.toString()))}),$(),Object.assign(l,n()),k.value=!1},$=()=>{f("save",W(r))};fe(()=>{});const _=u=>{p.value=parseInt(u.chat_type),r.chat_type=u.chat_type,r.library_qa_direct_reply_score=u.library_qa_direct_reply_score,r.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch,r.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,r.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch,l.forEach(o=>{o.chat_type=="3"?(o.mixture_qa_direct_reply_score=u.mixture_qa_direct_reply_score,o.mixture_qa_direct_reply_switch=u.mixture_qa_direct_reply_switch=="true"?1:0):o.chat_type=="1"&&(o.library_qa_direct_reply_score=u.library_qa_direct_reply_score,o.library_qa_direct_reply_switch=u.library_qa_direct_reply_switch=="true"?1:0)}),k.value=!0};return ue(()=>k.value,u=>{u===!1&&Object.assign(l,n())},{immediate:!0}),c({open:_}),(u,o)=>{const b=oe,q=se,C=Re,m=dt,L=rt,E=Z;return s(),D(E,{width:"746px",open:k.value,"onUpdate:open":o[1]||(o[1]=a=>k.value=a),title:"聊天模式设置",onOk:d},{default:i(()=>[t(L,{class:"direct-box",value:p.value,"onUpdate:value":o[0]||(o[0]=a=>p.value=a)},{default:i(()=>[(s(!0),v(T,null,G(l,a=>(s(),D(m,{class:Ce(["direct-item",{active:p.value==a.direct_id}]),value:a.direct_id,key:a.direct_id},{default:i(()=>[e("div",Zl,U(a.direct_title),1),e("div",Yl,U(a.direct_desc),1),ae(e("div",Xl,[e("div",ea,[o[4]||(o[4]=e("span",{class:"qa-title"},"QA文档直接回复答案",-1)),t(b,null,ht({default:i(()=>[t(x(ee),{class:"question-icon"})]),_:2},[a.chat_type=="1"?{name:"title",fn:i(()=>[o[2]||(o[2]=I("仅知识库模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"0"}:a.chat_type=="3"?{name:"title",fn:i(()=>[o[3]||(o[3]=I("混合模式下，检索出来的score排名最高的分段为QA模式，且score超过置顶阈值是，直接回复分段的答案，不经过大语言模型（LLM）生成回复。"))]),key:"1"}:void 0]),1024),e("div",ta,[a.chat_type=="1"?(s(),D(q,{key:0,checkedValue:1,unCheckedValue:0,checked:a.library_qa_direct_reply_switch,"onUpdate:checked":h=>a.library_qa_direct_reply_switch=h},null,8,["checked","onUpdate:checked"])):a.chat_type=="3"?(s(),D(q,{key:1,checkedValue:1,unCheckedValue:0,checked:a.mixture_qa_direct_reply_switch,"onUpdate:checked":h=>a.mixture_qa_direct_reply_switch=h},null,8,["checked","onUpdate:checked"])):R("",!0)])])],512),[[re,a.isQaDirectReply&&p.value==a.direct_id]]),ae(e("div",oa,[o[5]||(o[5]=e("span",null,"相似度超过",-1)),e("div",sa,[a.chat_type=="1"?(s(),D(C,{key:0,value:a.library_qa_direct_reply_score,"onUpdate:value":h=>a.library_qa_direct_reply_score=h,disabled:!a.library_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):a.chat_type=="3"?(s(),D(C,{key:1,value:a.mixture_qa_direct_reply_score,"onUpdate:value":h=>a.mixture_qa_direct_reply_score=h,disabled:!a.mixture_qa_direct_reply_switch,min:0,max:1,step:.01},null,8,["value","onUpdate:value","disabled"])):R("",!0)]),o[6]||(o[6]=e("span",null,"时直接回复答案",-1))],512),[[re,a.isQaDirectReply&&p.value==a.direct_id]])]),_:2},1032,["class","value"]))),128))]),_:1},8,["value"])]),_:1},8,["open"])}}},ia=Q(na,[["__scopeId","data-v-fc008010"]]),la={class:"actions-box"},aa={class:"setting-info-block"},ra={class:"set-item"},da={key:0},_a={key:1},ca={key:2},ua={class:"set-item"},pa={key:0,class:"set-item"},ma={class:"set-item"},va={key:0,class:"set-item"},fa={class:"form-box"},ba={__name:"index",setup(j){const c=w(!1),y=w(null),{robotInfo:f,updateRobotInfo:p}=Y("robotInfo"),n=F({chat_type:f.chat_type,library_qa_direct_reply_score:f.library_qa_direct_reply_score,library_qa_direct_reply_switch:f.library_qa_direct_reply_switch,mixture_qa_direct_reply_score:f.mixture_qa_direct_reply_score,mixture_qa_direct_reply_switch:f.mixture_qa_direct_reply_switch}),l=d=>{n.chat_type=d.chat_type,n.library_qa_direct_reply_score=d.library_qa_direct_reply_score,n.library_qa_direct_reply_switch=d.library_qa_direct_reply_switch,n.mixture_qa_direct_reply_score=d.mixture_qa_direct_reply_score,n.mixture_qa_direct_reply_switch=d.mixture_qa_direct_reply_switch,k()},k=()=>{p({...W(n)}),c.value=!1},r=()=>{y.value.open(W(n)),c.value=!0};return(d,$)=>{const _=oe,u=te;return s(),D(X,{class:"setting-box",title:"聊天模式","icon-name":"chat-mode",isEdit:c.value,"onUpdate:isEdit":$[1]||($[1]=o=>c.value=o),bodyStyle:{padding:0}},{tip:i(()=>[t(_,{placement:"top",overlayInnerStyle:{width:"400px"}},{title:i(()=>$[2]||($[2]=[e("span",null,"仅知识库模式：用户提问时，从知识库检索文档，大语言模型（LLM）根据检索出来的文档分段进行回复。如果没有符合的分段，则不由LLM回复，直接回复未知问题提示语。",-1),e("br",null,null,-1),e("span",null,"直连模式：用户提问时，直接由LLM生成答案，不从关联知识库中检索。",-1)])),default:i(()=>[t(x(ee))]),_:1})]),extra:i(()=>[e("div",la,[t(u,{size:"small",onClick:$[0]||($[0]=o=>r(!0))},{default:i(()=>$[3]||($[3]=[I("修改")])),_:1,__:[3]})])]),default:i(()=>[e("div",aa,[e("div",ra,[$[4]||($[4]=I(" 聊天模式： ")),x(f).chat_type=="1"?(s(),v("span",da,"仅知识库")):R("",!0),x(f).chat_type=="2"?(s(),v("span",_a,"直连模式")):R("",!0),x(f).chat_type=="3"?(s(),v("span",ca,"混合模式")):R("",!0)]),x(f).chat_type=="1"?(s(),v(T,{key:0},[e("div",ua,[$[5]||($[5]=I(" QA文档直接回复答案： ")),e("span",null,U(x(f).library_qa_direct_reply_switch=="true"?"开":"关"),1)]),x(f).library_qa_direct_reply_switch=="true"?(s(),v("div",pa,[$[6]||($[6]=I(" 相似度值： ")),e("span",null,U(x(f).library_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0),x(f).chat_type=="3"?(s(),v(T,{key:1},[e("div",ma,[$[7]||($[7]=I(" QA文档直接回复答案： ")),e("span",null,U(x(f).mixture_qa_direct_reply_switch=="true"?"开":"关"),1)]),x(f).mixture_qa_direct_reply_switch=="true"?(s(),v("div",va,[$[8]||($[8]=I(" 相似度值： ")),e("span",null,U(x(f).mixture_qa_direct_reply_score),1)])):R("",!0)],64)):R("",!0)]),e("div",fa,[t(ia,{ref_key:"ChatEditAlertRef",ref:y,onSave:l},null,512)])]),_:1},8,["isEdit"])}}},ha=Q(ba,[["__scopeId","data-v-be544020"]]),ya={class:"switch-box"},ka={class:"switch-box-body"},ga={class:"switch-box-header"},$a={class:"left-box"},xa={class:"switch-box-title"},wa={key:0,class:"title-tip"},qa={class:"right-box"},Sa={class:"extra-box"},Ca={class:"switch-desc"},La={class:"switch-box-right"},Ia={__name:"switch-box",props:{iconName:{type:String,default:""},title:{type:String,default:""},value:{type:Boolean,default:!1}},emits:["update:value","change"],setup(j,{emit:c}){const y=c,f=j,p=w(f.value),n=l=>{y("update:value",l),y("change",l)};return(l,k)=>{const r=de,d=se;return s(),v("div",ya,[e("div",ka,[e("div",ga,[e("div",$a,[t(r,{class:"switch-box-icon",name:f.iconName},null,8,["name"]),e("span",xa,U(f.title),1),l.$slots.tip?(s(),v("span",wa,[ce(l.$slots,"tip",{},void 0,!0)])):R("",!0)]),e("div",qa,[e("div",Sa,[ce(l.$slots,"extra",{},()=>[k[1]||(k[1]=e("div",{class:"extra-box"},null,-1))],!0)])])]),e("div",Ca,[ce(l.$slots,"default",{},void 0,!0)])]),e("div",La,[t(d,{checked:p.value,"onUpdate:checked":k[0]||(k[0]=$=>p.value=$),onChange:n,"checked-children":"开","un-checked-children":"关"},null,8,["checked"])])])}}},Ua=Q(Ia,[["__scopeId","data-v-0548f52d"]]),Ra="/assets/img/empty-Bx9z1cwf.png",Ea="/assets/img/phone-head-CDwwPhYa.png",Oa="/assets/img/phone-body-CbEf8GZP.png",Aa="/assets/img/phone-footer-ClQtNpln.png",ja={class:"common-problem-box"},Ma={class:"left-content-box"},za={key:0,class:"empty-box"},Da={key:1,class:"lists-box"},Pa={class:"drag-btn"},Na={class:"title"},Ta={class:"opration-box"},Va={class:"preview-box"},Ba={class:"phone-body"},Qa={key:0,class:"question-box"},Fa={__name:"common-problem",setup(j){w(!1);const{robotInfo:c,updateRobotInfo:y}=Y("robotInfo"),f=pe(()=>c.common_question_list?JSON.parse(c.common_question_list):[]),p=w([]);p.value=f.value,ue(f,()=>{p.value=f.value});const n=je.useForm,l=w(!1),k=w("添加问题"),r=F({question:"",index:-1}),d=F({question:[{message:"请输入问题名称",required:!0}]}),{resetFields:$,validate:_,validateInfos:u}=n(r,d),o=()=>{if(f.value.length>=10)return K.error("最多设置10条常用问题");l.value=!0,$(),r.question="",r.index=-1},b=(E,a)=>{l.value=!0,$(),r.question=E,r.index=a},q=E=>{let a=[];a=f.value.filter((h,V)=>E!=V),Z.confirm({title:"提醒",icon:t(Ae),content:"确定要删除该问题吗?",okText:"确定",okType:"danger",cancelText:"取消",onOk(){y({common_question_list:JSON.stringify(a)})},onCancel(){}})},C=()=>{_().then(()=>{let E=[];r.index>=0?E=f.value.map((a,h)=>h===r.index?r.question:a):E=[r.question,...f.value],y({common_question_list:JSON.stringify(E)}),l.value=!1})},m=E=>{y({})},L=E=>{y({common_question_list:JSON.stringify(p.value)})};return(E,a)=>{const h=oe,V=se,M=Kt,S=te,O=de,J=_e,P=Ze,H=je,N=Z;return s(),v("div",ja,[e("div",Ma,[t(X,{class:"setting-box",title:"常见问题设置","icon-name":"common-quession"},{icon:i(()=>[t(h,null,{title:i(()=>a[4]||(a[4]=[I("最多10条。开启后，常见问题会显示在每条问答后面")])),default:i(()=>[t(x(ee),{class:"quess-icon"})]),_:1})]),extra:i(()=>[t(V,{onChange:m,class:"switch-item",checkedValue:"true",unCheckedValue:"false",checked:x(c).enable_common_question,"onUpdate:checked":a[0]||(a[0]=z=>x(c).enable_common_question=z),"checked-children":"开","un-checked-children":"关"},null,8,["checked"]),t(M,{type:"vertical"}),t(S,{type:"primary",size:"small",onClick:o},{default:i(()=>a[5]||(a[5]=[I("添加")])),_:1,__:[5]})]),default:i(()=>[f.value.length==0?(s(),v("div",za,[a[7]||(a[7]=e("img",{src:Ra,alt:""},null,-1)),a[8]||(a[8]=e("div",{class:"title"},"暂无数据",-1)),a[9]||(a[9]=e("div",{class:"desc"},"常见问题会显示在每条对话后面,供用户快速提问",-1)),t(S,{onClick:o,type:"primary"},{default:i(()=>a[6]||(a[6]=[I("立即添加")])),_:1,__:[6]})])):(s(),v("div",Da,[t(x(Pe),{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=z=>p.value=z),handle:".drag-btn","item-key":"index",onEnd:L},{item:i(({element:z,index:be})=>[(s(),v("div",{class:"list-item",key:be},[e("span",Pa,[t(O,{name:"drag"})]),e("div",Na,U(z),1),e("div",Ta,[t(x(_t),{onClick:Ee=>b(z,be)},null,8,["onClick"]),t(x(me),{onClick:Ee=>q(be)},null,8,["onClick"])])]))]),_:1},8,["modelValue"])]))]),_:1})]),e("div",Va,[a[12]||(a[12]=e("div",{class:"phone-head"},[e("img",{class:"head-img",src:Ea,alt:""})],-1)),e("div",Ba,[a[11]||(a[11]=e("div",null,[e("img",{class:"body-img",src:Oa,alt:""})],-1)),f.value.length&&x(c).enable_common_question=="true"?(s(),v("div",Qa,[a[10]||(a[10]=e("div",{class:"name"},"常见问题",-1)),(s(!0),v(T,null,G(f.value,z=>(s(),v("div",{class:"list-item",key:z},U(z),1))),128))])):R("",!0)]),a[13]||(a[13]=e("div",{class:"phone-footer"},[e("img",{class:"footer-img",src:Aa,alt:""})],-1))]),t(N,{open:l.value,"onUpdate:open":a[3]||(a[3]=z=>l.value=z),title:k.value,onOk:C,width:"476px"},{default:i(()=>[t(H,{class:"form-box",layout:"vertical"},{default:i(()=>[t(P,yt({label:"问题名称"},x(u).question),{default:i(()=>[t(J,{maxLength:100,value:r.question,"onUpdate:value":a[2]||(a[2]=z=>r.question=z),placeholder:"请输入问题"},null,8,["value"])]),_:1},16)]),_:1})]),_:1},8,["open","title"])])}}},Ja=Q(Fa,[["__scopeId","data-v-dce83f0d"]]),Ga={__name:"display-aitations",setup(j){const{robotInfo:c,updateRobotInfo:y}=Y("robotInfo"),f=w(!1);ue(()=>c.answer_source_switch,n=>{f.value=n=="true"},{immediate:!0});const p=()=>{y({answer_source_switch:f.value?"true":"false"})};return(n,l)=>(s(),D(Ua,{title:"显示引文","icon-name":"jibenpeizhi",value:f.value,"onUpdate:value":l[0]||(l[0]=k=>f.value=k),onChange:p},{extra:i(()=>l[1]||(l[1]=[e("span",null,null,-1)])),default:i(()=>[l[2]||(l[2]=e("div",null,"开启后，机器人回答时，在回答后面显示引用的知识库文档",-1))]),_:1,__:[2]},8,["value"]))}},Ha={__name:"show-like",setup(j){const{robotInfo:c,updateRobotInfo:y}=Y("robotInfo"),f=p=>{y({})};return(p,n)=>{const l=se;return s(),D(X,{class:"setting-box",title:"显示点赞/点踩","icon-name":"like-icon"},{extra:i(()=>n[1]||(n[1]=[e("span",null,null,-1)])),default:i(()=>[n[2]||(n[2]=e("div",{class:"robot-info-box"},[e("div",{class:"robot-prompt"},"开启后，允许用户对机器人回答结果进行点赞点踩反馈")],-1)),t(l,{onChange:f,class:"switch-item",checkedValue:1,unCheckedValue:0,checked:x(c).feedback_switch,"onUpdate:checked":n[0]||(n[0]=k=>x(c).feedback_switch=k),"checked-children":"开","un-checked-children":"关"},null,8,["checked"])]),_:1,__:[2]})}}},Ka=Q(Ha,[["__scopeId","data-v-73894b10"]]),Wa={class:"content-box"},Za={key:0,class:"add-btn-block"},Ya={class:"list-content"},Xa={key:0,class:"user-block"},er={class:"name-box"},tr={class:"name"},or={class:"remark-text"},sr={key:0,class:"hover-btn-box"},nr={key:0},ir={key:1},lr={key:2},ar={key:1,class:"hover-btn-box"},rr={class:"role-menu-box"},dr=["onClick"],_r={class:"menu-header"},cr={key:0,class:"check-box"},ur=["onClick"],pr={class:"menu-header"},mr={key:0,class:"check-box"},vr=["onClick"],fr={class:"menu-header"},br={key:0,class:"check-box"},hr={class:"hover-btn-box"},yr={key:0},kr={key:1},gr={key:2},$r=["onClick"],xr={__name:"role-permission",setup(j){const c=Ut(),y=pe(()=>c.user_name),f=Je().query,p=w(Rt(f.id)),n=w([]),l=F({object_id:f.id,object_type:1}),k=()=>{Zt({...l}).then(o=>{let b=o.data||[];n.value=b})};k();const r=w(null),d=()=>{r.value.show(n.value,[{object_id:+f.id,object_type:1,operate_rights:4}])},$=(o,b)=>{let q=b==4?"管理":b==2?"编辑":"查看";Z.confirm({title:"提示?",icon:t(Ae),content:"确认修改该协作者权限为【"+q+"】",okText:"确认",cancelText:"取消",onOk:()=>{let C=[{object_id:+o.object_id,object_type:+o.object_type,operate_rights:+b}];Yt({identity_ids:o.identity_id,identity_type:o.identity_type,object_array:JSON.stringify(C)}).then(m=>{K.success("修改成功"),k()})},onCancel(){}})},_=o=>{Z.confirm({title:"提示?",icon:t(Ae),content:"确认删除该条数据",okText:"确认",okType:"danger",cancelText:"取消",onOk:()=>{Xt({identity_id:o.identity_id,identity_type:o.identity_type,object_id:o.object_id,object_type:o.object_type}).then(b=>{K.success("删除成功"),k()})},onCancel(){}})},u=w([{title:"姓名",dataIndex:"name",key:"name"},{title:"权限",dataIndex:"operate_rights",key:"operate_rights"},{title:"操作",dataIndex:"action",key:"action",width:80}]);return(o,b)=>{const q=te,C=to,m=so,L=no,E=Me;return s(),D(E,null,{default:i(()=>[e("div",Wa,[p.value==4?(s(),v("div",Za,[t(q,{type:"primary",onClick:d,icon:Ge(x(Ue))},{default:i(()=>b[0]||(b[0]=[I("添加协助者")])),_:1,__:[0]},8,["icon"])])):R("",!0),e("div",Ya,[t(L,{columns:u.value,"data-source":n.value,pagination:!1},{bodyCell:i(({column:a,record:h})=>[a.key==="name"?(s(),v("div",Xa,[t(C,{shape:"square",src:h.avatar,size:40},{icon:i(()=>[h.avatar?R("",!0):(s(),D(x(Qe),{key:0}))]),_:2},1032,["src"]),e("div",er,[e("div",tr,U(h.user_name),1),e("div",or,U(h.name),1)])])):R("",!0),a.key==="operate_rights"?(s(),v(T,{key:1},[p.value==2||h.user_name==y.value?(s(),v("div",sr,[h.operate_rights==4?(s(),v("span",nr,"管理")):R("",!0),h.operate_rights==2?(s(),v("span",ir,"编辑")):R("",!0),h.operate_rights==1?(s(),v("span",lr,"查看")):R("",!0)])):h.role_type==1||h.is_creator==1?(s(),v("div",ar,"管理")):(s(),D(m,{key:2,placement:"bottomRight",title:null,overlayInnerStyle:{padding:"2px"}},{content:i(()=>[e("div",rr,[e("div",{class:"role-menu",onClick:V=>$(h,4)},[e("div",_r,[t(x(Qe)),b[1]||(b[1]=e("span",{class:"title"},"管理",-1))]),b[2]||(b[2]=e("div",{class:"desc"},"可编辑，可删除，可查看",-1)),h.operate_rights==4?(s(),v("div",cr,[t(x(Oe))])):R("",!0)],8,dr),e("div",{class:"role-menu",onClick:V=>$(h,2)},[e("div",pr,[t(x(_t)),b[3]||(b[3]=e("span",{class:"title"},"编辑",-1))]),b[4]||(b[4]=e("div",{class:"desc"},"可编辑，可查看",-1)),h.operate_rights==2?(s(),v("div",mr,[t(x(Oe))])):R("",!0)],8,ur),e("div",{class:"role-menu",onClick:V=>$(h,1)},[e("div",fr,[t(x(oo)),b[5]||(b[5]=e("span",{class:"title"},"查看",-1))]),b[6]||(b[6]=e("div",{class:"desc"},"仅查看",-1)),h.operate_rights==1?(s(),v("div",br,[t(x(Oe))])):R("",!0)],8,vr)])]),default:i(()=>[e("div",hr,[h.operate_rights==4?(s(),v("span",yr,"管理")):R("",!0),h.operate_rights==2?(s(),v("span",kr,"编辑")):R("",!0),h.operate_rights==1?(s(),v("span",gr,"查看")):R("",!0),t(x(ot))])]),_:2},1024))],64)):R("",!0),a.key==="action"?(s(),v(T,{key:2},[p.value==4&&h.user_name!=y.value?(s(),v(T,{key:0},[h.role_type!=1&&h.is_creator!=1?(s(),v("a",{key:0,onClick:V=>_(h)},"移除",8,$r)):R("",!0)],64)):R("",!0)],64)):R("",!0)]),_:1},8,["columns","data-source"])])]),t(eo,{onOk:k,ref_key:"addCollaboratorRef",ref:r},null,512)]),_:1})}}},wr=Q(xr,[["__scopeId","data-v-64f2a2fa"]]),qr={class:"library-checkbox-box"},Sr={class:"list-box",ref:"scrollContainer"},Cr={class:"library-name"},Lr={key:0,class:"library-desc"},Ir={class:"library-desc"},Ur={key:0,class:"empty-box"},Rr={__name:"robot-select-alert",emits:["change"],setup(j,{expose:c,emit:y}){const f=y,p=F({indeterminate:!1,checkAll:!1,checkedList:[]}),n=w(!1),l=u=>{$(),p.checkedList=u,n.value=!0},k=()=>{n.value=!1,d()};w("");const r=w([]),d=()=>{f("change",[...p.checkedList])},$=async()=>{const u=await We({application_type:1});if(u){let o=u.data||[];r.value=o}},_=w(!1);return c({open:l}),(u,o)=>{const b=De,q=ze,C=Ie,m=Z;return s(),D(m,{width:"746px",open:n.value,"onUpdate:open":o[1]||(o[1]=L=>n.value=L),title:"添加技能",onOk:k},{default:i(()=>[e("div",qr,[t(C,{spinning:_.value,delay:100},{default:i(()=>[t(q,{value:p.checkedList,"onUpdate:value":o[0]||(o[0]=L=>p.checkedList=L),style:{width:"100%"}},{default:i(()=>[e("div",Sr,[(s(!0),v(T,null,G(r.value,L=>(s(),v("div",{class:"list-item-wraapper",key:L.id},[t(b,{class:"list-item",disabled:L.start_node_key==="",value:L.id},{default:i(()=>[e("div",Cr,[I(U(L.robot_name)+" ",1),L.start_node_key===""?(s(),v("span",Lr," (未发布)")):R("",!0)]),e("div",Ir,U(L.robot_intro),1)]),_:2},1032,["disabled","value"])]))),128))],512)]),_:1},8,["value"])]),_:1},8,["spinning"]),!_.value&&!r.value.length?(s(),v("div",Ur,o[2]||(o[2]=[e("img",{src:at,alt:""},null,-1),e("div",null,"暂无数据表, 请先去添加数据表",-1)]))):R("",!0)])]),_:1},8,["open"])}}},Er=Q(Rr,[["__scopeId","data-v-99f68955"]]),Or={class:"actions-box"},Ar={key:0,class:"library-list"},jr=["onClick"],Mr={class:"library-name"},zr={class:"library-intro"},Dr={__name:"index",props:{robotList:{type:Array,default:()=>[]}},setup(j){const c=w(!1),{robotInfo:y,getRobot:f}=Y("robotInfo"),p=j,n=F({work_flow_ids:[]}),l=w(null),k=pe(()=>p.robotList.filter(u=>n.work_flow_ids.includes(u.id))),r=u=>{let o=n.work_flow_ids.indexOf(u.id);n.work_flow_ids.splice(o,1),_()},d=u=>{n.work_flow_ids=[...u],_()},$=()=>{l.value.open([...n.work_flow_ids])},_=()=>{let u={...W(n)};u.work_flow_ids=u.work_flow_ids.join(","),At({id:y.id,...u}).then(o=>{K.success("保存成功"),f(y.id)})};return Le(()=>{n.work_flow_ids=y.work_flow_ids.split(",")}),(u,o)=>{const b=oe,q=te,C=ge;return s(),D(X,{class:"setting-box",title:"技能","icon-name":"skii",isEdit:c.value,"onUpdate:isEdit":o[0]||(o[0]=m=>c.value=m),bodyStyle:{padding:0}},{tip:i(()=>[t(b,{placement:"top"},{title:i(()=>o[1]||(o[1]=[e("span",null,"支持关联工作流",-1)])),default:i(()=>[t(x(ee))]),_:1})]),extra:i(()=>[e("div",Or,[t(C,{gap:8},{default:i(()=>[t(q,{size:"small",onClick:$},{default:i(()=>o[2]||(o[2]=[I("添加技能")])),_:1,__:[2]})]),_:1})])]),default:i(()=>[k.value.length>0?(s(),v("div",Ar,[(s(!0),v(T,null,G(k.value,m=>(s(),v("div",{class:"library-item",key:m.id},[e("span",{class:"close-btn",onClick:L=>r(m)},[t(x(me))],8,jr),e("div",Mr,U(m.robot_name),1),e("div",zr,U(m.robot_intro),1)]))),128))])):R("",!0),t(Er,{ref_key:"robotSelectAlertRef",ref:l,onChange:d},null,512)]),_:1},8,["isEdit"])}}},Pr=Q(Dr,[["__scopeId","data-v-e0ced8ed"]]),Nr={key:0,class:"robot-config-page"},Tr={class:"setting-box"},Vr={class:"setting-box"},Br={class:"setting-box"},Qr={class:"setting-box"},Fr={class:"setting-box"},Jr={class:"setting-box"},Gr={class:"setting-box"},Hr={class:"setting-box"},Kr={class:"setting-box"},Wr={class:"setting-box"},Zr={class:"setting-box"},Yr={class:"setting-box"},Xr={class:"setting-box"},ed={class:"setting-box"},td={key:1,class:"robot-config-page"},od={key:2,class:"robot-config-page"},sd={__name:"index",setup(j){const c=Wt(),y=w(null),{robotInfo:f}=kt(c),{getRobot:p}=c,n=()=>{y.value.scrollTop=y.value.scrollHeight},l=w(1),k=w(!1),r=F(f.value),d=o=>{let b=JSON.parse(JSON.stringify(o));o.robot_avatar&&(b.robot_avatar=new File([o.robot_avatar],o.robot_avatar.name)),Object.assign(r,b),u()},$=w([]);(()=>{We({application_type:1}).then(o=>{$.value=o.data||[]})})(),gt("robotInfo",{robotInfo:r,updateRobotInfo:d,scrollBoxToBottom:n,getRobot:p});const u=()=>{let o;r.robot_avatar&&(o=new File([r.robot_avatar],r.robot_avatar.name));let b=JSON.parse(JSON.stringify(W(r)));o&&(b.robot_avatar=o);let q=b.welcomes;q.question=q.question.map(m=>m.content),b.welcomes=JSON.stringify(q),b.prompt_struct=JSON.stringify(b.prompt_struct);let C=b.unknown_question_prompt;C.question=C.question.map(m=>m.content),b.unknown_question_prompt=JSON.stringify(C),delete b.robot_avatar_url,k.value=!0,jt(b).then(m=>{if(m.res!=0)return K.error(m.msg);k.value=!1,K.success("保存成功"),p(r.id)}).catch(()=>{k.value=!1})};return(o,b)=>{const q=et,C=tt;return s(),v(T,null,[t(C,{class:"tab-wrapper",activeKey:l.value,"onUpdate:activeKey":b[0]||(b[0]=m=>l.value=m)},{default:i(()=>[(s(),D(q,{key:1,tab:"基础配置"})),(s(),D(q,{key:3,tab:"权限管理"})),(s(),D(q,{key:2,tab:"常见问题"}))]),_:1},8,["activeKey"]),l.value==1?(s(),v("div",Nr,[e("div",{class:"scroll-box",ref_key:"scrollBox",ref:y},[e("div",Tr,[t(Ro)]),e("div",Vr,[t(tl)]),e("div",Br,[t(Bn)]),e("div",Qr,[t(ha)]),e("div",Fr,[t(rn,{robotList:$.value},null,8,["robotList"])]),e("div",Jr,[t(Pr,{robotList:$.value},null,8,["robotList"])]),e("div",Gr,[t(vl)]),e("div",Hr,[t(Sl)]),e("div",Kr,[t(zl)]),e("div",Wr,[t(Wl)]),e("div",Zr,[t(Ql)]),e("div",Yr,[t(Hl)]),e("div",Xr,[t(Ga)]),e("div",ed,[t(Ka)])],512)])):R("",!0),l.value==2?(s(),v("div",td,[t(Ja)])):R("",!0),l.value==3?(s(),v("div",od,[t(wr)])):R("",!0)],64)}}},E_=Q(sd,[["__scopeId","data-v-b61909e4"]]);export{E_ as default};
